import{R as b,T as _,U as d,V as g}from"./i18n-CLA-aXfX.js";import{E as L,Z as U,J as V,_ as W,X,W as Y,I as Z,a0 as $,D as q,A as F,Y as G,z as H}from"./i18n-CLA-aXfX.js";import{af as w,i as k,j as E,_ as u}from"./index-zQcUQ9m1.js";import{d as f}from"./utils.svelte-DtXXSlyN.js";const M={walkthrough:"tabs",walkthroughstep:"tabitem"};class B{#r;#e;#s;reactive_formatter=t=>t;#t;client;#i=w();get root(){return k(this.#i)}set root(t){E(this.#i,t,!0)}#o=new Set;#n=new Set;#l=[];#a=new Map;#p=new Map;component_ids;initial_tabs={};components_to_register=new Set;ready;ready_resolve;resolved=!1;constructor(t,s,i,o,r,a){this.ready=new Promise(p=>{this.ready_resolve=p}),this.reactive_formatter=a,this.#t=o,this.#r=t,this.#e=s,this.#s=i,this.root=this.create_node({id:s.id,children:[]},new Map,!0);for(const p of t)p.props.visible!=!1&&this.components_to_register.add(p.id);this.client=r,this.prepare();const n=t.reduce((p,l)=>(p.set(l.id,l),p),new Map);this.root.children=this.#e.children.map(p=>this.traverse(p,l=>this.create_node(l,n,!1,this.reactive_formatter))),this.component_ids=t.map(p=>p.id),this.initial_tabs={},m(this.root,this.initial_tabs),this.postprocess(this.root)}reload(t,s,i,o){this.#e=s,this.#r=t,this.#t=o,this.#s=i,this.root=this.create_node({id:s.id,children:[]},new Map,!0);for(const a of t)a.props.visible!=!1&&this.components_to_register.add(a.id);this.prepare();const r=t.reduce((a,n)=>(a.set(n.id,n),a),new Map);this.root.children=this.#e.children.map(a=>this.traverse(a,n=>this.create_node(n,r,!1,this.reactive_formatter))),this.component_ids=t.map(a=>a.id),this.initial_tabs={},m(this.root,this.initial_tabs),this.postprocess(this.root)}register_component(t,s,i){this.#p.set(t,s),this.#a.set(t,i),this.components_to_register.delete(t),this.components_to_register.size===0&&!this.resolved&&(this.resolved=!0,this.ready_resolve())}prepare(){const[t,s]=b(this.#s);this.#o=t,this.#n=s}process(){}postprocess(t){this.root=this.traverse(t,[s=>c(s,this.#t.root),s=>S(s,this.#t.root,this.components_to_register),s=>z(s,this.#t.root,this.components_to_register),s=>D(s,this.#t.root),s=>I(s,this.#t.root,this.initial_tabs),s=>this.find_attached_events(s,this.#s)])}find_attached_events(t,s){const i=s.filter(o=>o.targets.find(([r])=>r===t.id)).map(o=>{const r=o.targets.find(([a])=>a===t.id);return r?r[1]:null}).filter(Boolean);return t.props.shared_props.attached_events=i,t}traverse(t,s){function i(o,r,a){const n=r(o);return"children"in o&&o.children.length>0&&(n.children=o.children?.map(p=>a(p,r))||[]),n}if(Array.isArray(s)){let o=t;for(const r of s)o=i(o,r,this.traverse.bind(this));return o}else return i(t,s,this.traverse.bind(this))}create_node(t,s,i=!1,o){let r;if(i?r={type:"column",id:t.id,props:{visible:!0,root:"",theme_mode:"light"},component_class_id:"column",key:null}:r=s.get(t.id),!r)throw new Error(`Component with ID ${t.id} not found`);o&&(r.props.i18n=o);const a=j(t.id,r.props,[this.#o,this.#n],this.client,{...this.#t}),n=M[r.type]||r.type;return{id:t.id,type:n,props:a,children:[],show_progress_on:null,component_class_id:r.component_class_id||r.type,component:a.shared_props.visible!==!1?_(r.type,r.component_class_id,this.#t.root||""):null,key:r.key,rendered_in:r.rendered_in,documentation:r.documentation}}rerender(t,s){const i=t.reduce((a,n)=>(a.set(n.id,n),a),new Map),o=this.traverse(s,a=>this.create_node(a,i,!1,this.reactive_formatter)),r=h(this.root,o.id);if(!r)throw new Error("Rerender failed: root node not found in current tree");r.children=o.children}async update_state(t,s,i=!0){const o=h(this.root,t);let r=!1;i&&!o?.component&&(await u(),this.root=this.traverse(this.root,[n=>x(n,t,s.visible),n=>c(n,this.#t.root)]),r=!0);const a=this.#p.get(t);a&&(a(s),!(!i||r)&&(await u(),this.root=this.traverse(this.root,n=>c(n,this.#t.root))))}async get_state(t){const s=this.#a.get(t),i=this.#r.find(o=>o.id===t);return!s&&!i?null:s?await s():i?Promise.resolve({value:i.props.value}):null}}function A(e,t,s){return t?t.reduce((i,o)=>(i[o]=async(...r)=>(r.length===1&&(r=r[0]),await s.component_server(e,o,r)),i),{}):{}}function j(e,t,s,i,o={}){const r={},a={};for(const n in t)if(n==="id"||n==="autoscroll")a[n]=t[n];else if(f.includes(n)){const p=n;r[p]=t[n],p==="server_fns"&&(r.server=A(e,t.server_fns,i))}else a[n]=t[n];for(const n in o)if(f.includes(n)){const p=n;r[p]=o[n]}else a[n]=o[n];return r.client=i,r.id=e,r.interactive=g(e,r.interactive,a.value,s),r.load_component=(n,p)=>_(n,"",r.root||"",p),r.visible=r.visible===void 0?!0:r.visible,r.loading_status={},{shared_props:r,props:a}}function c(e,t){if(e.props.shared_props.visible&&!e.component){const s={...e,component:_(e.type,e.component_class_id,t),children:[]};return e.children&&(s.children=e.children.map(i=>c(i,t))),s}else return e}function x(e,t,s){return e.id==t&&(e.props.shared_props.visible=s),e}function v(e,t){t.delete(e.id),e.children&&e.children.forEach(s=>v(s,t))}function S(e,t,s){return e.props.shared_props.visible!==!0&&v(e,s),e}function z(e,t,s){return e.type==="form"&&e.children.every(o=>o.props.shared_props.visible===!1)&&(e.props.shared_props.visible=!1,s.delete(e.id)),e}function D(e,t){const s=["description","info","title","placeholder","value","label"];for(const i of Object.keys(e.props.shared_props))s.includes(i)&&(e.props.shared_props[i]=d(e.props.shared_props[i]));for(const i of Object.keys(e.props.props))s.includes(i)&&(e.props.props[i]=d(e.props.props[i]));return e}function I(e,t,s){if(e.type==="tabs"&&e.id in s){const i=s[e.id].sort((o,r)=>o.order-r.order);e.props.props.initial_tabs=i}return e}function y(e,t,s,i){s!==null&&e.type==="tabitem"&&(s in t||(t[s]=[]),"id"in e.props.props||(e.props.props.id=e.id),t[s].push({label:e.props.shared_props.label,id:e.props.props.id,elem_id:e.props.shared_props.elem_id,visible:e.props.shared_props.visible,interactive:e.props.shared_props.interactive,scale:e.props.shared_props.scale||null}),e.props.props.order=i),e.children&&e.children.forEach((o,r)=>{y(o,t,e.type==="tabs"?e.id:null,e.type==="tabs"?r:null)})}function m(e,t){function s(i){"children"in i&&i.children.length>0&&i.children?.forEach(o=>y(o,t,i.type==="tabs"?i.id:null,null))}return s(e)}function h(e,t){if(e.id===t)return e;if(e.children)for(const s of e.children){const i=h(s,t);if(i)return i}return null}export{B as AppTree,L as Embed,U as all_common_keys,V as changeLocale,W as get_initial_locale,X as i18n_marker,Y as is_translation_metadata,Z as language_choices,$ as load_translations,q as mount_css,F as prefix_css,G as process_langs,H as setupi18n,d as translate_if_needed};
