const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./browserAll-CX75A6VW.js","./webworkerAll-DdWDpZXi.js","./colorToUniform-BXaCBwVl.js","./i18n-CLA-aXfX.js","./index-zQcUQ9m1.js","./index-CqMwg91u.css","./i18n-Bf8vNdKW.css","./misc-snWqx6W0.js","./utils.svelte-DtXXSlyN.js","./ImagePreview-DsWqY--s.js","./MarkdownCode.svelte_svelte_type_style_lang-C7vd_kT1.js","./prism-python-D43YKUi0.js","./MarkdownCode-Di_MGSyc.css","./BlockLabel-BmXTkHTt.js","./IconButtonWrapper-DVQ8sIMc.css","./DownloadLink-DaQ_7WnR.js","./IconButton-B7IBJBO5.js","./svelte-component-BXBUmXeM.js","./Empty-BZ_-KNsK.js","./ShareButton-_eP1IUQf.js","./Download-X4TzKHZY.js","./Image-D4Pb0B7j.js","./IconButtonWrapper-dc02OfMv.js","./FullscreenButton-DgZ1jO8K.js","./Maximize-DZCF9YaH.js","./Image-4Q0YgCzk.js","./Image-Da_XA0w6.css","./ImagePreview-CCVfwC4m.css","./Block-DgGHn7bv.js","./index-CDsfLiji.js","./Clear-G_Bw7Svf.js","./StreamingBar-K0YZHDYh.css","./props-CKo_ykv6.js","./actions-C-VE6FDE.js","./Webcam-DGGmPfVE.js","./index-B7oLUUy4.js","./DropdownArrow-DvXZK-yN.js","./Square-Lg2xePrl.js","./Spinner-9vNbv65E.js","./StreamingBar-qOcZaUMs.js","./ImageUploader-Dpdel1G9.css","./ImagePaste-DZGLPUuh.js","./Upload-C3qqF65G.js","./window-D9mIs-QY.js","./tinycolor-Byo6XIcx.js","./Plus-Dehty5RW.js","./input-D71CySwn.js","./Check-D17sy-za.js","./utils-BsTlurbm.js","./event-modifiers-CdEA5IGF.js","./ArrowUp-C3gqDIL5.js","./Trash-CmOh7Hqs.js","./Undo-B0i5SYxj.js","./Upload-C2I0h_eD.css","./Example-CZSJmqDf.css","./WebGPURenderer-DhLjFybS.js","./SharedSystems-Yj1GZqaR.js","./WebGLRenderer-BFODkE0d.js"])))=>i.map(i=>d[i]);
import{x as ai,p as I,d as ve,i as Q,b as Ne,a as re,c as ze,F as Do,e as Qe,t as Fi,u as Bi,r as No,v as Rh,k as Ue,q as Fh,m as Bh,s as Lh,f as Oh,g as yn}from"./i18n-CLA-aXfX.js";import{n as ne,b as H,p as ue,l as yt,j as U,m as Z,d as X,a as Le,f as nt,h as it,s as $,r as tt,t as Wt,i as m,e as Vt,c as de,g as z,k as Fe,aj as fs,ac as Uo,aD as xn,U as qt,Q as Rt,_ as xr,R as Oe,V as Gt,a9 as _e,aA as Wo,X as ci,aB as Ls,af as Gh,aC as Os}from"./index-zQcUQ9m1.js";import{b as he}from"./misc-snWqx6W0.js";import{G as Dh}from"./utils.svelte-DtXXSlyN.js";import{I as Nh}from"./ImagePreview-DsWqY--s.js";import{B as bn}from"./Block-DgGHn7bv.js";import"./MarkdownCode.svelte_svelte_type_style_lang-C7vd_kT1.js";/* empty css                                                        */import{s as Gs,S as vn}from"./index-CDsfLiji.js";/* empty css                                                   *//* empty css                                                    *//* empty css                                             *//* empty css                                            *//* empty css                                              */import{b as si}from"./props-CKo_ykv6.js";import{a as ks}from"./actions-C-VE6FDE.js";import{C as wn,W as Uh}from"./Webcam-DGGmPfVE.js";import{I as Ho}from"./Image-D4Pb0B7j.js";import{I as Wh}from"./ImagePaste-DZGLPUuh.js";import{U as Hh}from"./Upload-C3qqF65G.js";import{W as Vh}from"./Spinner-9vNbv65E.js";import{b as kn}from"./window-D9mIs-QY.js";import{t as le,E as Xh}from"./tinycolor-Byo6XIcx.js";import{P as Vo}from"./Plus-Dehty5RW.js";import{b as Yh}from"./input-D71CySwn.js";import{C as Xo}from"./Check-D17sy-za.js";/* empty css                                                   */import{c as $h}from"./utils-BsTlurbm.js";import{s as ps}from"./event-modifiers-CdEA5IGF.js";import{A as qh}from"./ArrowUp-C3gqDIL5.js";import{C as jh}from"./Clear-G_Bw7Svf.js";import{I as ie}from"./IconButton-B7IBJBO5.js";import{D as Kh}from"./Download-X4TzKHZY.js";import{T as Zh}from"./Trash-CmOh7Hqs.js";import{U as Qh}from"./Undo-B0i5SYxj.js";import{I as Jh}from"./IconButtonWrapper-dc02OfMv.js";import{B as tl}from"./BlockLabel-BmXTkHTt.js";var el=ne('<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>');function il(s){var t=el();H(s,t)}var sl=ne('<svg width="100%" height="100%" viewBox="0 0 32 32"><path d="M28.828 3.172a4.094 4.094 0 0 0-5.656 0L4.05 22.292A6.954 6.954 0 0 0 2 27.242V30h2.756a6.952 6.952 0 0 0 4.95-2.05L28.828 8.829a3.999 3.999 0 0 0 0-5.657zM10.91 18.26l2.829 2.829l-2.122 2.121l-2.828-2.828zm-2.619 8.276A4.966 4.966 0 0 1 4.756 28H4v-.759a4.967 4.967 0 0 1 1.464-3.535l1.91-1.91l2.829 2.828zM27.415 7.414l-12.261 12.26l-2.829-2.828l12.262-12.26a2.047 2.047 0 0 1 2.828 0a2 2 0 0 1 0 2.828z" fill="currentColor"></path><path d="M6.5 15a3.5 3.5 0 0 1-2.475-5.974l3.5-3.5a1.502 1.502 0 0 0 0-2.121a1.537 1.537 0 0 0-2.121 0L3.415 5.394L2 3.98l1.99-1.988a3.585 3.585 0 0 1 4.95 0a3.504 3.504 0 0 1 0 4.949L5.439 10.44a1.502 1.502 0 0 0 0 2.121a1.537 1.537 0 0 0 2.122 0l4.024-4.024L13 9.95l-4.025 4.024A3.475 3.475 0 0 1 6.5 15z" fill="currentColor"></path></svg>');function rl(s){var t=sl();H(s,t)}var nl=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M2.753 2.933a.75.75 0 0 1 .814-.68l3.043.272c2.157.205 4.224.452 5.922.732c1.66.273 3.073.594 3.844.983c.197.1.412.233.578.415c.176.192.352.506.28.9c-.067.356-.304.59-.487.729a3.001 3.001 0 0 1-.695.369c-1.02.404-2.952.79-5.984 1.169c-1.442.18-2.489.357-3.214.522c.205.045.43.089.674.132c.992.174 2.241.323 3.568.437a31.21 31.21 0 0 1 3.016.398c.46.087.893.186 1.261.296c.352.105.707.236.971.412c.13.086.304.225.42.437a.988.988 0 0 1 .063.141A1.75 1.75 0 0 0 14.5 12.25v.158c-.758.154-1.743.302-2.986.444c-2.124.243-3.409.55-4.117.859c-.296.128-.442.236-.508.3c.026.037.073.094.156.17c.15.138.369.29.65.45c.56.316 1.282.61 1.979.838l2.637.814a.75.75 0 1 1-.443 1.433l-2.655-.819c-.754-.247-1.58-.578-2.257-.96a5.082 5.082 0 0 1-.924-.65c-.255-.233-.513-.544-.62-.935c-.12-.441-.016-.88.274-1.244c.261-.328.656-.574 1.113-.773c.92-.4 2.387-.727 4.545-.974c1.366-.156 2.354-.313 3.041-.462a16.007 16.007 0 0 0-.552-.114a29.716 29.716 0 0 0-2.865-.378c-1.352-.116-2.649-.27-3.7-.454c-.524-.092-1-.194-1.395-.307c-.376-.106-.75-.241-1.021-.426a1.186 1.186 0 0 1-.43-.49a.934.934 0 0 1 .059-.873c.13-.213.32-.352.472-.442a3.23 3.23 0 0 1 .559-.251c.807-.287 2.222-.562 4.37-.83c2.695-.338 4.377-.666 5.295-.962c-.638-.21-1.623-.427-2.89-.635c-1.65-.273-3.679-.515-5.816-.718l-3.038-.272a.75.75 0 0 1-.68-.814M17 12.25a.75.75 0 0 0-1.5 0v4.19l-.72-.72a.75.75 0 1 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l2-2a.75.75 0 1 0-1.06-1.06l-.72.72z"></path></svg>');function ol(s){var t=nl();H(s,t)}var al=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22q-2.05 0-3.875-.788t-3.187-2.15t-2.15-3.187T2 12q0-2.075.813-3.9t2.2-3.175T8.25 2.788T12.2 2q2 0 3.775.688t3.113 1.9t2.125 2.875T22 11.05q0 2.875-1.75 4.413T16 17h-1.85q-.225 0-.312.125t-.088.275q0 .3.375.863t.375 1.287q0 1.25-.687 1.85T12 22m-5.5-9q.65 0 1.075-.425T8 11.5t-.425-1.075T6.5 10t-1.075.425T5 11.5t.425 1.075T6.5 13m3-4q.65 0 1.075-.425T11 7.5t-.425-1.075T9.5 6t-1.075.425T8 7.5t.425 1.075T9.5 9m5 0q.65 0 1.075-.425T16 7.5t-.425-1.075T14.5 6t-1.075.425T13 7.5t.425 1.075T14.5 9m3 4q.65 0 1.075-.425T19 11.5t-.425-1.075T17.5 10t-1.075.425T16 11.5t.425 1.075T17.5 13"></path></svg>');function hl(s){var t=al();H(s,t)}var ll=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 256 256"><path fill="currentColor" d="M240 192a8 8 0 0 1-8 8h-32v32a8 8 0 0 1-16 0v-32H64a8 8 0 0 1-8-8V72H24a8 8 0 0 1 0-16h32V24a8 8 0 0 1 16 0v160h160a8 8 0 0 1 8 8M96 72h88v88a8 8 0 0 0 16 0V64a8 8 0 0 0-8-8H96a8 8 0 0 0 0 16"></path></svg>');function cl(s){var t=ll();H(s,t)}var ul=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24"><g fill="none"><path fill="currentColor" d="m5.505 11.41l.53.53l-.53-.53ZM3 14.952h-.75H3ZM9.048 21v.75V21ZM11.41 5.505l-.53-.53l.53.53Zm1.831 12.34a.75.75 0 0 0 1.06-1.061l-1.06 1.06ZM7.216 9.697a.75.75 0 1 0-1.06 1.061l1.06-1.06Zm10.749 2.362l-5.905 5.905l1.06 1.06l5.905-5.904l-1.06-1.06Zm-11.93-.12l5.905-5.905l-1.06-1.06l-5.905 5.904l1.06 1.06Zm0 6.025c-.85-.85-1.433-1.436-1.812-1.933c-.367-.481-.473-.79-.473-1.08h-1.5c0 .749.312 1.375.78 1.99c.455.596 1.125 1.263 1.945 2.083l1.06-1.06Zm-1.06-7.086c-.82.82-1.49 1.488-1.945 2.084c-.468.614-.78 1.24-.78 1.99h1.5c0-.29.106-.6.473-1.08c.38-.498.962-1.083 1.812-1.933l-1.06-1.06Zm7.085 7.086c-.85.85-1.435 1.433-1.933 1.813c-.48.366-.79.472-1.08.472v1.5c.75 0 1.376-.312 1.99-.78c.596-.455 1.264-1.125 2.084-1.945l-1.06-1.06Zm-7.085 1.06c.82.82 1.487 1.49 2.084 1.945c.614.468 1.24.78 1.989.78v-1.5c-.29 0-.599-.106-1.08-.473c-.497-.38-1.083-.962-1.933-1.812l-1.06 1.06Zm12.99-12.99c.85.85 1.433 1.436 1.813 1.933c.366.481.472.79.472 1.08h1.5c0-.749-.312-1.375-.78-1.99c-.455-.596-1.125-1.263-1.945-2.083l-1.06 1.06Zm1.06 7.086c.82-.82 1.49-1.488 1.945-2.084c.468-.614.78-1.24.78-1.99h-1.5c0 .29-.106.6-.473 1.08c-.38.498-.962 1.083-1.812 1.933l1.06 1.06Zm0-8.146c-.82-.82-1.487-1.49-2.084-1.945c-.614-.468-1.24-.78-1.989-.78v1.5c.29 0 .599.106 1.08.473c.497.38 1.083.962 1.933 1.812l1.06-1.06Zm-7.085 1.06c.85-.85 1.435-1.433 1.933-1.812c.48-.367.79-.473 1.08-.473v-1.5c-.75 0-1.376.312-1.99.78c-.596.455-1.264 1.125-2.084 1.945l1.06 1.06Zm2.362 10.749L7.216 9.698l-1.06 1.061l7.085 7.085l1.06-1.06Z"></path><path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M9 21h12"></path></g></svg>');function dl(s){var t=ul();H(s,t)}var _l=ne('<svg width="100%" height="100%" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.35327 10.9495L6.77663 15.158C7.12221 15.4229 7.50051 15.5553 7.91154 15.5553C8.32258 15.5553 8.70126 15.4229 9.0476 15.158L14.471 10.9495" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path><path d="M7.23461 11.4324C7.23406 11.432 7.2335 11.4316 7.23295 11.4312L1.81496 7.2268C1.81471 7.22661 1.81446 7.22641 1.8142 7.22621C1.52269 6.99826 1.39429 6.73321 1.39429 6.37014C1.39429 6.00782 1.52236 5.74301 1.81325 5.51507C1.8136 5.5148 1.81394 5.51453 1.81428 5.51426L7.2331 1.30812C7.45645 1.13785 7.67632 1.06653 7.91159 1.06653C8.14692 1.06653 8.36622 1.13787 8.58861 1.30787C8.58915 1.30828 8.58969 1.30869 8.59023 1.30911L14.0082 5.51462C14.0085 5.51485 14.0088 5.51507 14.0091 5.51529C14.3008 5.74345 14.4289 6.00823 14.4289 6.37014C14.4289 6.73356 14.3006 6.99862 14.01 7.22634C14.0096 7.22662 14.0093 7.22689 14.0089 7.22717L8.59007 11.4322C8.36672 11.6024 8.14686 11.6738 7.91159 11.6738C7.67628 11.6738 7.45699 11.6024 7.23461 11.4324Z" stroke="currentColor" stroke-width="1.5"></path></svg>');function fl(s){var t=_l();H(s,t)}var pl=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M10.05 23q-.75 0-1.4-.337T7.575 21.7l-5.9-8.65q-.2-.3-.175-.65t.3-.6q.475-.475 1.125-.55t1.175.3L7 13.575V4q0-.425.288-.712T8 3t.713.288T9 4v11.5q0 .6-.537.888t-1.038-.063l-2.125-1.5l3.925 5.725q.125.2.35.325t.475.125H17q.825 0 1.413-.587T19 19V5q0-.425.288-.712T20 4t.713.288T21 5v14q0 1.65-1.175 2.825T17 23zM12 1q.425 0 .713.288T13 2v9q0 .425-.288.713T12 12t-.712-.288T11 11V2q0-.425.288-.712T12 1m4 1q.425 0 .713.288T17 3v8q0 .425-.288.713T16 12t-.712-.288T15 11V3q0-.425.288-.712T16 2m-3.85 14.5"></path></svg>');function gl(s){var t=pl();H(s,t)}var ml=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rotate-ccw" style="transform: rotateY(180deg);"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>');function yl(s){var t=ml();H(s,t)}var xl=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24"><path fill="currentColor" d="M12 16q1.875 0 3.188-1.312T16.5 11.5t-1.312-3.187T12 7T8.813 8.313T7.5 11.5t1.313 3.188T12 16m0-1.8q-1.125 0-1.912-.788T9.3 11.5t.788-1.912T12 8.8t1.913.788t.787 1.912t-.787 1.913T12 14.2m0 4.8q-3.65 0-6.65-2.037T1 11.5q1.35-3.425 4.35-5.462T12 4t6.65 2.038T23 11.5q-1.35 3.425-4.35 5.463T12 19"></path></svg>');function bl(s){var t=xl();H(s,t)}var vl=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24"><path fill="currentColor" d="m19.8 22.6l-4.2-4.15q-.875.275-1.762.413T12 19q-3.775 0-6.725-2.087T1 11.5q.525-1.325 1.325-2.463T4.15 7L1.4 4.2l1.4-1.4l18.4 18.4zM12 16q.275 0 .513-.025t.512-.1l-5.4-5.4q-.075.275-.1.513T7.5 11.5q0 1.875 1.313 3.188T12 16m7.3.45l-3.175-3.15q.175-.425.275-.862t.1-.938q0-1.875-1.312-3.187T12 7q-.5 0-.937.1t-.863.3L7.65 4.85q1.025-.425 2.1-.637T12 4q3.775 0 6.725 2.088T23 11.5q-.575 1.475-1.513 2.738T19.3 16.45m-4.625-4.6l-3-3q.7-.125 1.288.113t1.012.687t.613 1.038t.087 1.162"></path></svg>');function wl(s){var t=vl();H(s,t)}var kl=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 256 256"><path fill="currentColor" d="M144 120v88a8 8 0 0 1-8 8H48a8 8 0 0 1-8-8v-88a8 8 0 0 1 8-8h88a8 8 0 0 1 8 8m64 56a8 8 0 0 0-8 8v16h-24a8 8 0 0 0 0 16h24a16 16 0 0 0 16-16v-16a8 8 0 0 0-8-8m0-72a8 8 0 0 0-8 8v32a8 8 0 0 0 16 0v-32a8 8 0 0 0-8-8m-8-64h-16a8 8 0 0 0 0 16h16v16a8 8 0 0 0 16 0V56a16 16 0 0 0-16-16m-56 0h-32a8 8 0 0 0 0 16h32a8 8 0 0 0 0-16M48 88a8 8 0 0 0 8-8V56h16a8 8 0 0 0 0-16H56a16 16 0 0 0-16 16v24a8 8 0 0 0 8 8"></path></svg>');function Al(s){var t=kl();H(s,t)}var Sl=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21l-4.343-4.343m0 0A8 8 0 1 0 5.343 5.343a8 8 0 0 0 11.314 11.314M11 8v6m-3-3h6"></path></svg>');function Cl(s){var t=Sl();H(s,t)}var Ml=ne('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21l-4.343-4.343m0 0A8 8 0 1 0 5.343 5.343a8 8 0 0 0 11.314 11.314M8 11h6"></path></svg>');function Tl(s){var t=Ml();H(s,t)}class gs{command;next;previous;constructor(t){this.command=t||null,this.next=null,this.previous=null}push(t){this.next=null;const e=new gs(t);e.previous=this,this.next=e}}class Pl{history=new gs;current_history=ai(this.history);undo(){this.history.previous&&(this.history.command?.undo(),this.history=this.history.previous,this.current_history.update(()=>this.history))}redo(t){this.history.next&&(this.history=this.history.next,this.history.command?.execute(t),this.current_history.update(()=>this.history))}async execute(t,e){await t.execute(e),this.history.push(t),this.history=this.history.next,this.current_history.update(()=>this.history)}async wait_for_next_frame(){return new Promise(t=>{requestAnimationFrame(()=>{t()})})}async replay(t,e){for(;t.previous;)t=t.previous;for(;t.next;)await t.next.command.execute(e),t=t.next;this.history=t,this.current_history.update(()=>this.history)}contains(t){let e=this.history;for(;e;){if(e.command?.name===t)return!0;e=e.next}return!1}reset(){this.history=new gs,this.current_history.update(()=>this.history)}}var Il=nt('<span style="margin-left: 4px;" class="svelte-1lrnmgy"> </span>'),zl=nt('<span style="margin-right: 4px;" class="svelte-1lrnmgy"> </span>'),El=nt("<button><!> <div><!></div> <!></button>");function ae(s,t){ue(t,!1);const e=Z();let i=I(t,"Icon",12),r=I(t,"label",12,""),n=I(t,"show_label",12,!1),o=I(t,"pending",12,!1),a=I(t,"size",12,"small"),h=I(t,"padded",12,!0),l=I(t,"highlight",12,!1),c=I(t,"disabled",12,!1),u=I(t,"hasPopup",12,!1),_=I(t,"color",12,"var(--block-label-text-color)"),d=I(t,"transparent",12,!1),f=I(t,"background",12,"var(--background-fill-primary)"),g=I(t,"offset",12,0),p=I(t,"label_position",12,"left"),y=I(t,"roundedness",12,"quite");yt(()=>(X(l()),X(_())),()=>{U(e,l()?"var(--color-accent)":_().toString())}),Le();var x={get Icon(){return i()},set Icon(F){i(F),z()},get label(){return r()},set label(F){r(F),z()},get show_label(){return n()},set show_label(F){n(F),z()},get pending(){return o()},set pending(F){o(F),z()},get size(){return a()},set size(F){a(F),z()},get padded(){return h()},set padded(F){h(F),z()},get highlight(){return l()},set highlight(F){l(F),z()},get disabled(){return c()},set disabled(F){c(F),z()},get hasPopup(){return u()},set hasPopup(F){u(F),z()},get color(){return _()},set color(F){_(F),z()},get transparent(){return d()},set transparent(F){d(F),z()},get background(){return f()},set background(F){f(F),z()},get offset(){return g()},set offset(F){g(F),z()},get label_position(){return p()},set label_position(F){p(F),z()},get roundedness(){return y()},set roundedness(F){y(F),z()}};ve();var b=El();let v,C;var w=it(b);{var k=F=>{var W=Il(),q=it(W,!0);tt(W),Wt(()=>Fe(q,r())),H(F,W)};Q(w,F=>{n()&&p()==="left"&&F(k)})}var R=$(w,2);let S;var P=it(R);i()(P,{}),tt(R);var B=$(R,2);{var G=F=>{var W=zl(),q=it(W,!0);tt(W),Wt(()=>Fe(q,r())),H(F,W)};Q(B,F=>{n()&&p()==="right"&&F(G)})}return tt(b),Wt(()=>{b.disabled=c(),Ne(b,"aria-label",r()),Ne(b,"aria-haspopup",u()),Ne(b,"title",r()),v=re(b,1,`${y()??""}-round`,"svelte-1lrnmgy",v,{pending:o(),padded:h(),highlight:l(),transparent:d()}),C=ze(b,"",C,{color:!c()&&m(e)?m(e):"var(--block-label-text-color)","--bg-color":c()?"auto":f(),"margin-left":g()+"px"}),S=re(R,1,"svelte-1lrnmgy",null,S,{small:a()==="small",large:a()==="large",medium:a()==="medium"})}),Vt("click",b,function(F){he.call(this,t,F)}),H(s,b),de(x)}function Kr(s,t){const e=i=>{s&&!s.contains(i.target)&&!i.defaultPrevented&&t(i)};return document.addEventListener("mousedown",e,!0),{destroy(){document.removeEventListener("mousedown",e,!0)}}}var j=(s=>(s.Application="application",s.WebGLPipes="webgl-pipes",s.WebGLPipesAdaptor="webgl-pipes-adaptor",s.WebGLSystem="webgl-system",s.WebGPUPipes="webgpu-pipes",s.WebGPUPipesAdaptor="webgpu-pipes-adaptor",s.WebGPUSystem="webgpu-system",s.CanvasSystem="canvas-system",s.CanvasPipesAdaptor="canvas-pipes-adaptor",s.CanvasPipes="canvas-pipes",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s.MaskEffect="mask-effect",s.BlendMode="blend-mode",s.TextureSource="texture-source",s.Environment="environment",s.ShapeBuilder="shape-builder",s.Batcher="batcher",s))(j||{});const br=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},Yi=(s,t)=>br(s).priority??t,jt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(br).forEach(t=>{t.type.forEach(e=>this._removeHandlers[e]?.(t))}),this},add(...s){return s.map(br).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,r=this._queue;i[e]?i[e]?.(t):(r[e]=r[e]||[],r[e]?.push(t))})}),this},handle(s,t,e){const i=this._addHandlers,r=this._removeHandlers;if(i[s]||r[s])throw new Error(`Extension type ${s} already has a handler`);i[s]=t,r[s]=e;const n=this._queue;return n[s]&&(n[s]?.forEach(o=>t(o)),delete n[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(s,t,e=-1){return this.handle(s,i=>{t.findIndex(n=>n.name===i.name)>=0||(t.push({name:i.name,value:i.ref}),t.sort((n,o)=>Yi(o.value,e)-Yi(n.value,e)))},i=>{const r=t.findIndex(n=>n.name===i.name);r!==-1&&t.splice(r,1)})},handleByList(s,t,e=-1){return this.handle(s,i=>{t.includes(i.ref)||(t.push(i.ref),t.sort((r,n)=>Yi(n,e)-Yi(r,e)))},i=>{const r=t.indexOf(i.ref);r!==-1&&t.splice(r,1)})},mixin(s,...t){for(const e of t)Object.defineProperties(s.prototype,Object.getOwnPropertyDescriptors(e))}},Rl={extension:{type:j.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await fs(()=>import("./browserAll-CX75A6VW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]),import.meta.url)}},Fl={extension:{type:j.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await fs(()=>import("./webworkerAll-DdWDpZXi.js"),__vite__mapDeps([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]),import.meta.url)}};class Kt{constructor(t,e,i){this._x=e||0,this._y=i||0,this._observer=t}clone(t){return new Kt(t??this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}var Ds={exports:{}},An;function Bl(){return An||(An=1,(function(s){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(h,l,c){this.fn=h,this.context=l,this.once=c||!1}function n(h,l,c,u,_){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new r(c,u||h,_),f=e?e+l:l;return h._events[f]?h._events[f].fn?h._events[f]=[h._events[f],d]:h._events[f].push(d):(h._events[f]=d,h._eventsCount++),h}function o(h,l){--h._eventsCount===0?h._events=new i:delete h._events[l]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)t.call(c,u)&&l.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=e?e+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var _=0,d=u.length,f=new Array(d);_<d;_++)f[_]=u[_].fn;return f},a.prototype.listenerCount=function(l){var c=e?e+l:l,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(l,c,u,_,d,f){var g=e?e+l:l;if(!this._events[g])return!1;var p=this._events[g],y=arguments.length,x,b;if(p.fn){switch(p.once&&this.removeListener(l,p.fn,void 0,!0),y){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,c),!0;case 3:return p.fn.call(p.context,c,u),!0;case 4:return p.fn.call(p.context,c,u,_),!0;case 5:return p.fn.call(p.context,c,u,_,d),!0;case 6:return p.fn.call(p.context,c,u,_,d,f),!0}for(b=1,x=new Array(y-1);b<y;b++)x[b-1]=arguments[b];p.fn.apply(p.context,x)}else{var v=p.length,C;for(b=0;b<v;b++)switch(p[b].once&&this.removeListener(l,p[b].fn,void 0,!0),y){case 1:p[b].fn.call(p[b].context);break;case 2:p[b].fn.call(p[b].context,c);break;case 3:p[b].fn.call(p[b].context,c,u);break;case 4:p[b].fn.call(p[b].context,c,u,_);break;default:if(!x)for(C=1,x=new Array(y-1);C<y;C++)x[C-1]=arguments[C];p[b].fn.apply(p[b].context,x)}}return!0},a.prototype.on=function(l,c,u){return n(this,l,c,u,!1)},a.prototype.once=function(l,c,u){return n(this,l,c,u,!0)},a.prototype.removeListener=function(l,c,u,_){var d=e?e+l:l;if(!this._events[d])return this;if(!c)return o(this,d),this;var f=this._events[d];if(f.fn)f.fn===c&&(!_||f.once)&&(!u||f.context===u)&&o(this,d);else{for(var g=0,p=[],y=f.length;g<y;g++)(f[g].fn!==c||_&&!f[g].once||u&&f[g].context!==u)&&p.push(f[g]);p.length?this._events[d]=p.length===1?p[0]:p:o(this,d)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=e?e+l:l,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,s.exports=a})(Ds)),Ds.exports}var Ll=Bl();const we=Do(Ll),Ol=Math.PI*2,Gl=180/Math.PI,Dl=Math.PI/180;class dt{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new dt(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return Ns.x=0,Ns.y=0,Ns}}const Ns=new dt;class pt{constructor(t=1,e=0,i=0,r=1,n=0,o=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,r,n,o){return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new dt;const i=t.x,r=t.y;return e.x=this.a*i+this.c*r+this.tx,e.y=this.b*i+this.d*r+this.ty,e}applyInverse(t,e){e=e||new dt;const i=this.a,r=this.b,n=this.c,o=this.d,a=this.tx,h=this.ty,l=1/(i*o+n*-r),c=t.x,u=t.y;return e.x=o*l*c+-n*l*u+(h*n-a*o)*l,e.y=i*l*u+-r*l*c+(-h*i+a*r)*l,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a,n=this.c,o=this.tx;return this.a=r*e-this.b*i,this.b=r*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this}append(t){const e=this.a,i=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this}appendFrom(t,e){const i=t.a,r=t.b,n=t.c,o=t.d,a=t.tx,h=t.ty,l=e.a,c=e.b,u=e.c,_=e.d;return this.a=i*l+r*u,this.b=i*c+r*_,this.c=n*l+o*u,this.d=n*c+o*_,this.tx=a*l+h*u+e.tx,this.ty=a*c+h*_+e.ty,this}setTransform(t,e,i,r,n,o,a,h,l){return this.a=Math.cos(a+l)*n,this.b=Math.sin(a+l)*n,this.c=-Math.sin(a-h)*o,this.d=Math.cos(a-h)*o,this.tx=t-(i*this.a+r*this.c),this.ty=e-(i*this.b+r*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,r=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,r=this.c,n=this.d,o=t.pivot,a=-Math.atan2(-r,n),h=Math.atan2(i,e),l=Math.abs(a+h);return l<1e-5||Math.abs(Ol-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=h),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(o.x*e+o.y*r),t.position.y=this.ty+(o.x*i+o.y*n),t}invert(){const t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,o=t*r-e*i;return this.a=r/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-r*n)/o,this.ty=-(t*this.ty-e*n)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new pt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return Ul.identity()}static get shared(){return Nl.identity()}}const Nl=new pt,Ul=new pt,Xe=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ye=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],$e=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],qe=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],vr=[],Yo=[],$i=Math.sign;function Wl(){for(let s=0;s<16;s++){const t=[];vr.push(t);for(let e=0;e<16;e++){const i=$i(Xe[s]*Xe[e]+$e[s]*Ye[e]),r=$i(Ye[s]*Xe[e]+qe[s]*Ye[e]),n=$i(Xe[s]*$e[e]+$e[s]*qe[e]),o=$i(Ye[s]*$e[e]+qe[s]*qe[e]);for(let a=0;a<16;a++)if(Xe[a]===i&&Ye[a]===r&&$e[a]===n&&qe[a]===o){t.push(a);break}}}for(let s=0;s<16;s++){const t=new pt;t.set(Xe[s],Ye[s],$e[s],qe[s],0,0),Yo.push(t)}}Wl();const Ct={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>Xe[s],uY:s=>Ye[s],vX:s=>$e[s],vY:s=>qe[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>vr[s][t],sub:(s,t)=>vr[s][Ct.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?Ct.S:Ct.N:Math.abs(t)*2<=Math.abs(s)?s>0?Ct.E:Ct.W:t>0?s>0?Ct.SE:Ct.SW:s>0?Ct.NE:Ct.NW,matrixAppendRotationInv:(s,t,e=0,i=0)=>{const r=Yo[Ct.inv(t)];r.tx=e,r.ty=i,s.append(r)},transformRectCoords:(s,t,e,i)=>{const{x:r,y:n,width:o,height:a}=s,{x:h,y:l,width:c,height:u}=t;return e===Ct.E?(i.set(r+h,n+l,o,a),i):e===Ct.S?i.set(c-n-a+h,r+l,a,o):e===Ct.W?i.set(c-r-o+h,u-n-a+l,o,a):e===Ct.N?i.set(n+h,u-r-o+l,a,o):i.set(r+h,n+l,o,a)}},qi=[new dt,new dt,new dt,new dt];class Mt{constructor(t=0,e=0,i=0,r=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(r)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new Mt(0,0,0,0)}clone(){return new Mt(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}strokeContains(t,e,i,r=.5){const{width:n,height:o}=this;if(n<=0||o<=0)return!1;const a=this.x,h=this.y,l=i*(1-r),c=i-l,u=a-l,_=a+n+l,d=h-l,f=h+o+l,g=a+c,p=a+n-c,y=h+c,x=h+o-c;return t>=u&&t<=_&&e>=d&&e<=f&&!(t>g&&t<p&&e>y&&e<x)}intersects(t,e){if(!e){const R=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=R)return!1;const P=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>P}const i=this.left,r=this.right,n=this.top,o=this.bottom;if(r<=i||o<=n)return!1;const a=qi[0].set(t.left,t.top),h=qi[1].set(t.left,t.bottom),l=qi[2].set(t.right,t.top),c=qi[3].set(t.right,t.bottom);if(l.x<=a.x||h.y<=a.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(a,a),e.apply(h,h),e.apply(l,l),e.apply(c,c),Math.max(a.x,h.x,l.x,c.x)<=i||Math.min(a.x,h.x,l.x,c.x)>=r||Math.max(a.y,h.y,l.y,c.y)<=n||Math.min(a.y,h.y,l.y,c.y)>=o))return!1;const _=u*(h.y-a.y),d=u*(a.x-h.x),f=_*i+d*n,g=_*r+d*n,p=_*i+d*o,y=_*r+d*o;if(Math.max(f,g,p,y)<=_*a.x+d*a.y||Math.min(f,g,p,y)>=_*c.x+d*c.y)return!1;const x=u*(a.y-l.y),b=u*(l.x-a.x),v=x*i+b*n,C=x*r+b*n,w=x*i+b*o,k=x*r+b*o;return!(Math.max(v,C,w,k)<=x*a.x+b*a.y||Math.min(v,C,w,k)>=x*c.x+b*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=r-this.y,this}scale(t,e=t){return this.x*=t,this.y*=e,this.width*=t,this.height*=e,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=r,this.height=n-r,this}getBounds(t){return t||(t=new Mt),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,i=t.y,r=t.x+t.width,n=t.y+t.height;return e>=this.x&&e<this.x+this.width&&i>=this.y&&i<this.y+this.height&&r>=this.x&&r<this.x+this.width&&n>=this.y&&n<this.y+this.height}set(t,e,i,r){return this.x=t,this.y=e,this.width=i,this.height=r,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const Us={default:-1};function Ot(s="default"){return Us[s]===void 0&&(Us[s]=-1),++Us[s]}const Sn=new Set,wt="8.0.0",Hl="8.3.4",oi={quiet:!1,noColor:!1},ht=(s,t,e=3)=>{if(oi.quiet||Sn.has(t))return;let i=new Error().stack;const r=`${t}
Deprecated since v${s}`,n=typeof console.groupCollapsed=="function"&&!oi.noColor;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",r):(i=i.split(`
`).splice(e).join(`
`),n?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",r),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",r),console.warn(i))),Sn.add(t)};Object.defineProperties(ht,{quiet:{get:()=>oi.quiet,set:s=>{oi.quiet=s},enumerable:!0,configurable:!1},noColor:{get:()=>oi.noColor,set:s=>{oi.noColor=s},enumerable:!0,configurable:!1}});const $o=()=>{};function ms(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function Cn(s){return!(s&s-1)&&!!s}function qo(s){const t={};for(const e in s)s[e]!==void 0&&(t[e]=s[e]);return t}const Mn=Object.create(null);function Vl(s){const t=Mn[s];return t===void 0&&(Mn[s]=Ot("resource")),t}const jo=class Ko extends we{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...Ko.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){ht(wt,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=Vl(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};jo.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let ys=jo;const Zo=class Qo extends we{constructor(t={}){super(),this.options=t,this.uid=Ot("textureSource"),this._resourceType="textureSource",this._resourceId=Ot("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...Qo.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new ys(qo(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){this.style!==t&&(this._style?.off("change",this._onStyleChange,this),this._style=t,this._style?.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(t){this._style.maxAnisotropy=t}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=Ot("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,i){i||(i=this._resolution),t||(t=this.width),e||(e=this.height);const r=Math.round(t*i),n=Math.round(e*i);return this.width=r/i,this.height=n/i,this._resolution=i,this.pixelWidth===r&&this.pixelHeight===n?!1:(this._refreshPOT(),this.pixelWidth=r,this.pixelHeight=n,this.emit("resize",this),this._resourceId=Ot("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=Cn(this.pixelWidth)&&Cn(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};Zo.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let me=Zo;class Zr extends me{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let i=t.format;i||(e instanceof Float32Array?i="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?i="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?i="rgba16uint":(e instanceof Int8Array,i="bgra8unorm")),super({...t,resource:e,format:i}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}Zr.extension=j.TextureSource;const Tn=new pt;class Xl{constructor(t,e){this.mapCoord=new pt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof e>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){this.texture!==t&&(this._texture?.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let r=0;r<t.length;r+=2){const n=t[r],o=t[r+1];e[r]=n*i.a+o*i.c+i.tx,e[r+1]=n*i.b+o*i.d+i.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const i=t.orig,r=t.trim;r&&(Tn.set(i.width/r.width,0,0,i.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Tn));const n=t.source,o=this.uClampFrame,a=this.clampMargin/n._resolution,h=this.clampOffset/n._resolution;return o[0]=(t.frame.x+a+h)/n.width,o[1]=(t.frame.y+a+h)/n.height,o[2]=(t.frame.x+t.frame.width-a+h)/n.width,o[3]=(t.frame.y+t.frame.height-a+h)/n.height,this.uClampOffset[0]=this.clampOffset/n.pixelWidth,this.uClampOffset[1]=this.clampOffset/n.pixelHeight,this.isSimple=t.frame.width===n.width&&t.frame.height===n.height&&t.rotate===0,!0}}class _t extends we{constructor({source:t,label:e,frame:i,orig:r,trim:n,defaultAnchor:o,defaultBorders:a,rotate:h,dynamic:l}={}){if(super(),this.uid=Ot("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new Mt,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=t?.source??new me,this.noFrame=!i,i)this.frame.copyFrom(i);else{const{width:c,height:u}=this._source;this.frame.width=c,this.frame.height=u}this.orig=r||this.frame,this.trim=n,this.rotate=h??0,this.defaultAnchor=o,this.defaultBorders=a,this.destroyed=!1,this.dynamic=l||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Xl(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:i,height:r}=this._source,n=e.x/i,o=e.y/r,a=e.width/i,h=e.height/r;let l=this.rotate;if(l){const c=a/2,u=h/2,_=n+c,d=o+u;l=Ct.add(l,Ct.NW),t.x0=_+c*Ct.uX(l),t.y0=d+u*Ct.uY(l),l=Ct.add(l,2),t.x1=_+c*Ct.uX(l),t.y1=d+u*Ct.uY(l),l=Ct.add(l,2),t.x2=_+c*Ct.uX(l),t.y2=d+u*Ct.uY(l),l=Ct.add(l,2),t.x3=_+c*Ct.uX(l),t.y3=d+u*Ct.uY(l)}else t.x0=n,t.y0=o,t.x1=n+a,t.y1=o,t.x2=n+a,t.y2=o+h,t.x3=n,t.y3=o+h}destroy(t=!1){this._source&&t&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return ht(wt,"Texture.baseTexture is now Texture.source"),this._source}}_t.EMPTY=new _t({label:"EMPTY",source:new me({label:"EMPTY"})});_t.EMPTY.destroy=$o;_t.WHITE=new _t({source:new Zr({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});_t.WHITE.destroy=$o;function Yl(s,t,e){const{width:i,height:r}=e.orig,n=e.trim;if(n){const o=n.width,a=n.height;s.minX=n.x-t._x*i,s.maxX=s.minX+o,s.minY=n.y-t._y*r,s.maxY=s.minY+a}else s.minX=-t._x*i,s.maxX=s.minX+i,s.minY=-t._y*r,s.maxY=s.minY+r}const Pn=new pt;class be{constructor(t=1/0,e=1/0,i=-1/0,r=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Pn,this.minX=t,this.minY=e,this.maxX=i,this.maxY=r}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new Mt);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Pn,this}set(t,e,i,r){this.minX=t,this.minY=e,this.maxX=i,this.maxY=r}addFrame(t,e,i,r,n){n||(n=this.matrix);const o=n.a,a=n.b,h=n.c,l=n.d,c=n.tx,u=n.ty;let _=this.minX,d=this.minY,f=this.maxX,g=this.maxY,p=o*t+h*e+c,y=a*t+l*e+u;p<_&&(_=p),y<d&&(d=y),p>f&&(f=p),y>g&&(g=y),p=o*i+h*e+c,y=a*i+l*e+u,p<_&&(_=p),y<d&&(d=y),p>f&&(f=p),y>g&&(g=y),p=o*t+h*r+c,y=a*t+l*r+u,p<_&&(_=p),y<d&&(d=y),p>f&&(f=p),y>g&&(g=y),p=o*i+h*r+c,y=a*i+l*r+u,p<_&&(_=p),y<d&&(d=y),p>f&&(f=p),y>g&&(g=y),this.minX=_,this.minY=d,this.maxX=f,this.maxY=g}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,i=this.minY,r=this.maxX,n=this.maxY,{a:o,b:a,c:h,d:l,tx:c,ty:u}=t;let _=o*e+h*i+c,d=a*e+l*i+u;this.minX=_,this.minY=d,this.maxX=_,this.maxY=d,_=o*r+h*i+c,d=a*r+l*i+u,this.minX=_<this.minX?_:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=_>this.maxX?_:this.maxX,this.maxY=d>this.maxY?d:this.maxY,_=o*e+h*n+c,d=a*e+l*n+u,this.minX=_<this.minX?_:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=_>this.maxX?_:this.maxX,this.maxY=d>this.maxY?d:this.maxY,_=o*r+h*n+c,d=a*r+l*n+u,this.minX=_<this.minX?_:this.minX,this.minY=d<this.minY?d:this.minY,this.maxX=_>this.maxX?_:this.maxX,this.maxY=d>this.maxY?d:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,i,r){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<i&&(this.minY=i),this.maxY>r&&(this.maxY=r),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new be(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,i,r){let n=this.minX,o=this.minY,a=this.maxX,h=this.maxY;r||(r=this.matrix);const l=r.a,c=r.b,u=r.c,_=r.d,d=r.tx,f=r.ty;for(let g=e;g<i;g+=2){const p=t[g],y=t[g+1],x=l*p+u*y+d,b=c*p+_*y+f;n=x<n?x:n,o=b<o?b:o,a=x>a?x:a,h=b>h?b:h}this.minX=n,this.minY=o,this.maxX=a,this.maxY=h}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var $l={grad:.9,turn:360,rad:360/(2*Math.PI)},Ie=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},$t=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},pe=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},Jo=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},In=function(s){return{r:pe(s.r,0,255),g:pe(s.g,0,255),b:pe(s.b,0,255),a:pe(s.a)}},Ws=function(s){return{r:$t(s.r),g:$t(s.g),b:$t(s.b),a:$t(s.a,3)}},ql=/^#([0-9a-f]{3,8})$/i,ji=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},ta=function(s){var t=s.r,e=s.g,i=s.b,r=s.a,n=Math.max(t,e,i),o=n-Math.min(t,e,i),a=o?n===t?(e-i)/o:n===e?2+(i-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:r}},ea=function(s){var t=s.h,e=s.s,i=s.v,r=s.a;t=t/360*6,e/=100,i/=100;var n=Math.floor(t),o=i*(1-e),a=i*(1-(t-n)*e),h=i*(1-(1-t+n)*e),l=n%6;return{r:255*[i,a,o,o,h,i][l],g:255*[h,i,i,a,o,o][l],b:255*[o,o,h,i,i,a][l],a:r}},zn=function(s){return{h:Jo(s.h),s:pe(s.s,0,100),l:pe(s.l,0,100),a:pe(s.a)}},En=function(s){return{h:$t(s.h),s:$t(s.s),l:$t(s.l),a:$t(s.a,3)}},Rn=function(s){return ea((e=(t=s).s,{h:t.h,s:(e*=((i=t.l)<50?i:100-i)/100)>0?2*e/(i+e)*100:0,v:i+e,a:t.a}));var t,e,i},Pi=function(s){return{h:(t=ta(s)).h,s:(r=(200-(e=t.s))*(i=t.v)/100)>0&&r<200?e*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,e,i,r},jl=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Kl=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Zl=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ql=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,wr={string:[[function(s){var t=ql.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?$t(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?$t(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=Zl.exec(s)||Ql.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:In({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=jl.exec(s)||Kl.exec(s);if(!t)return null;var e,i,r=zn({h:(e=t[1],i=t[2],i===void 0&&(i="deg"),Number(e)*($l[i]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Rn(r)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,i=s.b,r=s.a,n=r===void 0?1:r;return Ie(t)&&Ie(e)&&Ie(i)?In({r:Number(t),g:Number(e),b:Number(i),a:Number(n)}):null},"rgb"],[function(s){var t=s.h,e=s.s,i=s.l,r=s.a,n=r===void 0?1:r;if(!Ie(t)||!Ie(e)||!Ie(i))return null;var o=zn({h:Number(t),s:Number(e),l:Number(i),a:Number(n)});return Rn(o)},"hsl"],[function(s){var t=s.h,e=s.s,i=s.v,r=s.a,n=r===void 0?1:r;if(!Ie(t)||!Ie(e)||!Ie(i))return null;var o=(function(a){return{h:Jo(a.h),s:pe(a.s,0,100),v:pe(a.v,0,100),a:pe(a.a)}})({h:Number(t),s:Number(e),v:Number(i),a:Number(n)});return ea(o)},"hsv"]]},Fn=function(s,t){for(var e=0;e<t.length;e++){var i=t[e][0](s);if(i)return[i,t[e][1]]}return[null,void 0]},Jl=function(s){return typeof s=="string"?Fn(s.trim(),wr.string):typeof s=="object"&&s!==null?Fn(s,wr.object):[null,void 0]},Hs=function(s,t){var e=Pi(s);return{h:e.h,s:pe(e.s+100*t,0,100),l:e.l,a:e.a}},Vs=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Bn=function(s,t){var e=Pi(s);return{h:e.h,s:e.s,l:pe(e.l+100*t,0,100),a:e.a}},kr=(function(){function s(t){this.parsed=Jl(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return $t(Vs(this.rgba),2)},s.prototype.isDark=function(){return Vs(this.rgba)<.5},s.prototype.isLight=function(){return Vs(this.rgba)>=.5},s.prototype.toHex=function(){return t=Ws(this.rgba),e=t.r,i=t.g,r=t.b,o=(n=t.a)<1?ji($t(255*n)):"","#"+ji(e)+ji(i)+ji(r)+o;var t,e,i,r,n,o},s.prototype.toRgb=function(){return Ws(this.rgba)},s.prototype.toRgbString=function(){return t=Ws(this.rgba),e=t.r,i=t.g,r=t.b,(n=t.a)<1?"rgba("+e+", "+i+", "+r+", "+n+")":"rgb("+e+", "+i+", "+r+")";var t,e,i,r,n},s.prototype.toHsl=function(){return En(Pi(this.rgba))},s.prototype.toHslString=function(){return t=En(Pi(this.rgba)),e=t.h,i=t.s,r=t.l,(n=t.a)<1?"hsla("+e+", "+i+"%, "+r+"%, "+n+")":"hsl("+e+", "+i+"%, "+r+"%)";var t,e,i,r,n},s.prototype.toHsv=function(){return t=ta(this.rgba),{h:$t(t.h),s:$t(t.s),v:$t(t.v),a:$t(t.a,3)};var t},s.prototype.invert=function(){return Ae({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),Ae(Hs(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),Ae(Hs(this.rgba,-t))},s.prototype.grayscale=function(){return Ae(Hs(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),Ae(Bn(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),Ae(Bn(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?Ae({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):$t(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=Pi(this.rgba);return typeof t=="number"?Ae({h:t,s:e.s,l:e.l,a:e.a}):$t(e.h)},s.prototype.isEqual=function(t){return this.toHex()===Ae(t).toHex()},s})(),Ae=function(s){return s instanceof kr?s:new kr(s)},Ln=[],tc=function(s){s.forEach(function(t){Ln.indexOf(t)<0&&(t(kr,wr),Ln.push(t))})};function ec(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in e)i[e[r]]=r;var n={};s.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,h,l=i[this.toHex()];if(l)return l;if(o?.closest){var c=this.toRgb(),u=1/0,_="black";if(!n.length)for(var d in e)n[d]=new s(e[d]).toRgb();for(var f in e){var g=(a=c,h=n[f],Math.pow(a.r-h.r,2)+Math.pow(a.g-h.g,2)+Math.pow(a.b-h.b,2));g<u&&(u=g,_=f)}return _}},t.string.push([function(o){var a=o.toLowerCase(),h=a==="transparent"?"#0000":e[a];return h?new s(h).toRgb():null},"name"])}tc([ec]);const ui=class Si{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Si)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,e){const i=typeof t;if(i!==typeof e)return!1;if(i==="number"||i==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,o)=>n===e[o]);if(t!==null&&e!==null){const n=Object.keys(t),o=Object.keys(e);return n.length!==o.length?!1:n.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,i,r]=this._components;return{r:t,g:e,b:i,a:r}}toRgb(){const[t,e,i]=this._components;return{r:t,g:e,b:i}}toRgbaString(){const[t,e,i]=this.toUint8RgbArray();return`rgba(${t},${e},${i},${this.alpha})`}toUint8RgbArray(t){const[e,i,r]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(e*255),t[1]=Math.round(i*255),t[2]=Math.round(r*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,i,r,n]=this._components;return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,i,r]=this._components;return t[0]=e,t[1]=i,t[2]=r,t}toNumber(){return this._int}toBgrNumber(){const[t,e,i]=this.toUint8RgbArray();return(i<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,i,r,n]=Si._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=i,this._components[2]*=r,this._components[3]*=n,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,n=this._int&255;return e&&(i=i*t+.5|0,r=r*t+.5|0,n=n*t+.5|0),(t*255<<24)+(i<<16)+(r<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,i,r,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,i=(o>>8&255)/255,r=(o&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,i,r,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,i,r,n=255]=t,e/=255,i/=255,r/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=Si.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=Ae(t);o.isValid()&&({r:e,g:i,b:r,a:n}=o.rgba,e/=255,i/=255,r/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=i,this._components[2]=r,this._components[3]=n,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,i]=this._components;this._int=(t*255<<16)+(e*255<<8)+(i*255|0)}_clamp(t,e=0,i=1){return typeof t=="number"?Math.min(Math.max(t,e),i):(t.forEach((r,n)=>{t[n]=Math.min(Math.max(r,e),i)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof Si||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};ui.shared=new ui;ui._temp=new ui;ui.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Ht=ui;const ic={cullArea:null,cullable:!1,cullableChildren:!0};let Xs=0;const On=500;function It(...s){Xs!==On&&(Xs++,Xs===On?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...s))}const Ui={_registeredResources:new Set,register(s){this._registeredResources.add(s)},unregister(s){this._registeredResources.delete(s)},release(){this._registeredResources.forEach(s=>s.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(s){return this._registeredResources.has(s)},reset(){this._registeredResources.clear()}};class sc{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){let e;return this._index>0?e=this._pool[--this._index]:e=new this._classType,e.init?.(t),e}return(t){t.reset?.(),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let t=0;t<this._index;t++)this._pool[t].destroy();this._pool.length=0,this._count=0,this._index=0}}class rc{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new sc(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const i=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[i]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}clear(){this._poolsByClass.forEach(t=>t.clear()),this._poolsByClass.clear()}}const ge=new rc;Ui.register(ge);const nc={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(s){typeof s=="boolean"&&s===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(s===!0?{}:s))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(s){ht("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(s)}};function oc(s,t,e){const i=s.length;let r;if(t>=i||e===0)return;e=t+e>i?i-t:e;const n=i-e;for(r=t;r<n;++r)s[r]=s[r+e];s.length=n}const ac={allowChildren:!0,removeChildren(s=0,t){const e=t??this.children.length,i=e-s,r=[];if(i>0&&i<=e){for(let o=e-1;o>=s;o--){const a=this.children[o];a&&(r.push(a),a.parent=null)}oc(this.children,s,e);const n=this.renderGroup||this.parentRenderGroup;n&&n.removeChildren(r);for(let o=0;o<r.length;++o){const a=r[o];a.parentRenderLayer?.detach(a),this.emit("childRemoved",a,this,o),r[o].emit("removed",this)}return r.length>0&&this._didViewChangeTick++,r}else if(i===0&&this.children.length===0)return r;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(s){const t=this.getChildAt(s);return this.removeChild(t)},getChildAt(s){if(s<0||s>=this.children.length)throw new Error(`getChildAt: Index (${s}) does not exist.`);return this.children[s]},setChildIndex(s,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(s),this.addChildAt(s,t)},getChildIndex(s){const t=this.children.indexOf(s);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(s,t){this.allowChildren||ht(wt,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${s}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(s.parent){const r=s.parent.children.indexOf(s);if(s.parent===this&&r===t)return s;r!==-1&&s.parent.children.splice(r,1)}t===e.length?e.push(s):e.splice(t,0,s),s.parent=this,s.didChange=!0,s._updateFlags=15;const i=this.renderGroup||this.parentRenderGroup;return i&&i.addChild(s),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",s,this,t),s.emit("added",this),s},swapChildren(s,t){if(s===t)return;const e=this.getChildIndex(s),i=this.getChildIndex(t);this.children[e]=t,this.children[i]=s;const r=this.renderGroup||this.parentRenderGroup;r&&(r.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...s){return s.length===1?this.reparentChildAt(s[0],this.children.length):(s.forEach(t=>this.reparentChildAt(t,this.children.length)),s[0])},reparentChildAt(s,t){if(s.parent===this)return this.setChildIndex(s,t),s;const e=s.worldTransform.clone();s.removeFromParent(),this.addChildAt(s,t);const i=this.worldTransform.clone();return i.invert(),e.prepend(i),s.setFromMatrix(e),s},replaceChild(s,t){s.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(s)),t.setFromMatrix(s.localTransform),t.updateLocalTransform(),this.removeChild(s)}},hc={collectRenderables(s,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(s,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,s):this.collectRenderablesWithEffects(s,t,e))},collectRenderablesSimple(s,t,e){const i=this.children,r=i.length;for(let n=0;n<r;n++)i[n].collectRenderables(s,t,e)},collectRenderablesWithEffects(s,t,e){const{renderPipes:i}=t;for(let r=0;r<this.effects.length;r++){const n=this.effects[r];i[n.pipe].push(n,this,s)}this.collectRenderablesSimple(s,t,e);for(let r=this.effects.length-1;r>=0;r--){const n=this.effects[r];i[n.pipe].pop(n,this,s)}}};class Gn{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class lc{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const i=this._tests[e];if(i.test(t))return ge.get(i.maskClass,t)}return t}returnMaskEffect(t){ge.return(t)}}const Ar=new lc;jt.handleByList(j.MaskEffect,Ar._effectClasses);const cc={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)},addEffect(s){this.effects.indexOf(s)===-1&&(this.effects.push(s),this.effects.sort((e,i)=>e.priority-i.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(s){const t=this.effects.indexOf(s);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(s){const t=this._maskEffect;t?.mask!==s&&(t&&(this.removeEffect(t),Ar.returnMaskEffect(t),this._maskEffect=null),s!=null&&(this._maskEffect=Ar.getMaskEffect(s),this.addEffect(this._maskEffect)))},get mask(){return this._maskEffect?.mask},setMask(s){this._maskOptions={...this._maskOptions,...s},s.mask&&(this.mask=s.mask),this._markStructureAsChanged()},set filters(s){!Array.isArray(s)&&s&&(s=[s]);const t=this._filterEffect||(this._filterEffect=new Gn);s=s;const e=s?.length>0,i=t.filters?.length>0,r=e!==i;s=Array.isArray(s)?s.slice(0):s,t.filters=Object.freeze(s),r&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=s??null))},get filters(){return this._filterEffect?.filters},set filterArea(s){this._filterEffect||(this._filterEffect=new Gn),this._filterEffect.filterArea=s},get filterArea(){return this._filterEffect?.filterArea}},uc={label:null,get name(){return ht(wt,"Container.name property has been removed, use Container.label instead"),this.label},set name(s){ht(wt,"Container.name property has been removed, use Container.label instead"),this.label=s},getChildByName(s,t=!1){return this.getChildByLabel(s,t)},getChildByLabel(s,t=!1){const e=this.children;for(let i=0;i<e.length;i++){const r=e[i];if(r.label===s||s instanceof RegExp&&s.test(r.label))return r}if(t)for(let i=0;i<e.length;i++){const n=e[i].getChildByLabel(s,!0);if(n)return n}return null},getChildrenByLabel(s,t=!1,e=[]){const i=this.children;for(let r=0;r<i.length;r++){const n=i[r];(n.label===s||s instanceof RegExp&&s.test(n.label))&&e.push(n)}if(t)for(let r=0;r<i.length;r++)i[r].getChildrenByLabel(s,!0,e);return e}},te=ge.getPool(pt),Ee=ge.getPool(be),dc=new pt,_c={getFastGlobalBounds(s,t){t||(t=new be),t.clear(),this._getGlobalBoundsRecursive(!!s,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(s,t,e){let i=t;if(s&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const r=!!this.effects.length;if((this.renderGroup||r)&&(i=Ee.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const o=this.bounds;i.addFrame(o.minX,o.minY,o.maxX,o.maxY,this.groupTransform)}const n=this.children;for(let o=0;o<n.length;o++)n[o]._getGlobalBoundsRecursive(s,i,e)}if(r){let n=!1;const o=this.renderGroup||this.parentRenderGroup;for(let a=0;a<this.effects.length;a++)this.effects[a].addBounds&&(n||(n=!0,i.applyMatrix(o.worldTransform)),this.effects[a].addBounds(i,!0));n&&i.applyMatrix(o.worldTransform.copyTo(dc).invert()),t.addBounds(i),Ee.return(i)}else this.renderGroup&&(t.addBounds(i,this.relativeGroupTransform),Ee.return(i))}};function ia(s,t,e){e.clear();let i,r;return s.parent?t?i=s.parent.worldTransform:(r=te.get().identity(),i=Qr(s,r)):i=pt.IDENTITY,sa(s,e,i,t),r&&te.return(r),e.isValid||e.set(0,0,0,0),e}function sa(s,t,e,i){if(!s.visible||!s.measurable)return;let r;i?r=s.worldTransform:(s.updateLocalTransform(),r=te.get(),r.appendFrom(s.localTransform,e));const n=t,o=!!s.effects.length;if(o&&(t=Ee.get().clear()),s.boundsArea)t.addRect(s.boundsArea,r);else{const a=s.bounds;a&&!a.isEmpty()&&(t.matrix=r,t.addBounds(a));for(let h=0;h<s.children.length;h++)sa(s.children[h],t,r,i)}if(o){for(let a=0;a<s.effects.length;a++)s.effects[a].addBounds?.(t);n.addBounds(t,pt.IDENTITY),Ee.return(t)}i||te.return(r)}function Qr(s,t){const e=s.parent;return e&&(Qr(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function ra(s,t){if(s===16777215||!t)return t;if(t===16777215||!s)return s;const e=s>>16&255,i=s>>8&255,r=s&255,n=t>>16&255,o=t>>8&255,a=t&255,h=e*n/255|0,l=i*o/255|0,c=r*a/255|0;return(h<<16)+(l<<8)+c}const Dn=16777215;function Nn(s,t){return s===Dn?t:t===Dn?s:ra(s,t)}function ls(s){return((s&255)<<16)+(s&65280)+(s>>16&255)}const fc={getGlobalAlpha(s){if(s)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(s=new pt,t){if(t)return s.copyFrom(this.worldTransform);this.updateLocalTransform();const e=Qr(this,te.get().identity());return s.appendFrom(this.localTransform,e),te.return(e),s},getGlobalTint(s){if(s)return this.renderGroup?ls(this.renderGroup.worldColor):this.parentRenderGroup?ls(Nn(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=Nn(t,e.localColor),e=e.parent;return ls(t)}};function na(s,t,e){return t.clear(),e||(e=pt.IDENTITY),oa(s,t,e,s,!0),t.isValid||t.set(0,0,0,0),t}function oa(s,t,e,i,r){let n;if(r)n=te.get(),n=e.copyTo(n);else{if(!s.visible||!s.measurable)return;s.updateLocalTransform();const h=s.localTransform;n=te.get(),n.appendFrom(h,e)}const o=t,a=!!s.effects.length;if(a&&(t=Ee.get().clear()),s.boundsArea)t.addRect(s.boundsArea,n);else{s.renderPipeId&&(t.matrix=n,t.addBounds(s.bounds));const h=s.children;for(let l=0;l<h.length;l++)oa(h[l],t,n,i,!1)}if(a){for(let h=0;h<s.effects.length;h++)s.effects[h].addLocalBounds?.(t,i);o.addBounds(t,pt.IDENTITY),Ee.return(t)}te.return(n)}function aa(s,t){const e=s.children;for(let i=0;i<e.length;i++){const r=e[i],n=r.uid,o=(r._didViewChangeTick&65535)<<16|r._didContainerChangeTick&65535,a=t.index;(t.data[a]!==n||t.data[a+1]!==o)&&(t.data[t.index]=n,t.data[t.index+1]=o,t.didChange=!0),t.index=a+2,r.children.length&&aa(r,t)}return t.didChange}const pc=new pt,gc={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(s,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=s/t*e:this.scale.x=e},_setHeight(s,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=s/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new be});const s=this._localBoundsCacheData;return s.index=1,s.didChange=!1,s.data[0]!==this._didViewChangeTick&&(s.didChange=!0,s.data[0]=this._didViewChangeTick),aa(this,s),s.didChange&&na(this,s.localBounds,pc),s.localBounds},getBounds(s,t){return ia(this,s,t||new be)}},mc={_onRender:null,set onRender(s){const t=this.renderGroup||this.parentRenderGroup;if(!s){this._onRender&&t?.removeOnRender(this),this._onRender=null;return}this._onRender||t?.addOnRender(this),this._onRender=s},get onRender(){return this._onRender}},yc={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(s){this._zIndex!==s&&(this._zIndex=s,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(xc))}};function xc(s,t){return s._zIndex-t._zIndex}const bc={getGlobalPosition(s=new dt,t=!1){return this.parent?this.parent.toGlobal(this._position,s,t):(s.x=this._position.x,s.y=this._position.y),s},toGlobal(s,t,e=!1){const i=this.getGlobalTransform(te.get(),e);return t=i.apply(s,t),te.return(i),t},toLocal(s,t,e,i){t&&(s=t.toGlobal(s,e,i));const r=this.getGlobalTransform(te.get(),i);return e=r.applyInverse(s,e),te.return(r),e}};class ha{constructor(){this.uid=Ot("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let vc=0;class wc{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new ys(this.textureOptions)}createTexture(t,e,i){const r=new me({...this.textureOptions,width:t,height:e,resolution:1,antialias:i,autoGarbageCollect:!1});return new _t({source:r,label:`texturePool_${vc++}`})}getOptimalTexture(t,e,i=1,r){let n=Math.ceil(t*i-1e-6),o=Math.ceil(e*i-1e-6);n=ms(n),o=ms(o);const a=(n<<17)+(o<<1)+(r?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let h=this._texturePool[a].pop();return h||(h=this.createTexture(n,o,r)),h.source._resolution=i,h.source.width=n/i,h.source.height=o/i,h.source.pixelWidth=n,h.source.pixelHeight=o,h.frame.x=0,h.frame.y=0,h.frame.width=t,h.frame.height=e,h.updateUvs(),this._poolKeyHash[h.uid]=a,h}getSameSizeTexture(t,e=!1){const i=t.source;return this.getOptimalTexture(t.width,t.height,i._resolution,e)}returnTexture(t,e=!1){const i=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[i].push(t)}clear(t){if(t=t!==!1,t)for(const e in this._texturePool){const i=this._texturePool[e];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0)}this._texturePool={}}}const di=new wc;Ui.register(di);class kc{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new pt,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new ha,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let i=0;i<e.length;i++){const r=e[i];r._updateFlags=15,this.addChild(r)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(di.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const t=this._parentCacheAsTextureRenderGroup;t&&!t.textureNeedsUpdate&&t.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let i=0;i<e.length;i++)this.addChild(e[i])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let i=0;i<e.length;i++)this.removeChild(e[i])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let i=0;i<e.length;i++)this._getChildren(e[i],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const i=t.children;for(let r=0;r<i.length;r++)this._getChildren(i[r],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return(this._matrixDirty&1)===0?this._inverseWorldTransform:(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new pt),this._inverseWorldTransform.copyFrom(this.worldTransform).invert())}get textureOffsetInverseTransform(){return(this._matrixDirty&2)===0?this._textureOffsetInverseTransform:(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new pt),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y))}get inverseParentTextureTransform(){if((this._matrixDirty&4)===0)return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new pt),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function Ac(s,t,e={}){for(const i in t)!e[i]&&t[i]!==void 0&&(s[i]=t[i])}const Ys=new Kt(null),Ki=new Kt(null),$s=new Kt(null,1,1),Zi=new Kt(null),Un=1,Sc=2,qs=4;class ct extends we{constructor(t={}){super(),this.uid=Ot("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.parentRenderLayer=null,this.updateTick=-1,this.localTransform=new pt,this.relativeGroupTransform=new pt,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new Kt(this,0,0),this._scale=$s,this._pivot=Ki,this._origin=Zi,this._skew=Ys,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],Ac(this,t,{children:!0,parent:!0,effects:!0}),t.children?.forEach(e=>this.addChild(e)),t.parent?.addChild(this)}static mixin(t){ht("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),jt.mixin(ct,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||ht(wt,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let r=0;r<t.length;r++)this.addChild(t[r]);return t[0]}const e=t[0],i=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),i&&(i.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,i&&i.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let r=0;r<t.length;r++)this.removeChild(t[r]);return t[0]}const e=t[0],i=this.children.indexOf(e);return i>-1&&(this._didViewChangeTick++,this.children.splice(i,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,i),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),this.renderGroup=ge.get(kc,this),this.groupTransform=pt.IDENTITY,t?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),ge.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new pt),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*Gl}set angle(t){this.rotation=t*Dl}get pivot(){return this._pivot===Ki&&(this._pivot=new Kt(this,0,0)),this._pivot}set pivot(t){this._pivot===Ki&&(this._pivot=new Kt(this,0,0),this._origin!==Zi&&It("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===Ys&&(this._skew=new Kt(this,0,0)),this._skew}set skew(t){this._skew===Ys&&(this._skew=new Kt(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===$s&&(this._scale=new Kt(this,1,1)),this._scale}set scale(t){this._scale===$s&&(this._scale=new Kt(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===Zi&&(this._origin=new Kt(this,0,0)),this._origin}set origin(t){this._origin===Zi&&(this._origin=new Kt(this,0,0),this._pivot!==Ki&&It("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const i=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,i.width),e!==void 0&&this._setHeight(e,i.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,i=this._scale,r=this._pivot,n=this._origin,o=this._position,a=i._x,h=i._y,l=r._x,c=r._y,u=-n._x,_=-n._y;e.a=this._cx*a,e.b=this._sx*a,e.c=this._cy*h,e.d=this._sy*h,e.tx=o._x-(l*e.a+c*e.c)+(u*e.a+_*e.c)-u,e.ty=o._y-(l*e.b+c*e.d)+(u*e.b+_*e.d)-_}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=Un,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const i=Ht.shared.setValue(t??16777215).toBgrNumber();i!==this.localColor&&(this.localColor=i,this._updateFlags|=Un,this._onUpdate())}get tint(){return ls(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Sc,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=qs,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=qs,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=qs,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t?.children)&&e)for(let r=0;r<e.length;++r)e[r].destroy(t);this.renderGroup?.destroy(),this.renderGroup=null}}jt.mixin(ct,ac,_c,bc,mc,gc,cc,uc,yc,ic,nc,fc,hc);class la extends ct{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new be(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:i,y:r}=t;return i>=e.minX&&i<=e.maxX&&r>=e.minY&&r<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){super.destroy(t),this._bounds=null;for(const e in this._gpuData)this._gpuData[e].destroy?.();this._gpuData=null}collectRenderablesSimple(t,e,i){const{renderPipes:r}=e;r.blendMode.pushBlendMode(this,this.groupBlendMode,t),r[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const o=this.children,a=o.length;for(let h=0;h<a;h++)o[h].collectRenderables(t,e,i);r.blendMode.popBlendMode(t)}}class kt extends la{constructor(t=_t.EMPTY){t instanceof _t&&(t={texture:t});const{texture:e=_t.EMPTY,anchor:i,roundPixels:r,width:n,height:o,...a}=t;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new Kt({_onUpdate:()=>{this.onViewUpdate()}}),i?this.anchor=i:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=r??!1,n!==void 0&&(this.width=n),o!==void 0&&(this.height=o)}static from(t,e=!1){return t instanceof _t?new kt(t):new kt(_t.from(t,e))}set texture(t){t||(t=_t.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return Yl(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return ht("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,i=this._bounds,{width:r,height:n}=e.orig;i.minX=-t._x*r,i.maxX=i.minX+r,i.minY=-t._y*n,i.maxY=i.minY+n}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t?.texture){const i=typeof t=="boolean"?t:t?.textureSource;this._texture.destroy(i)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}}const Cc=new be;function ca(s,t,e){const i=Cc;s.measurable=!0,ia(s,e,i),t.addBoundsMask(i),s.measurable=!1}function ua(s,t,e){const i=Ee.get();s.measurable=!0;const r=te.get().identity(),n=da(s,e,r);na(s,i,n),s.measurable=!1,t.addBoundsMask(i),te.return(r),Ee.return(i)}function da(s,t,e){return s?(s!==t&&(da(s.parent,t,e),s.updateLocalTransform(),e.append(s.localTransform)),e):(It("Mask bounds, renderable is not inside the root container"),e)}class _a{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof kt),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask=null)}addBounds(t,e){this.inverse||ca(this.mask,t,e)}addLocalBounds(t,e){ua(this.mask,t,e)}containsPoint(t,e){const i=this.mask;return e(i,t)}destroy(){this.reset()}static test(t){return t instanceof kt}}_a.extension=j.MaskEffect;class fa{constructor(t){this.priority=0,this.pipe="colorMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}fa.extension=j.MaskEffect;class pa{constructor(t){this.priority=0,this.pipe="stencilMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null)}addBounds(t,e){ca(this.mask,t,e)}addLocalBounds(t,e){ua(this.mask,t,e)}containsPoint(t,e){const i=this.mask;return e(i,t)}destroy(){this.reset()}static test(t){return t instanceof ct}}pa.extension=j.MaskEffect;const Mc={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")};let Wn=Mc;const zt={get(){return Wn},set(s){Wn=s}};class ga extends me{constructor(t){t.resource||(t.resource=zt.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,i=this._resolution){const r=super.resize(t,e,i);return r&&this.resizeCanvas(),r}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}ga.extension=j.TextureSource;class Je extends me{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}Je.extension=j.TextureSource;var Sr=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(Sr||{});class js{constructor(t,e=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=i,this._once=r}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const ma=class oe{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new js(null,null,1/0),this.deltaMS=1/oe.targetFPMS,this.elapsedMS=1/oe.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Sr.NORMAL){return this._addListener(new js(t,e,i))}addOnce(t,e,i=Sr.NORMAL){return this._addListener(new js(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*oe.targetFPMS;const i=this._head;let r=i.next;for(;r;)r=r.emit(this);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,oe.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!oe._shared){const t=oe._shared=new oe;t.autoStart=!0,t._protected=!0}return oe._shared}static get system(){if(!oe._system){const t=oe._system=new oe;t.autoStart=!0,t._protected=!0}return oe._system}};ma.targetFPMS=.06;let Qi=ma,Ks;async function ya(){return Ks??(Ks=(async()=>{const t=zt.get().createCanvas(1,1).getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const e=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!e)return"premultiply-alpha-on-upload";const i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const n=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,n),t.deleteFramebuffer(r),t.deleteTexture(i),t.getExtension("WEBGL_lose_context")?.loseContext(),n[0]<=n[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Ks}const As=class xa extends me{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...xa.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=Qi.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await ya(),this._load=new Promise((i,r)=>{this.isValid?i(this):(this._resolve=i,this._reject=r,e.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(Qi.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Qi.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Qi.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};As.extension=j.TextureSource;As.defaultOptions={...me.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};As.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Ii=As;const xe=(s,t,e=!1)=>(Array.isArray(s)||(s=[s]),t?s.map(i=>typeof i=="string"||e?t(i):i):s);class Tc{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||It(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const i=xe(t);let r;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.test(e)){r=l.getCacheableAssets(i,e);break}}const n=new Map(Object.entries(r||{}));r||i.forEach(h=>{n.set(h,e)});const o=[...n.keys()],a={cacheKeys:o,keys:i};i.forEach(h=>{this._cacheMap.set(h,a)}),o.forEach(h=>{const l=r?r[h]:e;this._cache.has(h)&&this._cache.get(h)!==l&&It("[Cache] already has key:",h),this._cache.set(h,n.get(h))})}remove(t){if(!this._cacheMap.has(t)){It(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const Pt=new Tc,Cr=[];jt.handleByList(j.TextureSource,Cr);function ba(s={}){const t=s&&s.resource,e=t?s.resource:s,i=t?s:{resource:s};for(let r=0;r<Cr.length;r++){const n=Cr[r];if(n.test(e))return new n(i)}throw new Error(`Could not find a source type for resource: ${i.resource}`)}function Pc(s={},t=!1){const e=s&&s.resource,i=e?s.resource:s,r=e?s:{resource:s};if(!t&&Pt.has(i))return Pt.get(i);const n=new _t({source:ba(r)});return n.on("destroy",()=>{Pt.has(i)&&Pt.remove(i)}),t||Pt.set(i,n),n}function Ic(s,t=!1){return typeof s=="string"?Pt.get(s):s instanceof me?new _t({source:s}):Pc(s,t)}_t.from=Ic;me.from=ba;jt.add(_a,fa,pa,Ii,Je,ga,Zr);var He=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(He||{});function ye(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function xi(s){return s.split("?")[0].split("#")[0]}function zc(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ec(s,t,e){return s.replace(new RegExp(zc(t),"g"),e)}function Rc(s,t){let e="",i=0,r=-1,n=0,o=-1;for(let a=0;a<=s.length;++a){if(a<s.length)o=s.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(r===a-1||n===1))if(r!==a-1&&n===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",i=0):(e=e.slice(0,h),i=e.length-1-e.lastIndexOf("/")),r=a,n=0;continue}}else if(e.length===2||e.length===1){e="",i=0,r=a,n=0;continue}}}else e.length>0?e+=`/${s.slice(r+1,a)}`:e=s.slice(r+1,a),i=a-r-1;r=a,n=0}else o===46&&n!==-1?++n:n=-1}return e}const ce={toPosix(s){return Ec(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){ye(s),s=this.toPosix(s);const t=/^file:\/\/\//.exec(s);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(s);return e?e[0]:""},toAbsolute(s,t,e){if(ye(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const i=xi(this.toPosix(t??zt.get().getBaseUrl())),r=xi(this.toPosix(e??this.rootname(i)));return s=this.toPosix(s),s.startsWith("/")?ce.join(r,s.slice(1)):this.isAbsolute(s)?s:this.join(i,s)},normalize(s){if(ye(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const i=s.endsWith("/");return s=Rc(s),s.length>0&&i&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return ye(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const i=s[e];if(ye(i),i.length>0)if(t===void 0)t=i;else{const r=s[e-1]??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(ye(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let i=-1,r=!0;const n=this.getProtocol(s),o=s;s=s.slice(n.length);for(let a=s.length-1;a>=1;--a)if(t=s.charCodeAt(a),t===47){if(!r){i=a;break}}else r=!1;return i===-1?e?"/":this.isUrl(o)?n+s:n:e&&i===1?"//":n+s.slice(0,i)},rootname(s){ye(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){ye(s),t&&ye(t),s=xi(this.toPosix(s));let e=0,i=-1,r=!0,n;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let o=t.length-1,a=-1;for(n=s.length-1;n>=0;--n){const h=s.charCodeAt(n);if(h===47){if(!r){e=n+1;break}}else a===-1&&(r=!1,a=n+1),o>=0&&(h===t.charCodeAt(o)?--o===-1&&(i=n):(o=-1,i=a))}return e===i?i=a:i===-1&&(i=s.length),s.slice(e,i)}for(n=s.length-1;n>=0;--n)if(s.charCodeAt(n)===47){if(!r){e=n+1;break}}else i===-1&&(r=!1,i=n+1);return i===-1?"":s.slice(e,i)},extname(s){ye(s),s=xi(this.toPosix(s));let t=-1,e=0,i=-1,r=!0,n=0;for(let o=s.length-1;o>=0;--o){const a=s.charCodeAt(o);if(a===47){if(!r){e=o+1;break}continue}i===-1&&(r=!1,i=o+1),a===46?t===-1?t=o:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||i===-1||n===0||n===1&&t===i-1&&t===e+1?"":s.slice(t,i)},parse(s){ye(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=xi(this.toPosix(s));let e=s.charCodeAt(0);const i=this.isAbsolute(s);let r;t.root=this.rootname(s),i||this.hasProtocol(s)?r=1:r=0;let n=-1,o=0,a=-1,h=!0,l=s.length-1,c=0;for(;l>=r;--l){if(e=s.charCodeAt(l),e===47){if(!h){o=l+1;break}continue}a===-1&&(h=!1,a=l+1),e===46?n===-1?n=l:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||a===-1||c===0||c===1&&n===a-1&&n===o+1?a!==-1&&(o===0&&i?t.base=t.name=s.slice(1,a):t.base=t.name=s.slice(o,a)):(o===0&&i?(t.name=s.slice(1,n),t.base=s.slice(1,a)):(t.name=s.slice(o,n),t.base=s.slice(o,a)),t.ext=s.slice(n,a)),t.dir=this.dirname(s),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function va(s,t,e,i,r){const n=t[e];for(let o=0;o<n.length;o++){const a=n[o];e<t.length-1?va(s.replace(i[e],a),t,e+1,i,r):r.push(s.replace(i[e],a))}}function Fc(s){const t=/\{(.*?)\}/g,e=s.match(t),i=[];if(e){const r=[];e.forEach(n=>{const o=n.substring(1,n.length-1).split(",");r.push(o)}),va(s,r,0,e,i)}else i.push(s);return i}const xs=s=>!Array.isArray(s);class pi{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(e[i])}`).join("&")}}getAlias(t){const{alias:e,src:i}=t;return xe(e||i,n=>typeof n=="string"?n:Array.isArray(n)?n.map(o=>o?.src??o):n?.src?n.src:n,!0)}addManifest(t){this._manifest&&It("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];let r=e;Array.isArray(e)||(r=Object.entries(e).map(([n,o])=>typeof o=="string"||Array.isArray(o)?{alias:n,src:o}:{alias:n,...o})),r.forEach(n=>{const o=n.src,a=n.alias;let h;if(typeof a=="string"){const l=this._createBundleAssetId(t,a);i.push(l),h=[a,l]}else{const l=a.map(c=>this._createBundleAssetId(t,c));i.push(...l),h=[...a,...l]}this.add({...n,alias:h,src:o})}),this._bundles[t]=i}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);let i;i=n=>{this.hasKey(n)&&It(`[Resolver] already has key: ${n} overwriting`)},xe(e).forEach(n=>{const{src:o}=n;let{data:a,format:h,loadParser:l,parser:c}=n;const u=xe(o).map(f=>typeof f=="string"?Fc(f):Array.isArray(f)?f:[f]),_=this.getAlias(n);Array.isArray(_)?_.forEach(i):i(_);const d=[];u.forEach(f=>{f.forEach(g=>{let p={};if(typeof g!="object"){p.src=g;for(let y=0;y<this._parsers.length;y++){const x=this._parsers[y];if(x.test(g)){p=x.parse(g);break}}}else a=g.data??a,h=g.format??h,(g.loadParser||g.parser)&&(l=g.loadParser??l,c=g.parser??c),p={...p,...g};if(!_)throw new Error(`[Resolver] alias is undefined for this asset: ${p.src}`);p=this._buildResolvedAsset(p,{aliases:_,data:a,format:h,loadParser:l,parser:c,progressSize:n.progressSize}),d.push(p)})}),_.forEach(f=>{this._assetMap[f]=d})})}resolveBundle(t){const e=xs(t);t=xe(t);const i={};return t.forEach(r=>{const n=this._bundles[r];if(n){const o=this.resolve(n),a={};for(const h in o){const l=o[h];a[this._extractAssetIdFromBundle(r,h)]=l}i[r]=a}}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const r in e)i[r]=e[r].src;return i}return e.src}resolve(t){const e=xs(t);t=xe(t);const i={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let n=this._assetMap[r];const o=this._getPreferredOrder(n);o?.priority.forEach(a=>{o.params[a].forEach(h=>{const l=n.filter(c=>c[a]?c[a]===h:!1);l.length&&(n=l)})}),this._resolverHash[r]=n[0]}else this._resolverHash[r]=this._buildResolvedAsset({alias:[r],src:r},{});i[r]=this._resolverHash[r]}),e?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[e],r=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:i,data:r,loadParser:n,parser:o,format:a,progressSize:h}=e;return(this._basePath||this._rootPath)&&(t.src=ce.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...r||{},...t.data},t.loadParser=n??t.loadParser,t.parser=o??t.parser,t.format=a??t.format??Bc(t.src),h!==void 0&&(t.progressSize=h),t}}pi.RETINA_PREFIX=/@([0-9\.]+)x/;function Bc(s){return s.split(".").pop().split("?").shift().split("#").shift()}const Mr=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s},wa=class Ci{constructor(t,e){this.linkedSheets=[];let i=t;t?.source instanceof me&&(i={texture:t,data:e});const{texture:r,data:n,cachePrefix:o=""}=i;this.cachePrefix=o,this._texture=r instanceof _t?r:null,this.textureSource=r.source,this.textures={},this.animations={},this.data=n;const a=parseFloat(n.meta.scale);a?(this.resolution=a,r.source.resolution=this.resolution):this.resolution=r.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Ci.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const i=Ci.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const r=this._frameKeys[e],n=this._frames[r],o=n.frame;if(o){let a=null,h=null;const l=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,c=new Mt(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);n.rotated?a=new Mt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new Mt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new Mt(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[r]=new _t({source:this.textureSource,frame:a,orig:c,trim:h,rotate:n.rotated?2:0,defaultAnchor:n.anchor,defaultBorders:n.borders,label:r.toString()})}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const r=t[e][i];this.animations[e].push(this.textures[r])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ci.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ci.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};wa.BATCH_SIZE=1e3;let Hn=wa;const Lc=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function ka(s,t,e){const i={};if(s.forEach(r=>{i[r]=t}),Object.keys(t.textures).forEach(r=>{i[`${t.cachePrefix}${r}`]=t.textures[r]}),!e){const r=ce.dirname(s[0]);t.linkedSheets.forEach((n,o)=>{const a=ka([`${r}/${t.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(i,a)})}return i}const Oc={extension:j.Asset,cache:{test:s=>s instanceof Hn,getCacheableAssets:(s,t)=>ka(s,t,!1)},resolver:{extension:{type:j.ResolveParser,name:"resolveSpritesheet"},test:s=>{const e=s.split("?")[0].split("."),i=e.pop(),r=e.pop();return i==="json"&&Lc.includes(r)},parse:s=>{const t=s.split(".");return{resolution:parseFloat(pi.RETINA_PREFIX.exec(s)?.[1]??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:j.LoadParser,priority:He.Normal,name:"spritesheetLoader"},async testParse(s,t){return ce.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){const{texture:i,imageFilename:r,textureOptions:n,cachePrefix:o}=t?.data??{};let a=ce.dirname(t.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let h;if(i instanceof _t)h=i;else{const u=Mr(a+(r??s.meta.image),t.src);h=(await e.load([{src:u,data:n}]))[u]}const l=new Hn({texture:h.source,data:s,cachePrefix:o});await l.parse();const c=s?.meta?.related_multi_packs;if(Array.isArray(c)){const u=[];for(const d of c){if(typeof d!="string")continue;let f=a+d;t.data?.ignoreMultiPack||(f=Mr(f,t.src),u.push(e.load({src:f,data:{textureOptions:n,ignoreMultiPack:!0}})))}const _=await Promise.all(u);l.linkedSheets=_,_.forEach(d=>{d.linkedSheets=[l].concat(l.linkedSheets.filter(f=>f!==d))})}return l},async unload(s,t,e){await e.unload(s.textureSource._sourceOrigin),s.destroy(!1)}}};jt.add(Oc);const Zs=Object.create(null),Vn=Object.create(null);function Jr(s,t){let e=Vn[s];return e===void 0&&(Zs[t]===void 0&&(Zs[t]=1),Vn[s]=e=Zs[t]++),e}let Ji;function Aa(){return(!Ji||Ji?.isContextLost())&&(Ji=zt.get().createCanvas().getContext("webgl",{})),Ji}let ts;function Gc(){if(!ts){ts="mediump";const s=Aa();s&&s.getShaderPrecisionFormat&&(ts=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision?"highp":"mediump")}return ts}function Dc(s,t,e){return t?s:e?(s=s.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${s}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${s}
        `}function Nc(s,t,e){const i=e?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(s.substring(0,9)!=="precision"){let r=e?t.requestedFragmentPrecision:t.requestedVertexPrecision;return r==="highp"&&i!=="highp"&&(r="mediump"),`precision ${r} float;
${s}`}else if(i!=="highp"&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}function Uc(s,t){return t?`#version 300 es
${s}`:s}const Wc={},Hc={};function Vc(s,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const i=e?Wc:Hc;return i[t]?(i[t]++,t+=`-${i[t]}`):i[t]=1,s.indexOf("#define SHADER_NAME")!==-1?s:`${`#define SHADER_NAME ${t}`}
${s}`}function Xc(s,t){return t?s.replace("#version 300 es",""):s}const Qs={stripVersion:Xc,ensurePrecision:Nc,addProgramDefines:Dc,setProgramName:Vc,insertVersion:Uc},bi=Object.create(null),Sa=class Tr{constructor(t){t={...Tr.defaultOptions,...t};const e=t.fragment.indexOf("#version 300 es")!==-1,i={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:Gc()},setProgramName:{name:t.name},addProgramDefines:e,insertVersion:e};let r=t.fragment,n=t.vertex;Object.keys(Qs).forEach(o=>{const a=i[o];r=Qs[o](r,a,!0),n=Qs[o](n,a,!1)}),this.fragment=r,this.vertex=n,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=Jr(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,bi[this._cacheKey]=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return bi[e]||(bi[e]=new Tr(t),bi[e]._cacheKey=e),bi[e]}};Sa.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let _i=Sa;const Xn={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function Yc(s){return Xn[s]??Xn.float32}const $c={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function qc({source:s,entryPoint:t}){const e={},i=s.indexOf(`fn ${t}`);if(i!==-1){const r=s.indexOf("->",i);if(r!==-1){const n=s.substring(i,r),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let a;for(;(a=o.exec(n))!==null;){const h=$c[a[3]]??"float32";e[a[2]]={location:parseInt(a[1],10),format:h,stride:Yc(h).stride,offset:0,instance:!1,start:0}}}}return e}function Js(s){const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,e=/@group\((\d+)\)/,i=/@binding\((\d+)\)/,r=/var(<[^>]+>)? (\w+)/,n=/:\s*(\w+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,a=/(\w+)\s*:\s*([\w\<\>]+)/g,h=/struct\s+(\w+)/,l=s.match(t)?.map(u=>({group:parseInt(u.match(e)[1],10),binding:parseInt(u.match(i)[1],10),name:u.match(r)[2],isUniform:u.match(r)[1]==="<uniform>",type:u.match(n)[1]}));if(!l)return{groups:[],structs:[]};const c=s.match(o)?.map(u=>{const _=u.match(h)[1],d=u.match(a).reduce((f,g)=>{const[p,y]=g.split(":");return f[p.trim()]=y.trim(),f},{});return d?{name:_,members:d}:null}).filter(({name:u})=>l.some(_=>_.type===u))??[];return{groups:l,structs:c}}var Mi=(s=>(s[s.VERTEX=1]="VERTEX",s[s.FRAGMENT=2]="FRAGMENT",s[s.COMPUTE=4]="COMPUTE",s))(Mi||{});function jc({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]=[]),i.isUniform?t[i.group].push({binding:i.binding,visibility:Mi.VERTEX|Mi.FRAGMENT,buffer:{type:"uniform"}}):i.type==="sampler"?t[i.group].push({binding:i.binding,visibility:Mi.FRAGMENT,sampler:{type:"filtering"}}):i.type==="texture_2d"&&t[i.group].push({binding:i.binding,visibility:Mi.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}function Kc({groups:s}){const t=[];for(let e=0;e<s.length;e++){const i=s[e];t[i.group]||(t[i.group]={}),t[i.group][i.name]=i.binding}return t}function Zc(s,t){const e=new Set,i=new Set,r=[...s.structs,...t.structs].filter(o=>e.has(o.name)?!1:(e.add(o.name),!0)),n=[...s.groups,...t.groups].filter(o=>{const a=`${o.name}-${o.binding}`;return i.has(a)?!1:(i.add(a),!0)});return{structs:r,groups:n}}const vi=Object.create(null);class We{constructor(t){this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:i,layout:r,gpuLayout:n,name:o}=t;if(this.name=o,this.fragment=e,this.vertex=i,e.source===i.source){const a=Js(e.source);this.structsAndGroups=a}else{const a=Js(i.source),h=Js(e.source);this.structsAndGroups=Zc(a,h)}this.layout=r??Kc(this.structsAndGroups),this.gpuLayout=n??jc(this.structsAndGroups),this.autoAssignGlobalUniforms=this.layout[0]?.globalUniforms!==void 0,this.autoAssignLocalUniforms=this.layout[1]?.localUniforms!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,i=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=Jr(i,"program")}get attributeData(){return this._attributeData??(this._attributeData=qc(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,vi[this._cacheKey]=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return vi[e]||(vi[e]=new We(t),vi[e]._cacheKey=e),vi[e]}}const Ca=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],Qc=Ca.reduce((s,t)=>(s[t]=!0,s),{});function Jc(s,t){switch(s){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Ma=class Ta{constructor(t,e){this._touched=0,this.uid=Ot("uniform"),this._resourceType="uniformGroup",this._resourceId=Ot("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,e={...Ta.defaultOptions,...e},this.uniformStructures=t;const i={};for(const r in t){const n=t[r];if(n.name=r,n.size=n.size??1,!Qc[n.type]){const o=n.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(o){const[,a,h]=o;throw new Error(`Uniform type ${n.type} is not supported. Use type: '${a}', size: ${h} instead.`)}throw new Error(`Uniform type ${n.type} is not supported. Supported uniform types are: ${Ca.join(", ")}`)}n.value??(n.value=Jc(n.type,n.size)),i[r]=n.value}this.uniforms=i,this._dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this._signature=Jr(Object.keys(i).map(r=>`${r}-${t[r].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};Ma.defaultOptions={ubo:!1,isStatic:!1};let Pa=Ma;class cs{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const i in t){const r=t[i];this.setResource(r,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const i in this.resources)t[e++]=this.resources[i]._resourceId;this._key=t.join("|")}setResource(t,e){const i=this.resources[e];t!==i&&(i&&t.off?.("change",this.onResourceChange,this),t.on?.("change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const i in e)e[i]._touched=t}destroy(){const t=this.resources;for(const e in t)t[e]?.off?.("change",this.onResourceChange,this);this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const i in e)e[i]===t&&(e[i]=null)}else this._updateKey()}}var Pr=(s=>(s[s.WEBGL=1]="WEBGL",s[s.WEBGPU=2]="WEBGPU",s[s.BOTH=3]="BOTH",s))(Pr||{});class Ss extends we{constructor(t){super(),this.uid=Ot("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:i,groups:r,resources:n,compatibleRenderers:o,groupMap:a}=t;this.gpuProgram=e,this.glProgram=i,o===void 0&&(o=0,e&&(o|=Pr.WEBGPU),i&&(o|=Pr.WEBGL)),this.compatibleRenderers=o;const h={};if(!n&&!r&&(n={}),n&&r)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&r&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&r&&a)for(const l in a)for(const c in a[l]){const u=a[l][c];h[u]={group:l,binding:c,name:u}}else if(e&&r&&!a){const l=e.structsAndGroups.groups;a={},l.forEach(c=>{a[c.group]=a[c.group]||{},a[c.group][c.binding]=c.name,h[c.name]=c})}else if(n){r={},a={},e&&e.structsAndGroups.groups.forEach(u=>{a[u.group]=a[u.group]||{},a[u.group][u.binding]=u.name,h[u.name]=u});let l=0;for(const c in n)h[c]||(r[99]||(r[99]=new cs,this._ownedBindGroups.push(r[99])),h[c]={group:99,binding:l,name:c},a[99]=a[99]||{},a[99][l]=c,l++);for(const c in n){const u=c;let _=n[c];!_.source&&!_._resourceType&&(_=new Pa(_));const d=h[u];d&&(r[d.group]||(r[d.group]=new cs,this._ownedBindGroups.push(r[d.group])),r[d.group].setResource(_,d.binding))}}this.groups=r,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(r,h)}addResource(t,e,i){var r,n;(r=this._uniformBindMap)[e]||(r[e]={}),(n=this._uniformBindMap[e])[i]||(n[i]=t),this.groups[e]||(this.groups[e]=new cs,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const i={};for(const r in e){const n=e[r];Object.defineProperty(i,n.name,{get(){return t[n.group].getResource(n.binding)},set(o){t[n.group].setResource(o,n.binding)}})}return i}destroy(t=!1){this.emit("destroy",this),t&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(e=>{e.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:e,gl:i,...r}=t;let n,o;return e&&(n=We.from(e)),i&&(o=_i.from(i)),new Ss({gpuProgram:n,glProgram:o,...r})}}const tu={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},tr=0,er=1,ir=2,sr=3,rr=4,nr=5,Ir=class Ia{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<tr)}set blend(t){!!(this.data&1<<tr)!==t&&(this.data^=1<<tr)}get offsets(){return!!(this.data&1<<er)}set offsets(t){!!(this.data&1<<er)!==t&&(this.data^=1<<er)}set cullMode(t){if(t==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=t==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<ir)}set culling(t){!!(this.data&1<<ir)!==t&&(this.data^=1<<ir)}get depthTest(){return!!(this.data&1<<sr)}set depthTest(t){!!(this.data&1<<sr)!==t&&(this.data^=1<<sr)}get depthMask(){return!!(this.data&1<<nr)}set depthMask(t){!!(this.data&1<<nr)!==t&&(this.data^=1<<nr)}get clockwiseFrontFace(){return!!(this.data&1<<rr)}set clockwiseFrontFace(t){!!(this.data&1<<rr)!==t&&(this.data^=1<<rr)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!=="none",this._blendMode=t,this._blendModeId=tu[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Ia;return t.depthTest=!1,t.blend=!0,t}};Ir.default2d=Ir.for2d();let eu=Ir;const za=class zr extends Ss{constructor(t){t={...zr.defaultOptions,...t},super(t),this.enabled=!0,this._state=eu.for2d(),this.blendMode=t.blendMode,this.padding=t.padding,typeof t.antialias=="boolean"?this.antialias=t.antialias?"on":"off":this.antialias=t.antialias,this.resolution=t.resolution,this.blendRequired=t.blendRequired,this.clipToViewport=t.clipToViewport,this.addResource("uTexture",0,1)}apply(t,e,i,r){t.applyFilter(this,e,i,r)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}static from(t){const{gpu:e,gl:i,...r}=t;let n,o;return e&&(n=We.from(e)),i&&(o=_i.from(i)),new zr({gpuProgram:n,glProgram:o,...r})}};za.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Er=za;const Rr=[];jt.handleByNamedList(j.Environment,Rr);async function iu(s){if(!s)for(let t=0;t<Rr.length;t++){const e=Rr[t];if(e.value.test()){await e.value.load();return}}}let wi;function su(){if(typeof wi=="boolean")return wi;try{wi=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{wi=!1}return wi}function Yn(s,t,e=2){const i=t&&t.length,r=i?t[0]*e:s.length;let n=Ea(s,0,r,e,!0);const o=[];if(!n||n.next===n.prev)return o;let a,h,l;if(i&&(n=hu(s,t,n,e)),s.length>80*e){a=s[0],h=s[1];let c=a,u=h;for(let _=e;_<r;_+=e){const d=s[_],f=s[_+1];d<a&&(a=d),f<h&&(h=f),d>c&&(c=d),f>u&&(u=f)}l=Math.max(c-a,u-h),l=l!==0?32767/l:0}return Li(n,o,e,a,h,l,0),o}function Ea(s,t,e,i,r){let n;if(r===xu(s,t,e,i)>0)for(let o=t;o<e;o+=i)n=$n(o/i|0,s[o],s[o+1],n);else for(let o=e-i;o>=t;o-=i)n=$n(o/i|0,s[o],s[o+1],n);return n&&fi(n,n.next)&&(Gi(n),n=n.next),n}function ti(s,t){if(!s)return s;t||(t=s);let e=s,i;do if(i=!1,!e.steiner&&(fi(e,e.next)||Bt(e.prev,e,e.next)===0)){if(Gi(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Li(s,t,e,i,r,n,o){if(!s)return;!o&&n&&_u(s,i,r,n);let a=s;for(;s.prev!==s.next;){const h=s.prev,l=s.next;if(n?nu(s,i,r,n):ru(s)){t.push(h.i,s.i,l.i),Gi(s),s=l.next,a=l.next;continue}if(s=l,s===a){o?o===1?(s=ou(ti(s),t),Li(s,t,e,i,r,n,2)):o===2&&au(s,t,e,i,r,n):Li(ti(s),t,e,i,r,n,1);break}}}function ru(s){const t=s.prev,e=s,i=s.next;if(Bt(t,e,i)>=0)return!1;const r=t.x,n=e.x,o=i.x,a=t.y,h=e.y,l=i.y,c=Math.min(r,n,o),u=Math.min(a,h,l),_=Math.max(r,n,o),d=Math.max(a,h,l);let f=i.next;for(;f!==t;){if(f.x>=c&&f.x<=_&&f.y>=u&&f.y<=d&&Ti(r,a,n,h,o,l,f.x,f.y)&&Bt(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function nu(s,t,e,i){const r=s.prev,n=s,o=s.next;if(Bt(r,n,o)>=0)return!1;const a=r.x,h=n.x,l=o.x,c=r.y,u=n.y,_=o.y,d=Math.min(a,h,l),f=Math.min(c,u,_),g=Math.max(a,h,l),p=Math.max(c,u,_),y=Fr(d,f,t,e,i),x=Fr(g,p,t,e,i);let b=s.prevZ,v=s.nextZ;for(;b&&b.z>=y&&v&&v.z<=x;){if(b.x>=d&&b.x<=g&&b.y>=f&&b.y<=p&&b!==r&&b!==o&&Ti(a,c,h,u,l,_,b.x,b.y)&&Bt(b.prev,b,b.next)>=0||(b=b.prevZ,v.x>=d&&v.x<=g&&v.y>=f&&v.y<=p&&v!==r&&v!==o&&Ti(a,c,h,u,l,_,v.x,v.y)&&Bt(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;b&&b.z>=y;){if(b.x>=d&&b.x<=g&&b.y>=f&&b.y<=p&&b!==r&&b!==o&&Ti(a,c,h,u,l,_,b.x,b.y)&&Bt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;v&&v.z<=x;){if(v.x>=d&&v.x<=g&&v.y>=f&&v.y<=p&&v!==r&&v!==o&&Ti(a,c,h,u,l,_,v.x,v.y)&&Bt(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function ou(s,t){let e=s;do{const i=e.prev,r=e.next.next;!fi(i,r)&&Fa(i,e,e.next,r)&&Oi(i,r)&&Oi(r,i)&&(t.push(i.i,e.i,r.i),Gi(e),Gi(e.next),e=s=r),e=e.next}while(e!==s);return ti(e)}function au(s,t,e,i,r,n){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&gu(o,a)){let h=Ba(o,a);o=ti(o,o.next),h=ti(h,h.next),Li(o,t,e,i,r,n,0),Li(h,t,e,i,r,n,0);return}a=a.next}o=o.next}while(o!==s)}function hu(s,t,e,i){const r=[];for(let n=0,o=t.length;n<o;n++){const a=t[n]*i,h=n<o-1?t[n+1]*i:s.length,l=Ea(s,a,h,i,!1);l===l.next&&(l.steiner=!0),r.push(pu(l))}r.sort(lu);for(let n=0;n<r.length;n++)e=cu(r[n],e);return e}function lu(s,t){let e=s.x-t.x;if(e===0&&(e=s.y-t.y,e===0)){const i=(s.next.y-s.y)/(s.next.x-s.x),r=(t.next.y-t.y)/(t.next.x-t.x);e=i-r}return e}function cu(s,t){const e=uu(s,t);if(!e)return t;const i=Ba(e,s);return ti(i,i.next),ti(e,e.next)}function uu(s,t){let e=t;const i=s.x,r=s.y;let n=-1/0,o;if(fi(s,e))return e;do{if(fi(s,e.next))return e.next;if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){const u=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=i&&u>n&&(n=u,o=e.x<e.next.x?e:e.next,u===i))return o}e=e.next}while(e!==t);if(!o)return null;const a=o,h=o.x,l=o.y;let c=1/0;e=o;do{if(i>=e.x&&e.x>=h&&i!==e.x&&Ra(r<l?i:n,r,h,l,r<l?n:i,r,e.x,e.y)){const u=Math.abs(r-e.y)/(i-e.x);Oi(e,s)&&(u<c||u===c&&(e.x>o.x||e.x===o.x&&du(o,e)))&&(o=e,c=u)}e=e.next}while(e!==a);return o}function du(s,t){return Bt(s.prev,s,t.prev)<0&&Bt(t.next,s,s.next)<0}function _u(s,t,e,i){let r=s;do r.z===0&&(r.z=Fr(r.x,r.y,t,e,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,fu(r)}function fu(s){let t,e=1;do{let i=s,r;s=null;let n=null;for(t=0;i;){t++;let o=i,a=0;for(let l=0;l<e&&(a++,o=o.nextZ,!!o);l++);let h=e;for(;a>0||h>0&&o;)a!==0&&(h===0||!o||i.z<=o.z)?(r=i,i=i.nextZ,a--):(r=o,o=o.nextZ,h--),n?n.nextZ=r:s=r,r.prevZ=n,n=r;i=o}n.nextZ=null,e*=2}while(t>1);return s}function Fr(s,t,e,i,r){return s=(s-e)*r|0,t=(t-i)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function pu(s){let t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function Ra(s,t,e,i,r,n,o,a){return(r-o)*(t-a)>=(s-o)*(n-a)&&(s-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(r-o)*(i-a)}function Ti(s,t,e,i,r,n,o,a){return!(s===o&&t===a)&&Ra(s,t,e,i,r,n,o,a)}function gu(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!mu(s,t)&&(Oi(s,t)&&Oi(t,s)&&yu(s,t)&&(Bt(s.prev,s,t.prev)||Bt(s,t.prev,t))||fi(s,t)&&Bt(s.prev,s,s.next)>0&&Bt(t.prev,t,t.next)>0)}function Bt(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function fi(s,t){return s.x===t.x&&s.y===t.y}function Fa(s,t,e,i){const r=is(Bt(s,t,e)),n=is(Bt(s,t,i)),o=is(Bt(e,i,s)),a=is(Bt(e,i,t));return!!(r!==n&&o!==a||r===0&&es(s,e,t)||n===0&&es(s,i,t)||o===0&&es(e,s,i)||a===0&&es(e,t,i))}function es(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function is(s){return s>0?1:s<0?-1:0}function mu(s,t){let e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&Fa(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Oi(s,t){return Bt(s.prev,s,s.next)<0?Bt(s,t,s.next)>=0&&Bt(s,s.prev,t)>=0:Bt(s,t,s.prev)<0||Bt(s,s.next,t)<0}function yu(s,t){let e=s,i=!1;const r=(s.x+t.x)/2,n=(s.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&r<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==s);return i}function Ba(s,t){const e=Br(s.i,s.x,s.y),i=Br(t.i,t.x,t.y),r=s.next,n=t.prev;return s.next=t,t.prev=s,e.next=r,r.prev=e,i.next=e,e.prev=i,n.next=i,i.prev=n,i}function $n(s,t,e,i){const r=Br(s,t,e);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Gi(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Br(s,t,e){return{i:s,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function xu(s,t,e,i){let r=0;for(let n=t,o=e-i;n<e;n+=i)r+=(s[o]-s[n])*(s[n+1]+s[o+1]),o=n;return r}const bu=Yn.default||Yn;var La=(s=>(s[s.NONE=0]="NONE",s[s.COLOR=16384]="COLOR",s[s.STENCIL=1024]="STENCIL",s[s.DEPTH=256]="DEPTH",s[s.COLOR_DEPTH=16640]="COLOR_DEPTH",s[s.COLOR_STENCIL=17408]="COLOR_STENCIL",s[s.DEPTH_STENCIL=1280]="DEPTH_STENCIL",s[s.ALL=17664]="ALL",s))(La||{});class vu{constructor(t){this.items=[],this._name=t}emit(t,e,i,r,n,o,a,h){const{name:l,items:c}=this;for(let u=0,_=c.length;u<_;u++)c[u][l](t,e,i,r,n,o,a,h);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const wu=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Oa=class Ga extends we{constructor(t){super(),this.uid=Ot("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...wu,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(t={}){const e=t.skipExtensionImports===!0?!0:t.manageImports===!1;await iu(e),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const i in this._systemsHash)t={...this._systemsHash[i].constructor.defaultOptions,...t};t={...Ga.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let i=0;i<this.runners.init.items.length;i++)await this.runners.init.items[i].init(t);this._initOptions=t}render(t,e){let i=t;if(i instanceof ct&&(i={container:i},e&&(ht(wt,"passing a second argument is deprecated, please use render options instead"),i.target=e.renderTexture)),i.target||(i.target=this.view.renderTarget),i.target===this.view.renderTarget&&(this._lastObjectRendered=i.container,i.clearColor??(i.clearColor=this.background.colorRgba),i.clear??(i.clear=this.background.clearBeforeRender)),i.clearColor){const r=Array.isArray(i.clearColor)&&i.clearColor.length===4;i.clearColor=r?i.clearColor:Ht.shared.setValue(i.clearColor).toArray()}i.transform||(i.container.updateLocalTransform(),i.transform=i.container.localTransform),i.container.visible&&(i.container.enableRenderGroup(),this.runners.prerender.emit(i),this.runners.renderStart.emit(i),this.runners.render.emit(i),this.runners.renderEnd.emit(i),this.runners.postrender.emit(i))}resize(t,e,i){const r=this.view.resolution;this.view.resize(t,e,i),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),i!==void 0&&i!==r&&this.runners.resolutionChange.emit(i)}clear(t={}){const e=this;t.target||(t.target=e.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=La.ALL);const{clear:i,clearColor:r,target:n}=t;Ht.shared.setValue(r??this.background.colorRgba),e.renderTarget.clear(n,i,Ht.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new vu(e)})}_addSystems(t){let e;for(e in t){const i=t[e];this._addSystem(i.value,i.name)}}_addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const r in this.runners)this.runners[r].add(i);return this}_addPipes(t,e){const i=e.reduce((r,n)=>(r[n.name]=n.value,r),{});t.forEach(r=>{const n=r.value,o=r.name,a=i[o];this.renderPipes[o]=new n(this,a?new a:null),this.runners.destroy.add(this.renderPipes[o])})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(e=>{e.destroy()}),(t===!0||typeof t=="object"&&t.releaseGlobalResources)&&Ui.release(),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!su())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Oa.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Da=Oa,ss;function ku(s){return ss!==void 0||(ss=(()=>{const t={stencil:!0,failIfMajorPerformanceCaveat:s??Da.defaultOptions.failIfMajorPerformanceCaveat};try{if(!zt.get().getWebGLRenderingContext())return!1;let i=zt.get().createCanvas().getContext("webgl",t);const r=!!i?.getContextAttributes()?.stencil;if(i){const n=i.getExtension("WEBGL_lose_context");n&&n.loseContext()}return i=null,r}catch{return!1}})()),ss}let rs;async function Au(s={}){return rs!==void 0||(rs=await(async()=>{const t=zt.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(s)).requestDevice(),!0}catch{return!1}})()),rs}const qn=["webgl","webgpu","canvas"];async function Su(s){let t=[];s.preference?(t.push(s.preference),qn.forEach(n=>{n!==s.preference&&t.push(n)})):t=qn.slice();let e,i={};for(let n=0;n<t.length;n++){const o=t[n];if(o==="webgpu"&&await Au()){const{WebGPURenderer:a}=await fs(async()=>{const{WebGPURenderer:h}=await import("./WebGPURenderer-DhLjFybS.js");return{WebGPURenderer:h}},__vite__mapDeps([55,2,56,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]),import.meta.url);e=a,i={...s,...s.webgpu};break}else if(o==="webgl"&&ku(s.failIfMajorPerformanceCaveat??Da.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await fs(async()=>{const{WebGLRenderer:h}=await import("./WebGLRenderer-BFODkE0d.js");return{WebGLRenderer:h}},__vite__mapDeps([57,2,56,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]),import.meta.url);e=a,i={...s,...s.webgl};break}else if(o==="canvas")throw i={...s},new Error("CanvasRenderer is not yet implemented")}if(delete i.webgpu,delete i.webgl,!e)throw new Error("No available renderer for the current environment");const r=new e;return await r.init(i),r}const Na="8.14.1";class Ua{static init(){globalThis.__PIXI_APP_INIT__?.(this,Na)}static destroy(){}}Ua.extension=j.Application;class Cu{constructor(t){this._renderer=t}init(){globalThis.__PIXI_RENDERER_INIT__?.(this._renderer,Na)}destroy(){this._renderer=null}}Cu.extension={type:[j.WebGLSystem,j.WebGPUSystem],name:"initHook",priority:-10};const Wa=class Lr{constructor(...t){this.stage=new ct,t[0]!==void 0&&ht(wt,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.renderer=await Su(t),Lr._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return ht(wt,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,e=!1){const i=Lr._plugins.slice(0);i.reverse(),i.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Wa._plugins=[];let Ha=Wa;jt.handleByList(j.Application,Ha._plugins);jt.add(Ua);class Va extends we{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return ht(wt,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return ht(wt,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return ht(wt,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return ht(wt,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return ht(wt,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners();for(const e in this.chars)this.chars[e].texture?.destroy();this.chars=null,t&&(this.pages.forEach(e=>e.texture.destroy(!0)),this.pages=null)}}class Mu{constructor(t=0,e=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=i,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map(e=>[e,this.get(e)])}evict(t=!1){if(t||this.size>0){const e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){const e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){const t=[];let e=this.first;for(;e!==null;)t.push(e.key),e=e.next;return t}setWithEvicted(t,e,i=this.resetTtl){let r=null;if(this.has(t))this.set(t,e,!0,i);else{this.max>0&&this.size===this.max&&(r={...this.first},this.evict(!0));let n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=n:this.last.next=n,this.last=n}return r}set(t,e,i=!1,r=this.resetTtl){let n=this.items[t];return i||n!==void 0?(n.value=e,i===!1&&r&&(n.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(n)):(this.max>0&&this.size===this.max&&this.evict(!0),n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=n:this.last.next=n,this.last=n),this}values(t=this.keys()){return t.map(e=>this.get(e))}}function Xa(s=1e3,t=0,e=!1){if(isNaN(s)||s<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new Mu(s,t,e)}const Tu=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Or(s){const t=typeof s.fontSize=="number"?`${s.fontSize}px`:s.fontSize;let e=s.fontFamily;Array.isArray(s.fontFamily)||(e=s.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let r=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!Tu.includes(r)&&(r=`"${r}"`),e[i]=r}return`${s.fontStyle} ${s.fontVariant} ${s.fontWeight} ${t} ${e.join(",")}`}const or={willReadFrequently:!0},ke=class V{static get experimentalLetterSpacingSupported(){let t=V._experimentalLetterSpacingSupported;if(t===void 0){const e=zt.get().getCanvasRenderingContext2D().prototype;t=V._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,r,n,o,a,h,l){this.text=t,this.style=e,this.width=i,this.height=r,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=h,this.fontProperties=l}static measureText(t=" ",e,i=V._canvas,r=e.wordWrap){const n=`${t}-${e.styleKey}-wordWrap-${r}`;if(V._measurementCache.has(n))return V._measurementCache.get(n);const o=Or(e),a=V.measureFont(o);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const h=V.__context;h.font=o;const c=(r?V._wordWrap(t,e,i):t).split(/(?:\r\n|\r|\n)/),u=new Array(c.length);let _=0;for(let x=0;x<c.length;x++){const b=V._measureText(c[x],e.letterSpacing,h);u[x]=b,_=Math.max(_,b)}const d=e._stroke?.width||0;let f=_+d;e.dropShadow&&(f+=e.dropShadow.distance);const g=e.lineHeight||a.fontSize;let p=Math.max(g,a.fontSize+d)+(c.length-1)*(g+e.leading);e.dropShadow&&(p+=e.dropShadow.distance);const y=new V(t,e,f,p,c,u,g+e.leading,_,a);return V._measurementCache.set(n,y),y}static _measureText(t,e,i){let r=!1;V.experimentalLetterSpacingSupported&&(V.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,r=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const n=i.measureText(t);let o=n.width;const a=-n.actualBoundingBoxLeft;let l=n.actualBoundingBoxRight-a;if(o>0)if(r)o-=e,l-=e;else{const c=(V.graphemeSegmenter(t).length-1)*e;o+=c,l+=c}return Math.max(o,l)}static _wordWrap(t,e,i=V._canvas){const r=i.getContext("2d",or);let n=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:c}=e,u=V._collapseSpaces(c),_=V._collapseNewlines(c);let d=!u;const f=e.wordWrapWidth+l,g=V._tokenize(t);for(let p=0;p<g.length;p++){let y=g[p];if(V._isNewline(y)){if(!_){a+=V._addLine(o),d=!u,o="",n=0;continue}y=" "}if(u){const b=V.isBreakingSpace(y),v=V.isBreakingSpace(o[o.length-1]);if(b&&v)continue}const x=V._getFromCache(y,l,h,r);if(x>f)if(o!==""&&(a+=V._addLine(o),o="",n=0),V.canBreakWords(y,e.breakWords)){const b=V.wordWrapSplit(y);for(let v=0;v<b.length;v++){let C=b[v],w=C,k=1;for(;b[v+k];){const S=b[v+k];if(!V.canBreakChars(w,S,y,v,e.breakWords))C+=S;else break;w=S,k++}v+=k-1;const R=V._getFromCache(C,l,h,r);R+n>f&&(a+=V._addLine(o),d=!1,o="",n=0),o+=C,n+=R}}else{o.length>0&&(a+=V._addLine(o),o="",n=0);const b=p===g.length-1;a+=V._addLine(y,!b),d=!1,o="",n=0}else x+n>f&&(d=!1,a+=V._addLine(o),o="",n=0),(o.length>0||!V.isBreakingSpace(y)||d)&&(o+=y,n+=x)}return a+=V._addLine(o,!1),a}static _addLine(t,e=!0){return t=V._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,i,r){let n=i[t];return typeof n!="number"&&(n=V._measureText(t,e,r)+e,i[t]=n),n}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!V.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:V._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:V._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let r=0;r<t.length;r++){const n=t[r],o=t[r+1];if(V.isBreakingSpace(n,o)||V._isNewline(n)){i!==""&&(e.push(i),i=""),n==="\r"&&o===`
`?(e.push(`\r
`),r++):e.push(n);continue}i+=n}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,r,n){return!0}static wordWrapSplit(t){return V.graphemeSegmenter(t)}static measureFont(t){if(V._fonts[t])return V._fonts[t];const e=V._context;e.font=t;const i=e.measureText(V.METRICS_STRING+V.BASELINE_SYMBOL),r={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return V._fonts[t]=r,r}static clearMetrics(t=""){t?delete V._fonts[t]:V._fonts={}}static get _canvas(){if(!V.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",or)?.measureText)return V.__canvas=e,e;t=zt.get().createCanvas()}catch{t=zt.get().createCanvas()}t.width=t.height=10,V.__canvas=t}return V.__canvas}static get _context(){return V.__context||(V.__context=V._canvas.getContext("2d",or)),V.__context}};ke.METRICS_STRING="|q";ke.BASELINE_SYMBOL="M";ke.BASELINE_MULTIPLIER=1.4;ke.HEIGHT_MULTIPLIER=2;ke.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const s=new Intl.Segmenter;return t=>{const e=s.segment(t),i=[];let r=0;for(const n of e)i[r++]=n.segment;return i}}return s=>[...s]})();ke.experimentalLetterSpacing=!1;ke._fonts={};ke._newlines=[10,13];ke._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];ke._measurementCache=Xa(1e3);let us=ke;const jn=[{offset:0,color:"white"},{offset:1,color:"black"}],tn=class Gr{constructor(...t){this.uid=Ot("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=Pu(t);e={...e.type==="radial"?Gr.defaultRadialOptions:Gr.defaultLinearOptions,...qo(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(r=>{this.addColorStop(r.offset,r.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:Ht.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:i,y:r}=this.end,n=i-t,o=r-e;const a=n<0||o<0;if(this._wrapMode==="clamp-to-edge"){if(n<0){const p=t;t=i,i=p,n*=-1}if(o<0){const p=e;e=r,r=p,o*=-1}}const h=this.colorStops.length?this.colorStops:jn,l=this._textureSize,{canvas:c,context:u}=Zn(l,1),_=a?u.createLinearGradient(this._textureSize,0,0,0):u.createLinearGradient(0,0,this._textureSize,0);Kn(_,h),u.fillStyle=_,u.fillRect(0,0,l,1),this.texture=new _t({source:new Je({resource:c,addressMode:this._wrapMode})});const d=Math.sqrt(n*n+o*o),f=Math.atan2(o,n),g=new pt;g.scale(d/l,1),g.rotate(f),g.translate(t,e),this.textureSpace==="local"&&g.scale(l,l),this.transform=g}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:jn,e=this._textureSize,{canvas:i,context:r}=Zn(e,e),{x:n,y:o}=this.center,{x:a,y:h}=this.outerCenter,l=this.innerRadius,c=this.outerRadius,u=a-c,_=h-c,d=e/(c*2),f=(n-u)*d,g=(o-_)*d,p=r.createRadialGradient(f,g,l*d,(a-u)*d,(h-_)*d,c*d);Kn(p,t),r.fillStyle=t[t.length-1].color,r.fillRect(0,0,e,e),r.fillStyle=p,r.translate(f,g),r.rotate(this.rotation),r.scale(1,this.scale),r.translate(-f,-g),r.fillRect(0,0,e,e),this.texture=new _t({source:new Je({resource:i,addressMode:this._wrapMode})});const y=new pt;y.scale(1/d,1/d),y.translate(u,_),this.textureSpace==="local"&&y.scale(e,e),this.transform=y}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};tn.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};tn.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Be=tn;function Kn(s,t){for(let e=0;e<t.length;e++){const i=t[e];s.addColorStop(i.offset,i.color)}}function Zn(s,t){const e=zt.get().createCanvas(s,t),i=e.getContext("2d");return{canvas:e,context:i}}function Pu(s){let t=s[0]??{};return(typeof t=="number"||s[1])&&(ht("8.5.2","use options object instead"),t={type:"linear",start:{x:s[0],y:s[1]},end:{x:s[2],y:s[3]},textureSpace:s[4],textureSize:s[5]??Be.defaultLinearOptions.textureSize}),t}const Qn={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Cs{constructor(t,e){this.uid=Ot("fillPattern"),this._tick=0,this.transform=new pt,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=Qn[e].addressModeU,t.source.style.addressModeV=Qn[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}var ar,Jn;function Iu(){if(Jn)return ar;Jn=1,ar=e;var s={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},t=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function e(n){var o=[];return n.replace(t,function(a,h,l){var c=h.toLowerCase();for(l=r(l),c=="m"&&l.length>2&&(o.push([h].concat(l.splice(0,2))),c="l",h=h=="m"?"l":"L");;){if(l.length==s[c])return l.unshift(h),o.push(l);if(l.length<s[c])throw new Error("malformed path data");o.push([h].concat(l.splice(0,s[c])))}}),o}var i=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function r(n){var o=n.match(i);return o?o.map(Number):[]}return ar}var zu=Iu();const Eu=Do(zu);function Ru(s,t){const e=Eu(s),i=[];let r=null,n=0,o=0;for(let a=0;a<e.length;a++){const h=e[a],l=h[0],c=h;switch(l){case"M":n=c[1],o=c[2],t.moveTo(n,o);break;case"m":n+=c[1],o+=c[2],t.moveTo(n,o);break;case"H":n=c[1],t.lineTo(n,o);break;case"h":n+=c[1],t.lineTo(n,o);break;case"V":o=c[1],t.lineTo(n,o);break;case"v":o+=c[1],t.lineTo(n,o);break;case"L":n=c[1],o=c[2],t.lineTo(n,o);break;case"l":n+=c[1],o+=c[2],t.lineTo(n,o);break;case"C":n=c[5],o=c[6],t.bezierCurveTo(c[1],c[2],c[3],c[4],n,o);break;case"c":t.bezierCurveTo(n+c[1],o+c[2],n+c[3],o+c[4],n+c[5],o+c[6]),n+=c[5],o+=c[6];break;case"S":n=c[3],o=c[4],t.bezierCurveToShort(c[1],c[2],n,o);break;case"s":t.bezierCurveToShort(n+c[1],o+c[2],n+c[3],o+c[4]),n+=c[3],o+=c[4];break;case"Q":n=c[3],o=c[4],t.quadraticCurveTo(c[1],c[2],n,o);break;case"q":t.quadraticCurveTo(n+c[1],o+c[2],n+c[3],o+c[4]),n+=c[3],o+=c[4];break;case"T":n=c[1],o=c[2],t.quadraticCurveToShort(n,o);break;case"t":n+=c[1],o+=c[2],t.quadraticCurveToShort(n,o);break;case"A":n=c[6],o=c[7],t.arcToSvg(c[1],c[2],c[3],c[4],c[5],n,o);break;case"a":n+=c[6],o+=c[7],t.arcToSvg(c[1],c[2],c[3],c[4],c[5],n,o);break;case"Z":case"z":t.closePath(),i.length>0&&(r=i.pop(),r?(n=r.startX,o=r.startY):(n=0,o=0)),r=null;break;default:It(`Unknown SVG path command: ${l}`)}l!=="Z"&&l!=="z"&&r===null&&(r={startX:n,startY:o},i.push(r))}return t}class en{constructor(t=0,e=0,i=0){this.type="circle",this.x=t,this.y=e,this.radius=i}clone(){return new en(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let r=this.x-t,n=this.y-e;return r*=r,n*=n,r+n<=i}strokeContains(t,e,i,r=.5){if(this.radius===0)return!1;const n=this.x-t,o=this.y-e,a=this.radius,h=(1-r)*i,l=Math.sqrt(n*n+o*o);return l<=a+h&&l>a-(i-h)}getBounds(t){return t||(t=new Mt),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class sn{constructor(t=0,e=0,i=0,r=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=i,this.halfHeight=r}clone(){return new sn(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let i=(t-this.x)/this.halfWidth,r=(e-this.y)/this.halfHeight;return i*=i,r*=r,i+r<=1}strokeContains(t,e,i,r=.5){const{halfWidth:n,halfHeight:o}=this;if(n<=0||o<=0)return!1;const a=i*(1-r),h=i-a,l=n-h,c=o-h,u=n+a,_=o+a,d=t-this.x,f=e-this.y,g=d*d/(l*l)+f*f/(c*c),p=d*d/(u*u)+f*f/(_*_);return g>1&&p<=1}getBounds(t){return t||(t=new Mt),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function Fu(s,t,e,i,r,n){const o=s-e,a=t-i,h=r-e,l=n-i,c=o*h+a*l,u=h*h+l*l;let _=-1;u!==0&&(_=c/u);let d,f;_<0?(d=e,f=i):_>1?(d=r,f=n):(d=e+_*h,f=i+_*l);const g=s-d,p=t-f;return g*g+p*p}let Bu,Lu;class zi{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let r=0,n=e.length;r<n;r++)i.push(e[r].x,e[r].y);e=i}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,i=e.length;for(let r=0;r<i;r+=2){const n=e[r],o=e[r+1],a=e[(r+2)%i],h=e[(r+3)%i];t+=(a-n)*(h+o)}return t<0}containsPolygon(t){const e=this.getBounds(Bu),i=t.getBounds(Lu);if(!e.containsRect(i))return!1;const r=t.points;for(let n=0;n<r.length;n+=2){const o=r[n],a=r[n+1];if(!this.contains(o,a))return!1}return!0}clone(){const t=this.points.slice(),e=new zi(t);return e.closePath=this.closePath,e}contains(t,e){let i=!1;const r=this.points.length/2;for(let n=0,o=r-1;n<r;o=n++){const a=this.points[n*2],h=this.points[n*2+1],l=this.points[o*2],c=this.points[o*2+1];h>e!=c>e&&t<(l-a)*((e-h)/(c-h))+a&&(i=!i)}return i}strokeContains(t,e,i,r=.5){const n=i*i,o=n*(1-r),a=n-o,{points:h}=this,l=h.length-(this.closePath?0:2);for(let c=0;c<l;c+=2){const u=h[c],_=h[c+1],d=h[(c+2)%h.length],f=h[(c+3)%h.length],g=Fu(t,e,u,_,d,f),p=Math.sign((d-u)*(e-_)-(f-_)*(t-u));if(g<=(p<0?a:o))return!0}return!1}getBounds(t){t||(t=new Mt);const e=this.points;let i=1/0,r=-1/0,n=1/0,o=-1/0;for(let a=0,h=e.length;a<h;a+=2){const l=e[a],c=e[a+1];i=l<i?l:i,r=l>r?l:r,n=c<n?c:n,o=c>o?c:o}return t.x=i,t.width=r-i,t.y=n,t.height=o-n,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return ht("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return ht("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const ns=(s,t,e,i,r,n,o)=>{const a=s-e,h=t-i,l=Math.sqrt(a*a+h*h);return l>=r-n&&l<=r+o};class rn{constructor(t=0,e=0,i=0,r=0,n=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=i,this.height=r,this.radius=n}getBounds(t){return t||(t=new Mt),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new rn(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let r=t-(this.x+i),n=e-(this.y+i);const o=i*i;if(r*r+n*n<=o||(r=t-(this.x+this.width-i),r*r+n*n<=o)||(n=e-(this.y+this.height-i),r*r+n*n<=o)||(r=t-(this.x+i),r*r+n*n<=o))return!0}return!1}strokeContains(t,e,i,r=.5){const{x:n,y:o,width:a,height:h,radius:l}=this,c=i*(1-r),u=i-c,_=n+l,d=o+l,f=a-l*2,g=h-l*2,p=n+a,y=o+h;return(t>=n-c&&t<=n+u||t>=p-u&&t<=p+c)&&e>=d&&e<=d+g||(e>=o-c&&e<=o+u||e>=y-u&&e<=y+c)&&t>=_&&t<=_+f?!0:t<_&&e<d&&ns(t,e,_,d,l,u,c)||t>p-l&&e<d&&ns(t,e,p-l,d,l,u,c)||t>p-l&&e>y-l&&ns(t,e,p-l,y-l,l,u,c)||t<_&&e>y-l&&ns(t,e,_,y-l,l,u,c)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const Ya={};function Ou(s,t,e){let i=2166136261;for(let r=0;r<t;r++)i^=s[r].uid,i=Math.imul(i,16777619),i>>>=0;return Ya[i]||Gu(s,t,i,e)}function Gu(s,t,e,i){const r={};let n=0;for(let a=0;a<i;a++){const h=a<t?s[a]:_t.EMPTY.source;r[n++]=h.source,r[n++]=h.style}const o=new cs(r);return Ya[e]=o,o}class to{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function eo(s,t){const e=s.byteLength/8|0,i=new Float64Array(s,0,e);new Float64Array(t,0,e).set(i);const n=s.byteLength-e*8;if(n>0){const o=new Uint8Array(s,e*8,n);new Uint8Array(t,e*8,n).set(o)}}const Du={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var Nu=(s=>(s[s.DISABLED=0]="DISABLED",s[s.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",s[s.MASK_ACTIVE=2]="MASK_ACTIVE",s[s.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",s[s.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",s[s.NONE=5]="NONE",s))(Nu||{});function io(s,t){return t.alphaMode==="no-premultiply-alpha"&&Du[s]||s}const Uu=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Wu(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function Hu(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const i=Uu.replace(/%forloop%/gi,Wu(s));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}}finally{t.deleteShader(e)}return s}let ii=null;function Vu(){if(ii)return ii;const s=Aa();return ii=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),ii=Hu(ii,s),s.getExtension("WEBGL_lose_context")?.loseContext(),ii}class Xu{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class Yu{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new Xu,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const Ei=[];let bs=0;Ui.register({clear:()=>{if(Ei.length>0)for(const s of Ei)s&&s.destroy();Ei.length=0,bs=0}});function so(){return bs>0?Ei[--bs]:new Yu}function ro(s){Ei[bs++]=s}let ki=0;const $a=class qa{constructor(t){this.uid=Ot("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...qa.defaultOptions,...t},t.maxTextures||(ht("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=Vu());const{maxTextures:e,attributesInitialSize:i,indicesInitialSize:r}=t;this.attributeBuffer=new to(i*4),this.indexBuffer=new Uint16Array(r),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)ro(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const i=t._batch.textures.ids[e._source.uid];return!i&&i!==0?!1:(t._textureId=i,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let i=so(),r=i.textures;r.clear();const n=e[this.elementStart];let o=io(n.blendMode,n.texture._source),a=n.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const h=this.attributeBuffer.float32View,l=this.attributeBuffer.uint32View,c=this.indexBuffer;let u=this._batchIndexSize,_=this._batchIndexStart,d="startBatch";const f=this.maxTextures;for(let g=this.elementStart;g<this.elementSize;++g){const p=e[g];e[g]=null;const x=p.texture._source,b=io(p.blendMode,x),v=o!==b||a!==p.topology;if(x._batchTick===ki&&!v){p._textureId=x._textureBindLocation,u+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,h,l,p._attributeStart,p._textureId),this.packQuadIndex(c,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,h,l,p._attributeStart,p._textureId),this.packIndex(p,c,p._indexStart,p._attributeStart/this.vertexSize)),p._batch=i;continue}x._batchTick=ki,(r.count>=f||v)&&(this._finishBatch(i,_,u-_,r,o,a,t,d),d="renderBatch",_=u,o=b,a=p.topology,i=so(),r=i.textures,r.clear(),++ki),p._textureId=x._textureBindLocation=r.count,r.ids[x.uid]=r.count,r.textures[r.count++]=x,p._batch=i,u+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,h,l,p._attributeStart,p._textureId),this.packQuadIndex(c,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,h,l,p._attributeStart,p._textureId),this.packIndex(p,c,p._indexStart,p._attributeStart/this.vertexSize))}r.count>0&&(this._finishBatch(i,_,u-_,r,o,a,t,d),_=u,++ki),this.elementStart=this.elementSize,this._batchIndexStart=_,this._batchIndexSize=u}_finishBatch(t,e,i,r,n,o,a,h){t.gpuBindGroup=null,t.bindGroup=null,t.action=h,t.batcher=this,t.textures=r,t.blendMode=n,t.topology=o,t.start=e,t.size=i,++ki,this.batches[this.batchIndex++]=t,a.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),i=new to(e);eo(this.attributeBuffer.rawBinaryData,i.rawBinaryData),this.attributeBuffer=i}_resizeIndexBuffer(t){const e=this.indexBuffer;let i=Math.max(t,e.length*1.5);i+=i%2;const r=i>65535?new Uint32Array(i):new Uint16Array(i);if(r.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let n=0;n<e.length;n++)r[n]=e[n];else eo(e.buffer,r.buffer);this.indexBuffer=r}packQuadIndex(t,e,i){t[e]=i+0,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+0,t[e+4]=i+2,t[e+5]=i+3}packIndex(t,e,i,r){const n=t.indices,o=t.indexSize,a=t.indexOffset,h=t.attributeOffset;for(let l=0;l<o;l++)e[i++]=r+n[l+a]-h}destroy(){if(this.batches!==null){for(let t=0;t<this.batches.length;t++)ro(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]&&(this._elements[t]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};$a.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let $u=$a;var se=(s=>(s[s.MAP_READ=1]="MAP_READ",s[s.MAP_WRITE=2]="MAP_WRITE",s[s.COPY_SRC=4]="COPY_SRC",s[s.COPY_DST=8]="COPY_DST",s[s.INDEX=16]="INDEX",s[s.VERTEX=32]="VERTEX",s[s.UNIFORM=64]="UNIFORM",s[s.STORAGE=128]="STORAGE",s[s.INDIRECT=256]="INDIRECT",s[s.QUERY_RESOLVE=512]="QUERY_RESOLVE",s[s.STATIC=1024]="STATIC",s))(se||{});class Di extends we{constructor(t){let{data:e,size:i}=t;const{usage:r,label:n,shrinkToFit:o}=t;super(),this.uid=Ot("buffer"),this._resourceType="buffer",this._resourceId=Ot("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,i??(i=e?.byteLength);const a=!!e;this.descriptor={size:i,usage:r,mappedAtCreation:a,label:n},this.shrinkToFit=o??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&se.STATIC)}set static(t){t?this.descriptor.usage|=se.STATIC:this.descriptor.usage&=~se.STATIC}setDataWithSize(t,e,i){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){i&&this.emit("update",this);return}const r=this._data;if(this._data=t,this._dataInt32=null,!r||r.length!==t.length){!this.shrinkToFit&&r&&t.byteLength<r.byteLength?i&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=Ot("resource"),this.emit("change",this));return}i&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function ja(s,t){if(!(s instanceof Di)){let e=t?se.INDEX:se.VERTEX;s instanceof Array&&(t?(s=new Uint32Array(s),e=se.INDEX|se.COPY_DST):(s=new Float32Array(s),e=se.VERTEX|se.COPY_DST)),s=new Di({data:s,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return s}function qu(s,t,e){const i=s.getAttribute(t);if(!i)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const r=i.buffer.data;let n=1/0,o=1/0,a=-1/0,h=-1/0;const l=r.BYTES_PER_ELEMENT,c=(i.offset||0)/l,u=(i.stride||8)/l;for(let _=c;_<r.length;_+=u){const d=r[_],f=r[_+1];d>a&&(a=d),f>h&&(h=f),d<n&&(n=d),f<o&&(o=f)}return e.minX=n,e.minY=o,e.maxX=a,e.maxY=h,e}function ju(s){return(s instanceof Di||Array.isArray(s)||s.BYTES_PER_ELEMENT)&&(s={buffer:s}),s.buffer=ja(s.buffer,!1),s}class Ku extends we{constructor(t={}){super(),this.uid=Ot("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new be,this._boundsDirty=!0;const{attributes:e,indexBuffer:i,topology:r}=t;if(this.buffers=[],this.attributes={},e)for(const n in e)this.addAttribute(n,e[n]);this.instanceCount=t.instanceCount??1,i&&this.addIndex(i),this.topology=r||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const i=ju(e);this.buffers.indexOf(i.buffer)===-1&&(this.buffers.push(i.buffer),i.buffer.on("update",this.onBufferUpdate,this),i.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=i}addIndex(t){this.indexBuffer=ja(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,qu(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(e=>e.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const Zu=new Float32Array(1),Qu=new Uint32Array(1);class Ju extends Ku{constructor(){const e=new Di({data:Zu,label:"attribute-batch-buffer",usage:se.VERTEX|se.COPY_DST,shrinkToFit:!1}),i=new Di({data:Qu,label:"index-batch-buffer",usage:se.INDEX|se.COPY_DST,shrinkToFit:!1}),r=24;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:r,offset:0},aUV:{buffer:e,format:"float32x2",stride:r,offset:8},aColor:{buffer:e,format:"unorm8x4",stride:r,offset:16},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:r,offset:20}},indexBuffer:i})}}function no(s,t,e){if(s)for(const i in s){const r=i.toLocaleLowerCase(),n=t[r];if(n){let o=s[i];i==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&n.push(`//----${e}----//`),n.push(o)}else It(`${i} placement hook does not exist in shader`)}}const td=/\{\{(.*?)\}\}/g;function oo(s){const t={};return(s.match(td)?.map(i=>i.replace(/[{()}]/g,""))??[]).forEach(i=>{t[i]=[]}),t}function ao(s,t){let e;const i=/@in\s+([^;]+);/g;for(;(e=i.exec(s))!==null;)t.push(e[1])}function ho(s,t,e=!1){const i=[];ao(t,i),s.forEach(a=>{a.header&&ao(a.header,i)});const r=i;e&&r.sort();const n=r.map((a,h)=>`       @location(${h}) ${a},`).join(`
`);let o=t.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${n}
`),o}function lo(s,t){let e;const i=/@out\s+([^;]+);/g;for(;(e=i.exec(s))!==null;)t.push(e[1])}function ed(s){const e=/\b(\w+)\s*:/g.exec(s);return e?e[1]:""}function id(s){const t=/@.*?\s+/g;return s.replace(t,"")}function sd(s,t){const e=[];lo(t,e),s.forEach(h=>{h.header&&lo(h.header,e)});let i=0;const r=e.sort().map(h=>h.indexOf("builtin")>-1?h:`@location(${i++}) ${h}`).join(`,
`),n=e.sort().map(h=>`       var ${id(h)};`).join(`
`),o=`return VSOutput(
            ${e.sort().map(h=>` ${ed(h)}`).join(`,
`)});`;let a=t.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${r}
`),a=a.replace("{{start}}",`
${n}
`),a=a.replace("{{return}}",`
${o}
`),a}function co(s,t){let e=s;for(const i in t){const r=t[i];r.join(`
`).length?e=e.replace(`{{${i}}}`,`//-----${i} START-----//
${r.join(`
`)}
//----${i} FINISH----//`):e=e.replace(`{{${i}}}`,"")}return e}const De=Object.create(null),hr=new Map;let rd=0;function nd({template:s,bits:t}){const e=Ka(s,t);if(De[e])return De[e];const{vertex:i,fragment:r}=ad(s,t);return De[e]=Za(i,r,t),De[e]}function od({template:s,bits:t}){const e=Ka(s,t);return De[e]||(De[e]=Za(s.vertex,s.fragment,t)),De[e]}function ad(s,t){const e=t.map(o=>o.vertex).filter(o=>!!o),i=t.map(o=>o.fragment).filter(o=>!!o);let r=ho(e,s.vertex,!0);r=sd(e,r);const n=ho(i,s.fragment,!0);return{vertex:r,fragment:n}}function Ka(s,t){return t.map(e=>(hr.has(e)||hr.set(e,rd++),hr.get(e))).sort((e,i)=>e-i).join("-")+s.vertex+s.fragment}function Za(s,t,e){const i=oo(s),r=oo(t);return e.forEach(n=>{no(n.vertex,i,n.name),no(n.fragment,r,n.name)}),{vertex:co(s,i),fragment:co(t,r)}}const hd=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,ld=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,cd=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,ud=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,dd={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},_d={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function fd({bits:s,name:t}){const e=nd({template:{fragment:ld,vertex:hd},bits:[dd,...s]});return We.from({name:t,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function pd({bits:s,name:t}){return new _i({name:t,...od({template:{vertex:cd,fragment:ud},bits:[_d,...s]})})}const gd={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},md={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},lr={};function yd(s){const t=[];if(s===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let i=0;i<s;i++)t.push(`@group(1) @binding(${e++}) var textureSource${i+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${i+1}: sampler;`)}return t.join(`
`)}function xd(s){const t=[];if(s===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let e=0;e<s;e++)e===s-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function bd(s){return lr[s]||(lr[s]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${yd(s)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${xd(s)}
            `}}),lr[s]}const cr={};function vd(s){const t=[];for(let e=0;e<s;e++)e>0&&t.push("else"),e<s-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${e}], vUV);`),t.push("}");return t.join(`
`)}function wd(s){return cr[s]||(cr[s]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${s}];

            `,main:`

                ${vd(s)}
            `}}),cr[s]}const kd={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Ad={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},uo={};function Sd(s){let t=uo[s];if(t)return t;const e=new Int32Array(s);for(let i=0;i<s;i++)e[i]=i;return t=uo[s]=new Pa({uTextures:{value:e,type:"i32",size:s}},{isStatic:!0}),t}class Cd extends Ss{constructor(t){const e=pd({name:"batch",bits:[md,wd(t),Ad]}),i=fd({name:"batch",bits:[gd,bd(t),kd]});super({glProgram:e,gpuProgram:i,resources:{batchSamplers:Sd(t)}})}}let ur=null;const Qa=class Ja extends $u{constructor(t){super(t),this.geometry=new Ju,this.name=Ja.extension.name,this.vertexSize=6,ur??(ur=new Cd(t.maxTextures)),this.shader=ur}packAttributes(t,e,i,r,n){const o=n<<16|t.roundPixels&65535,a=t.transform,h=a.a,l=a.b,c=a.c,u=a.d,_=a.tx,d=a.ty,{positions:f,uvs:g}=t,p=t.color,y=t.attributeOffset,x=y+t.attributeSize;for(let b=y;b<x;b++){const v=b*2,C=f[v],w=f[v+1];e[r++]=h*C+c*w+_,e[r++]=u*w+l*C+d,e[r++]=g[v],e[r++]=g[v+1],i[r++]=p,i[r++]=o}}packQuadAttributes(t,e,i,r,n){const o=t.texture,a=t.transform,h=a.a,l=a.b,c=a.c,u=a.d,_=a.tx,d=a.ty,f=t.bounds,g=f.maxX,p=f.minX,y=f.maxY,x=f.minY,b=o.uvs,v=t.color,C=n<<16|t.roundPixels&65535;e[r+0]=h*p+c*x+_,e[r+1]=u*x+l*p+d,e[r+2]=b.x0,e[r+3]=b.y0,i[r+4]=v,i[r+5]=C,e[r+6]=h*g+c*x+_,e[r+7]=u*x+l*g+d,e[r+8]=b.x1,e[r+9]=b.y1,i[r+10]=v,i[r+11]=C,e[r+12]=h*g+c*y+_,e[r+13]=u*y+l*g+d,e[r+14]=b.x2,e[r+15]=b.y2,i[r+16]=v,i[r+17]=C,e[r+18]=h*p+c*y+_,e[r+19]=u*y+l*p+d,e[r+20]=b.x3,e[r+21]=b.y3,i[r+22]=v,i[r+23]=C}};Qa.extension={type:[j.Batcher],name:"default"};let Md=Qa;function Td(s,t,e,i,r,n,o,a=null){let h=0;e*=t,r*=n;const l=a.a,c=a.b,u=a.c,_=a.d,d=a.tx,f=a.ty;for(;h<o;){const g=s[e],p=s[e+1];i[r]=l*g+u*p+d,i[r+1]=c*g+_*p+f,r+=n,e+=t,h++}}function Pd(s,t,e,i){let r=0;for(t*=e;r<i;)s[t]=0,s[t+1]=0,t+=e,r++}function th(s,t,e,i,r){const n=t.a,o=t.b,a=t.c,h=t.d,l=t.tx,c=t.ty;e||(e=0),i||(i=2),r||(r=s.length/i-e);let u=e*i;for(let _=0;_<r;_++){const d=s[u],f=s[u+1];s[u]=n*d+a*f+l,s[u+1]=o*d+h*f+c,u+=i}}const Id=new pt;class eh{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,i=this.renderable;return i?ra(e,i.groupColor)+(this.alpha*i.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||Id}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const Ni={extension:{type:j.ShapeBuilder,name:"circle"},build(s,t){let e,i,r,n,o,a;if(s.type==="circle"){const v=s;if(o=a=v.radius,o<=0)return!1;e=v.x,i=v.y,r=n=0}else if(s.type==="ellipse"){const v=s;if(o=v.halfWidth,a=v.halfHeight,o<=0||a<=0)return!1;e=v.x,i=v.y,r=n=0}else{const v=s,C=v.width/2,w=v.height/2;e=v.x+C,i=v.y+w,o=a=Math.max(0,Math.min(v.radius,Math.min(C,w))),r=C-o,n=w-a}if(r<0||n<0)return!1;const h=Math.ceil(2.3*Math.sqrt(o+a)),l=h*8+(r?4:0)+(n?4:0);if(l===0)return!1;if(h===0)return t[0]=t[6]=e+r,t[1]=t[3]=i+n,t[2]=t[4]=e-r,t[5]=t[7]=i-n,!0;let c=0,u=h*4+(r?2:0)+2,_=u,d=l,f=r+o,g=n,p=e+f,y=e-f,x=i+g;if(t[c++]=p,t[c++]=x,t[--u]=x,t[--u]=y,n){const v=i-g;t[_++]=y,t[_++]=v,t[--d]=v,t[--d]=p}for(let v=1;v<h;v++){const C=Math.PI/2*(v/h),w=r+Math.cos(C)*o,k=n+Math.sin(C)*a,R=e+w,S=e-w,P=i+k,B=i-k;t[c++]=R,t[c++]=P,t[--u]=P,t[--u]=S,t[_++]=S,t[_++]=B,t[--d]=B,t[--d]=R}f=r,g=n+a,p=e+f,y=e-f,x=i+g;const b=i-g;return t[c++]=p,t[c++]=x,t[--d]=b,t[--d]=p,r&&(t[c++]=y,t[c++]=x,t[--d]=b,t[--d]=y),!0},triangulate(s,t,e,i,r,n){if(s.length===0)return;let o=0,a=0;for(let c=0;c<s.length;c+=2)o+=s[c],a+=s[c+1];o/=s.length/2,a/=s.length/2;let h=i;t[h*e]=o,t[h*e+1]=a;const l=h++;for(let c=0;c<s.length;c+=2)t[h*e]=s[c],t[h*e+1]=s[c+1],c>0&&(r[n++]=h,r[n++]=l,r[n++]=h-1),h++;r[n++]=l+1,r[n++]=l,r[n++]=h-1}},zd={...Ni,extension:{...Ni.extension,name:"ellipse"}},Ed={...Ni,extension:{...Ni.extension,name:"roundedRectangle"}},ih=1e-4,_o=1e-4;function Rd(s){const t=s.length;if(t<6)return 1;let e=0;for(let i=0,r=s[t-2],n=s[t-1];i<t;i+=2){const o=s[i],a=s[i+1];e+=(o-r)*(a+n),r=o,n=a}return e<0?-1:1}function fo(s,t,e,i,r,n,o,a){const h=s-e*r,l=t-i*r,c=s+e*n,u=t+i*n;let _,d;o?(_=i,d=-e):(_=-i,d=e);const f=h+_,g=l+d,p=c+_,y=u+d;return a.push(f,g),a.push(p,y),2}function Ve(s,t,e,i,r,n,o,a){const h=e-s,l=i-t;let c=Math.atan2(h,l),u=Math.atan2(r-s,n-t);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let _=c;const d=u-c,f=Math.abs(d),g=Math.sqrt(h*h+l*l),p=(15*f*Math.sqrt(g)/Math.PI>>0)+1,y=d/p;if(_+=y,a){o.push(s,t),o.push(e,i);for(let x=1,b=_;x<p;x++,b+=y)o.push(s,t),o.push(s+Math.sin(b)*g,t+Math.cos(b)*g);o.push(s,t),o.push(r,n)}else{o.push(e,i),o.push(s,t);for(let x=1,b=_;x<p;x++,b+=y)o.push(s+Math.sin(b)*g,t+Math.cos(b)*g),o.push(s,t);o.push(r,n),o.push(s,t)}return p*2}function Fd(s,t,e,i,r,n){const o=ih;if(s.length===0)return;const a=t;let h=a.alignment;if(t.alignment!==.5){let M=Rd(s);h=(h-.5)*M+.5}const l=new dt(s[0],s[1]),c=new dt(s[s.length-2],s[s.length-1]),u=i,_=Math.abs(l.x-c.x)<o&&Math.abs(l.y-c.y)<o;if(u){s=s.slice(),_&&(s.pop(),s.pop(),c.set(s[s.length-2],s[s.length-1]));const M=(l.x+c.x)*.5,T=(c.y+l.y)*.5;s.unshift(M,T),s.push(M,T)}const d=r,f=s.length/2;let g=s.length;const p=d.length/2,y=a.width/2,x=y*y,b=a.miterLimit*a.miterLimit;let v=s[0],C=s[1],w=s[2],k=s[3],R=0,S=0,P=-(C-k),B=v-w,G=0,F=0,W=Math.sqrt(P*P+B*B);P/=W,B/=W,P*=y,B*=y;const q=h,L=(1-q)*2,D=q*2;u||(a.cap==="round"?g+=Ve(v-P*(L-D)*.5,C-B*(L-D)*.5,v-P*L,C-B*L,v+P*D,C+B*D,d,!0)+2:a.cap==="square"&&(g+=fo(v,C,P,B,L,D,!0,d))),d.push(v-P*L,C-B*L),d.push(v+P*D,C+B*D);for(let M=1;M<f-1;++M){v=s[(M-1)*2],C=s[(M-1)*2+1],w=s[M*2],k=s[M*2+1],R=s[(M+1)*2],S=s[(M+1)*2+1],P=-(C-k),B=v-w,W=Math.sqrt(P*P+B*B),P/=W,B/=W,P*=y,B*=y,G=-(k-S),F=w-R,W=Math.sqrt(G*G+F*F),G/=W,F/=W,G*=y,F*=y;const T=w-v,st=C-k,N=w-R,rt=S-k,xt=T*N+st*rt,K=st*N-rt*T,mt=K<0;if(Math.abs(K)<.001*Math.abs(xt)){d.push(w-P*L,k-B*L),d.push(w+P*D,k+B*D),xt>=0&&(a.join==="round"?g+=Ve(w,k,w-P*L,k-B*L,w-G*L,k-F*L,d,!1)+4:g+=2,d.push(w-G*D,k-F*D),d.push(w+G*L,k+F*L));continue}const ot=(-P+v)*(-B+k)-(-P+w)*(-B+C),ut=(-G+R)*(-F+k)-(-G+w)*(-F+S),O=(T*ut-N*ot)/K,J=(rt*ot-st*ut)/K,Tt=(O-w)*(O-w)+(J-k)*(J-k),E=w+(O-w)*L,et=k+(J-k)*L,lt=w-(O-w)*D,at=k-(J-k)*D,ft=Math.min(T*T+st*st,N*N+rt*rt),Et=mt?L:D,Nt=ft+Et*Et*x;Tt<=Nt?a.join==="bevel"||Tt/x>b?(mt?(d.push(E,et),d.push(w+P*D,k+B*D),d.push(E,et),d.push(w+G*D,k+F*D)):(d.push(w-P*L,k-B*L),d.push(lt,at),d.push(w-G*L,k-F*L),d.push(lt,at)),g+=2):a.join==="round"?mt?(d.push(E,et),d.push(w+P*D,k+B*D),g+=Ve(w,k,w+P*D,k+B*D,w+G*D,k+F*D,d,!0)+4,d.push(E,et),d.push(w+G*D,k+F*D)):(d.push(w-P*L,k-B*L),d.push(lt,at),g+=Ve(w,k,w-P*L,k-B*L,w-G*L,k-F*L,d,!1)+4,d.push(w-G*L,k-F*L),d.push(lt,at)):(d.push(E,et),d.push(lt,at)):(d.push(w-P*L,k-B*L),d.push(w+P*D,k+B*D),a.join==="round"?mt?g+=Ve(w,k,w+P*D,k+B*D,w+G*D,k+F*D,d,!0)+2:g+=Ve(w,k,w-P*L,k-B*L,w-G*L,k-F*L,d,!1)+2:a.join==="miter"&&Tt/x<=b&&(mt?(d.push(lt,at),d.push(lt,at)):(d.push(E,et),d.push(E,et)),g+=2),d.push(w-G*L,k-F*L),d.push(w+G*D,k+F*D),g+=2)}v=s[(f-2)*2],C=s[(f-2)*2+1],w=s[(f-1)*2],k=s[(f-1)*2+1],P=-(C-k),B=v-w,W=Math.sqrt(P*P+B*B),P/=W,B/=W,P*=y,B*=y,d.push(w-P*L,k-B*L),d.push(w+P*D,k+B*D),u||(a.cap==="round"?g+=Ve(w-P*(L-D)*.5,k-B*(L-D)*.5,w-P*L,k-B*L,w+P*D,k+B*D,d,!1)+2:a.cap==="square"&&(g+=fo(w,k,P,B,L,D,!1,d)));const gt=_o*_o;for(let M=p;M<g+p-2;++M)v=d[M*2],C=d[M*2+1],w=d[(M+1)*2],k=d[(M+1)*2+1],R=d[(M+2)*2],S=d[(M+2)*2+1],!(Math.abs(v*(k-S)+w*(S-C)+R*(C-k))<gt)&&n.push(M,M+1,M+2)}function Bd(s,t,e,i){const r=ih;if(s.length===0)return;const n=s[0],o=s[1],a=s[s.length-2],h=s[s.length-1],l=t||Math.abs(n-a)<r&&Math.abs(o-h)<r,c=e,u=s.length/2,_=c.length/2;for(let d=0;d<u;d++)c.push(s[d*2]),c.push(s[d*2+1]);for(let d=0;d<u-1;d++)i.push(_+d,_+d+1);l&&i.push(_+u-1,_)}function sh(s,t,e,i,r,n,o){const a=bu(s,t,2);if(!a)return;for(let l=0;l<a.length;l+=3)n[o++]=a[l]+r,n[o++]=a[l+1]+r,n[o++]=a[l+2]+r;let h=r*i;for(let l=0;l<s.length;l+=2)e[h]=s[l],e[h+1]=s[l+1],h+=i}const Ld=[],Od={extension:{type:j.ShapeBuilder,name:"polygon"},build(s,t){for(let e=0;e<s.points.length;e++)t[e]=s.points[e];return!0},triangulate(s,t,e,i,r,n){sh(s,Ld,t,e,i,r,n)}},Gd={extension:{type:j.ShapeBuilder,name:"rectangle"},build(s,t){const e=s,i=e.x,r=e.y,n=e.width,o=e.height;return n>0&&o>0?(t[0]=i,t[1]=r,t[2]=i+n,t[3]=r,t[4]=i+n,t[5]=r+o,t[6]=i,t[7]=r+o,!0):!1},triangulate(s,t,e,i,r,n){let o=0;i*=e,t[i+o]=s[0],t[i+o+1]=s[1],o+=e,t[i+o]=s[2],t[i+o+1]=s[3],o+=e,t[i+o]=s[6],t[i+o+1]=s[7],o+=e,t[i+o]=s[4],t[i+o+1]=s[5],o+=e;const a=i/e;r[n++]=a,r[n++]=a+1,r[n++]=a+2,r[n++]=a+1,r[n++]=a+3,r[n++]=a+2}},Dd={extension:{type:j.ShapeBuilder,name:"triangle"},build(s,t){return t[0]=s.x,t[1]=s.y,t[2]=s.x2,t[3]=s.y2,t[4]=s.x3,t[5]=s.y3,!0},triangulate(s,t,e,i,r,n){let o=0;i*=e,t[i+o]=s[0],t[i+o+1]=s[1],o+=e,t[i+o]=s[2],t[i+o+1]=s[3],o+=e,t[i+o]=s[4],t[i+o+1]=s[5];const a=i/e;r[n++]=a,r[n++]=a+1,r[n++]=a+2}},Nd=new pt,Ud=new Mt;function Wd(s,t,e,i){const r=t.matrix?s.copyFrom(t.matrix).invert():s.identity();if(t.textureSpace==="local"){const o=e.getBounds(Ud);t.width&&o.pad(t.width);const{x:a,y:h}=o,l=1/o.width,c=1/o.height,u=-a*l,_=-h*c,d=r.a,f=r.b,g=r.c,p=r.d;r.a*=l,r.b*=l,r.c*=c,r.d*=c,r.tx=u*d+_*g+r.tx,r.ty=u*f+_*p+r.ty}else r.translate(t.texture.frame.x,t.texture.frame.y),r.scale(1/t.texture.source.width,1/t.texture.source.height);const n=t.texture.source.style;return!(t.fill instanceof Be)&&n.addressMode==="clamp-to-edge"&&(n.addressMode="repeat",n.update()),i&&r.append(Nd.copyFrom(i).invert()),r}const Ms={};jt.handleByMap(j.ShapeBuilder,Ms);jt.add(Gd,Od,Dd,Ni,zd,Ed);const Hd=new Mt,Vd=new pt;function Xd(s,t){const{geometryData:e,batches:i}=t;i.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let r=0;r<s.instructions.length;r++){const n=s.instructions[r];if(n.action==="texture")Yd(n.data,i,e);else if(n.action==="fill"||n.action==="stroke"){const o=n.action==="stroke",a=n.data.path.shapePath,h=n.data.style,l=n.data.hole;o&&l&&po(l.shapePath,h,!0,i,e),l&&(a.shapePrimitives[a.shapePrimitives.length-1].holes=l.shapePath.shapePrimitives),po(a,h,o,i,e)}}}function Yd(s,t,e){const i=[],r=Ms.rectangle,n=Hd;n.x=s.dx,n.y=s.dy,n.width=s.dw,n.height=s.dh;const o=s.transform;if(!r.build(n,i))return;const{vertices:a,uvs:h,indices:l}=e,c=l.length,u=a.length/2;o&&th(i,o),r.triangulate(i,a,2,u,l,c);const _=s.image,d=_.uvs;h.push(d.x0,d.y0,d.x1,d.y1,d.x3,d.y3,d.x2,d.y2);const f=ge.get(eh);f.indexOffset=c,f.indexSize=l.length-c,f.attributeOffset=u,f.attributeSize=a.length/2-u,f.baseColor=s.style,f.alpha=s.alpha,f.texture=_,f.geometryData=e,t.push(f)}function po(s,t,e,i,r){const{vertices:n,uvs:o,indices:a}=r;s.shapePrimitives.forEach(({shape:h,transform:l,holes:c})=>{const u=[],_=Ms[h.type];if(!_.build(h,u))return;const d=a.length,f=n.length/2;let g="triangle-list";if(l&&th(u,l),e){const b=h.closePath??!0,v=t;v.pixelLine?(Bd(u,b,n,a),g="line-list"):Fd(u,v,!1,b,n,a)}else if(c){const b=[],v=u.slice();$d(c).forEach(w=>{b.push(v.length/2),v.push(...w)}),sh(v,b,n,2,f,a,d)}else _.triangulate(u,n,2,f,a,d);const p=o.length/2,y=t.texture;if(y!==_t.WHITE){const b=Wd(Vd,t,h,l);Td(n,2,f,o,p,2,n.length/2-f,b)}else Pd(o,p,2,n.length/2-f);const x=ge.get(eh);x.indexOffset=d,x.indexSize=a.length-d,x.attributeOffset=f,x.attributeSize=n.length/2-f,x.baseColor=t.color,x.alpha=t.alpha,x.texture=y,x.geometryData=r,x.topology=g,i.push(x)})}function $d(s){const t=[];for(let e=0;e<s.length;e++){const i=s[e].shape,r=[];Ms[i.type].build(i,r)&&t.push(r)}return t}class qd{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class jd{constructor(){this.instructions=new ha}init(t){this.batcher=new Md({maxTextures:t}),this.instructions.reset()}get geometry(){return ht(Hl,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const nn=class Dr{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){Dr.defaultOptions.bezierSmoothness=t?.bezierSmoothness??Dr.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),Xd(t,e);const i=t.batchMode;t.customShader||i==="no-batch"?e.isBatchable=!1:i==="auto"?e.isBatchable=e.geometryData.vertices.length<400:e.isBatchable=!0,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=ge.get(jd,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:i,geometryData:r}=this._gpuContextHash[t.uid],n=r.vertices.length,o=r.indices.length;for(let c=0;c<i.length;c++)i[c].applyTransform=!1;const a=e.batcher;a.ensureAttributeBuffer(n),a.ensureIndexBuffer(o),a.begin();for(let c=0;c<i.length;c++){const u=i[c];a.add(u)}a.finish(e.instructions);const h=a.geometry;h.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),h.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);const l=a.batches;for(let c=0;c<l.length;c++){const u=l[c];u.bindGroup=Ou(u.textures.textures,u.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new qd;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(ge.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(i=>{ge.return(i)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};nn.extension={type:[j.WebGLSystem,j.WebGPUSystem,j.CanvasSystem],name:"graphicsContext"};nn.defaultOptions={bezierSmoothness:.5};let rh=nn;const Kd=8,os=11920929e-14,Zd=1;function nh(s,t,e,i,r,n,o,a,h,l){const u=Math.min(.99,Math.max(0,l??rh.defaultOptions.bezierSmoothness));let _=(Zd-u)/1;return _*=_,Qd(t,e,i,r,n,o,a,h,s,_),s}function Qd(s,t,e,i,r,n,o,a,h,l){Nr(s,t,e,i,r,n,o,a,h,l,0),h.push(o,a)}function Nr(s,t,e,i,r,n,o,a,h,l,c){if(c>Kd)return;const u=(s+e)/2,_=(t+i)/2,d=(e+r)/2,f=(i+n)/2,g=(r+o)/2,p=(n+a)/2,y=(u+d)/2,x=(_+f)/2,b=(d+g)/2,v=(f+p)/2,C=(y+b)/2,w=(x+v)/2;if(c>0){let k=o-s,R=a-t;const S=Math.abs((e-o)*R-(i-a)*k),P=Math.abs((r-o)*R-(n-a)*k);if(S>os&&P>os){if((S+P)*(S+P)<=l*(k*k+R*R)){h.push(C,w);return}}else if(S>os){if(S*S<=l*(k*k+R*R)){h.push(C,w);return}}else if(P>os){if(P*P<=l*(k*k+R*R)){h.push(C,w);return}}else if(k=C-(s+o)/2,R=w-(t+a)/2,k*k+R*R<=l){h.push(C,w);return}}Nr(s,t,u,_,y,x,C,w,h,l,c+1),Nr(C,w,b,v,g,p,o,a,h,l,c+1)}const Jd=8,t_=11920929e-14,e_=1;function i_(s,t,e,i,r,n,o,a){const l=Math.min(.99,Math.max(0,a??rh.defaultOptions.bezierSmoothness));let c=(e_-l)/1;return c*=c,s_(t,e,i,r,n,o,s,c),s}function s_(s,t,e,i,r,n,o,a){Ur(o,s,t,e,i,r,n,a,0),o.push(r,n)}function Ur(s,t,e,i,r,n,o,a,h){if(h>Jd)return;const l=(t+i)/2,c=(e+r)/2,u=(i+n)/2,_=(r+o)/2,d=(l+u)/2,f=(c+_)/2;let g=n-t,p=o-e;const y=Math.abs((i-n)*p-(r-o)*g);if(y>t_){if(y*y<=a*(g*g+p*p)){s.push(d,f);return}}else if(g=d-(t+n)/2,p=f-(e+o)/2,g*g+p*p<=a){s.push(d,f);return}Ur(s,t,e,l,c,d,f,a,h+1),Ur(s,d,f,u,_,n,o,a,h+1)}function oh(s,t,e,i,r,n,o,a){let h=Math.abs(r-n);(!o&&r>n||o&&n>r)&&(h=2*Math.PI-h),a||(a=Math.max(6,Math.floor(6*Math.pow(i,1/3)*(h/Math.PI)))),a=Math.max(a,3);let l=h/a,c=r;l*=o?-1:1;for(let u=0;u<a+1;u++){const _=Math.cos(c),d=Math.sin(c),f=t+_*i,g=e+d*i;s.push(f,g),c+=l}}function r_(s,t,e,i,r,n){const o=s[s.length-2],h=s[s.length-1]-e,l=o-t,c=r-e,u=i-t,_=Math.abs(h*u-l*c);if(_<1e-8||n===0){(s[s.length-2]!==t||s[s.length-1]!==e)&&s.push(t,e);return}const d=h*h+l*l,f=c*c+u*u,g=h*c+l*u,p=n*Math.sqrt(d)/_,y=n*Math.sqrt(f)/_,x=p*g/d,b=y*g/f,v=p*u+y*l,C=p*c+y*h,w=l*(y+x),k=h*(y+x),R=u*(p+b),S=c*(p+b),P=Math.atan2(k-C,w-v),B=Math.atan2(S-C,R-v);oh(s,v+t,C+e,n,P,B,l*c>u*h)}const Ri=Math.PI*2,dr={centerX:0,centerY:0,ang1:0,ang2:0},_r=({x:s,y:t},e,i,r,n,o,a,h)=>{s*=e,t*=i;const l=r*s-n*t,c=n*s+r*t;return h.x=l+o,h.y=c+a,h};function n_(s,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),i=t===1.5707963267948966?.551915024494:e,r=Math.cos(s),n=Math.sin(s),o=Math.cos(s+t),a=Math.sin(s+t);return[{x:r-n*i,y:n+r*i},{x:o+a*i,y:a-o*i},{x:o,y:a}]}const go=(s,t,e,i)=>{const r=s*i-t*e<0?-1:1;let n=s*e+t*i;return n>1&&(n=1),n<-1&&(n=-1),r*Math.acos(n)},o_=(s,t,e,i,r,n,o,a,h,l,c,u,_)=>{const d=Math.pow(r,2),f=Math.pow(n,2),g=Math.pow(c,2),p=Math.pow(u,2);let y=d*f-d*p-f*g;y<0&&(y=0),y/=d*p+f*g,y=Math.sqrt(y)*(o===a?-1:1);const x=y*r/n*u,b=y*-n/r*c,v=l*x-h*b+(s+e)/2,C=h*x+l*b+(t+i)/2,w=(c-x)/r,k=(u-b)/n,R=(-c-x)/r,S=(-u-b)/n,P=go(1,0,w,k);let B=go(w,k,R,S);a===0&&B>0&&(B-=Ri),a===1&&B<0&&(B+=Ri),_.centerX=v,_.centerY=C,_.ang1=P,_.ang2=B};function a_(s,t,e,i,r,n,o,a=0,h=0,l=0){if(n===0||o===0)return;const c=Math.sin(a*Ri/360),u=Math.cos(a*Ri/360),_=u*(t-i)/2+c*(e-r)/2,d=-c*(t-i)/2+u*(e-r)/2;if(_===0&&d===0)return;n=Math.abs(n),o=Math.abs(o);const f=Math.pow(_,2)/Math.pow(n,2)+Math.pow(d,2)/Math.pow(o,2);f>1&&(n*=Math.sqrt(f),o*=Math.sqrt(f)),o_(t,e,i,r,n,o,h,l,c,u,_,d,dr);let{ang1:g,ang2:p}=dr;const{centerX:y,centerY:x}=dr;let b=Math.abs(p)/(Ri/4);Math.abs(1-b)<1e-7&&(b=1);const v=Math.max(Math.ceil(b),1);p/=v;let C=s[s.length-2],w=s[s.length-1];const k={x:0,y:0};for(let R=0;R<v;R++){const S=n_(g,p),{x:P,y:B}=_r(S[0],n,o,u,c,y,x,k),{x:G,y:F}=_r(S[1],n,o,u,c,y,x,k),{x:W,y:q}=_r(S[2],n,o,u,c,y,x,k);nh(s,C,w,P,B,G,F,W,q),C=W,w=q,g+=p}}function h_(s,t,e){const i=(o,a)=>{const h=a.x-o.x,l=a.y-o.y,c=Math.sqrt(h*h+l*l),u=h/c,_=l/c;return{len:c,nx:u,ny:_}},r=(o,a)=>{o===0?s.moveTo(a.x,a.y):s.lineTo(a.x,a.y)};let n=t[t.length-1];for(let o=0;o<t.length;o++){const a=t[o%t.length],h=a.radius??e;if(h<=0){r(o,a),n=a;continue}const l=t[(o+1)%t.length],c=i(a,n),u=i(a,l);if(c.len<1e-4||u.len<1e-4){r(o,a),n=a;continue}let _=Math.asin(c.nx*u.ny-c.ny*u.nx),d=1,f=!1;c.nx*u.nx-c.ny*-u.ny<0?_<0?_=Math.PI+_:(_=Math.PI-_,d=-1,f=!0):_>0&&(d=-1,f=!0);const g=_/2;let p,y=Math.abs(Math.cos(g)*h/Math.sin(g));y>Math.min(c.len/2,u.len/2)?(y=Math.min(c.len/2,u.len/2),p=Math.abs(y*Math.sin(g)/Math.cos(g))):p=h;const x=a.x+u.nx*y+-u.ny*p*d,b=a.y+u.ny*y+u.nx*p*d,v=Math.atan2(c.ny,c.nx)+Math.PI/2*d,C=Math.atan2(u.ny,u.nx)-Math.PI/2*d;o===0&&s.moveTo(x+Math.cos(v)*p,b+Math.sin(v)*p),s.arc(x,b,p,v,C,f),n=a}}function l_(s,t,e,i){const r=(a,h)=>Math.sqrt((a.x-h.x)**2+(a.y-h.y)**2),n=(a,h,l)=>({x:a.x+(h.x-a.x)*l,y:a.y+(h.y-a.y)*l}),o=t.length;for(let a=0;a<o;a++){const h=t[(a+1)%o],l=h.radius??e;if(l<=0){a===0?s.moveTo(h.x,h.y):s.lineTo(h.x,h.y);continue}const c=t[a],u=t[(a+2)%o],_=r(c,h);let d;if(_<1e-4)d=h;else{const p=Math.min(_/2,l);d=n(h,c,p/_)}const f=r(u,h);let g;if(f<1e-4)g=h;else{const p=Math.min(f/2,l);g=n(h,u,p/f)}a===0?s.moveTo(d.x,d.y):s.lineTo(d.x,d.y),s.quadraticCurveTo(h.x,h.y,g.x,g.y,i)}}const c_=new Mt;class u_{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new be,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const i=this._currentPoly.points,r=i[i.length-2],n=i[i.length-1];return(r!==t||n!==e)&&i.push(t,e),this}arc(t,e,i,r,n,o){this._ensurePoly(!1);const a=this._currentPoly.points;return oh(a,t,e,i,r,n,o),this}arcTo(t,e,i,r,n){this._ensurePoly();const o=this._currentPoly.points;return r_(o,t,e,i,r,n),this}arcToSvg(t,e,i,r,n,o,a){const h=this._currentPoly.points;return a_(h,this._currentPoly.lastX,this._currentPoly.lastY,o,a,t,e,i,r,n),this}bezierCurveTo(t,e,i,r,n,o,a){this._ensurePoly();const h=this._currentPoly;return nh(this._currentPoly.points,h.lastX,h.lastY,t,e,i,r,n,o,a),this}quadraticCurveTo(t,e,i,r,n){this._ensurePoly();const o=this._currentPoly;return i_(this._currentPoly.points,o.lastX,o.lastY,t,e,i,r,n),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const i=this.shapePrimitives,r=i.length;for(let n=0;n<t.instructions.length;n++){const o=t.instructions[n];this[o.action](...o.data)}if(t.checkForHoles&&i.length-r>1){let n=null;for(let o=r;o<i.length;o++){const a=i[o];if(a.shape.type==="polygon"){const h=a.shape,l=n?.shape;l&&l.containsPolygon(h)?(n.holes||(n.holes=[]),n.holes.push(a),i.copyWithin(o,o+1),i.length--,o--):n=a}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,i,r,n){return this.drawShape(new Mt(t,e,i,r),n),this}circle(t,e,i,r){return this.drawShape(new en(t,e,i),r),this}poly(t,e,i){const r=new zi(t);return r.closePath=e,this.drawShape(r,i),this}regularPoly(t,e,i,r,n=0,o){r=Math.max(r|0,3);const a=-1*Math.PI/2+n,h=Math.PI*2/r,l=[];for(let c=0;c<r;c++){const u=a-c*h;l.push(t+i*Math.cos(u),e+i*Math.sin(u))}return this.poly(l,!0,o),this}roundPoly(t,e,i,r,n,o=0,a){if(r=Math.max(r|0,3),n<=0)return this.regularPoly(t,e,i,r,o);const h=i*Math.sin(Math.PI/r)-.001;n=Math.min(n,h);const l=-1*Math.PI/2+o,c=Math.PI*2/r,u=(r-2)*Math.PI/r/2;for(let _=0;_<r;_++){const d=_*c+l,f=t+i*Math.cos(d),g=e+i*Math.sin(d),p=d+Math.PI+u,y=d-Math.PI-u,x=f+n*Math.cos(p),b=g+n*Math.sin(p),v=f+n*Math.cos(y),C=g+n*Math.sin(y);_===0?this.moveTo(x,b):this.lineTo(x,b),this.quadraticCurveTo(f,g,v,C,a)}return this.closePath()}roundShape(t,e,i=!1,r){return t.length<3?this:(i?l_(this,t,e,r):h_(this,t,e),this.closePath())}filletRect(t,e,i,r,n){if(n===0)return this.rect(t,e,i,r);const o=Math.min(i,r)/2,a=Math.min(o,Math.max(-o,n)),h=t+i,l=e+r,c=a<0?-a:0,u=Math.abs(a);return this.moveTo(t,e+u).arcTo(t+c,e+c,t+u,e,u).lineTo(h-u,e).arcTo(h-c,e+c,h,e+u,u).lineTo(h,l-u).arcTo(h-c,l-c,t+i-u,l,u).lineTo(t+u,l).arcTo(t+c,l-c,t,l-u,u).closePath()}chamferRect(t,e,i,r,n,o){if(n<=0)return this.rect(t,e,i,r);const a=Math.min(n,Math.min(i,r)/2),h=t+i,l=e+r,c=[t+a,e,h-a,e,h,e+a,h,l-a,h-a,l,t+a,l,t,l-a,t,e+a];for(let u=c.length-1;u>=2;u-=2)c[u]===c[u-2]&&c[u-1]===c[u-3]&&c.splice(u-1,2);return this.poly(c,!0,o)}ellipse(t,e,i,r,n){return this.drawShape(new sn(t,e,i,r),n),this}roundRect(t,e,i,r,n,o){return this.drawShape(new rn(t,e,i,r,n),o),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let i=this._currentPoly;return i&&this.endPoly(),i=new zi,i.points.push(t,e),this._currentPoly=i,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new zi,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let i=e.shape.x,r=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const n=e.transform,o=i;i=n.a*i+n.c*r+n.tx,r=n.b*o+n.d*r+n.ty}this._currentPoly.points.push(i,r)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const i=t.instructions[e];this[i.action](...i.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let i=0;i<e.length;i++){const r=e[i],n=r.shape.getBounds(c_);r.transform?t.addRect(n,r.transform):t.addRect(n)}return t}}class Re{constructor(t,e=!1){this.instructions=[],this.uid=Ot("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?Ru(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new u_(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,i,r,n){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(dt.shared);let h=0,l=0;if(!o||o.action!=="bezierCurveTo")h=a.x,l=a.y;else{h=o.data[2],l=o.data[3];const c=a.x,u=a.y;h=c+(c-h),l=u+(u-l)}return this.instructions.push({action:"bezierCurveTo",data:[h,l,t,e,i,r,n]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,i){const r=this.instructions[this.instructions.length-1],n=this.getLastPoint(dt.shared);let o=0,a=0;if(!r||r.action!=="quadraticCurveTo")o=n.x,a=n.y;else{o=r.data[0],a=r.data[1];const h=n.x,l=n.y;o=h+(h-o),a=l+(l-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,t,e,i]}),this._dirty=!0,this}rect(t,e,i,r,n){return this.instructions.push({action:"rect",data:[t,e,i,r,n]}),this._dirty=!0,this}circle(t,e,i,r){return this.instructions.push({action:"circle",data:[t,e,i,r]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,i,r,n,o,a){n||(n=r/2);const h=-1*Math.PI/2+o,l=i*2,c=Math.PI*2/l,u=[];for(let _=0;_<l;_++){const d=_%2?n:r,f=_*c+h;u.push(t+d*Math.cos(f),e+d*Math.sin(f))}return this.poly(u,!0,a),this}clone(t=!1){const e=new Re;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let i=0;i<this.instructions.length;i++){const r=this.instructions[i];e.instructions.push({action:r.action,data:r.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,i=t.b,r=t.c,n=t.d,o=t.tx,a=t.ty;let h=0,l=0,c=0,u=0,_=0,d=0,f=0,g=0;for(let p=0;p<this.instructions.length;p++){const y=this.instructions[p],x=y.data;switch(y.action){case"moveTo":case"lineTo":h=x[0],l=x[1],x[0]=e*h+r*l+o,x[1]=i*h+n*l+a;break;case"bezierCurveTo":c=x[0],u=x[1],_=x[2],d=x[3],h=x[4],l=x[5],x[0]=e*c+r*u+o,x[1]=i*c+n*u+a,x[2]=e*_+r*d+o,x[3]=i*_+n*d+a,x[4]=e*h+r*l+o,x[5]=i*h+n*l+a;break;case"quadraticCurveTo":c=x[0],u=x[1],h=x[2],l=x[3],x[0]=e*c+r*u+o,x[1]=i*c+n*u+a,x[2]=e*h+r*l+o,x[3]=i*h+n*l+a;break;case"arcToSvg":h=x[5],l=x[6],f=x[0],g=x[1],x[0]=e*f+r*g,x[1]=i*f+n*g,x[5]=e*h+r*l+o,x[6]=i*h+n*l+a;break;case"circle":x[4]=Ai(x[3],t);break;case"rect":x[4]=Ai(x[4],t);break;case"ellipse":x[8]=Ai(x[8],t);break;case"roundRect":x[5]=Ai(x[5],t);break;case"addPath":x[0].transform(t);break;case"poly":x[2]=Ai(x[2],t);break;default:It("unknown transform action",y.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,i=this.instructions[e];if(!i)return t.x=0,t.y=0,t;for(;i.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;i=this.instructions[e]}switch(i.action){case"moveTo":case"lineTo":t.x=i.data[0],t.y=i.data[1];break;case"quadraticCurveTo":t.x=i.data[2],t.y=i.data[3];break;case"bezierCurveTo":t.x=i.data[4],t.y=i.data[5];break;case"arc":case"arcToSvg":t.x=i.data[5],t.y=i.data[6];break;case"addPath":i.data[0].getLastPoint(t);break}return t}}function Ai(s,t){return s?s.prepend(t):t.clone()}function Lt(s,t,e){const i=s.getAttribute(t);return i?Number(i):e}function d_(s,t){const e=s.querySelectorAll("defs");for(let i=0;i<e.length;i++){const r=e[i];for(let n=0;n<r.children.length;n++){const o=r.children[n];switch(o.nodeName.toLowerCase()){case"lineargradient":t.defs[o.id]=__(o);break;case"radialgradient":t.defs[o.id]=f_();break}}}}function __(s){const t=Lt(s,"x1",0),e=Lt(s,"y1",0),i=Lt(s,"x2",1),r=Lt(s,"y2",0),n=s.getAttribute("gradientUnits")||"objectBoundingBox",o=new Be(t,e,i,r,n==="objectBoundingBox"?"local":"global");for(let a=0;a<s.children.length;a++){const h=s.children[a],l=Lt(h,"offset",0),c=Ht.shared.setValue(h.getAttribute("stop-color")).toNumber();o.addColorStop(l,c)}return o}function f_(s){return It("[SVG Parser] Radial gradients are not yet supported"),new Be(0,0,1,0)}function mo(s){const t=s.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const yo={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function ah(s,t){const e=s.getAttribute("style"),i={},r={},n={strokeStyle:i,fillStyle:r,useFill:!1,useStroke:!1};for(const o in yo){const a=s.getAttribute(o);a&&xo(t,n,o,a.trim())}if(e){const o=e.split(";");for(let a=0;a<o.length;a++){const h=o[a].trim(),[l,c]=h.split(":");yo[l]&&xo(t,n,l,c.trim())}}return{strokeStyle:n.useStroke?i:null,fillStyle:n.useFill?r:null,useFill:n.useFill,useStroke:n.useStroke}}function xo(s,t,e,i){switch(e){case"stroke":if(i!=="none"){if(i.startsWith("url(")){const r=mo(i);t.strokeStyle.fill=s.defs[r]}else t.strokeStyle.color=Ht.shared.setValue(i).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(i);break;case"fill":if(i!=="none"){if(i.startsWith("url(")){const r=mo(i);t.fillStyle.fill=s.defs[r]}else t.fillStyle.color=Ht.shared.setValue(i).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(i);break;case"stroke-opacity":t.strokeStyle.alpha=Number(i);break;case"opacity":t.fillStyle.alpha=Number(i),t.strokeStyle.alpha=Number(i);break}}function p_(s){if(s.length<=2)return!0;const t=s.map(a=>a.area).sort((a,h)=>h-a),[e,i]=t,r=t[t.length-1],n=e/i,o=i/r;return!(n>3&&o<2)}function g_(s){return s.split(/(?=[Mm])/).filter(i=>i.trim().length>0)}function m_(s){const t=s.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),i=[],r=[];for(let c=0;c<e.length;c+=2)c+1<e.length&&(i.push(e[c]),r.push(e[c+1]));if(i.length===0||r.length===0)return 0;const n=Math.min(...i),o=Math.max(...i),a=Math.min(...r),h=Math.max(...r);return(o-n)*(h-a)}function bo(s,t){const e=new Re(s,!1);for(const i of e.instructions)t.instructions.push(i)}function y_(s,t){if(typeof s=="string"){const o=document.createElement("div");o.innerHTML=s.trim(),s=o.querySelector("svg")}const e={context:t,defs:{},path:new Re};d_(s,e);const i=s.children,{fillStyle:r,strokeStyle:n}=ah(s,e);for(let o=0;o<i.length;o++){const a=i[o];a.nodeName.toLowerCase()!=="defs"&&hh(a,e,r,n)}return t}function hh(s,t,e,i){const r=s.children,{fillStyle:n,strokeStyle:o}=ah(s,t);n&&e?e={...e,...n}:n&&(e=n),o&&i?i={...i,...o}:o&&(i=o);const a=!e&&!i;a&&(e={color:0});let h,l,c,u,_,d,f,g,p,y,x,b,v,C,w,k,R;switch(s.nodeName.toLowerCase()){case"path":{C=s.getAttribute("d");const S=s.getAttribute("fill-rule"),P=g_(C),B=S==="evenodd",G=P.length>1;if(B&&G){const W=P.map(L=>({path:L,area:m_(L)}));if(W.sort((L,D)=>D.area-L.area),P.length>3||!p_(W))for(let L=0;L<W.length;L++){const D=W[L],gt=L===0;t.context.beginPath();const M=new Re(void 0,!0);bo(D.path,M),t.context.path(M),gt?(e&&t.context.fill(e),i&&t.context.stroke(i)):t.context.cut()}else for(let L=0;L<W.length;L++){const D=W[L],gt=L%2===1;t.context.beginPath();const M=new Re(void 0,!0);bo(D.path,M),t.context.path(M),gt?t.context.cut():(e&&t.context.fill(e),i&&t.context.stroke(i))}}else{const W=S?S==="evenodd":!0;w=new Re(C,W),t.context.path(w),e&&t.context.fill(e),i&&t.context.stroke(i)}break}case"circle":f=Lt(s,"cx",0),g=Lt(s,"cy",0),p=Lt(s,"r",0),t.context.ellipse(f,g,p,p),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"rect":h=Lt(s,"x",0),l=Lt(s,"y",0),k=Lt(s,"width",0),R=Lt(s,"height",0),y=Lt(s,"rx",0),x=Lt(s,"ry",0),y||x?t.context.roundRect(h,l,k,R,y||x):t.context.rect(h,l,k,R),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"ellipse":f=Lt(s,"cx",0),g=Lt(s,"cy",0),y=Lt(s,"rx",0),x=Lt(s,"ry",0),t.context.beginPath(),t.context.ellipse(f,g,y,x),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"line":c=Lt(s,"x1",0),u=Lt(s,"y1",0),_=Lt(s,"x2",0),d=Lt(s,"y2",0),t.context.beginPath(),t.context.moveTo(c,u),t.context.lineTo(_,d),i&&t.context.stroke(i);break;case"polygon":v=s.getAttribute("points"),b=v.match(/\d+/g).map(S=>parseInt(S,10)),t.context.poly(b,!0),e&&t.context.fill(e),i&&t.context.stroke(i);break;case"polyline":v=s.getAttribute("points"),b=v.match(/\d+/g).map(S=>parseInt(S,10)),t.context.poly(b,!1),i&&t.context.stroke(i);break;case"g":case"svg":break;default:{It(`[SVG parser] <${s.nodeName}> elements unsupported`);break}}a&&(e=null);for(let S=0;S<r.length;S++)hh(r[S],t,e,i)}function x_(s){return Ht.isColorLike(s)}function vo(s){return s instanceof Cs}function wo(s){return s instanceof Be}function b_(s){return s instanceof _t}function v_(s,t,e){const i=Ht.shared.setValue(t??0);return s.color=i.toNumber(),s.alpha=i.alpha===1?e.alpha:i.alpha,s.texture=_t.WHITE,{...e,...s}}function w_(s,t,e){return s.texture=t,{...e,...s}}function ko(s,t,e){return s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,{...e,...s}}function Ao(s,t,e){return t.buildGradient(),s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,s.textureSpace=t.textureSpace,{...e,...s}}function k_(s,t){const e={...t,...s},i=Ht.shared.setValue(e.color);return e.alpha*=i.alpha,e.color=i.toNumber(),e}function Ke(s,t){if(s==null)return null;const e={},i=s;return x_(s)?v_(e,s,t):b_(s)?w_(e,s,t):vo(s)?ko(e,s,t):wo(s)?Ao(e,s,t):i.fill&&vo(i.fill)?ko(i,i.fill,t):i.fill&&wo(i.fill)?Ao(i,i.fill,t):k_(i,t)}function vs(s,t){const{width:e,alignment:i,miterLimit:r,cap:n,join:o,pixelLine:a,...h}=t,l=Ke(s,h);return l?{width:e,alignment:i,miterLimit:r,cap:n,join:o,pixelLine:a,...l}:null}const A_=new dt,So=new pt,on=class Se extends we{constructor(){super(...arguments),this.uid=Ot("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new Re,this._transform=new pt,this._fillStyle={...Se.defaultFillStyle},this._strokeStyle={...Se.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new be,this._boundsDirty=!0}clone(){const t=new Se;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=Ke(t,Se.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=vs(t,Se.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=Ke(t,Se.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=Ke(t,Se.defaultStrokeStyle),this}texture(t,e,i,r,n,o){return this.instructions.push({action:"texture",data:{image:t,dx:i||0,dy:r||0,dw:n||t.frame.width,dh:o||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?Ht.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new Re,this}fill(t,e){let i;const r=this.instructions[this.instructions.length-1];return this._tick===0&&r?.action==="stroke"?i=r.data.path:i=this._activePath.clone(),i?(t!=null&&(e!==void 0&&typeof t=="number"&&(ht(wt,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=Ke(t,Se.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(dt.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const i=this.instructions[this.instructions.length-1];return this._tick===0&&i?.action==="fill"?e=i.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=vs(t,Se.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],i=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(i);else{e.data.hole=i;break}}return this._initNextPathLocation(),this}arc(t,e,i,r,n,o){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,i,r,n,o),this}arcTo(t,e,i,r,n){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*i+o.c*r+o.tx,o.b*i+o.d*r+o.ty,n),this}arcToSvg(t,e,i,r,n,o,a){this._tick++;const h=this._transform;return this._activePath.arcToSvg(t,e,i,r,n,h.a*o+h.c*a+h.tx,h.b*o+h.d*a+h.ty),this}bezierCurveTo(t,e,i,r,n,o,a){this._tick++;const h=this._transform;return this._activePath.bezierCurveTo(h.a*t+h.c*e+h.tx,h.b*t+h.d*e+h.ty,h.a*i+h.c*r+h.tx,h.b*i+h.d*r+h.ty,h.a*n+h.c*o+h.tx,h.b*n+h.d*o+h.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,i,r){return this._tick++,this._activePath.ellipse(t,e,i,r,this._transform.clone()),this}circle(t,e,i){return this._tick++,this._activePath.circle(t,e,i,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const i=this._transform;return this._activePath.lineTo(i.a*t+i.c*e+i.tx,i.b*t+i.d*e+i.ty),this}moveTo(t,e){this._tick++;const i=this._transform,r=this._activePath.instructions,n=i.a*t+i.c*e+i.tx,o=i.b*t+i.d*e+i.ty;return r.length===1&&r[0].action==="moveTo"?(r[0].data[0]=n,r[0].data[1]=o,this):(this._activePath.moveTo(n,o),this)}quadraticCurveTo(t,e,i,r,n){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*i+o.c*r+o.tx,o.b*i+o.d*r+o.ty,n),this}rect(t,e,i,r){return this._tick++,this._activePath.rect(t,e,i,r,this._transform.clone()),this}roundRect(t,e,i,r,n){return this._tick++,this._activePath.roundRect(t,e,i,r,n,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,i,r,n=0,o){return this._tick++,this._activePath.regularPoly(t,e,i,r,n,o),this}roundPoly(t,e,i,r,n,o){return this._tick++,this._activePath.roundPoly(t,e,i,r,n,o),this}roundShape(t,e,i,r){return this._tick++,this._activePath.roundShape(t,e,i,r),this}filletRect(t,e,i,r,n){return this._tick++,this._activePath.filletRect(t,e,i,r,n),this}chamferRect(t,e,i,r,n,o){return this._tick++,this._activePath.chamferRect(t,e,i,r,n,o),this}star(t,e,i,r,n=0,o=0){return this._tick++,this._activePath.star(t,e,i,r,n,o,this._transform.clone()),this}svg(t){return this._tick++,y_(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,i,r,n,o){return t instanceof pt?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,i,r,n,o),this)}transform(t,e,i,r,n,o){return t instanceof pt?(this._transform.append(t),this):(So.set(t,e,i,r,n,o),this._transform.append(So),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const i=this.instructions[e],r=i.action;if(r==="fill"){const n=i.data;t.addBounds(n.path.bounds)}else if(r==="texture"){const n=i.data;t.addFrame(n.dx,n.dy,n.dx+n.dw,n.dy+n.dh,n.transform)}if(r==="stroke"){const n=i.data,o=n.style.alignment,a=n.style.width*(1-o),h=n.path.bounds;t.addFrame(h.minX-a,h.minY-a,h.maxX+a,h.maxY+a)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let i=!1;for(let r=0;r<e.length;r++){const n=e[r],o=n.data,a=o.path;if(!n.action||!a)continue;const h=o.style,l=a.shapePath.shapePrimitives;for(let c=0;c<l.length;c++){const u=l[c].shape;if(!h||!u)continue;const _=l[c].transform,d=_?_.applyInverse(t,A_):t;if(n.action==="fill")i=u.contains(d.x,d.y);else{const g=h;i=u.strokeContains(d.x,d.y,g.width,g.alignment)}const f=o.hole;if(f){const g=f.shapePath?.shapePrimitives;if(g)for(let p=0;p<g.length;p++)g[p].shape.contains(d.x,d.y)&&(i=!1)}if(i)return!0}}return i}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const i=typeof t=="boolean"?t:t?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(i)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(i))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};on.defaultFillStyle={color:16777215,alpha:1,texture:_t.WHITE,matrix:null,fill:null,textureSpace:"local"};on.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:_t.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let fe=on;const an=class ri extends we{constructor(t={}){super(),this.uid=Ot("textStyle"),this._tick=0,S_(t);const e={...ri.defaultTextStyle,...t};for(const i in e){const r=i;this[r]=e[i]}this.update(),this._tick=0}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.update())}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.update())}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...ri.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...ri.defaultDropShadow}):null,this.update())}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this.update())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t.toLowerCase(),this.update())}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.update())}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.update())}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.update())}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.update())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.update())}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.update())}get filters(){return this._filters}set filters(t){this._filters!==t&&(this._filters=Object.freeze(t),this.update())}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.update())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.update())}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.update())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.update())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.update())}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...fe.defaultFillStyle,...t},()=>{this._fill=Ke({...this._originalFill},fe.defaultFillStyle)})),this._fill=Ke(t===0?"black":t,fe.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...fe.defaultStrokeStyle,...t},()=>{this._stroke=vs({...this._originalStroke},fe.defaultStrokeStyle)})),this._stroke=vs(t,fe.defaultStrokeStyle),this.update())}update(){this._tick++,this.emit("update",this)}reset(){const t=ri.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return`${this.uid}-${this._tick}`}clone(){return new ri({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){if(this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const i=typeof t=="boolean"?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(i),this._originalFill?.texture&&this._originalFill.texture.destroy(i),this._stroke?.texture&&this._stroke.texture.destroy(i),this._originalStroke?.texture&&this._originalStroke.texture.destroy(i)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(i,r,n)=>(i[r]===n||(i[r]=n,e?.(r,n),this.update()),!0)})}_isFillStyle(t){return(t??null)!==null&&!(Ht.isColorLike(t)||t instanceof Be||t instanceof Cs)}};an.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};an.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let ws=an;function S_(s){const t=s;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=ws.defaultDropShadow;s.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){ht(wt,"strokeThickness is now a part of stroke");const e=t.stroke;let i={};if(Ht.isColorLike(e))i.color=e;else if(e instanceof Be||e instanceof Cs)i.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))i=e;else throw new Error("Invalid stroke value.");s.stroke={...i,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if(ht(wt,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&It("The number of fill colors must match the number of fill gradient stops.");const e=new Be({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),i=t.fillGradientStops.slice(),r=t.fill.map(n=>Ht.shared.setValue(n).toNumber());i.forEach((n,o)=>{e.addColorStop(n,r[o])}),s.fill={fill:e}}}class C_{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const i=zt.get().createCanvas();i.width=t,i.height=e;const r=i.getContext("2d");return{canvas:i,context:r}}getOptimalCanvasAndContext(t,e,i=1){t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),t=ms(t),e=ms(e);const r=(t<<17)+(e<<1);this._canvasPool[r]||(this._canvasPool[r]=[]);let n=this._canvasPool[r].pop();return n||(n=this._createCanvasAndContext(t,e)),n}returnCanvasAndContext(t){const e=t.canvas,{width:i,height:r}=e,n=(i<<17)+(r<<1);t.context.resetTransform(),t.context.clearRect(0,0,i,r),this._canvasPool[n].push(t)}clear(){this._canvasPool={}}}const Wr=new C_;Ui.register(Wr);const Co=1e5;function Mo(s,t,e,i=0){if(s.texture===_t.WHITE&&!s.fill)return Ht.shared.setValue(s.color).setAlpha(s.alpha??1).toHexa();if(s.fill){if(s.fill instanceof Cs){const r=s.fill,n=t.createPattern(r.texture.source.resource,"repeat"),o=r.transform.copyTo(pt.shared);return o.scale(r.texture.frame.width,r.texture.frame.height),n.setTransform(o),n}else if(s.fill instanceof Be){const r=s.fill,n=r.type==="linear",o=r.textureSpace==="local";let a=1,h=1;o&&e&&(a=e.width+i,h=e.height+i);let l,c=!1;if(n){const{start:u,end:_}=r;l=t.createLinearGradient(u.x*a,u.y*h,_.x*a,_.y*h),c=Math.abs(_.x-u.x)<Math.abs((_.y-u.y)*.1)}else{const{center:u,innerRadius:_,outerCenter:d,outerRadius:f}=r;l=t.createRadialGradient(u.x*a,u.y*h,_*a,d.x*a,d.y*h,f*a)}if(c&&o&&e){const u=e.lineHeight/h;for(let _=0;_<e.lines.length;_++){const d=(_*e.lineHeight+i/2)/h;r.colorStops.forEach(f=>{const g=d+f.offset*u;l.addColorStop(Math.floor(g*Co)/Co,Ht.shared.setValue(f.color).toHex())})}}else r.colorStops.forEach(u=>{l.addColorStop(u.offset,Ht.shared.setValue(u.color).toHex())});return l}}else{const r=t.createPattern(s.texture.source.resource,"repeat"),n=s.matrix.copyTo(pt.shared);return n.scale(s.texture.frame.width,s.texture.frame.height),r.setTransform(n),r}return It("FillStyle not recognised",s),"red"}const lh=class ch extends Va{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const e={...ch.defaultOptions,...t};this._textureSize=e.textureSize,this._mipmap=e.mipmap;const i=e.style.clone();e.overrideFill&&(i._fill.color=16777215,i._fill.alpha=1,i._fill.texture=_t.WHITE,i._fill.fill=null),this.applyFillAsTint=e.overrideFill;const r=i.fontSize;i.fontSize=this.baseMeasurementFontSize;const n=Or(i);e.overrideSize?i._stroke&&(i._stroke.width*=this.baseRenderedFontSize/r):i.fontSize=this.baseRenderedFontSize=r,this._style=i,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,e.textureStyle&&(this._textureStyle=e.textureStyle instanceof ys?e.textureStyle:new ys(e.textureStyle)),this.fontMetrics=us.measureFont(n),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(t){const e=us.graphemeSegmenter(t).filter(p=>!this._currentChars.includes(p)).filter((p,y,x)=>x.indexOf(p)===y);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let i;this._currentPageIndex===-1?i=this._nextPage():i=this.pages[this._currentPageIndex];let{canvas:r,context:n}=i.canvasAndContext,o=i.texture.source;const a=this._style;let h=this._currentX,l=this._currentY,c=this._currentMaxCharHeight;const u=this.baseRenderedFontSize/this.baseMeasurementFontSize,_=this._padding*u;let d=!1;const f=r.width/this.resolution,g=r.height/this.resolution;for(let p=0;p<e.length;p++){const y=e[p],x=us.measureText(y,a,r,!1);x.lineHeight=x.height;const b=x.width*u,v=Math.ceil((a.fontStyle==="italic"?2:1)*b),C=x.height*u,w=v+_*2,k=C+_*2;if(d=!1,y!==`
`&&y!=="\r"&&y!=="	"&&y!==" "&&(d=!0,c=Math.ceil(Math.max(k,c))),h+w>f&&(l+=c,c=k,h=0,l+c>g)){o.update();const S=this._nextPage();r=S.canvasAndContext.canvas,n=S.canvasAndContext.context,o=S.texture.source,h=0,l=0,c=0}const R=b/u-(a.dropShadow?.distance??0)-(a._stroke?.width??0);if(this.chars[y]={id:y.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:R,kerning:{}},d){this._drawGlyph(n,x,h+_,l+_,u,a);const S=o.width*u,P=o.height*u,B=new Mt(h/S*o.width,l/P*o.height,w/S*o.width,k/P*o.height);this.chars[y].texture=new _t({source:o,frame:B}),h+=Math.ceil(w)}}o.update(),this._currentX=h,this._currentY=l,this._currentMaxCharHeight=c,this._skipKerning&&this._applyKerning(e,n)}get pageTextures(){return ht(wt,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const i=this._measureCache;for(let r=0;r<t.length;r++){const n=t[r];for(let o=0;o<this._currentChars.length;o++){const a=this._currentChars[o];let h=i[n];h||(h=i[n]=e.measureText(n).width);let l=i[a];l||(l=i[a]=e.measureText(a).width);let c=e.measureText(n+a).width,u=c-(h+l);u&&(this.chars[n].kerning[a]=u),c=e.measureText(n+a).width,u=c-(h+l),u&&(this.chars[a].kerning[n]=u)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=Wr.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const i=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),r=new _t({source:new Je({resource:e.canvas,resolution:i,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(r.source.style=this._textureStyle);const n={canvasAndContext:e,texture:r};return this.pages[this._currentPageIndex]=n,n}_setupContext(t,e,i){e.fontSize=this.baseRenderedFontSize,t.scale(i,i),t.font=Or(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const r=e._stroke,n=r?.width??0;if(r&&(t.lineWidth=n,t.lineJoin=r.join,t.miterLimit=r.miterLimit,t.strokeStyle=Mo(r,t)),e._fill&&(t.fillStyle=Mo(e._fill,t)),e.dropShadow){const o=e.dropShadow,a=Ht.shared.setValue(o.color).toArray(),h=o.blur*i,l=o.distance*i;t.shadowColor=`rgba(${a[0]*255},${a[1]*255},${a[2]*255},${o.alpha})`,t.shadowBlur=h,t.shadowOffsetX=Math.cos(o.angle)*l,t.shadowOffsetY=Math.sin(o.angle)*l}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,i,r,n,o){const a=e.text,h=e.fontProperties,c=(o._stroke?.width??0)*n,u=i+c/2,_=r-c/2,d=h.descent*n,f=e.lineHeight*n;let g=!1;o.stroke&&c&&(g=!0,t.strokeText(a,u,_+f-d));const{shadowBlur:p,shadowOffsetX:y,shadowOffsetY:x}=t;o._fill&&(g&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(a,u,_+f-d)),g&&(t.shadowBlur=p,t.shadowOffsetX=y,t.shadowOffsetY=x)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:i}=this.pages[t];Wr.returnCanvasAndContext(e),i.destroy(!0)}this.pages=null}};lh.defaultOptions={textureSize:512,style:new ws,mipmap:!0};let To=lh;function M_(s,t,e,i){const r={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};r.offsetY=e.baseLineOffset;let n=r.lines[0],o=null,a=!0;const h={width:0,start:0,index:0,positions:[],chars:[]},l=e.baseMeasurementFontSize/t.fontSize,c=t.letterSpacing*l,u=t.wordWrapWidth*l,_=t.lineHeight?t.lineHeight*l:e.lineHeight,d=t.wordWrap&&t.breakWords,f=y=>{const x=n.width;for(let b=0;b<h.index;b++){const v=y.positions[b];n.chars.push(y.chars[b]),n.charPositions.push(v+x)}n.width+=y.width,a=!1,h.width=0,h.index=0,h.chars.length=0},g=()=>{let y=n.chars.length-1;if(i){let x=n.chars[y];for(;x===" ";)n.width-=e.chars[x].xAdvance,x=n.chars[--y]}r.width=Math.max(r.width,n.width),n={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,r.lines.push(n),r.height+=_},p=y=>y-c>u;for(let y=0;y<s.length+1;y++){let x;const b=y===s.length;b||(x=s[y]);const v=e.chars[x]||e.chars[" "];if(/(?:\s)/.test(x)||x==="\r"||x===`
`||b){if(!a&&t.wordWrap&&p(n.width+h.width)?(g(),f(h),b||n.charPositions.push(0)):(h.start=n.width,f(h),b||n.charPositions.push(0)),x==="\r"||x===`
`)g();else if(!b){const R=v.xAdvance+(v.kerning[o]||0)+c;n.width+=R,n.spaceWidth=R,n.spacesIndex.push(n.charPositions.length),n.chars.push(x)}}else{const k=v.kerning[o]||0,R=v.xAdvance+k+c;d&&p(n.width+h.width+R)&&(f(h),g()),h.positions[h.index++]=h.width+k,h.chars.push(x),h.width+=R}o=x}return g(),t.align==="center"?T_(r):t.align==="right"?P_(r):t.align==="justify"&&I_(r),r}function T_(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],i=s.width/2-e.width/2;for(let r=0;r<e.charPositions.length;r++)e.charPositions[r]+=i}}function P_(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],i=s.width-e.width;for(let r=0;r<e.charPositions.length;r++)e.charPositions[r]+=i}}function I_(s){const t=s.width;for(let e=0;e<s.lines.length;e++){const i=s.lines[e];let r=0,n=i.spacesIndex[r++],o=0;const a=i.spacesIndex.length,l=(t-i.width)/a;for(let c=0;c<i.charPositions.length;c++)c===n&&(n=i.spacesIndex[r++],o+=l),i.charPositions[c]+=o}}function z_(s){if(s==="")return[];typeof s=="string"&&(s=[s]);const t=[];for(let e=0,i=s.length;e<i;e++){const r=s[e];if(Array.isArray(r)){if(r.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);if(r[0].length===0||r[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const n=r[0].charCodeAt(0),o=r[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,h=o;a<=h;a++)t.push(String.fromCharCode(a))}else t.push(...Array.from(r))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}let as=0;class E_{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=Xa(1e3)}getFont(t,e){let i=`${e.fontFamily}-bitmap`,r=!0;if(e._fill.fill&&!e._stroke?(i+=e._fill.fill.styleKey,r=!1):(e._stroke||e.dropShadow)&&(i=`${e.styleKey}-bitmap`,r=!1),!Pt.has(i)){const o=Object.create(e);o.lineHeight=0;const a=new To({style:o,overrideFill:r,overrideSize:!0,...this.defaultOptions});as++,as>50&&It("BitmapText",`You have dynamically created ${as} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),a.once("destroy",()=>{as--,Pt.remove(i)}),Pt.set(i,a)}const n=Pt.get(i);return n.ensureCharacters?.(t),n}getLayout(t,e,i=!0){const r=this.getFont(t,e),n=`${t}-${e.styleKey}-${i}`;if(this.measureCache.has(n))return this.measureCache.get(n);const o=us.graphemeSegmenter(t),a=M_(o,e,r,i);return this.measureCache.set(n,a),a}measureText(t,e,i=!0){return this.getLayout(t,e,i)}install(...t){let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:t[2]?.chars,resolution:t[2]?.resolution,padding:t[2]?.padding,skipKerning:t[2]?.skipKerning},ht(wt,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const i=e?.name;if(!i)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const r=e.style,n=r instanceof ws?r:new ws(r),o=e.dynamicFill??this._canUseTintForStyle(n),a=new To({style:n,overrideFill:o,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),h=z_(e.chars);return a.ensureCharacters(h.join("")),Pt.set(`${i}-bitmap`,a),a.once("destroy",()=>Pt.remove(`${i}-bitmap`)),a}uninstall(t){const e=`${t}-bitmap`,i=Pt.get(e);i&&i.destroy()}_canUseTintForStyle(t){return!t._stroke&&(!t.dropShadow||t.dropShadow.color===0)&&!t._fill.fill&&t._fill.color===16777215}}const Po=new E_;class uh extends Va{constructor(t,e){super();const{textures:i,data:r}=t;Object.keys(r.pages).forEach(n=>{const o=r.pages[parseInt(n,10)],a=i[o.id];this.pages.push({texture:a})}),Object.keys(r.chars).forEach(n=>{const o=r.chars[n],{frame:a,source:h,rotate:l}=i[o.page],c=Ct.transformRectCoords(o,a,l,new Mt),u=new _t({frame:c,orig:new Mt(0,0,o.width,o.height),source:h,rotate:l});this.chars[n]={id:n.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:u}}),this.baseRenderedFontSize=r.fontSize,this.baseMeasurementFontSize=r.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:r.fontSize},this.baseLineOffset=r.baseLineOffset,this.lineHeight=r.lineHeight,this.fontFamily=r.fontFamily,this.distanceField=r.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){Po.install(t)}static uninstall(t){Po.uninstall(t)}}const fr={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const t=s.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const u in t){const _=t[u].match(/^[a-z]+/gm)[0],d=t[u].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),f={};for(const g in d){const p=d[g].split("="),y=p[0],x=p[1].replace(/"/gm,""),b=parseFloat(x),v=isNaN(b)?x:b;f[y]=v}e[_].push(f)}const i={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[r]=e.info,[n]=e.common,[o]=e.distanceField??[];o&&(i.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),i.fontSize=parseInt(r.size,10),i.fontFamily=r.face,i.lineHeight=parseInt(n.lineHeight,10);const a=e.page;for(let u=0;u<a.length;u++)i.pages.push({id:parseInt(a[u].id,10)||0,file:a[u].file});const h={};i.baseLineOffset=i.lineHeight-parseInt(n.base,10);const l=e.char;for(let u=0;u<l.length;u++){const _=l[u],d=parseInt(_.id,10);let f=_.letter??_.char??String.fromCharCode(d);f==="space"&&(f=" "),h[d]=f,i.chars[f]={id:d,page:parseInt(_.page,10)||0,x:parseInt(_.x,10),y:parseInt(_.y,10),width:parseInt(_.width,10),height:parseInt(_.height,10),xOffset:parseInt(_.xoffset,10),yOffset:parseInt(_.yoffset,10),xAdvance:parseInt(_.xadvance,10),kerning:{}}}const c=e.kerning||[];for(let u=0;u<c.length;u++){const _=parseInt(c[u].first,10),d=parseInt(c[u].second,10),f=parseInt(c[u].amount,10);i.chars[h[d]].kerning[h[_]]=f}return i}},Io={test(s){const t=s;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=s.getElementsByTagName("info")[0],i=s.getElementsByTagName("common")[0],r=s.getElementsByTagName("distanceField")[0];r&&(t.distanceField={type:r.getAttribute("fieldType"),range:parseInt(r.getAttribute("distanceRange"),10)});const n=s.getElementsByTagName("page"),o=s.getElementsByTagName("char"),a=s.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(let l=0;l<n.length;l++)t.pages.push({id:parseInt(n[l].getAttribute("id"),10)||0,file:n[l].getAttribute("file")});const h={};t.baseLineOffset=t.lineHeight-parseInt(i.getAttribute("base"),10);for(let l=0;l<o.length;l++){const c=o[l],u=parseInt(c.getAttribute("id"),10);let _=c.getAttribute("letter")??c.getAttribute("char")??String.fromCharCode(u);_==="space"&&(_=" "),h[u]=_,t.chars[_]={id:u,page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xOffset:parseInt(c.getAttribute("xoffset"),10),yOffset:parseInt(c.getAttribute("yoffset"),10),xAdvance:parseInt(c.getAttribute("xadvance"),10),kerning:{}}}for(let l=0;l<a.length;l++){const c=parseInt(a[l].getAttribute("first"),10),u=parseInt(a[l].getAttribute("second"),10),_=parseInt(a[l].getAttribute("amount"),10);t.chars[h[u]].kerning[h[c]]=_}return t}},zo={test(s){return typeof s=="string"&&s.includes("<font>")?Io.test(zt.get().parseXML(s)):!1},parse(s){return Io.parse(zt.get().parseXML(s))}},R_=[".xml",".fnt"],F_={extension:{type:j.CacheParser,name:"cacheBitmapFont"},test:s=>s instanceof uh,getCacheableAssets(s,t){const e={};return s.forEach(i=>{e[i]=t,e[`${i}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},B_={extension:{type:j.LoadParser,priority:He.Normal},name:"loadBitmapFont",id:"bitmap-font",test(s){return R_.includes(ce.extname(s).toLowerCase())},async testParse(s){return fr.test(s)||zo.test(s)},async parse(s,t,e){const i=fr.test(s)?fr.parse(s):zo.parse(s),{src:r}=t,{pages:n}=i,o=[],a=i.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let u=0;u<n.length;++u){const _=n[u].file;let d=ce.join(ce.dirname(r),_);d=Mr(d,r),o.push({src:d,data:a})}const h=await e.load(o),l=o.map(u=>h[u.src]);return new uh({data:i,textures:l},r)},async load(s,t){return await(await zt.get().fetch(s)).text()},async unload(s,t,e){await Promise.all(s.pages.map(i=>e.unload(i.texture.source._sourceOrigin))),s.destroy()}};class L_{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const O_={extension:{type:j.CacheParser,name:"cacheTextureArray"},test:s=>Array.isArray(s)&&s.every(t=>t instanceof _t),getCacheableAssets:(s,t)=>{const e={};return s.forEach(i=>{t.forEach((r,n)=>{e[i+(n===0?"":n+1)]=r})}),e}};async function dh(s){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(s)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const G_={extension:{type:j.DetectionParser,priority:1},test:async()=>dh("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")},Eo=["png","jpg","jpeg"],D_={extension:{type:j.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...Eo],remove:async s=>s.filter(t=>!Eo.includes(t))},N_="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Ts(s){return N_?!1:document.createElement("video").canPlayType(s)!==""}const U_={extension:{type:j.DetectionParser,priority:0},test:async()=>Ts("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")},W_={extension:{type:j.DetectionParser,priority:0},test:async()=>Ts("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")},H_={extension:{type:j.DetectionParser,priority:0},test:async()=>Ts("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")},V_={extension:{type:j.DetectionParser,priority:0},test:async()=>dh("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")},_h=class ds{constructor(){this.loadOptions={...ds.defaultOptions},this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,i)=>(this._parsersValidated=!1,t[e]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{let r=null,n=null;if((e.parser||e.loadParser)&&(n=this._parserHash[e.parser||e.loadParser],e.loadParser&&It(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),n||It(`[Assets] specified load parser "${e.parser||e.loadParser}" not found while loading ${t}`)),!n){for(let o=0;o<this.parsers.length;o++){const a=this.parsers[o];if(a.load&&a.test?.(t,e,this)){n=a;break}}if(!n)return It(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await n.load(t,e,this),i.parser=n;for(let o=0;o<this.parsers.length;o++){const a=this.parsers[o];a.parse&&a.parse&&await a.testParse?.(r,e,this)&&(r=await a.parse(r,e,this)||r,i.parser=a)}return r})(),i}async load(t,e){this._parsersValidated||this._validateParsers();const i=typeof e=="function"?{...ds.defaultOptions,...this.loadOptions,onProgress:e}:{...ds.defaultOptions,...this.loadOptions,...e||{}},{onProgress:r,onError:n,strategy:o,retryCount:a,retryDelay:h}=i;let l=0;const c={},u=xs(t),_=xe(t,g=>({alias:[g],src:g,data:{}})),d=_.reduce((g,p)=>g+(p.progressSize||1),0),f=_.map(async g=>{const p=ce.toAbsolute(g.src);c[g.src]||(await this._loadAssetWithRetry(p,g,{onProgress:r,onError:n,strategy:o,retryCount:a,retryDelay:h},c),l+=g.progressSize||1,r&&r(l/d))});return await Promise.all(f),u?c[_[0].src]:c}async unload(t){const i=xe(t,r=>({alias:[r],src:r})).map(async r=>{const n=ce.toAbsolute(r.src),o=this.promiseCache[n];if(o){const a=await o.promise;delete this.promiseCache[n],await o.parser?.unload?.(a,r,this)}});await Promise.all(i)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,e)=>(!e.name&&!e.id?It("[Assets] parser should have an id"):(t[e.name]||t[e.id])&&It(`[Assets] parser id conflict "${e.id}"`),t[e.name]=e,e.id&&(t[e.id]=e),t),{})}async _loadAssetWithRetry(t,e,i,r){let n=0;const{onError:o,strategy:a,retryCount:h,retryDelay:l}=i,c=u=>new Promise(_=>setTimeout(_,u));for(;;)try{this.promiseCache[t]||(this.promiseCache[t]=this._getLoadPromiseAndParser(t,e)),r[e.src]=await this.promiseCache[t].promise;return}catch(u){delete this.promiseCache[t],delete r[e.src],n++;const _=a!=="retry"||n>h;if(a==="retry"&&!_){o&&o(u,e),await c(l);continue}if(a==="skip"){o&&o(u,e);return}throw o&&o(u,e),new Error(`[Loader.load] Failed to load ${t}.
${u}`)}}};_h.defaultOptions={onProgress:void 0,onError:void 0,strategy:"throw",retryCount:3,retryDelay:250};let X_=_h;function gi(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function mi(s,t){const e=s.split("?")[0],i=ce.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Y_=".json",$_="application/json",q_={extension:{type:j.LoadParser,priority:He.Low},name:"loadJson",id:"json",test(s){return gi(s,$_)||mi(s,Y_)},async load(s){return await(await zt.get().fetch(s)).json()}},j_=".txt",K_="text/plain",Z_={name:"loadTxt",id:"text",extension:{type:j.LoadParser,priority:He.Low,name:"loadTxt"},test(s){return gi(s,K_)||mi(s,j_)},async load(s){return await(await zt.get().fetch(s)).text()}},Q_=["normal","bold","100","200","300","400","500","600","700","800","900"],J_=[".ttf",".otf",".woff",".woff2"],tf=["font/ttf","font/otf","font/woff","font/woff2"],ef=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function sf(s){const t=ce.extname(s),r=ce.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let n=r.length>0;for(const a of r)if(!a.match(ef)){n=!1;break}let o=r.join(" ");return n||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const rf=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function nf(s){return rf.test(s)?s:encodeURI(s)}const of={extension:{type:j.LoadParser,priority:He.Low},name:"loadWebFont",id:"web-font",test(s){return gi(s,tf)||mi(s,J_)},async load(s,t){const e=zt.get().getFontFaceSet();if(e){const i=[],r=t.data?.family??sf(s),n=t.data?.weights?.filter(a=>Q_.includes(a))??["normal"],o=t.data??{};for(let a=0;a<n.length;a++){const h=n[a],l=new FontFace(r,`url(${nf(s)})`,{...o,weight:h});await l.load(),e.add(l),i.push(l)}return Pt.has(`${r}-and-url`)?Pt.get(`${r}-and-url`).entries.push({url:s,faces:i}):Pt.set(`${r}-and-url`,{entries:[{url:s,faces:i}]}),i.length===1?i[0]:i}return It("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){const t=Array.isArray(s)?s:[s],e=t[0].family,i=Pt.get(`${e}-and-url`),r=i.entries.find(n=>n.faces.some(o=>t.indexOf(o)!==-1));r.faces=r.faces.filter(n=>t.indexOf(n)===-1),r.faces.length===0&&(i.entries=i.entries.filter(n=>n!==r)),t.forEach(n=>{zt.get().getFontFaceSet().delete(n)}),i.entries.length===0&&Pt.remove(`${e}-and-url`)}};function hn(s,t=1){const e=pi.RETINA_PREFIX?.exec(s);return e?parseFloat(e[1]):t}function ln(s,t,e){s.label=e,s._sourceOrigin=e;const i=new _t({source:s,label:e}),r=()=>{delete t.promiseCache[e],Pt.has(e)&&Pt.remove(e)};return i.source.once("destroy",()=>{t.promiseCache[e]&&(It("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),r())}),i.once("destroy",()=>{s.destroyed||(It("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())}),i}const af=".svg",hf="image/svg+xml",lf={extension:{type:j.LoadParser,priority:He.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(s){return gi(s,hf)||mi(s,af)},async load(s,t,e){return t.data?.parseAsGraphicsContext??this.config.parseAsGraphicsContext?uf(s):cf(s,t,e,this.config.crossOrigin)},unload(s){s.destroy(!0)}};async function cf(s,t,e,i){const r=await zt.get().fetch(s),n=zt.get().createImage();n.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await r.text())}`,n.crossOrigin=i,await n.decode();const o=t.data?.width??n.width,a=t.data?.height??n.height,h=t.data?.resolution||hn(s),l=Math.ceil(o*h),c=Math.ceil(a*h),u=zt.get().createCanvas(l,c),_=u.getContext("2d");_.imageSmoothingEnabled=!0,_.imageSmoothingQuality="high",_.drawImage(n,0,0,o*h,a*h);const{parseAsGraphicsContext:d,...f}=t.data??{},g=new Je({resource:u,alphaMode:"premultiply-alpha-on-upload",resolution:h,...f});return ln(g,e,s)}async function uf(s){const e=await(await zt.get().fetch(s)).text(),i=new fe;return i.svg(e),i}const df=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let hi=null,Hr=class{constructor(){hi||(hi=URL.createObjectURL(new Blob([df],{type:"application/javascript"}))),this.worker=new Worker(hi)}};Hr.revokeObjectURL=function(){hi&&(URL.revokeObjectURL(hi),hi=null)};const _f=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let li=null;class fh{constructor(){li||(li=URL.createObjectURL(new Blob([_f],{type:"application/javascript"}))),this.worker=new Worker(li)}}fh.revokeObjectURL=function(){li&&(URL.revokeObjectURL(li),li=null)};let Ro=0,pr;class ff{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new Hr;e.addEventListener("message",i=>{e.terminate(),Hr.revokeObjectURL(),t(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t,e){return this._run("loadImageBitmap",[t,e?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){pr===void 0&&(pr=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<pr&&(this._createdWorkers++,t=new fh().worker,t.addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){this._resolveHash[t.uuid]&&(t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),delete this._resolveHash[t.uuid])}async _run(t,e){await this._initWorkers();const i=new Promise((r,n)=>{this._queue.push({id:t,arguments:e,resolve:r,reject:n})});return this._next(),i}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),i=e.id;this._resolveHash[Ro]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Ro++,id:i})}reset(){this._workerPool.forEach(t=>t.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:t})=>{t?.(new Error("WorkerManager has been reset before completion"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const Fo=new ff,pf=[".jpeg",".jpg",".png",".webp",".avif"],gf=["image/jpeg","image/png","image/webp","image/avif"];async function mf(s,t){const e=await zt.get().fetch(s);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${e.status} ${e.statusText}`);const i=await e.blob();return t?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(i,{premultiplyAlpha:"none"}):createImageBitmap(i)}const ph={name:"loadTextures",id:"texture",extension:{type:j.LoadParser,priority:He.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return gi(s,gf)||mi(s,pf)},async load(s,t,e){let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Fo.isImageBitmapSupported()?i=await Fo.loadImageBitmap(s,t):i=await mf(s,t):i=await new Promise((n,o)=>{i=zt.get().createImage(),i.crossOrigin=this.config.crossOrigin,i.src=s,i.complete?n(i):(i.onload=()=>{n(i)},i.onerror=o)});const r=new Je({resource:i,alphaMode:"premultiply-alpha-on-upload",resolution:t.data?.resolution||hn(s),...t.data});return ln(r,e,s)},unload(s){s.destroy(!0)}},yf=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let gr,mr;function xf(s,t,e){e===void 0&&!t.startsWith("data:")?s.crossOrigin=vf(t):e!==!1&&(s.crossOrigin=typeof e=="string"?e:"anonymous")}function bf(s){return new Promise((t,e)=>{s.addEventListener("canplaythrough",i),s.addEventListener("error",r),s.load();function i(){n(),t()}function r(o){n(),e(o)}function n(){s.removeEventListener("canplaythrough",i),s.removeEventListener("error",r)}})}function vf(s,t=globalThis.location){if(s.startsWith("data:"))return"";t||(t=globalThis.location);const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function wf(){const s=[],t=[];for(const e of yf){const i=Ii.MIME_TYPES[e.substring(1)]||`video/${e.substring(1)}`;Ts(i)&&(s.push(e),t.includes(i)||t.push(i))}return{validVideoExtensions:s,validVideoMime:t}}const kf={name:"loadVideo",id:"video",extension:{type:j.LoadParser,name:"loadVideo"},test(s){if(!gr||!mr){const{validVideoExtensions:i,validVideoMime:r}=wf();gr=i,mr=r}const t=gi(s,mr),e=mi(s,gr);return t||e},async load(s,t,e){const i={...Ii.defaultOptions,resolution:t.data?.resolution||hn(s),alphaMode:t.data?.alphaMode||await ya(),...t.data},r=document.createElement("video"),n={preload:i.autoLoad!==!1?"auto":void 0,"webkit-playsinline":i.playsinline!==!1?"":void 0,playsinline:i.playsinline!==!1?"":void 0,muted:i.muted===!0?"":void 0,loop:i.loop===!0?"":void 0,autoplay:i.autoPlay!==!1?"":void 0};Object.keys(n).forEach(h=>{const l=n[h];l!==void 0&&r.setAttribute(h,l)}),i.muted===!0&&(r.muted=!0),xf(r,s,i.crossorigin);const o=document.createElement("source");let a;if(i.mime)a=i.mime;else if(s.startsWith("data:"))a=s.slice(5,s.indexOf(";"));else if(!s.startsWith("blob:")){const h=s.split("?")[0].slice(s.lastIndexOf(".")+1).toLowerCase();a=Ii.MIME_TYPES[h]||`video/${h}`}return o.src=s,a&&(o.type=a),new Promise(h=>{const l=async()=>{const c=new Ii({...i,resource:r});r.removeEventListener("canplay",l),t.data.preload&&await bf(r),h(ln(c,e,s))};i.preload&&!i.autoPlay&&r.load(),r.addEventListener("canplay",l),r.appendChild(o)})},unload(s){s.destroy(!0)}},gh={extension:{type:j.ResolveParser,name:"resolveTexture"},test:ph.test,parse:s=>({resolution:parseFloat(pi.RETINA_PREFIX.exec(s)?.[1]??"1"),format:s.split(".").pop(),src:s})},Af={extension:{type:j.ResolveParser,priority:-2,name:"resolveJson"},test:s=>pi.RETINA_PREFIX.test(s)&&s.endsWith(".json"),parse:gh.parse};class Sf{constructor(){this._detections=[],this._initialized=!1,this.resolver=new pi,this.loader=new X_,this.cache=Pt,this._backgroundLoader=new L_(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized){It("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let n=t.manifest;typeof n=="string"&&(n=await this.load(n)),this.resolver.addManifest(n)}const e=t.texturePreference?.resolution??1,i=typeof e=="number"?[e]:e,r=await this._detectFormats({preferredFormats:t.texturePreference?.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:r,resolution:i}}),t.preferences&&this.setPreferences(t.preferences),t.loadOptions&&(this.loader.loadOptions={...this.loader.loadOptions,...t.loadOptions})}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const i=xs(t),r=xe(t).map(a=>{if(typeof a!="string"){const h=this.resolver.getAlias(a);return h.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),n=this.resolver.resolve(r),o=await this._mapLoadToResolve(n,e);return i?o[r[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const r=this.resolver.resolveBundle(t),n={},o=Object.keys(r);let a=0;const h=[],l=()=>{e?.(h.reduce((u,_)=>u+_,0)/a)},c=o.map((u,_)=>{const d=r[u],f=Object.values(d),p=[...new Set(f.flat())].reduce((y,x)=>y+(x.progressSize||1),0);return h.push(0),a+=p,this._mapLoadToResolve(d,y=>{h[_]=y*p,l()}).then(y=>{n[u]=y})});return await Promise.all(c),i?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Pt.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=Pt.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const r=await this.loader.load(i,e);this._backgroundLoader.active=!0;const n={};return i.forEach(o=>{const a=r[o.src],h=[o.src];o.alias&&h.push(...o.alias),h.forEach(l=>{n[l]=a}),Pt.set(h,a)}),n}async unload(t){this._initialized||await this.init();const e=xe(t).map(r=>typeof r!="string"?r.src:r),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=xe(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(r=>this._unloadFromResolved(e[r]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{Pt.remove(i.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const i of t.detections)t.skipDetections||await i.test()?e=await i.add(e):t.skipDetections||(e=await i.remove(e));return e=e.filter((i,r)=>e.indexOf(i)===r),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(i=>i in t).forEach(i=>{e.config[i]=t[i]})})}}const Ze=new Sf;jt.handleByList(j.LoadParser,Ze.loader.parsers).handleByList(j.ResolveParser,Ze.resolver.parsers).handleByList(j.CacheParser,Ze.cache.parsers).handleByList(j.DetectionParser,Ze.detections);jt.add(O_,D_,G_,V_,U_,W_,H_,q_,Z_,of,lf,ph,kf,B_,F_,gh,Af);const Bo={loader:j.LoadParser,resolver:j.ResolveParser,cache:j.CacheParser,detection:j.DetectionParser};jt.handle(j.Asset,s=>{const t=s.ref;Object.entries(Bo).filter(([e])=>!!t[e]).forEach(([e,i])=>jt.add(Object.assign(t[e],{extension:t[e].extension??i})))},s=>{const t=s.ref;Object.keys(Bo).filter(e=>!!t[e]).forEach(e=>jt.remove(t[e]))});class Dt extends la{constructor(t){t instanceof fe&&(t={context:t});const{context:e,roundPixels:i,...r}=t||{};super({label:"Graphics",...r}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new fe,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=i??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||t?.context===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new Dt(this._context.clone()):(this._ownedContext=null,new Dt(this._context))}lineStyle(t,e,i){ht(wt,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const r={};return t&&(r.width=t),e&&(r.color=e),i&&(r.alpha=i),this.context.strokeStyle=r,this}beginFill(t,e){ht(wt,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const i={};return t!==void 0&&(i.color=t),e!==void 0&&(i.alpha=e),this.context.fillStyle=i,this}endFill(){ht(wt,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==fe.defaultStrokeStyle.width||t.color!==fe.defaultStrokeStyle.color||t.alpha!==fe.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return ht(wt,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return ht(wt,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return ht(wt,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return ht(wt,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return ht(wt,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return ht(wt,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}class Jt extends _t{static create(t){return new Jt({source:new me(t)})}resize(t,e,i){return this.source.resize(t,e,i),this}}var Vr=(s=>(s.CLAMP="clamp-to-edge",s.REPEAT="repeat",s.MIRRORED_REPEAT="mirror-repeat",s))(Vr||{});new Proxy(Vr,{get(s,t){return ht(wt,`DRAW_MODES.${t} is deprecated, use '${Vr[t]}' instead`),s[t]}});var Xr=(s=>(s.NEAREST="nearest",s.LINEAR="linear",s))(Xr||{});const Lo=new Proxy(Xr,{get(s,t){return ht(wt,`DRAW_MODES.${t} is deprecated, use '${Xr[t]}' instead`),s[t]}});jt.add(Rl,Fl);function hs(s,t,e){return s<t?t:s>e?e:s}function _s(s,t,e){return new Promise(i=>{if(!t){i(null);return}const r=t.getLocalBounds(),n=e?new Mt(e.x,e.y,e.width,e.height):new Mt(0,0,r.width,r.height);s.extract.canvas({target:t,resolution:1,frame:n}).toBlob?.(a=>{a||i(null),i(a)})})}var Cf=nt('<div class="color-gradient svelte-qx84u5"><div class="marker svelte-qx84u5"></div></div> <div class="opacity-slider svelte-qx84u5"><div class="opacity-marker svelte-qx84u5"></div></div> <div class="hue-slider svelte-qx84u5"><div class="marker svelte-qx84u5"></div></div>',1);function Mf(s,t){ue(t,!1);let e=I(t,"color",12,"rgb(255, 255, 255)"),i=Z([0,0]),r=null,n=!1,o=[0,0],a=Z(0),h=Z(0),l=null,c=!1,u=!1;function _(N){l=N.currentTarget.getBoundingClientRect(),c=!0,d(N.clientX)}function d(N){if(!l)return;const rt=hs(N-l.left,0,l.width);U(h,rt);const xt=rt/l.width*360;U(a,xt),e(f({h:xt,s:o[0],v:o[1],a:1}))}function f(N){const rt=N.s,xt=N.v;let K=rt*xt;const mt=N.h/60;let ot=K*(1-Math.abs(mt%2-1));const ut=xt-K;K=K+ut,ot=ot+ut;const O=Math.floor(mt)%6,J=[K,ot,ut,ut,ot,K][O],Tt=[ot,K,K,ot,ut,ut][O],E=[ut,ut,ot,K,K,ot][O];return`rgba(${J*255}, ${Tt*255}, ${E*255}, ${N.a})`}function g(N,rt){if(!r)return;const xt=hs(N-r.left,0,r.width),K=hs(rt-r.top,0,r.height);U(i,[xt,K]);const mt={h:m(a)*1,s:xt/r.width,v:1-K/r.height,a:1};o=[mt.s,mt.v],e(f(mt))}function p(N){n=!0,r=N.currentTarget.getBoundingClientRect(),g(N.clientX,N.clientY)}function y(N){n&&g(N.clientX,N.clientY),c&&d(N.clientX),u&&P(N.clientX)}function x(){n&&(n=!1),c&&(c=!1),u&&(u=!1)}async function b(N){if(n||c||(await xr(),!N))return;r||(r=m(v).getBoundingClientRect()),l||(l=m(C).getBoundingClientRect());const rt=le(N).toHsv(),xt=rt.s*r.width,K=(1-rt.v)*r.height;U(i,[xt,K]),o=[rt.s,rt.v],U(a,rt.h),U(h,rt.h/360*l.width)}let v=Z(),C=Z(),w=I(t,"opacity",12,1),k=Z();function R(N){U(S,N.currentTarget.getBoundingClientRect()),u=!0,P(N.clientX)}let S=Z(null);function P(N){if(!m(S))return;const rt=hs(N-m(S).left,0,m(S).width);w(rt/m(S).width)}Uo(()=>{U(S,m(k).getBoundingClientRect())}),yt(()=>X(e()),()=>{b(e())}),Le();var B={get color(){return e()},set color(N){e(N),z()},get opacity(){return w()},set opacity(N){w(N),z()}};ve();var G=Cf();Vt("mousemove",xn,y),Vt("mouseup",xn,x);var F=qt(G),W=it(F);let q;tt(F),Qe(F,N=>U(v,N),()=>m(v));var L=$(F,2),D=it(L);let gt;tt(L),Qe(L,N=>U(k,N),()=>m(k));var M=$(L,2),T=it(M);let st;return tt(M),Qe(M,N=>U(C,N),()=>m(C)),Wt(()=>{ze(F,`--hue:${m(a)??""}`),q=ze(W,"",q,{transform:`translate(${m(i),Rt(()=>m(i)[0])??""}px,${m(i),Rt(()=>m(i)[1])??""}px)`,background:e()}),ze(L,`--color:${(e()==="auto"?"transparent":e())??""}`),gt=ze(D,"",gt,{background:"white",transform:`translateX(${X(w()),m(S),Rt(()=>w()*(m(S)?.width??1))??""}px)`}),st=ze(T,"",st,{background:"hsl("+m(a)+", 100%, 50%)",transform:`translateX(${m(h)??""}px)`})}),Vt("mousedown",F,p),Vt("mousedown",L,R),Vt("mousedown",M,_),H(s,G),de(B)}var Tf=nt("<span></span>"),Pf=nt("<button></button>"),If=nt('<div class="swatch svelte-q8yof7"><!> <!> <button></button></div>'),zf=nt("<button></button>"),Ef=nt('<!> <div class="swatch-wrap svelte-q8yof7"><div class="swatch-container svelte-q8yof7"><!> <menu class="swatch svelte-q8yof7"></menu></div></div>',1);function Rf(s,t){ue(t,!1);const e=Z(),i=Z();let r=I(t,"selected_color",12),n=I(t,"colors",12),o=I(t,"user_colors",28,()=>[]),a=I(t,"show_empty",12,!1),h=I(t,"current_mode",12,"hex"),l=I(t,"color_picker",12,!1);const c=Oe();function u(S){return Array.isArray(S)?S[0]:S}function _(S){return Array.isArray(S)?S[1]:le(S).getAlpha()}function d(S,P){const B=u(S);return P==="hex"?le(B).toHexString():P==="rgb"?le(B).toRgbString():le(B).toHslString()}`${n().findIndex(S=>d(S,h())===d(r(),h()))}`;function f(S,P){`${S}${P.index}`,c(S,P)}function g(){c("select",{index:null,color:r()}),l(!l())}yt(()=>(X(a()),X(n())),()=>{U(e,a()?n():n().filter(S=>S))}),yt(()=>X(r()),()=>{U(i,_(r()))}),Le();var p={get selected_color(){return r()},set selected_color(S){r(S),z()},get colors(){return n()},set colors(S){n(S),z()},get user_colors(){return o()},set user_colors(S){o(S),z()},get show_empty(){return a()},set show_empty(S){a(S),z()},get current_mode(){return h()},set current_mode(S){h(S),z()},get color_picker(){return l()},set color_picker(S){l(S),z()}};ve();var y=Ef(),x=qt(y);{var b=S=>{var P=Tf();let B;Wt(()=>B=re(P,1,"svelte-q8yof7",null,B,{lg:o()})),H(S,P)};Q(x,S=>{l()||S(b)})}var v=$(x,2),C=it(v),w=it(C);{var k=S=>{var P=If(),B=it(P);{var G=L=>{{let D=Gt(()=>(X(r()),Rt(()=>u(r()))));ae(L,{get Icon(){return Vo},roundedness:"very",get background(){return m(D)},color:"white",$$events:{click:()=>c("add_color")}})}};Q(B,L=>{l()&&L(G)})}var F=$(B,2);Fi(F,1,o,Bi,(L,D,gt)=>{const M=Gt(()=>(m(D),Rt(()=>u(m(D))))),T=Gt(()=>(m(D),Rt(()=>_(m(D)))));var st=Pf();let N,rt;Wt(()=>{N=re(st,1,"color svelte-q8yof7",null,N,{empty:m(D)===null,selected:`${m(M)}-${m(T)}`==`${r()}-${m(i)}`}),rt=ze(st,`background-color: ${m(M)??""}`,rt,{opacity:m(T)})}),Vt("click",st,()=>f("edit",{index:gt,color:m(M),opacity:m(T)})),H(L,st)});var W=$(F,2);let q;tt(P),Wt(()=>q=re(W,1,"color colorpicker svelte-q8yof7",null,q,{hidden:!l()})),Vt("click",W,g),H(S,P)};Q(w,S=>{o()&&S(k)})}var R=$(w,2);return Fi(R,5,()=>m(e),Bi,(S,P,B)=>{const G=Gt(()=>(m(P),Rt(()=>u(m(P))))),F=Gt(()=>(m(P),Rt(()=>_(m(P)))));var W=zf();let q,L;Wt(()=>{q=re(W,1,"color svelte-q8yof7",null,q,{empty:m(P)===null,selected:`${m(G)}-${m(F)}`==`${r()}-${m(i)}`}),L=ze(W,`background-color: ${m(G)??""}`,L,{opacity:m(F)})}),Vt("click",W,()=>f("select",{index:B,color:m(G),opacity:m(F)})),H(S,W)}),tt(R),tt(C),tt(v),H(s,y),de(p)}var Ff=nt("<button> </button>"),Bf=nt('<div class="input svelte-yn52fn"><button class="swatch svelte-yn52fn"></button> <div><div class="input-wrap svelte-yn52fn"><input type="text" class="svelte-yn52fn"/> <button class="eyedropper svelte-yn52fn"><!></button></div> <div class="buttons svelte-yn52fn"></div></div></div>');function Lf(s,t){ue(t,!1);const e=Z();let i=I(t,"color",12),r=I(t,"current_mode",12,"hex");const n=Oe(),o=[["Hex","hex"],["RGB","rgb"],["HSL","hsl"]];function a(w,k){return k==="hex"?le(w).toHexString():k==="rgb"?le(w).toRgbString():le(w).toHslString()}function h(){new EyeDropper().open().then(k=>{i(k.sRGBHex)})}const l=!!window.EyeDropper;function c(){n("selected",m(e)),n("close")}yt(()=>(X(i()),X(r())),()=>{U(e,a(i(),r()))}),yt(()=>m(e),()=>{m(e)&&n("selected",m(e))}),Le();var u={get color(){return i()},set color(w){i(w),z()},get current_mode(){return r()},set current_mode(w){r(w),z()}};ve();var _=Bf(),d=it(_);let f;var g=$(d,2),p=it(g),y=it(p);No(y);var x=$(y,2),b=it(x);{var v=w=>{Xh(w)};Q(b,w=>{l&&w(v)})}tt(x),tt(p);var C=$(p,2);return Fi(C,5,()=>o,Bi,(w,k)=>{var R=_e(()=>Wo(m(k),2));let S=()=>m(R)[0],P=()=>m(R)[1];var B=Ff();let G;var F=it(B,!0);tt(B),Wt(()=>{G=re(B,1,"button svelte-yn52fn",null,G,{active:r()===P()}),Fe(F,S())}),Vt("click",B,()=>r(P())),H(w,B)}),tt(C),tt(g),tt(_),Wt(()=>{f=ze(d,"",f,{background:i()}),Rh(y,m(e))}),Vt("click",d,c),Vt("change",y,w=>i(w.currentTarget.value)),Vt("click",x,h),H(s,_),de(u)}var Of=nt('<div class="wrap svelte-1y25b79"><span class="svelte-1y25b79"><!></span> <input type="range" class="svelte-1y25b79"/></div>');function Gf(s,t){ue(t,!1);let e=I(t,"selected_size",12),i=I(t,"min",12),r=I(t,"max",12);const n=Oe();var o={get selected_size(){return e()},set selected_size(u){e(u),z()},get min(){return i()},set min(u){i(u),z()},get max(){return r()},set max(u){r(u),z()}};ve();var a=Of(),h=it(a),l=it(h);ol(l),tt(h);var c=$(h,2);return No(c),Ne(c,"step",1),tt(a),ks(a,(u,_)=>Kr?.(u,_),()=>()=>n("click_outside")),Wt(()=>{Ne(c,"min",i()),Ne(c,"max",r())}),Yh(c,e),H(s,a),de(o)}var Df=nt("<!> <!>",1),Nf=nt("<div><!> <!> <!></div>");function Oo(s,t){ue(t,!1);let e=I(t,"colors",12),i=I(t,"selected_color",12),r=I(t,"color_mode",12,void 0),n=I(t,"recent_colors",28,()=>[]),o=I(t,"selected_size",12),a=I(t,"selected_opacity",12),h=I(t,"show_swatch",12),l=I(t,"show_size",12),c=I(t,"mode",12,"brush"),u=Z(!1),_=Z("hex"),d=null;const f=Oe();function g({index:M,color:T,opacity:st},N){N==="user"&&!T&&(d=M,U(u,!0)),T&&(i(T),st!==void 0&&a(st),N==="core"&&U(u,!1))}function p(M){d!==null&&n(n()[d]=M,!0)}let y=Z(0),x=Z(0);function b(M,T){let st;return function(...N){clearTimeout(st),st=setTimeout(()=>M(...N),T)}}let v=I(t,"preview",12,!1);function C(){v()||v(!0),k()}function w(){v(!1)}const k=b(w,1e3);function R(M){i(M)}function S(){n().length>=5&&n().pop(),!n().some(M=>Array.isArray(M)?M[0]===i()&&M[1]===a():M===i())&&(n().push([i(),a()]),n(n()))}yt(()=>X(i()),()=>{p(i())}),yt(()=>(X(o()),X(i())),()=>{o(),i(),C()}),Le();var P={get colors(){return e()},set colors(M){e(M),z()},get selected_color(){return i()},set selected_color(M){i(M),z()},get color_mode(){return r()},set color_mode(M){r(M),z()},get recent_colors(){return n()},set recent_colors(M){n(M),z()},get selected_size(){return o()},set selected_size(M){o(M),z()},get selected_opacity(){return a()},set selected_opacity(M){a(M),z()},get show_swatch(){return h()},set show_swatch(M){h(M),z()},get show_size(){return l()},set show_size(M){l(M),z()},get mode(){return c()},set mode(M){c(M),z()},get preview(){return v()},set preview(M){v(M),z()}};ve();var B=Nf();let G;var F=it(B);{var W=M=>{var T=ci(),st=qt(T);{var N=rt=>{var xt=Df(),K=qt(xt);Mf(K,{get color(){return i()},set color(ot){i(ot)},get opacity(){return a()},set opacity(ot){a(ot)},$$legacy:!0});var mt=$(K,2);Lf(mt,{get color(){return i()},get current_mode(){return m(_)},set current_mode(ot){U(_,ot)},$$events:{close:()=>U(u,!1),selected:({detail:ot})=>R(ot)},$$legacy:!0}),H(rt,xt)};Q(st,rt=>{m(u)&&rt(N)})}H(M,T)};Q(F,M=>{r()==="defaults"&&M(W)})}var q=$(F,2);{var L=M=>{{let T=Gt(()=>r()==="defaults"?n():null);Rf(M,{get colors(){return e()},get user_colors(){return m(T)},get selected_color(){return i()},get current_mode(){return m(_)},get color_picker(){return m(u)},set color_picker(st){U(u,st)},$$events:{select:({detail:st})=>g(st,"core"),edit:({detail:st})=>g(st,"user"),add_color:S},$$legacy:!0})}};Q(q,M=>{h()&&M(L)})}var D=$(q,2);{var gt=M=>{Gf(M,{max:100,min:1,get selected_size(){return o()},set selected_size(T){o(T)},$$legacy:!0})};Q(D,M=>{l()&&M(gt)})}return tt(B),ks(B,(M,T)=>Kr?.(M,T),()=>()=>f("click_outside")),Wt(()=>G=re(B,1,"wrap svelte-1l3f0ck",null,G,{padded:!m(u),color_picker:m(u),size_picker:l()&&c()==="brush",eraser_picker:c()==="eraser"})),kn("innerHeight",M=>U(x,M)),kn("innerWidth",M=>U(y,M)),H(s,B),de(P)}var Uf=nt("<!> <!>",1),Wf=nt("<!> <!> <!>",1),Hf=nt("<!> <!> <!>",1),Vf=nt('<div class="toolbar-wrap svelte-1uf24la"><div class="half-container svelte-1uf24la"><!> <!> <!></div> <div><!> <!> <!> <!></div></div>');function Xf(s,t){ue(t,!1);const e=Z(),i=Z(),r=Z(),n=Z(),o=Z();let a=I(t,"tool",12,"image"),h=I(t,"subtool",12,null),l=I(t,"background",12,!1),c=I(t,"brush_options",12),u=I(t,"selected_size",28,()=>c()&&typeof c().default_size=="number"?c().default_size:25),_=I(t,"eraser_options",12),d=I(t,"selected_eraser_size",28,()=>_()&&typeof _().default_size=="number"?_().default_size:25),f=I(t,"selected_color",28,()=>c()&&(()=>{const O=c().default_color;return Array.isArray(O)?O[0]:O})()),g=I(t,"selected_opacity",28,()=>c()&&(()=>{const O=c().default_color;if(Array.isArray(O))return O[1];const J=le(O);return J.getAlpha()<1?J.getAlpha():1})()),p=I(t,"preview",12,!1),y=I(t,"show_brush_color",12,!1),x=I(t,"show_brush_size",12,!1),b=I(t,"show_eraser_size",12,!1),v=I(t,"sources",12),C=I(t,"transforms",12),w=[];const k=Oe();function R(O,J){O.stopPropagation(),k("tool_change",{tool:J})}function S(O,J){O.stopPropagation(),k("subtool_change",{tool:a(),subtool:J})}yt(()=>(X(a()),X(h())),()=>{x(a()==="draw"&&h()==="size")}),yt(()=>(X(a()),X(h())),()=>{y(a()==="draw"&&h()==="color")}),yt(()=>(X(a()),X(h())),()=>{b(a()==="erase"&&h()==="size")}),yt(()=>X(C()),()=>{U(e,C().includes("crop"))}),yt(()=>X(C()),()=>{U(i,C().includes("resize"))}),yt(()=>X(v()),()=>{U(r,v().includes("upload"))}),yt(()=>X(v()),()=>{U(n,v().includes("webcam"))}),yt(()=>X(v()),()=>{U(o,v().includes("clipboard"))}),Le();var P={get tool(){return a()},set tool(O){a(O),z()},get subtool(){return h()},set subtool(O){h(O),z()},get background(){return l()},set background(O){l(O),z()},get brush_options(){return c()},set brush_options(O){c(O),z()},get selected_size(){return u()},set selected_size(O){u(O),z()},get eraser_options(){return _()},set eraser_options(O){_(O),z()},get selected_eraser_size(){return d()},set selected_eraser_size(O){d(O),z()},get selected_color(){return f()},set selected_color(O){f(O),z()},get selected_opacity(){return g()},set selected_opacity(O){g(O),z()},get preview(){return p()},set preview(O){p(O),z()},get show_brush_color(){return y()},set show_brush_color(O){y(O),z()},get show_brush_size(){return x()},set show_brush_size(O){x(O),z()},get show_eraser_size(){return b()},set show_eraser_size(O){b(O),z()},get sources(){return v()},set sources(O){v(O),z()},get transforms(){return C()},set transforms(O){C(O),z()}};ve();var B=Vf(),G=it(B),F=it(G);{var W=O=>{{let J=Gt(()=>a()==="image");ae(O,{get Icon(){return Ho},label:"Image",get highlight(){return m(J)},size:"medium",padded:!1,transparent:!0,$$events:{click:Tt=>R(Tt,"image")}})}};Q(F,O=>{X(v()),Rt(()=>v().length>0)&&O(W)})}var q=$(F,2);{var L=O=>{{let J=Gt(()=>a()==="draw");ae(O,{get Icon(){return rl},label:"Brush",get highlight(){return m(J)},size:"medium",padded:!1,transparent:!0,$$events:{click:Tt=>R(Tt,"draw")}})}};Q(q,O=>{c()&&O(L)})}var D=$(q,2);{var gt=O=>{{let J=Gt(()=>a()==="erase");ae(O,{get Icon(){return dl},label:"Erase",get highlight(){return m(J)},size:"medium",padded:!1,transparent:!0,$$events:{click:Tt=>R(Tt,"erase")}})}};Q(D,O=>{_()&&O(gt)})}tt(G);var M=$(G,2);let T;var st=it(M);{var N=O=>{var J=ci(),Tt=qt(J);{var E=lt=>{var at=Uf(),ft=qt(at);{var Et=Ut=>{{let Ft=Gt(()=>h()==="crop");ae(Ut,{get Icon(){return cl},label:"Crop",get highlight(){return m(Ft)},size:"medium",padded:!1,transparent:!0,offset:0,$$events:{click:vt=>S(vt,"crop")}})}};Q(ft,Ut=>{m(e)&&Ut(Et)})}var Nt=$(ft,2);{var bt=Ut=>{{let Ft=Gt(()=>h()==="size");ae(Ut,{get Icon(){return Al},label:"Resize",get highlight(){return m(Ft)},size:"medium",padded:!1,transparent:!0,offset:0,$$events:{click:vt=>S(vt,"size")}})}};Q(Nt,Ut=>{m(i)&&Ut(bt)})}H(lt,at)},et=lt=>{var at=Wf(),ft=qt(at);{var Et=vt=>{{let ee=Gt(()=>h()==="upload");ae(vt,{get Icon(){return Hh},label:"Upload",get highlight(){return m(ee)},size:"medium",padded:!1,transparent:!0,offset:0,$$events:{click:Zt=>S(Zt,"upload")}})}};Q(ft,vt=>{m(r)&&vt(Et)})}var Nt=$(ft,2);{var bt=vt=>{{let ee=Gt(()=>h()==="paste");ae(vt,{get Icon(){return Wh},label:"Paste",get highlight(){return m(ee)},size:"large",padded:!1,transparent:!0,offset:0,$$events:{click:Zt=>S(Zt,"paste")}})}};Q(Nt,vt=>{m(o)&&vt(bt)})}var Ut=$(Nt,2);{var Ft=vt=>{{let ee=Gt(()=>h()==="webcam");ae(vt,{get Icon(){return Vh},label:"Webcam",get highlight(){return m(ee)},size:"medium",padded:!1,transparent:!0,offset:0,$$events:{click:Zt=>S(Zt,"webcam")}})}};Q(Ut,vt=>{m(n)&&vt(Ft)})}H(lt,at)};Q(Tt,lt=>{l()?lt(E):lt(et,!1)})}H(O,J)};Q(st,O=>{a()==="image"&&O(N)})}var rt=$(st,2);{var xt=O=>{var J=Hf(),Tt=qt(J);ae(Tt,{get Icon(){return hl},label:"Color",get color(){return f()},size:"medium",padded:!1,transparent:!0,offset:0,$$events:{click:at=>S(at,"color")}});var E=$(Tt,2);{let at=Gt(()=>h()==="size");ae(E,{get Icon(){return wn},label:"Brush Size",get highlight(){return m(at)},size:"medium",padded:!1,transparent:!0,offset:0,$$events:{click:ft=>S(ft,"size")}})}var et=$(E,2);{var lt=at=>{Oo(at,{get colors(){return X(c()),Rt(()=>c().colors)},get color_mode(){return X(c()),Rt(()=>c().color_mode)},get recent_colors(){return w},get show_swatch(){return y()},get show_size(){return x()},mode:"brush",get selected_size(){return u()},set selected_size(ft){u(ft)},get selected_color(){return f()},set selected_color(ft){f(ft)},get selected_opacity(){return g()},set selected_opacity(ft){g(ft)},get preview(){return p()},set preview(ft){p(ft)},$$events:{click_outside:ft=>{ft.stopPropagation(),p(!1),y(!1),x(!1),S(ft,null)}},$$legacy:!0})};Q(et,at=>{(y()||x())&&at(lt)})}H(O,J)};Q(rt,O=>{a()==="draw"&&c()&&O(xt)})}var K=$(rt,2);{var mt=O=>{{let J=Gt(()=>h()==="size");ae(O,{get Icon(){return wn},label:"Eraser Size",get highlight(){return m(J)},size:"medium",padded:!1,transparent:!0,offset:0,$$events:{click:Tt=>S(Tt,"size")}})}};Q(K,O=>{a()==="erase"&&_()&&O(mt)})}var ot=$(K,2);{var ut=O=>{Oo(O,{colors:[],show_swatch:!1,show_size:!0,mode:"eraser",get selected_size(){return d()},set selected_size(J){d(J)},get selected_color(){return f()},set selected_color(J){f(J)},get selected_opacity(){return g()},set selected_opacity(J){g(J)},get preview(){return p()},set preview(J){p(J)},$$events:{click_outside:J=>{J.stopPropagation(),p(!1),b(!1),S(J,null)}},$$legacy:!0})};Q(ot,O=>{b()&&O(ut)})}return tt(M),tt(B),Wt(()=>T=re(M,1,"half-container right svelte-1uf24la",null,T,{hide:a()==="pan"||a()==="image"&&!l()&&v().length===0||a()==="image"&&l()&&C().length===0})),H(s,B),de(P)}var Yr=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
    
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,$r=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}`,Yf=`
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uOffset;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture(uTexture, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample top right pixel
    color += texture(uTexture, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y));

    // Sample bottom right pixel
    color += texture(uTexture, vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y));

    // Sample bottom left pixel
    color += texture(uTexture, vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y));

    // Average
    color *= 0.25;

    finalColor = color;
}`,$f=`struct KawaseBlurUniforms {
  uOffset:vec2<f32>,
};

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> kawaseBlurUniforms : KawaseBlurUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uOffset = kawaseBlurUniforms.uOffset;
  var color: vec4<f32> = vec4<f32>(0.0);

  // Sample top left pixel
  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x - uOffset.x, uv.y + uOffset.y));
  // Sample top right pixel
  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x + uOffset.x, uv.y + uOffset.y));
  // Sample bottom right pixel
  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x + uOffset.x, uv.y - uOffset.y));
  // Sample bottom left pixel
  color += textureSample(uTexture, uSampler, vec2<f32>(uv.x - uOffset.x, uv.y - uOffset.y));
  // Average
  color *= 0.25;

  return color;
}`,qf=`
precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform vec2 uOffset;

uniform vec4 uInputClamp;

void main(void)
{
    vec4 color = vec4(0.0);

    // Sample top left pixel
    color += texture(uTexture, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y + uOffset.y), uInputClamp.xy, uInputClamp.zw));

    // Sample top right pixel
    color += texture(uTexture, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y + uOffset.y), uInputClamp.xy, uInputClamp.zw));

    // Sample bottom right pixel
    color += texture(uTexture, clamp(vec2(vTextureCoord.x + uOffset.x, vTextureCoord.y - uOffset.y), uInputClamp.xy, uInputClamp.zw));

    // Sample bottom left pixel
    color += texture(uTexture, clamp(vec2(vTextureCoord.x - uOffset.x, vTextureCoord.y - uOffset.y), uInputClamp.xy, uInputClamp.zw));

    // Average
    color *= 0.25;

    finalColor = color;
}
`,jf=`struct KawaseBlurUniforms {
  uOffset:vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> kawaseBlurUniforms : KawaseBlurUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  let uOffset = kawaseBlurUniforms.uOffset;
  var color: vec4<f32> = vec4(0.0);

  // Sample top left pixel
  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x - uOffset.x, uv.y + uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));
  // Sample top right pixel
  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x + uOffset.x, uv.y + uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));
  // Sample bottom right pixel
  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x + uOffset.x, uv.y - uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));
  // Sample bottom left pixel
  color += textureSample(uTexture, uSampler, clamp(vec2<f32>(uv.x - uOffset.x, uv.y - uOffset.y), gfu.uInputClamp.xy, gfu.uInputClamp.zw));
  // Average
  color *= 0.25;
    
  return color;
}`,Kf=Object.defineProperty,Zf=(s,t,e)=>t in s?Kf(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,je=(s,t,e)=>(Zf(s,typeof t!="symbol"?t+"":t,e),e);const mh=class yh extends Er{constructor(...t){let e=t[0]??{};(typeof e=="number"||Array.isArray(e))&&(ht("6.0.0","KawaseBlurFilter constructor params are now options object. See params: { strength, quality, clamp, pixelSize }"),e={strength:e},t[1]!==void 0&&(e.quality=t[1]),t[2]!==void 0&&(e.clamp=t[2])),e={...yh.DEFAULT_OPTIONS,...e};const i=We.from({vertex:{source:$r,entryPoint:"mainVertex"},fragment:{source:e?.clamp?jf:$f,entryPoint:"mainFragment"}}),r=_i.from({vertex:Yr,fragment:e?.clamp?qf:Yf,name:"kawase-blur-filter"});super({gpuProgram:i,glProgram:r,resources:{kawaseBlurUniforms:{uOffset:{value:new Float32Array(2),type:"vec2<f32>"}}}}),je(this,"uniforms"),je(this,"_pixelSize",{x:0,y:0}),je(this,"_clamp"),je(this,"_kernels",[]),je(this,"_blur"),je(this,"_quality"),this.uniforms=this.resources.kawaseBlurUniforms.uniforms,this.pixelSize=e.pixelSize??{x:1,y:1},Array.isArray(e.strength)?this.kernels=e.strength:typeof e.strength=="number"&&(this._blur=e.strength,this.quality=e.quality??3),this._clamp=!!e.clamp}apply(t,e,i,r){const n=this.pixelSizeX/e.source.width,o=this.pixelSizeY/e.source.height;let a;if(this._quality===1||this._blur===0)a=this._kernels[0]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,t.applyFilter(this,e,i,r);else{const h=di.getSameSizeTexture(e);let l=e,c=h,u;const _=this._quality-1;for(let d=0;d<_;d++)a=this._kernels[d]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,t.applyFilter(this,l,c,!0),u=l,l=c,c=u;a=this._kernels[_]+.5,this.uniforms.uOffset[0]=a*n,this.uniforms.uOffset[1]=a*o,t.applyFilter(this,l,i,r),di.returnTexture(h)}}get strength(){return this._blur}set strength(t){this._blur=t,this._generateKernels()}get quality(){return this._quality}set quality(t){this._quality=Math.max(1,Math.round(t)),this._generateKernels()}get kernels(){return this._kernels}set kernels(t){Array.isArray(t)&&t.length>0?(this._kernels=t,this._quality=t.length,this._blur=Math.max(...t)):(this._kernels=[0],this._quality=1)}get pixelSize(){return this._pixelSize}set pixelSize(t){if(typeof t=="number"){this.pixelSizeX=this.pixelSizeY=t;return}if(Array.isArray(t)){this.pixelSizeX=t[0],this.pixelSizeY=t[1];return}this._pixelSize=t}get pixelSizeX(){return this.pixelSize.x}set pixelSizeX(t){this.pixelSize.x=t}get pixelSizeY(){return this.pixelSize.y}set pixelSizeY(t){this.pixelSize.y=t}get clamp(){return this._clamp}_updatePadding(){this.padding=Math.ceil(this._kernels.reduce((t,e)=>t+e+.5,0))}_generateKernels(){const t=this._blur,e=this._quality,i=[t];if(t>0){let r=t;const n=t/e;for(let o=1;o<e;o++)r-=n,i.push(r)}this._kernels=i,this._updatePadding()}};je(mh,"DEFAULT_OPTIONS",{strength:4,quality:3,clamp:!1,pixelSize:{x:1,y:1}});let Qf=mh;var Jf=`precision highp float;
in vec2 vTextureCoord;
out vec4 finalColor;

uniform sampler2D uTexture;
uniform float uAlpha;
uniform vec3 uColor;
uniform vec2 uOffset;

uniform vec4 uInputSize;

void main(void){
    vec4 sample = texture(uTexture, vTextureCoord - uOffset * uInputSize.zw);

    // Premultiply alpha
    sample.rgb = uColor.rgb * sample.a;

    // alpha user alpha
    sample *= uAlpha;

    finalColor = sample;
}`,tp=`struct DropShadowUniforms {
  uAlpha: f32,
  uColor: vec3<f32>,
  uOffset: vec2<f32>,
};

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;

@group(0) @binding(1) var uTexture: texture_2d<f32>; 
@group(0) @binding(2) var uSampler: sampler;
@group(1) @binding(0) var<uniform> dropShadowUniforms : DropShadowUniforms;

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  @location(0) uv : vec2<f32>
) -> @location(0) vec4<f32> {
  var color: vec4<f32> = textureSample(uTexture, uSampler, uv - dropShadowUniforms.uOffset * gfu.uInputSize.zw);

  // Premultiply alpha
  color = vec4<f32>(vec3<f32>(dropShadowUniforms.uColor.rgb * color.a), color.a);
  // alpha user alpha
  color *= dropShadowUniforms.uAlpha;

  return color;
}`,ep=Object.defineProperty,ip=(s,t,e)=>t in s?ep(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,ni=(s,t,e)=>(ip(s,typeof t!="symbol"?t+"":t,e),e);const xh=class bh extends Er{constructor(t){t={...bh.DEFAULT_OPTIONS,...t};const e=We.from({vertex:{source:$r,entryPoint:"mainVertex"},fragment:{source:tp,entryPoint:"mainFragment"}}),i=_i.from({vertex:Yr,fragment:Jf,name:"drop-shadow-filter"});super({gpuProgram:e,glProgram:i,resources:{dropShadowUniforms:{uAlpha:{value:t.alpha,type:"f32"},uColor:{value:new Float32Array(3),type:"vec3<f32>"},uOffset:{value:t.offset,type:"vec2<f32>"}}},resolution:t.resolution}),ni(this,"uniforms"),ni(this,"shadowOnly",!1),ni(this,"_color"),ni(this,"_blurFilter"),ni(this,"_basePass"),this.uniforms=this.resources.dropShadowUniforms.uniforms,this._color=new Ht,this.color=t.color??0,this._blurFilter=new Qf({strength:t.kernels??t.blur,quality:t.kernels?void 0:t.quality}),this._basePass=new Er({gpuProgram:We.from({vertex:{source:$r,entryPoint:"mainVertex"},fragment:{source:`
                    @group(0) @binding(1) var uTexture: texture_2d<f32>; 
                    @group(0) @binding(2) var uSampler: sampler;
                    @fragment
                    fn mainFragment(
                        @builtin(position) position: vec4<f32>,
                        @location(0) uv : vec2<f32>
                    ) -> @location(0) vec4<f32> {
                        return textureSample(uTexture, uSampler, uv);
                    }
                    `,entryPoint:"mainFragment"}}),glProgram:_i.from({vertex:Yr,fragment:`
                in vec2 vTextureCoord;
                out vec4 finalColor;
                uniform sampler2D uTexture;

                void main(void){
                    finalColor = texture(uTexture, vTextureCoord);
                }
                `,name:"drop-shadow-filter"}),resources:{}}),Object.assign(this,t)}apply(t,e,i,r){const n=di.getSameSizeTexture(e);t.applyFilter(this,e,n,!0),this._blurFilter.apply(t,n,i,r),this.shadowOnly||t.applyFilter(this._basePass,e,i,!1),di.returnTexture(n)}get offset(){return this.uniforms.uOffset}set offset(t){this.uniforms.uOffset=t,this._updatePadding()}get offsetX(){return this.offset.x}set offsetX(t){this.offset.x=t,this._updatePadding()}get offsetY(){return this.offset.y}set offsetY(t){this.offset.y=t,this._updatePadding()}get color(){return this._color.value}set color(t){this._color.setValue(t);const[e,i,r]=this._color.toArray();this.uniforms.uColor[0]=e,this.uniforms.uColor[1]=i,this.uniforms.uColor[2]=r}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}get blur(){return this._blurFilter.strength}set blur(t){this._blurFilter.strength=t,this._updatePadding()}get quality(){return this._blurFilter.quality}set quality(t){this._blurFilter.quality=t,this._updatePadding()}get kernels(){return this._blurFilter.kernels}set kernels(t){this._blurFilter.kernels=t}get pixelSize(){return this._blurFilter.pixelSize}set pixelSize(t){typeof t=="number"&&(t={x:t,y:t}),Array.isArray(t)&&(t={x:t[0],y:t[1]}),this._blurFilter.pixelSize=t}get pixelSizeX(){return this._blurFilter.pixelSizeX}set pixelSizeX(t){this._blurFilter.pixelSizeX=t}get pixelSizeY(){return this._blurFilter.pixelSizeY}set pixelSizeY(t){this._blurFilter.pixelSizeY=t}_updatePadding(){const t=Math.max(Math.abs(this.offsetX),Math.abs(this.offsetY));this.padding=t+this.blur*2+this.quality*4}};ni(xh,"DEFAULT_OPTIONS",{offset:{x:4,y:4},color:0,alpha:.5,shadowOnly:!1,kernels:void 0,blur:2,quality:3,pixelSize:{x:1,y:1},resolution:1});let sp=xh;class rp{name="image";context;current_tool;current_subtool;async setup(t,e,i){this.context=t,this.current_tool=e,this.current_subtool=i}cleanup(){}async add_image({image:t,fixed_canvas:e,border_region:i=0}){const r=new np(this.context,t,e,i);await this.context.execute_command(r)}set_tool(t,e){this.current_tool=t,this.current_subtool=e}}class np{sprite=null;fixed_canvas;context;background;current_canvas_size;computed_dimensions;current_scale;current_position;border_region;scaled_width;scaled_height;previous_image=null;name;constructor(t,e,i,r=0){if(this.name="AddImage",this.context=t,this.background=e,this.fixed_canvas=i,this.border_region=r,this.current_canvas_size=Ue(this.context.dimensions),this.current_scale=Ue(this.context.scale),this.current_position=Ue(this.context.position),this.computed_dimensions={width:0,height:0},this.context.background_image&&this.context.background_image.texture){const n=this.context.background_image,o=n.borderRegion||0;this.previous_image={texture:this.clone_texture(n.texture),width:n.width,height:n.height,x:n.position.x,y:n.position.y,border_region:o}}}clone_texture(t){const e=Jt.create({width:t.width,height:t.height,resolution:window.devicePixelRatio||1}),i=new kt(t),r=new ct;return r.addChild(i),this.context.app.renderer.render(r,{renderTexture:e}),r.destroy({children:!0}),e}async start(){let t;if(this.background instanceof _t)t=this.background;else{const r=await createImageBitmap(this.background);t=_t.from(r)}this.sprite=new kt(t);const[e,i]=this.handle_image();this.computed_dimensions={width:e,height:i}}handle_image(){if(this.sprite===null)return[0,0];if(this.fixed_canvas){const t=Math.max(this.current_canvas_size.width-this.border_region*2,10),e=Math.max(this.current_canvas_size.height-this.border_region*2,10),{width:i,height:r,x:n,y:o}=op(this.sprite.width,this.sprite.height,t,e);this.sprite.width=i,this.sprite.height=r,this.sprite.x=n+this.border_region,this.sprite.y=o+this.border_region}else{const t=this.sprite.width,e=this.sprite.height;return this.sprite.x=this.border_region,this.sprite.y=this.border_region,[t+this.border_region*2,e+this.border_region*2]}return[this.current_canvas_size.width,this.current_canvas_size.height]}async execute(t){if(t&&(this.context=t),await this.start(),this.sprite===null)return;const{width:e,height:i}=this.computed_dimensions;await this.context.set_image_properties({scale:1,position:{x:this.context.app.screen.width/2,y:this.context.app.screen.height/2},width:this.fixed_canvas?this.current_canvas_size.width:e,height:this.fixed_canvas?this.current_canvas_size.height:i});const r=this.context.layer_manager.create_background_layer(this.fixed_canvas?this.current_canvas_size.width:e,this.fixed_canvas?this.current_canvas_size.height:i);this.sprite.zIndex=0,r.addChild(this.sprite),this.context.layer_manager.reset_layers(this.fixed_canvas?this.current_canvas_size.width:e,this.fixed_canvas?this.current_canvas_size.height:i,!0),this.border_region>0&&(this.sprite.borderRegion=this.border_region),this.context.set_background_image(this.sprite),this.context.reset()}async undo(){if(this.sprite){if(this.sprite.destroy(),this.previous_image){const t=new kt(this.previous_image.texture);t.width=this.previous_image.width,t.height=this.previous_image.height,t.position.set(this.previous_image.x,this.previous_image.y),this.previous_image.border_region>0&&(t.borderRegion=this.previous_image.border_region),await this.context.set_image_properties({scale:1,position:{x:this.context.app.screen.width/2,y:this.context.app.screen.height/2},width:this.previous_image.width,height:this.previous_image.height});const e=this.context.layer_manager.create_background_layer(this.previous_image.width,this.previous_image.height);t.zIndex=0,e.addChild(t),this.context.layer_manager.reset_layers(this.previous_image.width,this.previous_image.height,!0),this.context.set_background_image(t)}else await this.context.set_image_properties({scale:1,position:{x:this.context.app.screen.width/2,y:this.context.app.screen.height/2},width:this.current_canvas_size.width,height:this.current_canvas_size.height}),this.context.layer_manager.create_background_layer(this.current_canvas_size.width,this.current_canvas_size.height),this.context.layer_manager.reset_layers(this.current_canvas_size.width,this.current_canvas_size.height);this.context.reset()}}}function op(s,t,e,i){const r=s/t,n=e/i;let o,a;r>n?(o=e,a=e/r):(a=i,o=i*r);const h=Math.round((e-o)/2),l=Math.round((i-a)/2);return{width:Math.round(o),height:Math.round(a),x:h,y:l}}class qr{name="zoom";min_zoom=ai(!0);image_editor_context;max_zoom=10;border_padding=30;pad_bottom=0;is_pinching=!1;is_dragging=!1;is_pointer_dragging=!1;last_touch_position=null;last_pinch_distance=0;drag_start=new dt;current_tool;current_subtool;local_scale=1;local_dimensions={width:0,height:0};local_position={x:0,y:0};prevent_default(t){t.preventDefault(),t.stopPropagation()}set_tool(t,e){this.current_tool=t,this.current_subtool=e}set_zoom(t){const e=this.calculate_min_zoom(this.local_dimensions.width,this.local_dimensions.height);let i;const r=t==="fit";r?i=e:i=Math.max(0,Math.min(this.max_zoom,t));const n=this.image_editor_context.app.screen,o=n.width,a=n.height;let h;h={x:o/2,y:a/2},this.zoom_to_point(i,h,!0,r)}async setup(t,e,i){this.image_editor_context=t,this.current_tool=e,this.current_subtool=i,this.pad_bottom=t.pad_bottom;const{width:r,height:n}=await this.get_container_dimensions(),o=this.calculate_min_zoom(r,n),a=Math.min(o,1);this.local_scale=a;const h=this.image_editor_context.app.screen,l=h.width/2,c=h.height/2,u=r*a,_=n*a,d=l-u/2,f=c-_/2;this.local_position={x:d,y:f},this.setup_event_listeners(),await this.image_editor_context.set_image_properties({scale:a,position:{x:d,y:f}}),this.image_editor_context.dimensions.subscribe(g=>{this.local_dimensions=g}),this.image_editor_context.scale.subscribe(g=>{this.local_scale=g}),this.image_editor_context.position.subscribe(g=>{this.local_position=g})}setup_event_listeners(){const t=this.image_editor_context.app.stage;this.image_editor_context.app.canvas.addEventListener("wheel",this.prevent_default,{passive:!1}),t.eventMode="static",t.hitArea=this.image_editor_context.app.screen;const i=this.handle_wheel.bind(this);t.addEventListener("wheel",i,{passive:!1}),"ontouchstart"in window?(t.addEventListener("touchstart",this.handle_touch_start.bind(this)),t.addEventListener("touchmove",this.handle_touch_move.bind(this)),t.addEventListener("touchend",this.handle_touch_end.bind(this))):(t.addEventListener("pointerdown",this.handle_pointer_down.bind(this)),t.addEventListener("pointermove",this.handle_pointer_move.bind(this)),t.addEventListener("pointerup",this.handle_pointer_up.bind(this)),t.addEventListener("pointerupoutside",this.handle_pointer_up.bind(this)))}handle_wheel(t){const e=t.deltaMode===0&&Math.abs(t.deltaY)<50,i=e?30:10;if(t.altKey||t.metaKey){const r=this.image_editor_context.app.stage.toLocal(t.global),n=-t.deltaY*(e?.001:5e-4),o=this.local_scale*(1+n);this.zoom_to_point(o,r,!0)}else{const r=t.deltaX,n=t.deltaY,o={x:this.local_position.x-r/100*i,y:this.local_position.y-n/100*i},a=this.image_editor_context.app.screen,h=this.local_dimensions.width*this.local_scale,l=this.local_dimensions.height*this.local_scale,c=a.width-this.border_padding*2,u=a.height-this.border_padding*2-this.pad_bottom;let _={...o};if(h<=c)_.x=(a.width-h)/2;else{const d=a.width/2,f=d,g=a.width-d-h;_.x=Math.min(Math.max(o.x,g),f)}if(l<=u)_.y=(a.height-this.pad_bottom-l)/2;else{const d=(a.height-this.pad_bottom)/2,f=d,g=a.height-this.pad_bottom-d-l;_.y=Math.min(Math.max(o.y,g),f)}this.image_editor_context.set_image_properties({scale:this.local_scale,position:_})}}cleanup(){const t=this?.image_editor_context?.app?.stage;t&&(t.removeEventListener("wheel",this.handle_wheel.bind(this)),"ontouchstart"in window?(t.removeEventListener("touchstart",this.handle_touch_start.bind(this)),t.removeEventListener("touchmove",this.handle_touch_move.bind(this)),t.removeEventListener("touchend",this.handle_touch_end.bind(this))):(t.removeEventListener("pointerdown",this.handle_pointer_down.bind(this)),t.removeEventListener("pointermove",this.handle_pointer_move.bind(this)),t.removeEventListener("pointerup",this.handle_pointer_up.bind(this)),t.removeEventListener("pointerupoutside",this.handle_pointer_up.bind(this))))}async get_container_dimensions(){const t=this.image_editor_context.image_container.getLocalBounds();return{width:t.width,height:t.height}}calculate_min_zoom(t,e){const i=this.image_editor_context.app.screen,r=i.width,n=i.height;if(!t||!r||!e||!n)return 1;const o=r-this.border_padding*2,a=n-this.border_padding*2-this.pad_bottom,h=o/t,l=a/e;return Math.min(h,l)}handle_touch_start(t){t.preventDefault();const e=t;if(e.touches&&e.touches.length===2)this.is_pinching=!0,this.last_pinch_distance=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY);else if(e.touches&&e.touches.length===1){this.is_dragging=!0;const i=this.image_editor_context.app.view.getBoundingClientRect();this.last_touch_position=new dt(e.touches[0].pageX-i.left,e.touches[0].pageY-i.top)}}handle_touch_move(t){t.preventDefault();const e=t;if(this.is_pinching&&e.touches&&e.touches.length===2){const i=this.image_editor_context.app.view.getBoundingClientRect(),r=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY),n={x:(e.touches[0].pageX+e.touches[1].pageX)/2-i.left,y:(e.touches[0].pageY+e.touches[1].pageY)/2-i.top},o=r/this.last_pinch_distance;this.last_pinch_distance=r,this.zoom_to_point(this.local_scale*o,n)}else if(this.is_dragging&&e.touches&&e.touches.length===1&&this.last_touch_position){const i=this.image_editor_context.app.view.getBoundingClientRect(),r=new dt(e.touches[0].pageX-i.left,e.touches[0].pageY-i.top),n=r.x-this.last_touch_position.x,o=r.y-this.last_touch_position.y;this.image_editor_context.set_image_properties({position:{x:this.local_position.x+n,y:this.local_position.y+o}}),this.last_touch_position=r}}handle_touch_end(t){t.preventDefault();const e=t;if(e.touches&&e.touches.length<2&&(this.is_pinching=!1,e.touches&&e.touches.length===1)){const i=this.image_editor_context.app.view.getBoundingClientRect();this.last_touch_position=new dt(e.touches[0].pageX-i.left,e.touches[0].pageY-i.top),this.is_dragging=!0}e.touches&&e.touches.length===0&&(this.is_dragging=!1,this.last_touch_position=null,this.last_pinch_distance=0)}get_bounded_position(t){const e=this.image_editor_context.app.screen,i=this.local_dimensions.width*this.local_scale,r=this.local_dimensions.height*this.local_scale,n={x:(e.width-i)/2,y:(e.height-r-this.pad_bottom)/2};if(i<=e.width&&r<=e.height)return n;let o=t.x,a=t.y;if(i<=e.width)o=n.x;else{const h=e.width-i;o=Math.max(h,Math.min(0,t.x))}if(r<=e.height-this.pad_bottom)a=n.y;else{const h=e.height-r-this.pad_bottom;a=Math.max(h,Math.min(0,t.y))}return{x:o,y:a}}zoom_to_point(t,e,i,r){const n=this.image_editor_context.image_container,o=n.getGlobalPosition(),a=n.scale.x,h={x:(e.x-o.x)/a,y:(e.y-o.y)/a},l=this.calculate_min_zoom(this.local_dimensions.width,this.local_dimensions.height),c=Math.min(l,1);t=Math.min(Math.max(t,c),this.max_zoom);const u={x:e.x-h.x*t,y:e.y-h.y*t};if(t===c||r){const _=this.image_editor_context.app.screen.width,d=this.image_editor_context.app.screen.height,f=this.local_dimensions.width*t,g=this.local_dimensions.height*t;u.x=(_-f)/2,u.y=(d-this.pad_bottom-g)/2}this.image_editor_context.set_image_properties({scale:t,position:u,animate:typeof i=="boolean"?!i:t===c}),this.min_zoom.set(t===c)}handle_pointer_down(t){t.button===0&&this.current_tool==="pan"&&(this.is_pointer_dragging=!0,this.drag_start.copyFrom(t.global),this.drag_start.x-=this.local_position.x,this.drag_start.y-=this.local_position.y)}handle_pointer_move(t){if(this.is_pointer_dragging&&this.current_tool==="pan"){const e={x:t.global.x-this.drag_start.x,y:t.global.y-this.drag_start.y},i=this.image_editor_context.app.screen,r=this.local_dimensions.width*this.local_scale,n=this.local_dimensions.height*this.local_scale,o=i.width-this.border_padding*2,a=i.height-this.border_padding*2-this.pad_bottom;let h={...e};r<=o?h.x=(i.width-r)/2:h.x=e.x,n<=a?h.y=(i.height-this.pad_bottom-n)/2:h.y=e.y,this.image_editor_context.set_image_properties({scale:this.local_scale,position:h})}}handle_pointer_up(t){if(this.is_pointer_dragging&&this.current_tool==="pan"){this.is_pointer_dragging=!1;const e={x:t.global.x-this.drag_start.x,y:t.global.y-this.drag_start.y},i=this.image_editor_context.app.screen,r=this.local_dimensions.width*this.local_scale,n=this.local_dimensions.height*this.local_scale,o=i.width-this.border_padding*2,a=i.height-this.border_padding*2-this.pad_bottom;let h={...e};if(r<=o)h.x=(i.width-r)/2;else{const l=i.width/2,c=l,u=i.width-l-r;h.x=Math.min(Math.max(e.x,u),c)}if(n<=a)h.y=(i.height-this.pad_bottom-n)/2;else{const l=(i.height-this.pad_bottom)/2,c=l,u=i.height-this.pad_bottom-l-n;h.y=Math.min(Math.max(e.y,u),c)}this.image_editor_context.set_image_properties({scale:this.local_scale,position:h,animate:!0})}}}class ap{layers=[];active_layer=null;active_layer_id=null;draw_textures=new Map;layer_store=ai({active_layer:"",layers:[]});background_layer=null;image_container;app;fixed_canvas;dark;border_region;layer_options;constructor(t,e,i,r,n,o){this.image_container=t,this.app=e,this.fixed_canvas=i,this.dark=r,this.border_region=n,this.layer_options=o}toggle_layer_visibility(t){const e=this.layers.find(i=>i.id===t);e&&(e.container.visible=!e.container.visible,e.visible=e.container.visible,this.layer_store.update(i=>({active_layer:i.active_layer,layers:this.layers})))}create_background_layer(t,e){this.background_layer&&this.background_layer.destroy();const i=new ct;this.background_layer=i;const r=Jt.create({width:t,height:e,resolution:window.devicePixelRatio,antialias:!0,scaleMode:Lo.NEAREST}),n=new kt(r);i.addChild(n);const o=new Dt;return o.clear(),o.rect(0,0,t,e).fill({color:this.dark?3355443:16777215,alpha:1}),this.app.renderer.render({container:o,target:r,clear:!0}),this.image_container.addChild(i),i.zIndex=-1,this.update_layer_order(),i}set_layer_options(t,e,i){this.layer_options=t,this.reset_layers(e,i)}async create_background_layer_from_url(t,e,i){const r=this.create_background_layer(e||this.image_container.width,i||this.image_container.height);try{const n=await _t.from(t),o=new kt(n),a=o.texture.width,h=o.texture.height,l=e||this.image_container.width,c=i||this.image_container.height;if(this.fixed_canvas){const u=Math.max(l-this.border_region*2,10),_=Math.max(c-this.border_region*2,10),d=a/h,f=u/_;let g,p,y=this.border_region,x=this.border_region;a<=u&&h<=_?(g=a,p=h):d>f?(g=u,p=u/d):(p=_,g=_*d),y+=Math.round((u-g)/2),x+=Math.round((_-p)/2),o.width=g,o.height=p,o.position.set(y,x)}else{o.position.set(this.border_region,this.border_region),this.background_layer&&this.background_layer.destroy();const u=a+this.border_region*2,_=h+this.border_region*2,d=this.create_background_layer(u,_);return o.width=a,o.height=h,d.addChild(o),d}return r.addChild(o),r}catch(n){return console.error("Error loading image from URL:",n),r}}create_layer({width:t,height:e,layer_name:i,user_created:r,layer_id:n=void 0,make_active:o=!1}){const a=new ct,h=n||Math.random().toString(36).substring(2,15),l=i||`Layer ${this.layers.length+1}`;this.layers.push({name:l,id:h,container:a,user_created:r,visible:!0}),this.image_container.addChild(a);const c=Jt.create({width:t,height:e,resolution:window.devicePixelRatio,antialias:!0,scaleMode:Lo.NEAREST}),u=new kt(c);a.addChild(u);const _=new Dt;return _.clear(),_.beginFill(0,0),_.drawRect(0,0,t,e),_.endFill(),this.app.renderer.render({container:_,target:c,clear:!0}),this.draw_textures.set(a,c),this.update_layer_order(),o&&this.set_active_layer(h),this.layer_store.set({active_layer:this.active_layer_id||"",layers:this.layers}),a}async add_layer_from_url(t){const{width:e,height:i}=this.image_container.getLocalBounds(),r=this.create_layer({width:e,height:i,layer_name:"Layer 1",user_created:!0}),n=this.layers.findIndex(a=>a.container===r);if(n===-1)return console.error("Could not find newly created layer"),"";const o=this.layers[n].id;try{const a=await Ze.load(t),h=this.draw_textures.get(r);if(!h)return console.error("No draw texture found for layer"),o;const l=new kt(a),c=l.width,u=l.height;let _=this.border_region,d=this.border_region;const f=this.fixed_canvas?e-this.border_region*2:e,g=this.fixed_canvas?i-this.border_region*2:i;if((c<f||u<g)&&(_=Math.floor((f-c)/2),d=Math.floor((g-u)/2)),l.position.set(_,d),c>f||u>g){const p=c/u,y=f/g;let x,b;p>y?(x=f,b=f/p):(b=g,x=g*p),l.width=x,l.height=b,_=this.border_region+Math.floor((f-x)/2),d=this.border_region+Math.floor((g-b)/2),l.position.set(_,d)}return this.app.renderer.render(l,{renderTexture:h}),this.set_active_layer(o),o}catch(a){return console.error("Error loading image from URL:",a),o}}get_active_layer(){return this.active_layer}set_active_layer(t){this.layers.some(e=>e.id===t)&&(this.active_layer=this.layers.find(e=>e.id===t)?.container||this.layers[0]?.container||null,this.active_layer_id=t,this.layer_store.set({active_layer:t,layers:this.layers}))}get_layers(){return this.layers}get_layer_textures(t){const e=this.layers.find(i=>i.id===t);if(e){const i=this.draw_textures.get(e.container);if(i)return{draw:i}}return null}delete_layer(t){const e=this.layers.findIndex(i=>i.id===t);if(e>-1){const i=this.draw_textures.get(this.layers[e].container);if(i&&(i.destroy(),this.draw_textures.delete(this.layers[e].container)),this.layers[e].container.destroy(),this.active_layer===this.layers[e].container){const r=this.layers[Math.max(0,e-1)]||null;this.active_layer=r?.container||null,this.active_layer_id=r?.id||null}this.layers=this.layers.filter(r=>r.id!==t),this.layer_store.update(r=>({active_layer:r.active_layer===t?this.layers[this.layers.length-1]?.id:r.active_layer,layers:this.layers})),this.update_layer_order()}}update_layer_order(){this.background_layer&&(this.background_layer.zIndex=-1),this.layers.forEach((t,e)=>{t.container.zIndex=e})}move_layer(t,e){const i=this.layers.findIndex(r=>r.id===t);if(i>-1){const r=e==="up"?i-1:i+1;this.layers=this.layers.map((n,o)=>o===i?this.layers[r]:o===r?this.layers[i]:n),this.update_layer_order(),this.layer_store.update(n=>({active_layer:t,layers:this.layers}))}}resize_all_layers(t,e,i,r,n,o){new Map(this.layers.map(d=>[d.id,d]));const a=this.background_layer,h=()=>{let d=0,f=0;const g=t-n,p=e-o;return r.includes("left")?d=0:r.includes("right")?d=g:d=Math.floor(g/2),r.includes("top")?f=0:r.includes("bottom")?f=p:f=Math.floor(p/2),{offsetX:d,offsetY:f}};this.background_layer=this._resize_background_layer(a,t,e,i,h);const l=[],c=this.layers.map(d=>({id:d.id,name:d.name,user_created:d.user_created,texture:this.draw_textures.get(d.container),container:d.container}));this.layers=[],this.draw_textures.clear();for(const d of c){const f=this._resize_single_layer(d,t,e,i,h);f&&l.push(f)}const u=Ue(this.layer_store).active_layer;!l.some(d=>d.id===u)&&l.length>0?this.set_active_layer(l[0].id):l.length===0?this.layer_store.update(d=>({...d,active_layer:""})):this.layer_store.update(d=>({...d})),this.update_layer_order(),setTimeout(()=>{Ze.cache.reset(),this.app.renderer.textureGC.run()},100)}_resize_background_layer(t,e,i,r,n){if(!t)return this.create_background_layer(e,i);let o=t.children.find(h=>h instanceof kt&&h.texture!==t.children[0]?.texture);const a=this.create_background_layer(e,i);if(o){const h=new kt(o.texture);if(h.width=o.width,h.height=o.height,r)h.width=e,h.height=i,h.position.set(0,0);else{const{offsetX:l,offsetY:c}=n();h.position.set(o.x+l,o.y+c)}a.addChild(h)}return a}_resize_single_layer(t,e,i,r,n){if(!t.texture)return console.warn(`No texture found for layer ${t.id}, skipping cleanup.`),t.container&&!t.container.destroyed&&(this.image_container.children.includes(t.container)&&this.image_container.removeChild(t.container),t.container.destroy({children:!0})),null;const o=this.create_layer({width:e,height:i,layer_name:t.name,user_created:t.user_created}),a=this.layers[this.layers.length-1];a.id=t.id;const h=this.draw_textures.get(o);if(!h){if(console.error(`Failed to get texture for newly created layer ${a.id}. Cleaning up.`),o&&!o.destroyed){this.image_container.children.includes(o)&&this.image_container.removeChild(o),o.destroy({children:!0});const c=this.layers.findIndex(u=>u.container===o);c>-1&&this.layers.splice(c,1),this.draw_textures.delete(o)}return t.texture&&!t.texture.destroyed&&t.texture.destroy(!0),t.container&&!t.container.destroyed&&t.container.destroy({children:!0}),null}this.app.renderer.clear({target:h,clearColor:[0,0,0,0]});const l=new kt(t.texture);if(r)l.width=e,l.height=i,l.position.set(0,0);else{const{offsetX:c,offsetY:u}=n();l.position.set(c,u)}return this.app.renderer.render(l,{renderTexture:h}),l.destroy(),t.texture&&!t.texture.destroyed&&t.texture.destroy(!0),t.container&&!t.container.destroyed&&(this.image_container.children.includes(t.container)&&this.image_container.removeChild(t.container),t.container.destroy({children:!0})),a}async get_blobs(t,e){return{background:await _s(this.app.renderer,this.background_layer,{width:t,height:e,x:0,y:0}),layers:await Promise.all(this.layers.map(async r=>{const n=await _s(this.app.renderer,r.container,{width:t,height:e,x:0,y:0});return n||null})),composite:await _s(this.app.renderer,this.image_container,{width:t,height:e,x:0,y:0})}}reset_layers(t,e,i=!1){const r=i?this.layers.map(n=>[n.name,n.id]):this.layer_options.layers.map(n=>[n,void 0]);this.layers.forEach(n=>{this.delete_layer(n.id)});for(const[n,o]of r)this.create_layer({width:t,height:e,layer_name:n,user_created:!this.layer_options.layers.find(a=>a===n),layer_id:o});if(!i)this.active_layer=this.layers[0].container,this.active_layer_id=this.layers[0].id;else if(this.active_layer=this.layers.find(n=>n.id===this.active_layer_id)?.container||this.layers[0]?.container,!this.active_layer)return;this.layer_store.update(n=>({active_layer:this.active_layer_id||this.layers[0].id,layers:this.layers}))}init_layers(t,e){for(const r of this.layers)this.delete_layer(r.id);let i=0;for(const r of this.layer_options.layers)this.create_layer({width:t,height:e,layer_name:r,user_created:!1,layer_id:`layer-${i}`}),i++;this.active_layer=this.layers[0].container,this.active_layer_id=this.layers[0].id,this.layer_store.update(r=>({active_layer:this.layers[0].id,layers:this.layers}))}}class hp{constructor(t,e){this.context=t,this.width=e.width,this.height=e.height,this.layer_name=e.layer_name||`Layer ${this.context.layer_manager.get_layers().length+1}`,this.user_created=e.user_created,this.layer_id=e.layer_id||Math.random().toString(36).substring(2,15),this.make_active=e.make_active||!1,this.name="AddLayer";const r=this.context.layer_manager.get_layers().find(n=>n.container===this.context.layer_manager.get_active_layer());this.previous_active_layer=r?.id||null}layer_id;layer_name;width;height;user_created;make_active;previous_active_layer=null;name;async execute(t){t&&(this.context=t),this.context.layer_manager.create_layer({width:this.width,height:this.height,layer_name:this.layer_name,user_created:this.user_created,layer_id:this.layer_id,make_active:this.make_active})}async undo(){this.context.layer_manager.delete_layer(this.layer_id),this.previous_active_layer&&this.context.layer_manager.set_active_layer(this.previous_active_layer)}}class lp{constructor(t,e){this.context=t,this.name="RemoveLayer";const i=this.context.layer_manager.get_layers(),r=i.find(a=>a.id===e);if(!r)throw new Error(`Layer with ID ${e} not found`);const n=this.context.layer_manager.get_active_layer(),o=r.container===n;if(o){const a=i.findIndex(l=>l.id===e),h=i[Math.max(0,a-1)];this.previous_active_layer=h?.id||null}this.layer_data={id:r.id,name:r.name,user_created:r.user_created,visible:r.visible,was_active:o},this.captureTextureData(e)}layer_data;previous_active_layer=null;texture_copy=null;name;captureTextureData(t){const e=this.context.layer_manager.get_layer_textures(t);if(e)try{const i=e.draw,r=Jt.create({width:i.width,height:i.height,resolution:window.devicePixelRatio||1}),n=new kt(i);this.context.app.renderer.render(n,{renderTexture:r}),this.texture_copy=r,n.destroy()}catch(i){console.error("Failed to copy layer texture:",i),this.texture_copy=null}}async execute(t){t&&(this.context=t),this.context.layer_manager.delete_layer(this.layer_data.id)}async undo(){const t=Ue(this.context.dimensions);if(this.context.layer_manager.create_layer({width:t.width,height:t.height,layer_name:this.layer_data.name,user_created:this.layer_data.user_created,layer_id:this.layer_data.id,make_active:this.layer_data.was_active}),this.texture_copy)try{const e=this.context.layer_manager.get_layer_textures(this.layer_data.id);if(e){const i=new kt(this.texture_copy);this.context.app.renderer.render(i,{renderTexture:e.draw}),i.destroy()}}catch(e){console.error("Failed to restore layer content:",e)}this.layer_data.visible||this.context.layer_manager.toggle_layer_visibility(this.layer_data.id),!this.layer_data.was_active&&this.previous_active_layer&&this.context.layer_manager.set_active_layer(this.previous_active_layer)}destroy(){this.texture_copy&&(this.texture_copy.destroy(),this.texture_copy=null)}}class cp{constructor(t,e,i){this.context=t,this.layer_id=e,this.direction=i,this.name="ReorderLayer";const r=this.context.layer_manager.get_layers();this.original_order=r.map(a=>a.id);const n=r.findIndex(a=>a.id===e);if(n===-1)throw new Error(`Layer with ID ${e} not found`);const o=i==="up"?n-1:n+1;o<0||o>=r.length?this.new_order=[...this.original_order]:(this.new_order=[...this.original_order],[this.new_order[n],this.new_order[o]]=[this.new_order[o],this.new_order[n]])}original_order;new_order;layer_id;direction;name;async execute(t){t&&(this.context=t),this.context.layer_manager.move_layer(this.layer_id,this.direction)}async undo(){const t=this.context.layer_manager.get_layers();if(this.original_order.join(",")===t.map(n=>n.id).join(","))return;const e=t.findIndex(n=>n.id===this.layer_id);if(e===-1)return;const i=this.original_order.indexOf(this.layer_id),r=e>i?"up":"down";this.context.layer_manager.move_layer(this.layer_id,r)}}const up={image:()=>new rp,zoom:()=>new qr},yr={stiffness:.45,damping:.8};class dp{state;scale;position;subscribers;constructor(t){if(!(t instanceof jr))throw new Error("EditorState must be created by ImageEditor");this.scale=1,this.position={x:0,y:0},this.subscribers=new Set,this.state=Object.freeze({get position(){return{...this.position}},get scale(){return this.scale},get current_tool(){return this.current_tool},get current_subtool(){return this.current_subtool},subscribe:this.subscribe.bind(this)})}_set_position(t,e){const i={...this.position};this.position={x:t,y:e},this._notify_subscribers("position",i,this.position)}_set_scale(t){const e=this.scale;this.scale=t,this._notify_subscribers("scale",e,t)}_notify_subscribers(t,e,i){this.subscribers.forEach(r=>{r({property:t,oldValue:e,newValue:i,timestamp:Date.now()})})}subscribe(t){return this.subscribers.add(t),()=>this.subscribers.delete(t)}}class jr{ready;background_image_present=ai(!1);min_zoom=ai(!0);app;ui_container;image_container;command_manager;layer_manager;tools=new Map;current_tool;current_subtool;target_element;width;height;original_width;original_height;dimensions;scale;position;state;scale_value=1;position_value={x:0,y:0};dimensions_value={width:0,height:0};layers=ai({active_layer:"",layers:[]});outline_container;outline_graphics;background_image;ready_resolve;event_callbacks=new Map;fixed_canvas;dark;border_region;layer_options;overlay_container;overlay_graphics;pad_bottom;theme_mode;constructor(t){this.pad_bottom=t.pad_bottom||0,this.dark=t.dark||!1,this.theme_mode=t.theme_mode||"dark",this.target_element=t.target_element,this.width=t.width,this.height=t.height,this.original_width=t.width,this.original_height=t.height,this.command_manager=new Pl,this.ready=new Promise(e=>{this.ready_resolve=e}),this.fixed_canvas=t.fixed_canvas||!1,this.tools=new Map(t.tools.map(e=>typeof e=="string"?[e,up[e]()]:[e.name,e]));for(const e of this.tools.values())e?.on&&e.on("change",()=>{this.notify("change")});this.dimensions=Gs({width:this.width,height:this.height},yr),this.scale=Gs(1,yr),this.position=Gs({x:0,y:0},yr),this.state=new dp(this),this.border_region=t.border_region||0,this.layer_options=t.layer_options||{allow_additional_layers:!0,layers:["Layer 1"],disabled:!1},this.scale.subscribe(e=>{this.state._set_scale(e)}),this.position.subscribe(e=>{this.state._set_position(e.x,e.y)}),this.init()}get context(){const t=this;return{app:this.app,ui_container:this.ui_container,image_container:this.image_container,get background_image(){return t.background_image},pad_bottom:this.pad_bottom,command_manager:this.command_manager,layer_manager:this.layer_manager,dimensions:{subscribe:this.dimensions.subscribe},scale:{subscribe:this.scale.subscribe},position:{subscribe:this.position.subscribe},set_image_properties:this.set_image_properties.bind(this),execute_command:this.execute_command.bind(this),resize_canvas:this.resize_canvas.bind(this),reset:this.reset.bind(this),set_background_image:this.set_background_image.bind(this)}}async init(){const t=this.target_element.getBoundingClientRect();new ResizeObserver(r=>{r.forEach(n=>{this.resize_canvas(n.contentBoxSize[0].inlineSize,n.contentBoxSize[0].blockSize)})}).observe(this.target_element),this.app=new Ha,this.dark||(globalThis.__PIXI_APP__=this.app),await this.app.init({width:t.width,height:t.height,backgroundAlpha:this.dark?0:1,backgroundColor:this.theme_mode==="dark"?"#27272a":"#ffffff",resolution:window.devicePixelRatio,autoDensity:!0,antialias:!0,powerPreference:"high-performance"});const e=this.app.canvas;e.style.background="transparent",this.setup_containers(),this.layer_manager.create_background_layer(this.width,this.height),this.layer_manager.init_layers(this.width,this.height);for(const r of this.tools.values())await r.setup(this.context,this.current_tool,this.current_subtool);const i=this.tools.get("zoom");i&&i.min_zoom.subscribe(r=>{this.min_zoom.set(r)}),this.target_element.appendChild(e),this.target_element.style.background="transparent",this.dimensions.subscribe(r=>{this.dimensions_value=r,this.image_container.width=r.width,this.image_container.height=r.height}),this.scale.subscribe(r=>{this.scale_value=r}),this.position.subscribe(r=>{this.position_value=r}),this.app.ticker.add(()=>{this.image_container.scale.set(this.scale_value),this.image_container.position.set(this.position_value.x,this.position_value.y);const r=this.dimensions_value.width*this.scale_value,n=this.dimensions_value.height*this.scale_value,o=Math.round(this.image_container.position.x-this.outline_container.position.x),a=Math.round(this.image_container.position.y-this.outline_container.position.y);if(this.overlay_container.position.set(this.outline_container.position.x,this.outline_container.position.y),this.outline_graphics.clear(),this.outline_graphics.rect(o,a,r,n).fill({color:this.dark?3355443:16777215,alpha:1}),this.border_region>0){const h=this.border_region*this.scale_value,l=o+h-1,c=a+h-1,u=r-h*2+1,_=n-h*2+1;this.overlay_graphics.clear(),this.overlay_graphics.rect(l,c,u,_).stroke({color:10066329,width:1,alpha:0,pixelLine:!0});const d=5,g=d+5,p=10066329;for(let y=l;y<l+u;y+=g)this.overlay_graphics.rect(y,c,Math.min(d,l+u-y),1).fill({color:p,alpha:.7}),this.overlay_graphics.rect(y,c+_,Math.min(d,l+u-y),1).fill({color:p,alpha:.7});for(let y=c;y<c+_;y+=g)this.overlay_graphics.rect(l,y,1,Math.min(d,c+_-y)).fill({color:p,alpha:.7}),this.overlay_graphics.rect(l+u,y,1,Math.min(d,c+_-y)).fill({color:p,alpha:.7})}else this.overlay_graphics.clear()}),this.ready_resolve()}setup_containers(){if(this.image_container=new ct({eventMode:"static",sortableChildren:!0}),this.image_container.width=this.width,this.image_container.height=this.height,this.app.stage.sortableChildren=!0,this.app.stage.alpha=1,this.app.stage.addChild(this.image_container),this.image_container.scale.set(1),this.ui_container=new ct({eventMode:"static"}),this.app.stage.addChild(this.ui_container),this.ui_container.width=this.width,this.ui_container.height=this.height,this.outline_container=new ct,this.outline_container.zIndex=-10,this.outline_graphics=new Dt,this.outline_graphics.rect(0,0,this.width,this.height).fill({color:this.dark?3355443:16777215,alpha:0}),!this.dark){const i=new sp({alpha:.1,blur:2,color:0,offset:{x:0,y:0},quality:4,shadowOnly:!1});this.outline_graphics.filters=[i]}this.outline_container.addChild(this.outline_graphics),this.app.stage.addChild(this.outline_container),this.overlay_container=new ct,this.app.stage.addChild(this.overlay_container),this.overlay_container.width=this.width,this.overlay_container.height=this.height,this.overlay_container.zIndex=999,this.overlay_container.eventMode="static",this.overlay_container.interactiveChildren=!0,this.overlay_graphics=new Dt,this.overlay_container.addChild(this.overlay_graphics),this.overlay_graphics.rect(0,0,this.width,this.height).fill({color:0,alpha:0});const t=this.app.screen.width/2,e=this.app.screen.height/2;this.image_container.position.set(t,e),this.outline_container.position.set(t,e),this.layer_manager=new ap(this.image_container,this.app,this.fixed_canvas,this.dark,this.border_region,this.layer_options),this.layers=this.layer_manager.layer_store}resize_canvas(t,e){this.app.renderer&&this.app.renderer.resize(t,e);const i=t/2,r=e/2;this.image_container&&this.image_container.position.set(i,r),this.outline_container&&this.outline_container.position.set(i,r)}reset(){const t=this.tools.get("zoom");t&&(t.cleanup(),t.setup(this.context,this.current_tool,this.current_subtool)),this.tools.get("brush")&&this.set_tool("draw")}async set_image_properties(t){let e=typeof t.animate<"u"?!t.animate:!0;if(t.position){const i=this.position.set(t.position,{hard:e});e&&await i}if(t.scale){const i=this.scale.set(t.scale,{hard:e});e&&await i}if(t.width&&t.height){this.width=t.width,this.height=t.height;const i=this.dimensions.set({width:t.width,height:t.height},{hard:e});e&&await i}}async execute_command(t){await this.command_manager.execute(t,this.context)}undo(){this.command_manager.undo(),this.notify("change")}redo(){this.command_manager.redo(this.context),this.notify("change")}async add_image({image:t,resize:e=!0}){await this.tools.get("image").add_image({image:t,fixed_canvas:this.fixed_canvas,border_region:this.border_region})}async add_image_from_url(t){const e=this.tools.get("image"),i=await Ze.load(t);await e.add_image({image:i,fixed_canvas:this.fixed_canvas,border_region:this.border_region});const r=this.tools.get("resize");r&&typeof r.set_border_region=="function"&&r.set_border_region(this.border_region)}set_tool(t){this.current_tool=t;for(const e of this.tools.values())e.set_tool(this.current_tool,this.current_subtool)}set_subtool(t){this.current_subtool=t;for(const e of this.tools.values())e.set_tool(this.current_tool,this.current_subtool)}set_background_image(t){this.background_image=t}async reset_canvas(){this.width=this.original_width,this.height=this.original_height,this.layer_manager.reset_layers(this.width,this.height),this.background_image=void 0,this.background_image_present.set(!1),this.command_manager.reset(),await this.set_image_properties({width:this.width,height:this.height,scale:1,position:{x:0,y:0},animate:!1}),this.layer_manager.create_background_layer(this.width,this.height);for(const e of this.tools.values())e.cleanup(),e.setup(this.context,this.current_tool,this.current_subtool);const t=this.tools.get("zoom");t&&t.min_zoom.subscribe(e=>{this.min_zoom.set(e)}),this.notify("change")}add_layer(){const t=new hp(this.context,{width:this.width,height:this.height,user_created:!0,make_active:!0});this.execute_command(t),this.notify("change")}async add_layers_from_url(t){if(this.command_manager.reset(),this.layer_manager.get_layers().forEach(n=>this.layer_manager.delete_layer(n.id)),t===void 0||t.length===0){this.layer_manager.create_layer({width:this.width,height:this.height,layer_name:void 0,user_created:!1});return}const i=[];for await(const n of t){const o=await this.layer_manager.add_layer_from_url(n);o&&i.push(o)}i.length>0&&this.layer_manager.set_active_layer(i[0]);const r=this.tools.get("resize");r&&typeof r.set_border_region=="function"&&r.set_border_region(this.border_region),this.notify("change"),this.notify("input")}set_layer(t){this.layer_manager.set_active_layer(t),this.notify("change")}move_layer(t,e){const i=new cp(this.context,t,e);this.execute_command(i),this.notify("change")}delete_layer(t){const e=new lp(this.context,t);this.execute_command(e),this.notify("change")}modify_canvas_size(t,e,i,r){const n=this.width,o=this.height;this.layer_manager.resize_all_layers(t,e,r,i,n,o),this.width=t,this.height=e,this.set_image_properties({width:t,height:e,scale:1,position:{x:0,y:0},animate:!1}),this.notify("change")}async get_blobs(){return await this.layer_manager.get_blobs(this.width,this.height)}on(t,e){this.event_callbacks.set(t,[...this.event_callbacks.get(t)||[],e])}off(t,e){this.event_callbacks.set(t,this.event_callbacks.get(t)?.filter(i=>i!==e)||[])}notify(t){for(const e of this.event_callbacks.get(t)||[])e()}destroy(){this.app&&this.app?.destroy()}resize(t,e){this.set_image_properties({width:t,height:e}),this.reset()}async get_crop_bounds(){const t=this.tools.get("crop"),e=t.get_crop_bounds();return{image:await t.get_image(),...e}}get background_image_sprite(){return this.background_image}set_layer_options(t){this.layer_options=t,this.layer_manager.set_layer_options(t,this.width,this.height)}toggle_layer_visibility(t){this.layer_manager.toggle_layer_visibility(t)}}class _p{name="crop";image_editor_context;current_tool="image";current_subtool="crop";CORNER_SIZE=25;LINE_THICKNESS=5;HANDLE_COLOR=0;HIT_AREA_SIZE=40;is_dragging=!1;selected_handle=null;active_corner_index=-1;active_edge_index=-1;last_pointer_position=null;crop_bounds={x:0,y:0,width:0,height:0};crop_ui_container=null;crop_mask=null;dimensions={width:0,height:0};position={x:0,y:0};scale=1;is_dragging_window=!1;drag_start_position=null;drag_start_bounds=null;background_image_watcher=null;has_been_manually_changed=!1;event_callbacks=new Map;async setup(t,e,i){this.image_editor_context=t,this.current_tool=e,this.current_subtool=i,t.dimensions.subscribe(n=>{this.dimensions=n,this.crop_bounds={x:0,y:0,width:n.width,height:n.height},this.crop_ui_container&&this.update_crop_ui(),this.set_crop_mask(),this.update_crop_mask()}),t.position.subscribe(n=>{this.position=n}),t.scale.subscribe(n=>{this.scale=n}),this.background_image_watcher=()=>{this.crop_mask&&this.current_tool==="image"&&this.current_subtool==="crop"&&this.image_editor_context.background_image&&this.image_editor_context.background_image.setMask(this.crop_mask)},this.image_editor_context.app.ticker.add(this.background_image_watcher),await this.init_crop_ui(),this.setup_event_listeners();const r=e==="image"&&i==="crop";this.crop_ui_container&&(this.crop_ui_container.visible=r)}cleanup(){this.crop_ui_container&&this.image_editor_context.app.stage.removeChild(this.crop_ui_container),this.crop_mask&&(this.crop_mask.parent&&this.crop_mask.parent.removeChild(this.crop_mask),this.image_editor_context.background_image&&this.image_editor_context.background_image.mask===this.crop_mask&&(this.image_editor_context.background_image.mask=null),this.image_editor_context.image_container.mask===this.crop_mask&&(this.image_editor_context.image_container.mask=null)),this.crop_mask=null,this.crop_ui_container=null,this.background_image_watcher&&(this.image_editor_context.app.ticker.remove(this.background_image_watcher),this.background_image_watcher=null),this.cleanup_event_listeners()}set_tool(t,e){this.current_tool=t,this.current_subtool=e;const i=t==="image"&&e==="crop";this.crop_ui_container&&(this.crop_ui_container.visible=i),i&&this.crop_mask&&this.update_crop_mask()}set_crop_mask(){this.crop_mask&&(this.crop_mask.parent&&this.crop_mask.parent.removeChild(this.crop_mask),this.image_editor_context.image_container.mask===this.crop_mask&&(this.image_editor_context.image_container.mask=null),this.image_editor_context.background_image&&this.image_editor_context.background_image.mask===this.crop_mask&&(this.image_editor_context.background_image.mask=null)),this.crop_mask=new Dt,this.image_editor_context.image_container.addChild(this.crop_mask)}async init_crop_ui(){const{width:t,height:e}=this.image_editor_context.background_image?.getLocalBounds()||{width:!1,height:!1};this.crop_ui_container=this.make_crop_ui(this.dimensions.width*this.scale,this.dimensions.height*this.scale),this.crop_ui_container.position.set(this.position.x,this.position.y),this.crop_ui_container.visible=!1,this.image_editor_context.app.stage.addChild(this.crop_ui_container),this.set_crop_mask(),this.image_editor_context.app.ticker.add(this.update_crop_ui.bind(this)),this.update_crop_mask()}make_crop_ui(t,e){const i=new ct;i.eventMode="static",i.interactiveChildren=!0;const r=new Dt().rect(0,0,t,e).stroke({width:1,color:0,alignment:0,alpha:.5});return r.eventMode="static",r.cursor="move",r.hitArea=new Mt(0,0,t,e),r.on("pointerdown",this.handle_window_drag_start.bind(this)),i.addChild(r),this.create_corner_handles(i,t,e),this.create_edge_handles(i,t,e),i}create_handle(t=!1){const e=new ct;e.eventMode="static";const i=new Dt;t?i.rect(0,0,this.CORNER_SIZE*1.5,this.LINE_THICKNESS).fill(this.HANDLE_COLOR):i.rect(0,0,this.CORNER_SIZE,this.LINE_THICKNESS).rect(0,0,this.LINE_THICKNESS,this.CORNER_SIZE).fill(this.HANDLE_COLOR),e.addChild(i);const r=t?this.HIT_AREA_SIZE*1.5:this.HIT_AREA_SIZE;return e.hitArea=new Mt(-r/2+this.LINE_THICKNESS,-r/2+this.LINE_THICKNESS,r,r),e}create_edge_handles(t,e,i){[-1,1].forEach((r,n)=>{const o=this.create_handle(!0);o.rotation=0,o.on("pointerdown",a=>{this.handle_pointer_down(a,o,-1,n)}),o.x=e/2-this.CORNER_SIZE*3/2,o.y=r<0?-this.LINE_THICKNESS:i,o.cursor="ns-resize",t.addChild(o)}),[-1,1].forEach((r,n)=>{const o=this.create_handle(!0);o.rotation=Math.PI/2,o.on("pointerdown",a=>{this.handle_pointer_down(a,o,-1,n+2)}),o.x=r<0?-this.LINE_THICKNESS:e,o.y=i/2-this.CORNER_SIZE*3/2,o.cursor="ew-resize",t.addChild(o)})}create_corner_handles(t,e,i){[{x:0,y:0,xScale:1,yScale:1,cursor:"nwse-resize"},{x:e,y:0,xScale:-1,yScale:1,cursor:"nesw-resize"},{x:0,y:i,xScale:1,yScale:-1,cursor:"nesw-resize"},{x:e,y:i,xScale:-1,yScale:-1,cursor:"nwse-resize"}].forEach(({x:n,y:o,xScale:a,yScale:h,cursor:l},c)=>{const u=this.create_handle(!1);u.x=n-(a<0?-this.LINE_THICKNESS:this.LINE_THICKNESS),u.y=o-(h<0?-this.LINE_THICKNESS:this.LINE_THICKNESS),u.scale.set(a,h),u.on("pointerdown",_=>{this.handle_pointer_down(_,u,c,-1)}),u.cursor=l,t.addChild(u)})}handle_pointer_down(t,e,i,r){if(this.current_subtool!=="crop")return;t.stopPropagation(),this.is_dragging=!0,this.selected_handle=e,this.active_corner_index=i,this.active_edge_index=r;const n=this.image_editor_context.image_container.toLocal(t.global);this.last_pointer_position=new dt(n.x,n.y)}update_crop_bounds(t){this.has_been_manually_changed=!0;const e=new dt(t.x,t.y),i={x:this.crop_bounds.x,y:this.crop_bounds.y,width:this.crop_bounds.width,height:this.crop_bounds.height};if(this.active_corner_index!==-1)switch(this.active_corner_index){case 0:const r=Math.max(20,i.width-e.x),n=i.width-r;this.crop_bounds.width=r,this.crop_bounds.x=i.x+n;const o=Math.max(20,i.height-e.y),a=i.height-o;this.crop_bounds.height=o,this.crop_bounds.y=i.y+a;break;case 1:this.crop_bounds.width=Math.max(20,i.width+e.x);const h=Math.max(20,i.height-e.y),l=i.height-h;this.crop_bounds.height=h,this.crop_bounds.y=i.y+l;break;case 2:const c=Math.max(20,i.width-e.x),u=i.width-c;this.crop_bounds.width=c,this.crop_bounds.x=i.x+u,this.crop_bounds.height=Math.max(20,i.height+e.y);break;case 3:this.crop_bounds.width=Math.max(20,i.width+e.x),this.crop_bounds.height=Math.max(20,i.height+e.y);break}else if(this.active_edge_index!==-1)switch(this.active_edge_index){case 0:const r=Math.max(20,i.height-e.y),n=i.height-r;this.crop_bounds.height=r,this.crop_bounds.y=i.y+n;break;case 1:this.crop_bounds.height=Math.max(20,i.height+e.y);break;case 2:const o=Math.max(20,i.width-e.x),a=i.width-o;this.crop_bounds.width=o,this.crop_bounds.x=i.x+a;break;case 3:this.crop_bounds.width=Math.max(20,i.width+e.x);break}this.constrain_crop_bounds(),this.update_crop_ui(),this.update_crop_mask(),this.crop_mask&&this.image_editor_context.background_image&&this.image_editor_context.background_image.setMask(this.crop_mask)}constrain_crop_bounds(){this.crop_bounds.x,this.crop_bounds.y,this.crop_bounds.width,this.crop_bounds.height,this.crop_bounds.width=Math.max(20,Math.min(this.crop_bounds.width,this.dimensions.width)),this.crop_bounds.height=Math.max(20,Math.min(this.crop_bounds.height,this.dimensions.height));const t=this.crop_bounds.x;if(this.crop_bounds.x=Math.max(0,Math.min(this.crop_bounds.x,this.dimensions.width-this.crop_bounds.width)),this.crop_bounds.x!==t&&this.active_corner_index===0||this.active_edge_index===2){const i=this.crop_bounds.x-t;this.crop_bounds.width-=i}const e=this.crop_bounds.y;if(this.crop_bounds.y=Math.max(0,Math.min(this.crop_bounds.y,this.dimensions.height-this.crop_bounds.height)),this.crop_bounds.y!==e&&(this.active_corner_index===0||this.active_corner_index===1||this.active_edge_index===0)){const i=this.crop_bounds.y-e;this.crop_bounds.height-=i}this.crop_bounds.width=Math.max(20,Math.min(this.crop_bounds.width,this.dimensions.width-this.crop_bounds.x)),this.crop_bounds.height=Math.max(20,Math.min(this.crop_bounds.height,this.dimensions.height-this.crop_bounds.y))}update_crop_mask(){if(!this.crop_mask)return;this.crop_mask.clear();const{width:t,height:e}=this.image_editor_context.background_image?.getLocalBounds()??{width:0,height:0};this.crop_mask.rect(0,0,t,e).fill({color:0,alpha:.4}).rect(this.crop_bounds.x,this.crop_bounds.y,this.crop_bounds.width,this.crop_bounds.height).cut(),this.image_editor_context.background_image&&(this.image_editor_context.background_image.mask=null),this.image_editor_context.image_container.mask===this.crop_mask&&(this.image_editor_context.image_container.mask=null)}update_crop_ui(){if(!this.crop_mask||!this.crop_ui_container)return;this.crop_ui_container.position.set(this.position.x+this.crop_bounds.x*this.scale,this.position.y+this.crop_bounds.y*this.scale);const t=this.crop_bounds.width*this.scale,e=this.crop_bounds.height*this.scale,i=this.crop_ui_container.getChildAt(0);i.clear().rect(0,0,t,e).stroke({width:1,color:0,alignment:0,alpha:.5}),i.hitArea=new Mt(0,0,t,e),this.update_handle_positions(t,e)}update_handle_positions(t,e){if(!this.crop_ui_container)return;const i=this.crop_ui_container.children.slice(1),r=i.slice(0,4),n=[{x:0,y:0},{x:t,y:0},{x:0,y:e},{x:t,y:e}];r.forEach((a,h)=>{const l=h%2===0?1:-1,c=h<2?1:-1;a.position.set(n[h].x-(l<0?-this.LINE_THICKNESS:this.LINE_THICKNESS),n[h].y-(c<0?-this.LINE_THICKNESS:this.LINE_THICKNESS))}),i.slice(4).forEach((a,h)=>{h<2?a.position.set(t/2-this.CORNER_SIZE*1.5/2,h===0?-this.LINE_THICKNESS:e):a.position.set(h===2?0:t+this.LINE_THICKNESS,e/2-this.CORNER_SIZE*1.5/2)})}setup_event_listeners(){const t=this.image_editor_context.app.stage;t.eventMode="static",t.on("pointermove",this.handle_pointer_move.bind(this)),t.on("pointerup",this.handle_pointer_up.bind(this)),t.on("pointerupoutside",this.handle_pointer_up.bind(this))}cleanup_event_listeners(){const t=this.image_editor_context.app.stage;t.off("pointermove",this.handle_pointer_move.bind(this)),t.off("pointerup",this.handle_pointer_up.bind(this)),t.off("pointerupoutside",this.handle_pointer_up.bind(this))}handle_pointer_move(t){if(this.current_subtool==="crop"){if(this.is_dragging_window&&this.drag_start_position&&this.drag_start_bounds){const e=this.image_editor_context.image_container.toLocal(t.global),i=new dt(e.x-this.drag_start_position.x,e.y-this.drag_start_position.y);this.crop_bounds={x:this.drag_start_bounds.x+i.x,y:this.drag_start_bounds.y+i.y,width:this.drag_start_bounds.width,height:this.drag_start_bounds.height},this.constrain_crop_bounds(),this.update_crop_mask(),this.crop_mask&&this.image_editor_context.background_image&&this.image_editor_context.background_image.setMask(this.crop_mask);return}if(this.is_dragging&&this.selected_handle&&this.last_pointer_position){const e=this.image_editor_context.image_container.toLocal(t.global),i=new dt(e.x,e.y),r=new dt(i.x-this.last_pointer_position.x,i.y-this.last_pointer_position.y);this.update_crop_bounds(r),this.last_pointer_position=i,this.update_crop_mask()}}}handle_pointer_up(){this.current_subtool==="crop"&&(this.is_dragging=!1,this.is_dragging_window=!1,this.selected_handle=null,this.last_pointer_position=null,this.drag_start_position=null,this.drag_start_bounds=null,this.active_corner_index=-1,this.active_edge_index=-1,this.notify("change"))}handle_window_drag_start(t){if(this.current_subtool!=="crop")return;t.stopPropagation(),this.is_dragging_window=!0,this.has_been_manually_changed=!0;const e=this.image_editor_context.image_container.toLocal(t.global);this.drag_start_position=new dt(e.x,e.y),this.drag_start_bounds={...this.crop_bounds}}get crop_manually_changed(){return this.has_been_manually_changed}on(t,e){this.event_callbacks.set(t,[...this.event_callbacks.get(t)||[],e])}off(t,e){this.event_callbacks.set(t,this.event_callbacks.get(t)?.filter(i=>i!==e)||[])}notify(t){for(const e of this.event_callbacks.get(t)||[])e()}get_crop_bounds(){const{width:t,height:e}=this.image_editor_context.background_image?.getLocalBounds()??{width:0,height:0};return{x:this.crop_bounds.x,y:this.crop_bounds.y,crop_dimensions:{width:this.crop_bounds.width,height:this.crop_bounds.height},image_dimensions:{width:t,height:e}}}get_image(){if(!this.image_editor_context.background_image)return Promise.resolve(null);const t=new ct,e=new kt(this.image_editor_context.background_image.texture);return t.addChild(e),_s(this.image_editor_context.app.renderer,t,this.crop_bounds)}}class fp{constructor(t,e,i,r){this.context=t,this.name="Resize",this.original_width=e.width,this.original_height=e.height,this.original_x=e.x,this.original_y=e.y,this.new_width=i.width,this.new_height=i.height,this.new_x=i.x,this.new_y=i.y,this.reset_ui=r}original_width;original_height;original_x;original_y;new_width;new_height;new_x;new_y;reset_ui;name;async execute(t){t&&(this.context=t),this.context.background_image&&(this.context.background_image.width=this.new_width,this.context.background_image.height=this.new_height,this.context.background_image.position.set(this.new_x,this.new_y),this.reset_ui())}async undo(){this.context.background_image&&(this.context.background_image.width=this.original_width,this.context.background_image.height=this.original_height,this.context.background_image.position.set(this.original_x,this.original_y),this.reset_ui())}}class pp{name="resize";image_editor_context;current_tool="image";current_subtool="size";current_cursor="unset";CORNER_SIZE=25;LINE_THICKNESS=5;HANDLE_COLOR=0;HIT_AREA_SIZE=40;borderRegion=0;is_dragging=!1;selected_handle=null;active_corner_index=-1;active_edge_index=-1;last_pointer_position=null;resize_ui_container=null;dimensions={width:0,height:0};position={x:0,y:0};scale=1;is_moving=!1;dom_mousedown_handler=null;dom_mousemove_handler=null;dom_mouseup_handler=null;event_callbacks=new Map;last_scale=1;original_state=null;async setup(t,e,i){if(this.image_editor_context=t,this.current_tool=e,this.current_subtool=i,t.background_image)if(t.background_image.borderRegion!==void 0)this.borderRegion=t.background_image.borderRegion;else{const r=t.background_image,n=t.image_container,o=Math.abs(r.position.x-(n.width-r.width)/2)<2,a=Math.abs(r.position.y-(n.height-r.height)/2)<2;(!o||!a)&&(this.borderRegion=Math.max(r.position.x,r.position.y),t.background_image.borderRegion=this.borderRegion)}if(t.dimensions.subscribe(r=>{this.dimensions=r,this.resize_ui_container&&this.update_resize_ui()}),t.position.subscribe(r=>{this.position=r,this.resize_ui_container&&this.current_tool==="image"&&this.current_subtool==="size"&&this.update_resize_ui()}),t.scale.subscribe(r=>{this.scale=r,this.resize_ui_container&&this.current_tool==="image"&&this.current_subtool==="size"&&this.update_resize_ui()}),await this.init_resize_ui(),this.setup_event_listeners(),this.current_subtool==="size"&&this.image_editor_context.background_image){const r=this.image_editor_context.background_image,n=this.image_editor_context.image_container,o=r.width,a=r.height,h=n.getLocalBounds(),l=h.width,c=h.height,u=-(o-l),_=-(a-c),d=0,f=0,g=o>l&&(r.position.x<u||r.position.x>d),p=a>c&&(r.position.y<_||r.position.y>f);(g||p)&&this.apply_boundary_constraints()}}cleanup(){this.resize_ui_container&&this.image_editor_context.app.stage.removeChild(this.resize_ui_container),this.cleanup_event_listeners()}set_tool(t,e){if(this.current_tool=t,this.current_subtool=e,t==="image"&&e==="size"){if(this.image_editor_context.background_image){const i=this.image_editor_context.background_image.borderRegion;typeof i=="number"&&i>0&&(this.borderRegion=i)}if(this.show_resize_ui(),this.image_editor_context.background_image){const i=this.image_editor_context.background_image,r=this.image_editor_context.image_container,n=i.width,o=i.height,a=r.getLocalBounds(),h=a.width,l=a.height,c=h-this.borderRegion*2,u=l-this.borderRegion*2,_=n>c?-(n-c)+this.borderRegion:this.borderRegion,d=n>c?this.borderRegion:h-n-this.borderRegion,f=o>u?-(o-u)+this.borderRegion:this.borderRegion,g=o>u?this.borderRegion:l-o-this.borderRegion,p=i.position.x<_||i.position.x>d,y=i.position.y<f||i.position.y>g;(p||y)&&this.apply_boundary_constraints()}}else this.hide_resize_ui()}async init_resize_ui(){this.resize_ui_container=this.make_resize_ui(this.dimensions.width*this.scale,this.dimensions.height*this.scale),this.resize_ui_container.position.set(this.position.x,this.position.y),this.resize_ui_container.visible=!1,this.image_editor_context.app.stage.addChild(this.resize_ui_container)}make_resize_ui(t,e){const i=new ct;i.eventMode="static",i.interactiveChildren=!0;const r=new Dt().rect(0,0,t,e).stroke({width:1,color:0,alignment:0,alpha:.3}),n=new Dt;n.rect(0,0,t,e).stroke({width:1,color:0,alpha:.7,pixelLine:!0});const o=5,h=o+5;for(let c=0;c<t;c+=h*2)n.rect(c,0,Math.min(o,t-c),1).fill(0),n.rect(c,e-1,Math.min(o,t-c),1).fill(0);for(let c=0;c<e;c+=h*2)n.rect(0,c,1,Math.min(o,e-c)).fill(0),n.rect(t-1,c,1,Math.min(o,e-c)).fill(0);i.addChild(r),i.addChild(n);const l=new Dt().rect(0,0,t,e).fill(16777215,0);return l.eventMode="static",l.cursor="move",i.addChild(l),this.create_corner_handles(i,t,e),this.create_edge_handles(i,t,e),i}create_handle(t=!1){const e=new ct;e.eventMode="static",e.cursor="pointer";const i=new Dt,r=t?8:10;i.rect(-r/2,-r/2,r,r).fill(16777215).stroke({width:1,color:this.HANDLE_COLOR}),e.addChild(i);const n=t?this.HIT_AREA_SIZE*1.5:this.HIT_AREA_SIZE;return e.hitArea=new Mt(-n/2,-n/2,n,n),e}create_edge_handles(t,e,i){[-1,1].forEach((r,n)=>{const o=this.create_handle(!0);o.rotation=0,o.on("pointerdown",a=>{this.handle_pointer_down(a,o,-1,n)}),o.x=e/2,o.y=r<0?0:i,o.cursor="ns-resize",t.addChild(o)}),[-1,1].forEach((r,n)=>{const o=this.create_handle(!0);o.rotation=0,o.on("pointerdown",a=>{this.handle_pointer_down(a,o,-1,n+2)}),o.x=r<0?0:e,o.y=i/2,o.cursor="ew-resize",t.addChild(o)})}create_corner_handles(t,e,i){[{x:0,y:0,cursor:"nwse-resize"},{x:e,y:0,cursor:"nesw-resize"},{x:0,y:i,cursor:"nesw-resize"},{x:e,y:i,cursor:"nwse-resize"}].forEach(({x:n,y:o,cursor:a},h)=>{const l=this.create_handle(!1);l.x=n,l.y=o,l.on("pointerdown",c=>{this.handle_pointer_down(c,l,h,-1)}),l.cursor=a,t.addChild(l)})}handle_pointer_down(t,e,i,r){if(this.current_subtool!=="size")return;t.stopPropagation(),this.is_dragging=!0,this.selected_handle=e,this.active_corner_index=i,this.active_edge_index=r;const n=this.image_editor_context.image_container.toLocal(t.global);if(this.last_pointer_position=new dt(n.x,n.y),this.image_editor_context.background_image){const o=this.image_editor_context.background_image;this.original_state={width:o.width,height:o.height,x:o.position.x,y:o.position.y}}}maintain_aspect_ratio(t,e,i,r){const n=Math.abs(r.x),o=Math.abs(r.y);return n>o*1.2?e=t/i:o>n*1.2?t=e*i:t/i>e?e=t/i:t=e*i,{width:t,height:e}}limit_dimensions(t,e,i){const r=this.dimensions.width,n=this.dimensions.height;let o=t,a=e;return o>r&&(i&&this.active_corner_index!==-1&&(a=r/o*a),o=r),a>n&&(i&&this.active_corner_index!==-1&&(o=n/a*o),a=n),o=Math.max(20,o),a=Math.max(20,a),{width:o,height:a}}calculate_position_deltas(t,e,i,r){let n=0,o=0;return this.active_corner_index===0||this.active_edge_index===2?n=t-i:this.active_corner_index===2&&(n=t-i,o=0),(this.active_corner_index===0||this.active_corner_index===1||this.active_edge_index===0)&&(o=e-r),{x:n,y:o}}apply_boundary_constraints(){if(!this.image_editor_context.background_image)return;const t=this.image_editor_context.background_image,e=this.image_editor_context.image_container;let i=t.position.x,r=t.position.y;const n=e.width,o=e.height,a=t.width,h=t.height,l=n-this.borderRegion*2,c=o-this.borderRegion*2;if(a>l){const u=-(a-l)+this.borderRegion,_=this.borderRegion;i=Math.max(u,Math.min(_,i))}else{const u=this.borderRegion,_=n-a-this.borderRegion;(i<u||i>_)&&(i=Math.max(u,Math.min(_,i)))}if(h>c){const u=-(h-c)+this.borderRegion,_=this.borderRegion;r=Math.max(u,Math.min(_,r))}else{const u=this.borderRegion,_=o-h-this.borderRegion;(r<u||r>_)&&(r=Math.max(u,Math.min(_,r)))}if(t.position.set(i,r),this.resize_ui_container){const u=e.position.x+i*this.scale,_=e.position.y+r*this.scale;this.resize_ui_container.position.set(u,_)}}update_resize_bounds(t,e=!1){const i=this.image_editor_context.background_image;if(!i)return;const r=i.width,n=i.height,o=i.position.x,a=i.position.y,h=r/n;let l;if(this.active_corner_index!==-1){switch(this.active_corner_index){case 0:l=new dt(o-t.x,a-t.y);break;case 1:l=new dt(o+r+t.x,a-t.y);break;case 2:l=new dt(o-t.x,a+n+t.y);break;case 3:l=new dt(o+r+t.x,a+n+t.y);break;default:return}const c=this.handle_direct_corner_resize(l,r,n,o,a,h,e);i.width=c.width,i.height=c.height,i.position.set(c.x,c.y)}else if(this.active_edge_index!==-1){switch(this.active_edge_index){case 0:l=new dt(o+r/2,a-t.y);break;case 1:l=new dt(o+r/2,a+n+t.y);break;case 2:l=new dt(o-t.x,a+n/2);break;case 3:l=new dt(o+r+t.x,a+n/2);break;default:return}const c=this.handle_direct_edge_resize(l,r,n,o,a);i.width=c.width,i.height=c.height,i.position.set(c.x,c.y)}this.update_resize_ui()}update_resize_ui(){if(!this.resize_ui_container||!this.image_editor_context.background_image||!this.image_editor_context.background_image.position)return;const t=this.image_editor_context.background_image,i=this.image_editor_context.image_container.getGlobalPosition(),r=t.position.x*this.scale,n=t.position.y*this.scale;this.resize_ui_container.position.set(i.x+r,i.y+n);const o=t.width*this.scale,a=t.height*this.scale;this.resize_ui_container.getChildAt(0).clear().rect(0,0,o,a).stroke({width:1,color:0,alignment:0,alpha:.3});const l=this.resize_ui_container.getChildAt(1);if(l.clear(),l.rect(0,0,o,a).stroke({width:1,color:0,alpha:.7,pixelLine:!0}),!this.is_dragging&&!this.is_moving&&Math.abs(this.scale-this.last_scale)<.001){for(let f=0;f<o;f+=20)l.rect(f,0,Math.min(5,o-f),1).fill(0),l.rect(f,a-1,Math.min(5,o-f),1).fill(0);for(let f=0;f<a;f+=20)l.rect(0,f,1,Math.min(5,a-f)).fill(0),l.rect(o-1,f,1,Math.min(5,a-f)).fill(0)}this.last_scale=this.scale,this.resize_ui_container.getChildAt(2).clear().rect(0,0,o,a).fill(16777215,0),this.update_handle_positions(o,a)}update_handle_positions(t,e){if(!this.resize_ui_container)return;const i=this.resize_ui_container.children.slice(3);this.resize_ui_container.getChildAt(2).clear().rect(0,0,t,e).fill(16777215,0);const n=i.slice(0,4),o=[{x:0,y:0},{x:t,y:0},{x:0,y:e},{x:t,y:e}];n.forEach((h,l)=>{h.position.set(o[l].x,o[l].y)}),i.slice(4).forEach((h,l)=>{l<2?h.position.set(t/2,l===0?0:e):h.position.set(l===2?0:t,e/2)})}setup_event_listeners(){const t=this.image_editor_context.app.stage;t.eventMode="static",t.on("pointermove",this.handle_pointer_move.bind(this)),t.on("pointerup",this.handle_pointer_up.bind(this)),t.on("pointerupoutside",this.handle_pointer_up.bind(this)),this.setup_dom_event_listeners()}setup_dom_event_listeners(){this.cleanup_dom_event_listeners();const t=this.image_editor_context.app.canvas;this.dom_mousedown_handler=e=>{if(this.current_subtool!=="size"||this.is_dragging||this.selected_handle||!this.image_editor_context.background_image)return;const i=this.image_editor_context.background_image,n=this.image_editor_context.image_container.getBounds(),o=t.getBoundingClientRect(),a=e.clientX-o.left,h=e.clientY-o.top,l=(a-n.x)/this.scale,c=(h-n.y)/this.scale;l>=i.position.x&&l<=i.position.x+i.width&&c>=i.position.y&&c<=i.position.y+i.height&&(this.is_moving=!0,this.last_pointer_position=new dt(l,c),this.original_state={width:i.width,height:i.height,x:i.position.x,y:i.position.y},e.preventDefault(),e.stopPropagation())},this.dom_mousemove_handler=e=>{if(this.current_subtool!=="size"||!this.is_moving||!this.last_pointer_position||!this.image_editor_context.background_image)return;const r=this.image_editor_context.image_container.getBounds(),n=t.getBoundingClientRect(),o=e.clientX-n.left,a=e.clientY-n.top,h=(o-r.x)/this.scale,l=(a-r.y)/this.scale,c=new dt(h,l);this.handle_image_dragging(c),this.last_pointer_position=c,e.preventDefault(),e.stopPropagation()},this.dom_mouseup_handler=e=>{if(this.current_subtool==="size"){if(this.original_state&&this.image_editor_context.background_image){const i=this.image_editor_context.background_image,r={width:i.width,height:i.height,x:i.position.x,y:i.position.y};if(this.original_state.width!==r.width||this.original_state.height!==r.height||this.original_state.x!==r.x||this.original_state.y!==r.y){const n=new fp(this.image_editor_context,this.original_state,r,this.update_resize_ui.bind(this));this.image_editor_context.execute_command(n)}this.original_state=null}this.is_moving=!1,this.last_pointer_position=null,this.update_resize_ui(),e.preventDefault(),e.stopPropagation()}},t.addEventListener("mousedown",this.dom_mousedown_handler),window.addEventListener("mousemove",this.dom_mousemove_handler),window.addEventListener("mouseup",this.dom_mouseup_handler)}cleanup_dom_event_listeners(){const t=this.image_editor_context.app.canvas;this.dom_mousedown_handler&&(t.removeEventListener("mousedown",this.dom_mousedown_handler),this.dom_mousedown_handler=null),this.dom_mousemove_handler&&(window.removeEventListener("mousemove",this.dom_mousemove_handler),this.dom_mousemove_handler=null),this.dom_mouseup_handler&&(window.removeEventListener("mouseup",this.dom_mouseup_handler),this.dom_mouseup_handler=null)}cleanup_event_listeners(){const t=this.image_editor_context.app.stage;t.off("pointermove",this.handle_pointer_move.bind(this)),t.off("pointerup",this.handle_pointer_up.bind(this)),t.off("pointerupoutside",this.handle_pointer_up.bind(this)),this.cleanup_dom_event_listeners()}handle_pointer_move(t){if(this.current_subtool!=="size")return;const e=this.image_editor_context.image_container.toLocal(t.global),i=new dt(e.x,e.y);if(this.is_moving&&this.last_pointer_position)this.handle_image_dragging(i),this.last_pointer_position=i;else if(this.is_dragging&&this.selected_handle){if(!this.image_editor_context.background_image)return;const r=this.image_editor_context.background_image,n=this.active_corner_index!==-1&&!t.shiftKey,o=r.width,a=r.height,h=r.position.x,l=r.position.y,c=o/a;let u;if(this.active_corner_index!==-1)u=this.handle_direct_corner_resize(i,o,a,h,l,c,n);else if(this.active_edge_index!==-1)u=this.handle_direct_edge_resize(i,o,a,h,l);else return;u=this.limit_dimensions_to_container(u,h,l,o,a,n),r.width=u.width,r.height=u.height,r.position.set(u.x,u.y),this.update_resize_ui(),this.last_pointer_position=i}}handle_pointer_up(){this.current_subtool==="size"&&(this.is_dragging=!1,this.is_moving=!1,this.selected_handle=null,this.last_pointer_position=null,this.active_corner_index=-1,this.active_edge_index=-1,this.update_resize_ui(),this.notify("change"))}handle_image_dragging(t){if(!this.last_pointer_position||!this.image_editor_context.background_image)return;const e=this.image_editor_context.background_image,i=this.image_editor_context.image_container.getLocalBounds(),r=t.x-this.last_pointer_position.x,n=t.y-this.last_pointer_position.y;let o=e.position.x+r,a=e.position.y+n;const h=i.width,l=i.height,c=e.width,u=e.height,_=h-this.borderRegion*2,d=l-this.borderRegion*2;if(c>_){const f=-(c-_)+this.borderRegion,g=this.borderRegion;o=Math.max(f,Math.min(g,o))}else{const f=this.borderRegion,g=h-c-this.borderRegion;o=Math.max(f,Math.min(g,o))}if(u>d){const f=-(u-d)+this.borderRegion,g=this.borderRegion;a=Math.max(f,Math.min(g,a))}else{const f=this.borderRegion,g=l-u-this.borderRegion;a=Math.max(f,Math.min(g,a))}e.position.set(o,a),this.update_resize_ui()}handle_direct_corner_resize(t,e,i,r,n,o,a){let h=0,l=0,c=r,u=n;switch(this.active_corner_index){case 0:h=r+e-t.x,l=n+i-t.y;break;case 1:h=t.x-r,l=n+i-t.y;break;case 2:h=r+e-t.x,l=t.y-n;break;case 3:h=t.x-r,l=t.y-n;break}h=Math.max(20,h),l=Math.max(20,l);let _=h,d=l;if(a){const f={x:t.x-(r+e/2),y:t.y-(n+i/2)},g=Math.abs(Math.atan2(f.y,f.x));g<Math.PI/4||g>3*Math.PI/4?d=_/o:_=d*o}switch(this.active_corner_index){case 0:c=r+e-_,u=n+i-d;break;case 1:u=n+i-d;break;case 2:c=r+e-_;break}return{width:_,height:d,x:c,y:u}}handle_direct_edge_resize(t,e,i,r,n){let o=e,a=i,h=r,l=n;switch(this.active_edge_index){case 0:a=Math.max(20,n+i-t.y),l=t.y;break;case 1:a=Math.max(20,t.y-n);break;case 2:o=Math.max(20,r+e-t.x),h=t.x;break;case 3:o=Math.max(20,t.x-r);break}return{width:o,height:a,x:h,y:l}}limit_dimensions_to_container(t,e,i,r,n,o){let{width:a,height:h,x:l,y:c}=t;const u=this.dimensions.width-this.borderRegion*2,_=this.dimensions.height-this.borderRegion*2,d=a,f=h,g=this.apply_size_limits(a,h,u,_,o,d/f);a=g.width,h=g.height;const p=this.adjust_position_for_resizing(a,h,e,i,r,n);return l=p.x,c=p.y,this.apply_border_constraints(a,h,l,c,o,d/f)}apply_size_limits(t,e,i,r,n,o){let a=t,h=e;const l=a>i,c=h>r;if(l&&c){const u=i/a,_=r/h;u<_?(a=i,n&&(h=a/o)):(h=r,n&&(a=h*o))}else l?(a=i,n&&(h=a/o)):c&&(h=r,n&&(a=h*o));return{width:a,height:h}}adjust_position_for_resizing(t,e,i,r,n,o){let a=i,h=r;switch(this.active_corner_index){case 0:a=i+n-t,h=r+o-e;break;case 1:h=r+o-e;break;case 2:a=i+n-t;break}if(this.active_edge_index!==-1)switch(this.active_edge_index){case 0:h=r+o-e;break;case 2:a=i+n-t;break}return{x:a,y:h}}apply_border_constraints(t,e,i,r,n,o){const a=this.apply_top_left_constraints(t,e,i,r,n,o),h=this.apply_bottom_right_constraints(a.width,a.height,a.x,a.y,n,o);return h.width=Math.max(20,h.width),h.height=Math.max(20,h.height),h}apply_top_left_constraints(t,e,i,r,n,o){let a=t,h=e,l=i,c=r;return l<this.borderRegion&&((this.active_corner_index===0||this.active_corner_index===2||this.active_edge_index===2)&&(a-=this.borderRegion-l,n&&(h=a/o)),l=this.borderRegion),c<this.borderRegion&&((this.active_corner_index===0||this.active_corner_index===1||this.active_edge_index===0)&&(h-=this.borderRegion-c,n&&(a=h*o)),c=this.borderRegion),{width:a,height:h,x:l,y:c}}apply_bottom_right_constraints(t,e,i,r,n,o){let a=t,h=e,l=i,c=r;if(l+a>this.dimensions.width-this.borderRegion)if(this.active_corner_index===1||this.active_corner_index===3||this.active_edge_index===3)a=this.dimensions.width-this.borderRegion-l,n&&(h=a/o);else{const _=l+a-(this.dimensions.width-this.borderRegion);l=Math.max(this.borderRegion,l-_)}if(c+h>this.dimensions.height-this.borderRegion)if(this.active_corner_index===2||this.active_corner_index===3||this.active_edge_index===1)h=this.dimensions.height-this.borderRegion-c,n&&(a=h*o);else{const _=c+h-(this.dimensions.height-this.borderRegion);c=Math.max(this.borderRegion,c-_)}return{width:a,height:h,x:l,y:c}}show_resize_ui(){if(this.resize_ui_container&&(this.resize_ui_container.visible=!0,this.update_resize_ui()),this.image_editor_context.background_image){const t=this.image_editor_context.background_image;this.current_cursor=t.cursor,t.cursor="move"}this.setup_dom_event_listeners()}hide_resize_ui(){if(this.resize_ui_container&&(this.resize_ui_container.visible=!1),this.image_editor_context.background_image){const t=this.image_editor_context.background_image;t.cursor=this.current_cursor}this.cleanup_dom_event_listeners()}on(t,e){this.event_callbacks.set(t,[...this.event_callbacks.get(t)||[],e])}off(t,e){this.event_callbacks.set(t,this.event_callbacks.get(t)?.filter(i=>i!==e)||[])}notify(t){for(const e of this.event_callbacks.get(t)||[])e()}set_border_region(t){this.borderRegion=t,this.image_editor_context?.background_image&&(this.image_editor_context.background_image.borderRegion=t),this.resize_ui_container&&this.update_resize_ui(),this.current_subtool==="size"&&this.image_editor_context?.background_image&&this.apply_boundary_constraints()}}function gp(s,t){(s instanceof ct||"cursor"in s)&&(s.cursor=t)}function vh(s,t){for(const e of s)gp(e,t),e instanceof ct&&e.children.length>0&&vh(e.children,t)}function mp(s){return s!==null&&window.clearTimeout(s),null}class yp{constructor(t,e,i){this.image_editor_context=t,this.state=e,this.scale=i,this.initialize_cursor(),this.initialize_brush_preview()}cursor_graphics=null;cursor_container=null;brush_preview_container=null;brush_preview_graphics=null;is_preview_visible=!1;is_cursor_over_image=!1;cursor_position_check_timeout=null;is_brush_or_erase_active=!1;_bound_update_cursor=null;_bound_check_cursor_over_image=null;is_over_image(){return this.is_cursor_over_image}setup_event_listeners(){this.cleanup_event_listeners(),this._bound_update_cursor=this.update_cursor_position.bind(this),this._bound_check_cursor_over_image=this.check_cursor_over_image.bind(this);const t=this.image_editor_context.app.stage;t.on("pointermove",this._bound_update_cursor),t.on("pointermove",this._bound_check_cursor_over_image),this.image_editor_context.image_container.on("pointerenter",this.on_image_container_pointer_enter.bind(this)),this.image_editor_context.image_container.on("pointerleave",this.on_image_container_pointer_leave.bind(this))}cleanup_event_listeners(){const t=this.image_editor_context.app.stage;this._bound_update_cursor&&(t.off("pointermove",this._bound_update_cursor),this._bound_update_cursor=null),this._bound_check_cursor_over_image&&(t.off("pointermove",this._bound_check_cursor_over_image),this._bound_check_cursor_over_image=null),this.image_editor_context.image_container.off("pointerenter"),this.image_editor_context.image_container.off("pointerleave"),this.cursor_position_check_timeout=mp(this.cursor_position_check_timeout)}initialize_cursor(){this.cursor_container&&(this.cursor_container.parent&&this.cursor_container.parent.removeChild(this.cursor_container),this.cursor_container.destroy({children:!0}),this.cursor_container=null),this.cursor_container=new ct,this.image_editor_context.ui_container.addChild(this.cursor_container),this.cursor_graphics=new Dt,this.cursor_container.addChild(this.cursor_graphics),this.update_cursor_appearance()}update_cursor_appearance(){if(!this.cursor_graphics)return;this.cursor_graphics.clear();const t=this.state.mode==="draw"?le(this.state.color).toString():16777215;this.cursor_graphics.circle(0,0,this.state.brush_size*this.scale).stroke({width:1.5,color:t,alpha:.8}),this.cursor_graphics.circle(0,0,1).fill({color:t,alpha:.8})}update_cursor_position(t){if(!this.cursor_container)return;const e=this.image_editor_context.image_container.toLocal(t.global),i=this.image_editor_context.ui_container.toLocal(this.image_editor_context.image_container.toGlobal(e));this.cursor_container.position.set(i.x,i.y)}check_cursor_over_image(t){this.cursor_position_check_timeout!==null&&(window.clearTimeout(this.cursor_position_check_timeout),this.cursor_position_check_timeout=null);const i=this.image_editor_context.image_container.getBounds(),r=this.is_cursor_over_image;this.is_cursor_over_image=t.global.x>=i.x&&t.global.x<=i.x+i.width&&t.global.y>=i.y&&t.global.y<=i.y+i.height,r!==this.is_cursor_over_image&&this.update_cursor_and_preview_visibility()}update_cursor_size(){this.update_cursor_appearance()}set_active(t){this.is_brush_or_erase_active=t,this.update_cursor_and_preview_visibility()}update_cursor_visibility(){this.cursor_container&&(this.cursor_container.visible=this.is_cursor_over_image&&this.is_brush_or_erase_active)}preview_brush(t){this.is_preview_visible=t,this.brush_preview_container&&(this.brush_preview_container.visible=t&&this.is_brush_or_erase_active),t&&(this.update_brush_preview(),this.update_brush_preview_position())}initialize_brush_preview(){this.brush_preview_container&&(this.brush_preview_container.parent&&this.brush_preview_container.parent.removeChild(this.brush_preview_container),this.brush_preview_container.destroy({children:!0}),this.brush_preview_container=null),this.brush_preview_container=new ct,this.image_editor_context.ui_container.addChild(this.brush_preview_container),this.brush_preview_graphics=new Dt,this.brush_preview_container.addChild(this.brush_preview_graphics),this.brush_preview_container.visible=!1}update_brush_preview(){if(!this.brush_preview_graphics)return;this.brush_preview_graphics.clear();const t=this.state.brush_size*this.scale,e=this.state.mode==="draw"?le(this.state.color).setAlpha(this.state.opacity).toString():16777215;this.brush_preview_graphics.circle(0,0,t).fill({color:e,alpha:this.state.mode==="draw"?this.state.opacity:.3}),this.brush_preview_graphics.circle(0,0,t+1).stroke({width:1,color:0,alpha:.5})}update_brush_preview_position(){if(!this.brush_preview_container)return;const t=this.image_editor_context.image_container,e=t.width/2,i=t.height/2,r=t.toGlobal({x:e,y:i}),n=this.image_editor_context.ui_container.toLocal(r);this.brush_preview_container.position.set(n.x,n.y)}on_image_container_pointer_enter(){this.is_cursor_over_image=!0,this.update_cursor_and_preview_visibility()}on_image_container_pointer_leave(){this.is_cursor_over_image=!1,this.update_cursor_and_preview_visibility()}update_cursor_and_preview_visibility(){this.update_cursor_visibility(),this.brush_preview_container&&(this.brush_preview_container.visible=this.is_preview_visible&&this.is_brush_or_erase_active)}cleanup(){this.is_brush_or_erase_active=!1,this.cursor_container&&(this.cursor_container.parent&&this.cursor_container.parent.removeChild(this.cursor_container),this.cursor_container.destroy({children:!0}),this.cursor_container=null),this.brush_preview_container&&(this.brush_preview_container.parent&&this.brush_preview_container.parent.removeChild(this.brush_preview_container),this.brush_preview_container.destroy({children:!0}),this.brush_preview_container=null),this.cursor_position_check_timeout!==null&&(window.clearTimeout(this.cursor_position_check_timeout),this.cursor_position_check_timeout=null)}update_state(t,e){this.state=t,this.scale=e,this.update_cursor_appearance(),this.is_preview_visible&&this.update_brush_preview()}}class xp{stroke_data;context;original_texture=null;name;constructor(t,e,i){this.name="Draw",this.stroke_data=e,this.context=t,i&&(this.original_texture=this.create_texture_from(i))}create_texture_from(t){const e=Jt.create({width:t.width,height:t.height,resolution:window.devicePixelRatio||1}),i=new kt(t),r=new ct;return r.addChild(i),this.context.app.renderer.render(r,{renderTexture:e}),r.destroy({children:!0}),e}render_stroke_from_data(t,e){const i=t.segments.filter(n=>n.mode==="draw"),r=t.segments.filter(n=>n.mode==="erase");if(i.length>0){const n=new Dt,o=new ct;o.addChild(n);let a=1;for(const c of i){c.opacity<a&&(a=c.opacity);let u=16777215;c.color.startsWith("#")&&(u=parseInt(c.color.replace("#","0x"),16)),n.setFillStyle({color:u,alpha:1}),this.render_segment_to_graphics(n,c)}const h=Jt.create({width:e.width,height:e.height,resolution:window.devicePixelRatio||1}),l=new kt(h);this.context.app.renderer.render({container:o,target:h}),l.alpha=a,this.context.app.renderer.render({container:l,target:e,clear:!1}),o.destroy({children:!0}),l.destroy(),h.destroy()}if(r.length>0){const n=Jt.create({width:e.width,height:e.height,resolution:window.devicePixelRatio||1}),o=new kt(e),a=new ct;a.addChild(o),this.context.app.renderer.render({container:a,target:n,clear:!0});const h=new Dt,l=new ct;l.addChild(h),h.setFillStyle({color:16777215,alpha:1});for(const f of r)this.render_segment_to_graphics(h,f);const c=Jt.create({width:e.width,height:e.height,resolution:window.devicePixelRatio||1});this.context.app.renderer.render({container:l,target:c,clear:!0});const u=new kt(n),_=new kt(c),d=new ct;d.addChild(u),d.setMask({mask:_,inverse:!0}),this.context.app.renderer.render({container:d,target:e,clear:!0}),a.destroy({children:!0}),l.destroy({children:!0}),d.destroy({children:!0}),n.destroy(),c.destroy()}}render_segment_to_graphics(t,e){const i=Math.sqrt(Math.pow(e.to_x-e.from_x,2)+Math.pow(e.to_y-e.from_y,2));if(i<.1)t.circle(e.from_x,e.from_y,e.size).fill();else{const r=Math.max(e.size/3,2),n=Math.max(Math.ceil(i/r),2);for(let o=0;o<n;o++){const a=o/(n-1),h=e.from_x+(e.to_x-e.from_x)*a,l=e.from_y+(e.to_y-e.from_y)*a;t.circle(h,l,e.size).fill()}}}async execute(t){t&&(this.context=t);let e=this.context.layer_manager.get_layer_textures(this.stroke_data.layer_id);if(!e){const h=this.context.layer_manager.get_layers(),l=h[h.length-1];e=this.context.layer_manager.get_layer_textures(l.id)}if(!e)return;const i=Jt.create({width:e.draw.width,height:e.draw.height,resolution:window.devicePixelRatio||1}),r=new kt(e.draw),n=new ct;n.addChild(r),this.context.app.renderer.render({container:n,target:i,clear:!0}),n.destroy({children:!0}),this.render_stroke_from_data(this.stroke_data,i);const o=new kt(i),a=new ct;a.addChild(o),this.context.app.renderer.render({container:a,target:e.draw,clear:!0}),a.destroy({children:!0}),i.destroy()}async undo(){if(!this.original_texture)return;const t=this.context.layer_manager.get_layer_textures(this.stroke_data.layer_id);if(!t)return;const e=new kt(this.original_texture),i=new ct;i.addChild(e),this.context.app.renderer.render({container:i,target:t.draw,clear:!0}),i.destroy({children:!0})}}class bp{stroke_texture=null;erase_texture=null;display_container=null;stroke_container=null;stroke_graphics=null;preview_sprite=null;erase_graphics=null;dimensions;image_editor_context;app;is_new_stroke=!0;current_opacity=1;original_layer_texture=null;active_layer_id=null;current_stroke_segments=[];constructor(t,e){this.image_editor_context=t,this.app=e,this.dimensions={width:this.image_editor_context.image_container.width,height:this.image_editor_context.image_container.height}}initialize_textures(){this.cleanup_textures();const t=this.image_editor_context.image_container.getLocalBounds();this.dimensions={width:t.width,height:t.height},this.stroke_texture=Jt.create({width:this.dimensions.width,height:this.dimensions.height,resolution:window.devicePixelRatio||1}),this.erase_texture=Jt.create({width:this.dimensions.width,height:this.dimensions.height,resolution:window.devicePixelRatio||1}),this.display_container=new ct,this.image_editor_context.image_container.addChild(this.display_container),this.stroke_container=new ct,this.stroke_graphics=new Dt,this.stroke_container.addChild(this.stroke_graphics),this.erase_graphics=new Dt,this.preview_sprite=new kt(this.stroke_texture),this.preview_sprite.alpha=0,this.display_container.addChild(this.preview_sprite);const e=new ct;this.app.renderer.render(e,{renderTexture:this.stroke_texture}),this.app.renderer.render(e,{renderTexture:this.erase_texture}),e.destroy(),this.is_new_stroke=!0,this.current_opacity=1}reinitialize(){(this.image_editor_context.image_container.width!==this.dimensions.width||this.image_editor_context.image_container.height!==this.dimensions.height)&&this.initialize_textures()}cleanup_textures(){this.stroke_texture&&(this.stroke_texture.destroy(),this.stroke_texture=null),this.erase_texture&&(this.erase_texture.destroy(),this.erase_texture=null),this.display_container&&(this.display_container.parent&&this.display_container.parent.removeChild(this.display_container),this.display_container.destroy({children:!0}),this.display_container=null),this.original_layer_texture&&(this.original_layer_texture.destroy(),this.original_layer_texture=null),this.stroke_container=null,this.stroke_graphics=null,this.preview_sprite=null,this.erase_graphics=null,this.active_layer_id=null}preserve_canvas_state(){const t=this.image_editor_context.layer_manager.get_active_layer();if(!t)return;const i=this.image_editor_context.layer_manager.get_layers().find(a=>a.container===t);if(!i)return;this.active_layer_id=i.id;const r=this.image_editor_context.layer_manager.get_layer_textures(i.id);if(!r)return;this.original_layer_texture&&this.original_layer_texture.destroy(),this.original_layer_texture=Jt.create({width:this.dimensions.width,height:this.dimensions.height,resolution:window.devicePixelRatio||1});const n=new kt(r.draw),o=new ct;o.addChild(n),this.app.renderer.render(o,{renderTexture:this.original_layer_texture}),o.destroy({children:!0}),this.is_new_stroke=!0}reset_eraser_mask(){!this.erase_graphics||!this.erase_texture||(this.erase_graphics.clear(),this.erase_graphics.setFillStyle({color:16777215,alpha:1}),this.erase_graphics.rect(0,0,this.dimensions.width,this.dimensions.height).fill(),this.erase_graphics.endFill(),this.app.renderer.render(this.erase_graphics,{renderTexture:this.erase_texture}))}commit_stroke(){if(!this.stroke_texture||!this.preview_sprite||!this.stroke_graphics||!this.original_layer_texture||!this.active_layer_id)return;this.preview_sprite.visible=!1;const t=this.image_editor_context.layer_manager.get_active_layer();if(!t)return;const i=this.image_editor_context.layer_manager.get_layers().find(h=>h.container===t);if(!i||i.id!==this.active_layer_id||!this.image_editor_context.layer_manager.get_layer_textures(i.id))return;const n={segments:[...this.current_stroke_segments],layer_id:this.active_layer_id},o=new xp(this.image_editor_context,n,this.original_layer_texture);this.stroke_graphics&&this.stroke_graphics.clear();const a=new ct;this.app.renderer.render(a,{renderTexture:this.stroke_texture}),a.destroy(),this.is_new_stroke=!0,this.original_layer_texture=null,this.active_layer_id=null,this.current_stroke_segments=[],this.image_editor_context.command_manager.execute(o,this.image_editor_context)}calculate_distance(t,e,i,r){return Math.sqrt(Math.pow(i-t,2)+Math.pow(r-e,2))}draw_segment(t,e,i,r,n,o,a,h){if(!this.stroke_graphics||!this.stroke_texture||!this.stroke_container||!this.preview_sprite)return;this.is_new_stroke&&!this.original_layer_texture&&this.preserve_canvas_state(),this.current_opacity=h==="draw"?Math.min(Math.max(a,0),1):.5;const l=n;if(this.is_new_stroke){this.stroke_graphics.clear(),this.current_stroke_segments=[];const u=new ct;this.app.renderer.render(u,{renderTexture:this.stroke_texture}),u.destroy(),this.is_new_stroke=!1}if(this.current_stroke_segments.push({from_x:t,from_y:e,to_x:i,to_y:r,size:l,color:o,opacity:this.current_opacity,mode:h}),h==="draw"){let u=16777215;try{o.startsWith("#")&&(u=parseInt(o.replace("#","0x"),16))}catch{u=16777215}this.stroke_graphics.setFillStyle({color:u,alpha:1})}else this.stroke_graphics.setFillStyle({color:16777215,alpha:1});const c=this.calculate_distance(t,e,i,r);if(c<.1)this.stroke_graphics.circle(t,e,l).fill();else{const u=Math.max(l/3,2),_=Math.max(Math.ceil(c/u),2);for(let d=0;d<_;d++){const f=d/(_-1),g=t+(i-t)*f,p=e+(r-e)*f;this.stroke_graphics.circle(g,p,l).fill()}}if(this.stroke_graphics.endFill(),this.app.renderer.render(this.stroke_container,{renderTexture:this.stroke_texture}),h==="draw")this.preview_sprite.texture=this.stroke_texture,this.preview_sprite.alpha=this.current_opacity,this.preview_sprite.tint=16777215;else{const u=this.image_editor_context.layer_manager.get_active_layer();if(!u)return;const d=this.image_editor_context.layer_manager.get_layers().find(C=>C.container===u);if(!d)return;const f=this.image_editor_context.layer_manager.get_layer_textures(d.id);if(!f)return;const g=Jt.create({width:this.dimensions.width,height:this.dimensions.height,resolution:window.devicePixelRatio||1}),p=new ct,y=new kt(f.draw);p.addChild(y),this.app.renderer.render(p,{renderTexture:g}),p.destroy({children:!0});const x=new ct,b=new kt(this.stroke_texture),v=new Dt;v.setFillStyle({color:16777215,alpha:.5}),v.rect(0,0,this.dimensions.width,this.dimensions.height).fill(),v.setMask({mask:b,inverse:!1}),x.addChild(v),this.app.renderer.render(x,{renderTexture:g}),this.preview_sprite.texture=g,this.preview_sprite.alpha=1,x.destroy({children:!0}),g.destroy()}this.preview_sprite.visible=!0}get_dimensions(){return this.dimensions}get textures_initialized(){return!!(this.stroke_texture&&this.display_container&&this.preview_sprite)}cleanup(){this.cleanup_textures()}}class vp{name="brush";image_editor_context;current_tool;current_subtool;state={opacity:1,brush_size:10,color:"#000000",mode:"draw"};brush_size=10;eraser_size=20;is_drawing=!1;last_x=0;last_y=0;scale=1;_bound_pointer_down=null;_bound_pointer_move=null;_bound_pointer_up=null;event_callbacks=new Map;brush_cursor=null;brush_textures=null;async setup(t,e,i){this.image_editor_context=t,this.current_tool=e,this.current_subtool=i,this.state.mode=e==="erase"?"erase":"draw",this.state.mode==="draw"?this.state.brush_size=this.brush_size:this.state.brush_size=this.eraser_size,t.scale.subscribe(r=>{this.scale=r,this.brush_cursor&&this.brush_cursor.update_state(this.state,this.scale)}),this.brush_cursor=new yp(this.image_editor_context,this.state,this.scale),this.brush_cursor.set_active(e==="draw"||e==="erase"),this.brush_textures=new bp(this.image_editor_context,t.app),this.brush_textures.initialize_textures(),this.setup_event_listeners(),this.handle_cursors(e)}handle_cursors(t){vh(this.image_editor_context.image_container.children,"none")}set_tool(t,e){if(this.current_tool=t,this.current_subtool=e,this.current_tool!=="erase"&&this.current_tool!=="draw"&&this.commit_pending_changes(),this.brush_cursor){const a=t==="draw"||t==="erase";this.brush_cursor.set_active(a)}const i=t==="erase"?"erase":"draw",r=this.state.mode!==i,n=t==="erase"||t==="draw",o=this.brush_textures?.textures_initialized??!1;n&&(r||!o)&&this.brush_textures?.initialize_textures(),this.state.mode!==i&&(this.state.mode=i,this.state.mode==="draw"?this.state.brush_size=this.brush_size:this.state.brush_size=this.eraser_size,this.brush_cursor&&this.brush_cursor.update_state(this.state,this.scale))}commit_pending_changes(){this.is_drawing&&this.on_pointer_up()}on_pointer_down(t){if(!this.image_editor_context.layer_manager.get_active_layer()?.visible||this.current_tool!=="erase"&&this.current_tool!=="draw"||this.brush_cursor&&!this.brush_cursor.is_over_image())return;this.brush_textures&&this.brush_textures.preserve_canvas_state();const i=this.image_editor_context.image_container.toLocal(t.global);this.is_drawing=!0,this.last_x=i.x,this.last_y=i.y,this.brush_textures&&this.brush_textures.draw_segment(i.x,i.y,i.x,i.y,this.state.brush_size,this.state.color,this.state.opacity,this.state.mode)}on_pointer_move(t){if(this.brush_cursor&&this.brush_cursor.update_cursor_position(t),!this.is_drawing)return;const e=this.image_editor_context.image_container.toLocal(t.global);this.brush_textures&&this.brush_textures.draw_segment(this.last_x,this.last_y,e.x,e.y,this.state.brush_size,this.state.color,this.state.opacity,this.state.mode),this.last_x=e.x,this.last_y=e.y}on_pointer_up(){this.is_drawing&&(this.is_drawing=!1,this.brush_textures&&this.brush_textures.commit_stroke(),this.notify("change"))}setup_event_listeners(){this.cleanup_event_listeners(),this._bound_pointer_down=this.on_pointer_down.bind(this),this._bound_pointer_move=this.on_pointer_move.bind(this),this._bound_pointer_up=this.on_pointer_up.bind(this);const t=this.image_editor_context.image_container;t.eventMode="static",t.interactiveChildren=!0;const e=this.image_editor_context.app.stage;e.eventMode="static",e.on("pointerdown",this._bound_pointer_down),e.on("pointermove",this._bound_pointer_move),e.on("pointerup",this._bound_pointer_up),e.on("pointerupoutside",this._bound_pointer_up),this.brush_cursor&&this.brush_cursor.setup_event_listeners()}cleanup_event_listeners(){const t=this.image_editor_context.app.stage;this._bound_pointer_down&&(t.off("pointerdown",this._bound_pointer_down),this._bound_pointer_down=null),this._bound_pointer_move&&(t.off("pointermove",this._bound_pointer_move),this._bound_pointer_move=null),this._bound_pointer_up&&(t.off("pointerup",this._bound_pointer_up),t.off("pointerupoutside",this._bound_pointer_up),this._bound_pointer_up=null),this.brush_cursor&&this.brush_cursor.cleanup_event_listeners()}set_brush_size(t){this.brush_size=t,this.state.mode==="draw"&&(this.state.brush_size=t,this.brush_cursor&&this.brush_cursor.update_state(this.state,this.scale))}set_brush_color(t){const e=le(t).toHexString();this.state.color=e,this.brush_cursor&&this.brush_cursor.update_state(this.state,this.scale)}set_brush_opacity(t){const e=Math.max(0,Math.min(1,t));this.state.opacity=e,this.brush_cursor&&this.brush_cursor.update_state(this.state,this.scale)}set_eraser_size(t){this.eraser_size=t,this.state.mode==="erase"&&(this.state.brush_size=t,this.brush_cursor&&this.brush_cursor.update_state(this.state,this.scale))}get_current_size(){return this.state.mode==="draw"?this.brush_size:this.eraser_size}preview_brush(t){this.brush_cursor&&this.brush_cursor.preview_brush(t)}cleanup(){this.commit_pending_changes(),this.cleanup_event_listeners(),this.brush_textures&&(this.brush_textures.cleanup(),this.brush_textures=null),this.brush_cursor&&(this.brush_cursor.cleanup(),this.brush_cursor=null)}on(t,e){this.event_callbacks.set(t,[...this.event_callbacks.get(t)||[],e])}off(t,e){this.event_callbacks.set(t,this.event_callbacks.get(t)?.filter(i=>i!==e)||[])}notify(t){for(const e of this.event_callbacks.get(t)||[])e()}}var wp=nt('<div class="svelte-189k4ah"><!> <!> <!></div>'),kp=nt('<li class="svelte-189k4ah"><!> <button> </button> <!></li>'),Ap=nt('<li class="add-layer svelte-189k4ah"><!></li>'),Sp=nt('<ul class="svelte-189k4ah"><!> <!></ul>'),Cp=nt('<div><button class="layer-title-button svelte-189k4ah" aria-label="Show Layers"> <span class="icon svelte-189k4ah"><!></span></button> <!></div>');function Mp(s,t){ue(t,!1);const e=()=>Bh(o(),"$layers",i),[i,r]=Fh(),n=Oe();let o=I(t,"layers",12),a=I(t,"enable_additional_layers",12,!0),h=I(t,"enable_layers",12,!0),l=I(t,"show_layers",12,!1);function c(){n("new_layer")}function u(b){n("change_layer",b),l(!1)}function _(b,v){n("move_layer",{id:b,direction:v})}function d(b){n("delete_layer",b)}var f={get layers(){return o()},set layers(b){o(b),z()},get enable_additional_layers(){return a()},set enable_additional_layers(b){a(b),z()},get enable_layers(){return h()},set enable_layers(b){h(b),z()},get show_layers(){return l()},set show_layers(b){l(b),z()}};ve();var g=ci(),p=qt(g);{var y=b=>{var v=Cp();let C;var w=it(v),k=it(w),R=$(k),S=it(R);fl(S),tt(R),tt(w);var P=$(w,2);{var B=G=>{var F=Sp(),W=it(F);Fi(W,1,()=>(e(),Rt(()=>e().layers)),Bi,(D,gt,M)=>{let T=()=>m(gt).id,st=()=>m(gt).name,N=()=>m(gt).user_created,rt=()=>m(gt).visible;var xt=kp(),K=it(xt);{var mt=et=>{ie(et,{get Icon(){return wl},size:"small",$$events:{click:lt=>{lt.stopPropagation(),n("toggle_layer_visibility",T())}}})},ot=et=>{ie(et,{get Icon(){return bl},size:"small",$$events:{click:lt=>{lt.stopPropagation(),n("toggle_layer_visibility",T())}}})};Q(K,et=>{rt()?et(ot,!1):et(mt)})}var ut=$(K,2);Ne(ut,"aria-label",`layer-${M+1}`);let O;var J=it(ut,!0);tt(ut);var Tt=$(ut,2);{var E=et=>{var lt=wp(),at=it(lt);{var ft=Ft=>{ie(Ft,{get Icon(){return qh},size:"x-small",$$events:{click:vt=>{vt.stopPropagation(),_(T(),"up")}}})};Q(at,Ft=>{M>0&&Ft(ft)})}var Et=$(at,2);{var Nt=Ft=>{ie(Ft,{get Icon(){return il},size:"x-small",$$events:{click:vt=>{vt.stopPropagation(),_(T(),"down")}}})};Q(Et,Ft=>{e(),Rt(()=>M<e().layers.length-1)&&Ft(Nt)})}var bt=$(Et,2);{var Ut=Ft=>{ie(Ft,{get Icon(){return jh},size:"x-small",$$events:{click:vt=>{vt.stopPropagation(),d(T())}}})};Q(bt,Ft=>{e(),N(),Rt(()=>e().layers.length>1&&N())&&Ft(Ut)})}tt(lt),H(et,lt)};Q(Tt,et=>{e(),Rt(()=>e().layers.length>1)&&et(E)})}tt(xt),Wt(()=>{O=re(ut,1,"svelte-189k4ah",null,O,{selected_layer:e().active_layer===T()}),Fe(J,st())}),Vt("click",ut,ps(()=>u(T()))),H(D,xt)});var q=$(W,2);{var L=D=>{var gt=Ap(),M=it(gt);ie(M,{get Icon(){return Vo},label:"Add Layer",size:"x-small",$$events:{click:T=>{T.stopPropagation(),c()}}}),tt(gt),H(D,gt)};Q(q,D=>{a()&&D(L)})}tt(F),H(G,F)};Q(P,G=>{l()&&G(B)})}tt(v),ks(v,(G,F)=>Kr?.(G,F),()=>()=>l(!1)),Wt(G=>{C=re(v,1,"layer-wrap svelte-189k4ah",null,C,{closed:!l()}),Fe(k,`${G??""} `)},[()=>(X(l()),e(),Rt(()=>l()?"Layers":e().layers.find(G=>G.id===e().active_layer)?.name))]),Vt("click",w,ps(()=>l(!l()))),H(b,v)};Q(p,b=>{h()&&b(y)})}H(s,g);var x=de(f);return r(),x}var Tp=nt('<div class="toolbar-wrap-wrap svelte-1357rcu"><div class="toolbar-wrap svelte-1357rcu"><!></div></div>');function Pp(s,t){ue(t,!1);let e=I(t,"layers",12),i=I(t,"enable_additional_layers",12,!0),r=I(t,"enable_layers",12,!0),n=I(t,"show_layers",12,!1);var o={get layers(){return e()},set layers(u){e(u),z()},get enable_additional_layers(){return i()},set enable_additional_layers(u){i(u),z()},get enable_layers(){return r()},set enable_layers(u){r(u),z()},get show_layers(){return n()},set show_layers(u){n(u),z()}},a=Tp(),h=it(a),l=it(h);{var c=u=>{Mp(u,{get layers(){return e()},get enable_additional_layers(){return i()},get enable_layers(){return r()},get show_layers(){return n()},$$events:{new_layer(_){he.call(this,t,_)},change_layer(_){he.call(this,t,_)},move_layer(_){he.call(this,t,_)},delete_layer(_){he.call(this,t,_)},toggle_layer_visibility(_){he.call(this,t,_)}}})};Q(l,u=>{r()&&u(c)})}return tt(h),tt(a),H(s,a),de(o)}var Ip=nt('<li class="svelte-o0h5ih"><button class="svelte-o0h5ih"> </button></li>'),zp=nt('<div class="zoom-controls svelte-o0h5ih"><ul class="svelte-o0h5ih"><li class="svelte-o0h5ih"><button class="svelte-o0h5ih">Fit to screen</button></li> <!></ul></div>'),Ep=nt('<!> <!> <!> <!> <div class="zoom-number svelte-o0h5ih"><span role="button" tabindex="0" class="svelte-o0h5ih"> </span> <!></div> <div class="separator svelte-o0h5ih"></div> <!> <!> <!> <!>',1);function Rp(s,t){ue(t,!1);const e=Z();let i=I(t,"can_save",12,!1),r=I(t,"changeable",12,!1),n=I(t,"current_zoom",12,1),o=I(t,"tool",12),a=I(t,"min_zoom",12,!0),h=I(t,"enable_download",12,!1),l=I(t,"can_undo",12),c=I(t,"can_redo",12);const u=Oe();let _=Z(!1);function d(y){y.stopPropagation(),U(_,!m(_))}function f(y){u("set_zoom",y),U(_,!1)}function g(y){y.key==="Enter"&&f(n())}yt(()=>X(n()),()=>{U(e,Math.round(n()*100))}),Le();var p={get can_save(){return i()},set can_save(y){i(y),z()},get changeable(){return r()},set changeable(y){r(y),z()},get current_zoom(){return n()},set current_zoom(y){n(y),z()},get tool(){return o()},set tool(y){o(y),z()},get min_zoom(){return a()},set min_zoom(y){a(y),z()},get enable_download(){return h()},set enable_download(y){h(y),z()},get can_undo(){return l()},set can_undo(y){l(y),z()},get can_redo(){return c()},set can_redo(y){c(y),z()}};return ve(),Jh(s,{children:(y,x)=>{var b=Ep(),v=qt(b);{var C=M=>{ie(M,{get Icon(){return Kh},label:"Download",$$events:{click:T=>{u("download"),T.stopPropagation()}}})};Q(v,M=>{h()&&M(C)})}var w=$(v,2);{let M=Gt(()=>o()==="pan");ie(w,{get Icon(){return gl},label:"Pan",get highlight(){return m(M)},size:"small",padded:!1,transparent:!0,get disabled(){return a()},$$events:{click:T=>{T.stopPropagation(),u("pan")}}})}var k=$(w,2);ie(k,{get Icon(){return Tl},label:"Zoom out",$$events:{click:M=>{u("zoom_out"),M.stopPropagation()}}});var R=$(k,2);ie(R,{get Icon(){return Cl},label:"Zoom in",$$events:{click:M=>{u("zoom_in"),M.stopPropagation()}}});var S=$(R,2),P=it(S),B=it(P);tt(P);var G=$(P,2);{var F=M=>{var T=zp(),st=it(T),N=it(st),rt=it(N);tt(N);var xt=$(N,2);Fi(xt,0,()=>[.25,.5,1,2,4],Bi,(K,mt)=>{var ot=Ip(),ut=it(ot),O=it(ut);tt(ut),tt(ot),Wt(()=>Fe(O,`${mt*100}%`)),Vt("click",ut,ps(()=>f(mt))),H(K,ot)}),tt(st),tt(T),Vt("click",rt,ps(()=>f("fit"))),H(M,T)};Q(G,M=>{m(_)&&M(F)})}tt(S);var W=$(S,4);{let M=Gt(()=>!l());ie(W,{get Icon(){return Qh},label:"Undo",get disabled(){return m(M)},$$events:{click:T=>{u("undo"),T.stopPropagation()}}})}var q=$(W,2);{let M=Gt(()=>!c());ie(q,{get Icon(){return yl},label:"Redo",get disabled(){return m(M)},$$events:{click:T=>{u("redo"),T.stopPropagation()}}})}var L=$(q,2);{var D=M=>{{let T=Gt(()=>!i());ie(M,{get disabled(){return m(T)},get Icon(){return Xo},label:"Save changes",color:"var(--color-accent)",$$events:{click:st=>{u("save"),st.stopPropagation()}}})}};Q(L,M=>{r()&&M(D)})}var gt=$(L,2);ie(gt,{get Icon(){return Zh},label:"Clear canvas",$$events:{click:M=>{u("remove_image"),M.stopPropagation()}}}),Wt(()=>Fe(B,`${m(e)??""}%`)),Vt("click",P,d),Vt("keydown",P,g),H(y,b)},$$slots:{default:!0}}),de(p)}var Fp=nt('<div class="modal svelte-6fnl1z"><div class="modal-inner svelte-6fnl1z"><!></div></div>'),Bp=nt("<!> <!> <!> <!>",1),Lp=nt('<div class="crop-confirm-button svelte-6fnl1z"><!></div>'),Op=nt('<div data-testid="image" aria-dropeffect="copy"><!> <div></div> <div></div> <!> <!></div>');function Gp(s,t){ue(t,!1);const e=Z(),{drag:i,open_file_upload:r}=$h(),n=Oe(),o=!0;let a=I(t,"changeable",12,!1),h=I(t,"sources",28,()=>["upload","webcam","clipboard"]),l=I(t,"transforms",28,()=>["crop","resize"]),c=I(t,"canvas_size",12),u=I(t,"is_dragging",12,!1),_=I(t,"background_image",12,!1),d=I(t,"brush_options",12),f=I(t,"eraser_options",12),g=I(t,"fixed_canvas",12,!1),p=I(t,"root",12),y=I(t,"i18n",12),x=I(t,"upload",12),b=I(t,"composite",12),v=I(t,"layers",12),C=I(t,"background",12),w=I(t,"border_region",12,0),k=I(t,"layer_options",12),R=I(t,"current_tool",12),S=I(t,"webcam_options",12),P=I(t,"show_download_button",12,!1),B=I(t,"theme_mode",12),G=I(t,"full_history",12,null),F=Z(),W=Z();function q(){!m(T)||!m(ut)||(m(T).set_tool(R()),m(T).set_subtool(m(At)))}function L(A){!m(T)||!m(ut)||(A.layers.length>0&&!A.active_layer&&m(T).set_layer(A.layers[0].id),R()&&(m(T).set_tool(R()),m(At)&&m(T).set_subtool(m(At))),m(K)&&(R()==="draw"||R()==="erase")&&m(K).set_tool(R(),m(At)))}function D(){return k()&&m(T)&&m(ut)}let gt=I(t,"has_drawn",12,!1);async function M(){return m(T)?!_()&&!gt()&&!v().length?{background:null,layers:[],composite:null}:await m(T).get_blobs():{background:null,layers:[],composite:null}}let T=Z();function st(A){m(T).add_image({image:A})}let N;async function rt(A){if(!m(T)||!A||!D())return;let Y;if(typeof A=="string")Y=A;else if(A?.meta?._type==="gradio.FileData"&&A?.url)Y=A.url;else{console.warn("Invalid source provided to add_image_from_url:",A);return}try{N=m(T).add_image_from_url(Y);let Yt=et.add_image_from_url(Y);await Promise.all([N,Yt]),et.set_tool("image"),et.set_subtool("crop"),_(!0),m(mt).set_zoom("fit"),n("upload"),n("input")}catch(Yt){console.error("Error adding image from URL:",Yt)}}async function xt(A){if(!(!m(T)||!A.length||!D())&&Array.isArray(A)&&A.every(Y=>Y?.meta?._type==="gradio.FileData"))try{await N,await m(T).add_layers_from_url(A.map(Y=>Y.url)),n("change"),n("input")}catch(Y){console.error("Error adding layer from URL:",Y)}}let K=Z(),mt=Z(),ot=Z(1),ut=Z(!1),O=Z(!0),J={width:0,height:0};async function Tt(){if(!m(T)||!m(ut)||!m(mt))return;if(await xr(),m(F).offsetParent!==null){const Y=m(F).getBoundingClientRect();(Y.width!==J.width||Y.height!==J.height)&&(m(mt).set_zoom("fit"),J={width:Y.width,height:Y.height})}}Uo(()=>{let A,Y;return Et().then(()=>{A=new IntersectionObserver(()=>{Tt()}),Y=new ResizeObserver(()=>{Tt()}),A.observe(m(F)),Y.observe(m(F)),setTimeout(()=>{G()&&m(T)&&m(T).command_manager.replay(G(),m(T).context).then(()=>{E()})},0)}),typeof window<"u"&&(window.editor=m(T)),()=>{A&&A.disconnect(),Y&&Y.disconnect(),m(T)&&m(T).destroy()}});function E(){if(!m(T)||!m(ut))return;const A=Ue(m(T).layers);A.layers.length>0&&!A.active_layer&&m(T).set_layer(A.layers[0].id),R()&&(m(T).set_tool(R()),m(At)&&m(T).set_subtool(m(At))),m(K)&&(R()==="draw"||R()==="erase")&&m(K).set_tool(R(),m(At)),G(m(T).command_manager.history)}let et,lt=Z(),at=I(t,"can_undo",12,!1),ft=Z(!1);async function Et(){U(K,new vp),U(mt,new qr),U(T,new jr({target_element:m(F),width:c()[0],height:c()[1],tools:["image",m(mt),new pp,m(K)],fixed_canvas:g(),border_region:w(),layer_options:k(),theme_mode:B()})),m(K).on("change",()=>{gt(!0)}),U(lt,new qr),et=new jr({target_element:m(W),width:c()[0],height:c()[1],tools:["image",m(lt),new _p],dark:!0,fixed_canvas:!1,border_region:0,pad_bottom:40}),m(T).scale.subscribe(A=>{U(ot,A)}),m(T).min_zoom.subscribe(A=>{U(O,A)}),m(T).dimensions.subscribe(A=>{J={...A}}),m(T).command_manager.current_history.subscribe(A=>{at(A.previous!==null),U(ft,A.next!==null)}),await Promise.all([m(T).ready,et.ready]).then(()=>{bt({tool:"image"}),U(ut,!0),h().length>0?bt({tool:"image"}):bt({tool:"draw"}),et.set_subtool("crop")}),m(T).on("change",()=>{n("change"),n("input"),G(m(T).command_manager.history)}),C()||v().length>0?(C()&&await rt(C()),v().length>0&&await xt(v()),bt({tool:"draw"})):b()&&(await rt(b()),bt({tool:"draw"})),q()}async function Nt(A){if(A==null||!h().includes("upload"))return;m(T).reset_canvas();const Y=Array.isArray(A)?A[0]:A;await m(T).add_image({image:Y}),await et.add_image({image:Y}),et.reset(),_(!0),m(mt).set_zoom("fit"),bt({tool:"draw"}),n("upload")}function bt({tool:A}){m(T).set_tool(A),R(A),A==="image"&&(et.set_tool("image"),et.set_subtool("crop"))}function Ut({tool:A,subtool:Y}){m(T).set_subtool(Y),U(At,Y),Y!==null&&(A==="draw"&&(Y==="size"?U(Wi,!0):Y==="color"&&U(Hi,!0)),A==="erase"&&Y==="size"&&U(Ft,!0),A==="image"&&Y==="paste"&&Is(),A==="image"&&Y==="upload"&&xr().then(()=>{U(e,!1),r()}))}let Ft=Z(!1),vt=Z(),ee=Z(),Zt=Z(1),Xt=Z();function Ge(){const A=d().default_color==="auto"?d().colors[0]:d().default_color;if(Array.isArray(A))U(vt,A[0]),U(Zt,A[1]);else{U(vt,A);const Y=le(A);Y.getAlpha()<1?U(Zt,Y.getAlpha()):U(Zt,1)}U(ee,typeof d().default_size=="number"?d().default_size:25)}function Ps(){U(Xt,f().default_size==="auto"?25:f().default_size)}let Wi=Z(!1),Hi=Z(!1),At=Z(null),Ce=Z(!1);function Vi(A){m(mt).set_zoom(A)}function Xi(A){m(mt).set_zoom(A==="in"?m(ot)+(m(ot)<1?.1:m(ot)*.1):m(ot)-(m(ot)<1?.1:m(ot)*.1))}async function Is(){const A=await navigator.clipboard.read();for(let Y=0;Y<A.length;Y++){const Yt=A[Y].types.find(Pe=>Pe.startsWith("image/"));if(Yt){const Pe=await A[Y].getType(Yt);Nt(Pe)}}}function zs(A){A.detail!==null&&Nt(A.detail),Ut({tool:R(),subtool:null})}function Me(){n("save")}async function Te(){const{image:A}=await et.get_crop_bounds();A&&(await m(T).add_image({image:A,resize:!1}),Ut({tool:"image",subtool:null}),n("change"),n("input"))}async function yi(){const Y=(await m(T).get_blobs()).composite;if(!Y){n("download_error","Unable to generate image to download.");return}const Yt=URL.createObjectURL(Y),Pe=document.createElement("a");Pe.href=Yt,Pe.download="image.png",Pe.click(),URL.revokeObjectURL(Yt)}function wh(){m(T).undo()}function kh(){m(T).redo()}let Es=Z(C());yt(()=>(X(k()),m(T)),()=>{k()&&D()&&(m(T).set_layer_options(k()),q())}),yt(()=>(m(T),m(ut),Ue),()=>{if(m(T)&&m(ut)&&m(T).layers){const A=Ue(m(T).layers);A.layers.length>0&&!A.active_layer&&L(A)}}),yt(()=>(X(C()),X(v()),X(b()),m(T),m(ut),m(mt)),()=>{C()==null&&v().length==0&&b()==null&&m(T)&&m(ut)&&(m(T).reset_canvas(),m(mt).set_zoom("fit"),bt({tool:"image"}),_(!1),gt(!1))}),yt(()=>(m(Es),X(C())),()=>{m(Es)!==C()&&(bt({tool:"draw"}),Ut({tool:"draw",subtool:null}),R("draw"),U(Es,C()))}),yt(()=>(X(R()),m(At),m(lt)),()=>{R()==="image"&&m(At)==="crop"&&m(lt).set_zoom("fit")}),yt(()=>(X(at()),m(T)),()=>{_(at()&&m(T).command_manager.contains("AddImage"))}),yt(()=>(X(d()),X(f())),()=>{d()&&Ge(),f()&&Ps()}),yt(()=>(m(K),m(vt),X(d())),()=>{m(K)?.set_brush_color((()=>{let A;if(m(vt)==="auto"){const Y=d().colors.find(Yt=>Array.isArray(Yt)?Yt[0]===d().default_color:Yt===d().default_color)||d().colors[0];A=Array.isArray(Y)?Y[0]:Y}else A=m(vt);return A})())}),yt(()=>(m(K),m(ee)),()=>{m(K)?.set_brush_size(typeof m(ee)=="number"?m(ee):25)}),yt(()=>(m(K),m(Xt)),()=>{m(K)?.set_eraser_size(typeof m(Xt)=="number"?m(Xt):25)}),yt(()=>(X(R()),X(_()),m(At),X(h())),()=>{U(e,R()!=="image"||R()==="image"&&_()||R()==="image"&&m(At)==="webcam"||!h().includes("upload"))}),yt(()=>(m(K),m(Ce)),()=>{m(K)?.preview_brush(m(Ce))}),yt(()=>(m(K),m(Zt)),()=>{m(K)?.set_brush_opacity(m(Zt))}),yt(()=>(X(b()),X(C())),()=>{rt(b()||C())}),yt(()=>X(v()),()=>{xt(v())}),Le();var Ah={antialias:o,get_blobs:M,add_image:st,add_image_from_url:rt,add_layers_from_url:xt,get changeable(){return a()},set changeable(A){a(A),z()},get sources(){return h()},set sources(A){h(A),z()},get transforms(){return l()},set transforms(A){l(A),z()},get canvas_size(){return c()},set canvas_size(A){c(A),z()},get is_dragging(){return u()},set is_dragging(A){u(A),z()},get background_image(){return _()},set background_image(A){_(A),z()},get brush_options(){return d()},set brush_options(A){d(A),z()},get eraser_options(){return f()},set eraser_options(A){f(A),z()},get fixed_canvas(){return g()},set fixed_canvas(A){g(A),z()},get root(){return p()},set root(A){p(A),z()},get i18n(){return y()},set i18n(A){y(A),z()},get upload(){return x()},set upload(A){x(A),z()},get composite(){return b()},set composite(A){b(A),z()},get layers(){return v()},set layers(A){v(A),z()},get background(){return C()},set background(A){C(A),z()},get border_region(){return w()},set border_region(A){w(A),z()},get layer_options(){return k()},set layer_options(A){k(A),z()},get current_tool(){return R()},set current_tool(A){R(A),z()},get webcam_options(){return S()},set webcam_options(A){S(A),z()},get show_download_button(){return P()},set show_download_button(A){P(A),z()},get theme_mode(){return B()},set theme_mode(A){B(A),z()},get full_history(){return G()},set full_history(A){G(A),z()},get has_drawn(){return gt()},set has_drawn(A){gt(A),z()},get can_undo(){return at()},set can_undo(A){at(A),z()}};ve();var ei=Op();let cn;Ne(ei,"aria-label","Click to upload or drop files");var un=it(ei);{var Sh=A=>{var Y=Bp(),Yt=qt(Y);{var Pe=Qt=>{Rp(Qt,{get changeable(){return a()},get min_zoom(){return m(O)},get current_zoom(){return m(ot)},get tool(){return R()},can_save:!0,get enable_download(){return P()},get can_undo(){return at()},get can_redo(){return m(ft)},$$events:{set_zoom:St=>Vi(St.detail),zoom_in:()=>Xi("in"),zoom_out:()=>Xi("out"),remove_image:()=>{n("clear"),m(T).reset_canvas(),bt({tool:"image"}),_(!1),gt(!1)},save:Me,pan:St=>{bt({tool:"pan"})},download:()=>yi(),undo:wh,redo:kh}})};Q(Yt,Qt=>{m(At)!=="crop"&&Qt(Pe)})}var pn=$(Yt,2);{var Th=Qt=>{Xf(Qt,{get sources(){return h()},get transforms(){return l()},get background(){return _()},get show_brush_size(){return m(Wi)},get show_brush_color(){return m(Hi)},get show_eraser_size(){return m(Ft)},get brush_options(){return d()},get eraser_options(){return f()},get tool(){return R()},get subtool(){return m(At)},get selected_color(){return m(vt)},set selected_color(St){U(vt,St)},get selected_size(){return m(ee)},set selected_size(St){U(ee,St)},get selected_eraser_size(){return m(Xt)},set selected_eraser_size(St){U(Xt,St)},get selected_opacity(){return m(Zt)},set selected_opacity(St){U(Zt,St)},get preview(){return m(Ce)},set preview(St){U(Ce,St)},$$events:{tool_change:St=>bt(St.detail),subtool_change:St=>Ut(St.detail)},$$legacy:!0})};Q(pn,Qt=>{m(At)!=="crop"&&Qt(Th)})}var gn=$(pn,2);{var Ph=Qt=>{var St=Fp(),mn=it(St),Eh=it(mn);Uh(Eh,{get upload(){return x()},get root(){return p()},streaming:!1,mode:"image",include_audio:!1,get i18n(){return y()},get mirror_webcam(){return X(S()),Rt(()=>S().mirror)},get webcam_constraints(){return X(S()),Rt(()=>S().constraints)},$$events:{capture:zs,error(Bs){he.call(this,t,Bs)},drag(Bs){he.call(this,t,Bs)}}}),tt(mn),tt(St),H(Qt,St)};Q(gn,Qt=>{R()==="image"&&m(At)==="webcam"&&Qt(Ph)})}var Ih=$(gn,2);{var zh=Qt=>{Pp(Qt,{get enable_additional_layers(){return X(k()),Rt(()=>k().allow_additional_layers)},get layers(){return m(T),Rt(()=>m(T).layers)},$$events:{new_layer:()=>{m(T).add_layer()},change_layer:St=>{m(T).set_layer(St.detail),R()==="draw"&&bt({tool:"draw"})},move_layer:St=>{m(T).move_layer(St.detail.id,St.detail.direction)},delete_layer:St=>{m(T).delete_layer(St.detail)},toggle_layer_visibility:St=>{m(T).toggle_layer_visibility(St.detail)}}})};Q(Ih,Qt=>{m(At),X(k()),Rt(()=>m(At)!=="crop"&&!k().disabled)&&Qt(zh)})}H(A,Y)};Q(un,A=>{m(ut)&&A(Sh)})}var Rs=$(un,2);let dn;Qe(Rs,A=>U(F,A),()=>m(F));var Fs=$(Rs,2);let _n;Qe(Fs,A=>U(W,A),()=>m(W));var fn=$(Fs,2);{var Ch=A=>{var Y=Lp(),Yt=it(Y);ae(Yt,{get Icon(){return Xo},label:"Confirm crop",show_label:!0,size:"large",padded:!0,color:"white",background:"var(--color-green-500)",label_position:"right",$$events:{click:Te}}),tt(Y),H(A,Y)};Q(fn,A=>{m(At)==="crop"&&A(Ch)})}var Mh=$(fn,2);return Lh(Mh,t,"default",{},null),tt(ei),ks(ei,(A,Y)=>i?.(A,Y),()=>({on_drag_change:A=>u(A),on_files:Nt,accepted_types:"image/*",disable_click:m(e)})),Wt(()=>{cn=re(ei,1,"image-container svelte-6fnl1z",null,cn,{"dark-bg":m(At)==="crop"}),dn=re(Rs,1,"pixi-target svelte-6fnl1z",null,dn,{visible:m(At)!=="crop"}),_n=re(Fs,1,"pixi-target-crop svelte-6fnl1z",null,_n,{visible:m(At)==="crop"})}),H(s,ei),si(t,"antialias",o),si(t,"get_blobs",M),si(t,"add_image",st),si(t,"add_image_from_url",rt),si(t,"add_layers_from_url",xt),de(Ah)}const Dp=/^(#\s*)(.+)$/m;function Go(s){const t=s.trim(),e=t.match(Dp);if(!e)return[!1,t||!1];const[i,,r]=e,n=r.trim();if(t===i)return[n,!1];const o=e.index!==void 0?e.index+i.length:0,h=t.substring(o).trim()||!1;return[n,h]}var Np=nt('<h2 class="svelte-b4yllx"> </h2>'),Up=nt('<p class="svelte-b4yllx"> </p>'),Wp=nt("<!> <!>",1),Hp=nt("<div>Upload an image</div>"),Vp=nt('<div class="or svelte-b4yllx">or</div>'),Xp=nt("<div>select the draw tool to start</div>"),Yp=nt('<div class="empty wrap svelte-b4yllx"><!> <!> <!></div>'),$p=nt("<!> <!>",1);function qp(s,t){ue(t,!1);const e=Z(),i=Z();let r=I(t,"brush",12),n=I(t,"eraser",12),o=I(t,"sources",12),a=I(t,"i18n",12),h=I(t,"root",12),l=I(t,"label",12,void 0),c=I(t,"show_label",12),u=I(t,"changeable",12,!1),_=I(t,"theme_mode",12),d=I(t,"layers",12),f=I(t,"composite",12),g=I(t,"background",12),p=I(t,"layer_options",12),y=I(t,"transforms",12),x=I(t,"accept_blobs",12),b=I(t,"canvas_size",12),v=I(t,"fixed_canvas",12,!1),C=I(t,"realtime",12),w=I(t,"upload",12),k=I(t,"is_dragging",12),R=I(t,"placeholder",12,void 0),S=I(t,"border_region",12),P=I(t,"full_history",12,null),B=I(t,"webcam_options",12),G=I(t,"show_download_button",12,!1);const F=Oe();let W=Z(),q=Z(!1);function L(E){return!!E}function D(E){return!!E}async function gt(){let E;try{E=await m(W).get_blobs()}catch{return{background:null,layers:[],composite:null}}const et=E.background?w()(await Ls([new File([E.background],"background.png")]),h()):Promise.resolve(null),lt=E.layers.filter(L).map(async(bt,Ut)=>w()(await Ls([new File([bt],`layer_${Ut}.png`)]),h())),at=E.composite?w()(await Ls([new File([E.composite],"composite.png")]),h()):Promise.resolve(null),[ft,Et,...Nt]=await Promise.all([et,at,...lt]);return{background:Array.isArray(ft)?ft[0]:ft,layers:Nt.flatMap(bt=>Array.isArray(bt)?bt:[bt]).filter(D),composite:Array.isArray(Et)?Et[0]:Et}}function M(E){m(W)&&E==null&&(m(W).handle_remove(),F("receive_null"))}let T=Z(!1),st=Z(),N=I(t,"image_id",12,null);function rt(){return new Promise(E=>setTimeout(()=>E(),30))}let xt=!1,K=!1;async function mt(E){if(!C())return;if(xt){K=!0;return}xt=!0,await rt();const et=await m(W).get_blobs(),lt=[];let at=Math.random().toString(36).substring(2);et.background&&lt.push([at,"background",new File([et.background],"background.png"),null]),et.composite&&lt.push([at,"composite",new File([et.composite],"composite.png"),null]),et.layers.forEach((ft,Et)=>{ft&&lt.push([at,"layer",new File([ft],`layer_${Et}.png`),Et])}),await Promise.all(lt.map(async([ft,Et,Nt,bt])=>x()({binary:!0,data:{file:Nt,id:ft,type:Et,index:bt}}))),N(at),F("change"),await rt(),xt=!1,K&&(K=!1,xt=!1,mt())}let ot=Z();yt(()=>m(T),()=>{m(T)&&F("upload")}),yt(()=>(X(d()),X(f()),X(g())),()=>{M({layers:d(),composite:f(),background:g()})}),yt(()=>(m(e),m(i),X(R()),Go),()=>{(E=>{var et=Wo(E,2);U(e,et[0]),U(i,et[1])})(R()?Go(R()):[!1,!1])}),Le();var ut={get_data:gt,get brush(){return r()},set brush(E){r(E),z()},get eraser(){return n()},set eraser(E){n(E),z()},get sources(){return o()},set sources(E){o(E),z()},get i18n(){return a()},set i18n(E){a(E),z()},get root(){return h()},set root(E){h(E),z()},get label(){return l()},set label(E){l(E),z()},get show_label(){return c()},set show_label(E){c(E),z()},get changeable(){return u()},set changeable(E){u(E),z()},get theme_mode(){return _()},set theme_mode(E){_(E),z()},get layers(){return d()},set layers(E){d(E),z()},get composite(){return f()},set composite(E){f(E),z()},get background(){return g()},set background(E){g(E),z()},get layer_options(){return p()},set layer_options(E){p(E),z()},get transforms(){return y()},set transforms(E){y(E),z()},get accept_blobs(){return x()},set accept_blobs(E){x(E),z()},get canvas_size(){return b()},set canvas_size(E){b(E),z()},get fixed_canvas(){return v()},set fixed_canvas(E){v(E),z()},get realtime(){return C()},set realtime(E){C(E),z()},get upload(){return w()},set upload(E){w(E),z()},get is_dragging(){return k()},set is_dragging(E){k(E),z()},get placeholder(){return R()},set placeholder(E){R(E),z()},get border_region(){return S()},set border_region(E){S(E),z()},get full_history(){return P()},set full_history(E){P(E),z()},get webcam_options(){return B()},set webcam_options(E){B(E),z()},get show_download_button(){return G()},set show_download_button(E){G(E),z()},get image_id(){return N()},set image_id(E){N(E),z()}};ve();var O=$p(),J=qt(O);{let E=Gt(()=>(X(l()),X(a()),Rt(()=>l()||a()("image.image"))));tl(J,{get show_label(){return c()},get Icon(){return Ho},get label(){return m(E)}})}var Tt=$(J,2);return Qe(Gp(Tt,{get transforms(){return y()},get composite(){return f()},get layers(){return d()},get background(){return g()},get canvas_size(){return b()},get changeable(){return u()},get sources(){return o()},get brush_options(){return r()},get eraser_options(){return n()},get fixed_canvas(){return v()},get border_region(){return S()},get layer_options(){return p()},get i18n(){return a()},get root(){return h()},get upload(){return w()},get webcam_options(){return B()},get show_download_button(){return G()},get theme_mode(){return _()},get background_image(){return m(T)},set background_image(E){U(T,E)},get current_tool(){return m(ot)},set current_tool(E){U(ot,E)},get is_dragging(){return k()},set is_dragging(E){k(E)},get has_drawn(){return m(q)},set has_drawn(E){U(q,E)},get can_undo(){return m(st)},set can_undo(E){U(st,E)},get full_history(){return P()},set full_history(E){P(E)},$$events:{history(E){he.call(this,t,E)},save(E){he.call(this,t,E)},input(E){he.call(this,t,E)},change:mt,clear:()=>F("clear"),download_error(E){he.call(this,t,E)}},children:(E,et)=>{var lt=ci(),at=qt(lt);{var ft=Et=>{var Nt=Yp(),bt=it(Nt);{var Ut=Xt=>{var Ge=ci(),Ps=qt(Ge);{var Wi=At=>{var Ce=Wp(),Vi=qt(Ce);{var Xi=Me=>{var Te=Np(),yi=it(Te,!0);tt(Te),Wt(()=>Fe(yi,m(e))),H(Me,Te)};Q(Vi,Me=>{m(e)&&Me(Xi)})}var Is=$(Vi,2);{var zs=Me=>{var Te=Up(),yi=it(Te,!0);tt(Te),Wt(()=>Fe(yi,m(i))),H(Me,Te)};Q(Is,Me=>{m(i)&&Me(zs)})}H(At,Ce)},Hi=At=>{var Ce=Hp();H(At,Ce)};Q(Ps,At=>{m(e)||m(i)?At(Wi):At(Hi,!1)})}H(Xt,Ge)};Q(bt,Xt=>{X(o()),Rt(()=>o()&&o().length)&&Xt(Ut)})}var Ft=$(bt,2);{var vt=Xt=>{var Ge=Vp();H(Xt,Ge)};Q(Ft,Xt=>{X(o()),X(r()),X(R()),Rt(()=>o()&&o().length&&r()&&!R())&&Xt(vt)})}var ee=$(Ft,2);{var Zt=Xt=>{var Ge=Xp();H(Xt,Ge)};Q(ee,Xt=>{r()&&!R()&&Xt(Zt)})}tt(Nt),H(Et,Nt)};Q(at,Et=>{m(ot)==="image"&&!m(st)&&Et(ft)})}H(E,lt)},$$slots:{default:!0},$$legacy:!0}),E=>U(W,E),()=>m(W)),H(s,O),si(t,"get_data",gt),de(ut)}var jp=nt("<!> <!>",1),Kp=nt("<!> <!>",1);function Zp(s,t){ue(t,!0);let e=Oh(t,["$$slots","$$events","$$legacy"]);class i extends Dh{async get_data(){const C=await super.get_data(),w=await l();return{...C,value:w}}}const r=new i(e,{server:{accept_blobs:()=>{}},buttons:[],height:350,border_region:0});let n,o=Gh(null),a=!1,h=!1;async function l(){if(m(o)){const C={id:m(o)};return U(o,null),C}return await n.get_data()}let c;function u(){r.dispatch("apply")}let _=_e(()=>r.props.value?.background||r.props.value?.layers?.length||r.props.value?.composite),d=_e(()=>r.props.value?.background?new Os(r.props.value.background):null),f=_e(()=>r.props.value?.composite?new Os(r.props.value.composite):null),g=_e(()=>r.props.value?.layers?.map(v=>new Os(v))||[]);var p=ci(),y=qt(p);{var x=v=>{{let C=_e(()=>c?"focus":"base");bn(v,{get visible(){return r.shared.visible},variant:"solid",get border_mode(){return m(C)},padding:!1,get elem_id(){return r.shared.elem_id},get elem_classes(){return r.shared.elem_classes},get height(){return r.props.height},get width(){return r.props.width},allow_overflow:!0,overflow_behavior:"visible",get container(){return r.shared.container},get scale(){return r.shared.scale},get min_width(){return r.shared.min_width},children:(w,k)=>{var R=jp(),S=qt(R);vn(S,yn({get autoscroll(){return r.shared.autoscroll},get i18n(){return r.i18n}},()=>r.shared.loading_status,{on_clear_status:()=>r.dispatch("clear_status",r.shared.loading_status)}));var P=$(S,2);{let B=_e(()=>r.props.value?.composite||null);Nh(P,{get value(){return m(B)},get label(){return r.shared.label},get show_label(){return r.shared.show_label},get buttons(){return r.props.buttons},get selectable(){return r.props._selectable},get i18n(){return r.i18n},$$events:{select:({detail:G})=>r.dispatch("select",G),share:({detail:G})=>r.dispatch("share",G),error:({detail:G})=>r.dispatch("error",G)}})}H(w,R)},$$slots:{default:!0}})}},b=v=>{{let C=_e(()=>m(_)?"solid":"dashed"),w=_e(()=>c?"focus":"base");bn(v,{get visible(){return r.shared.visible},get variant(){return m(C)},get border_mode(){return m(w)},padding:!1,get elem_id(){return r.shared.elem_id},get elem_classes(){return r.shared.elem_classes},get height(){return r.props.height},get width(){return r.props.width},allow_overflow:!0,overflow_behavior:"visible",get container(){return r.shared.container},get scale(){return r.shared.scale},get min_width(){return r.shared.min_width},children:(k,R)=>{var S=Kp(),P=qt(S);vn(P,yn({get autoscroll(){return r.shared.autoscroll},get i18n(){return r.i18n}},()=>r.shared.loading_status,{on_clear_status:()=>r.dispatch("clear_status",r.shared.loading_status)}));var B=$(P,2);{let G=_e(()=>r.shared.attached_events.includes("apply")),F=_e(()=>r.shared.attached_events.includes("change")||r.shared.attached_events.includes("input")),W=_e(()=>r.props.buttons===null?!0:r.props.buttons.includes("download"));Qe(qp(B,{get border_region(){return r.props.border_region},get canvas_size(){return r.props.canvas_size},get layers(){return m(g)},get composite(){return m(f)},get background(){return m(d)},get root(){return r.shared.root},get sources(){return r.props.sources},get label(){return r.shared.label},get show_label(){return r.shared.show_label},get fixed_canvas(){return r.props.fixed_canvas},get brush(){return r.props.brush},get eraser(){return r.props.eraser},get changeable(){return m(G)},get realtime(){return m(F)},get i18n(){return r.i18n},get transforms(){return r.props.transforms},get accept_blobs(){return r.shared.server.accept_blobs},get layer_options(){return r.props.layers},upload:(...q)=>r.shared.client.upload(...q),get placeholder(){return r.props.placeholder},get webcam_options(){return r.props.webcam_options},get show_download_button(){return m(W)},get theme_mode(){return r.shared.theme_mode},get is_dragging(){return c},set is_dragging(q){c=q},get image_id(){return m(o)},set image_id(q){U(o,q,!0)},$$events:{input:()=>{h?r.dispatch("input"):h=!0},save:q=>u(),edit:()=>r.dispatch("edit"),clear:()=>r.dispatch("clear"),drag:({detail:q})=>c=q,upload:()=>r.dispatch("upload"),share:({detail:q})=>r.dispatch("share",q),error:[({detail:q})=>{r.shared.loading_status=r.shared.loading_status||{},r.shared.loading_status.status="error",r.dispatch("error",q)},function(q){he.call(this,t,q)}],receive_null:()=>r.props.value={background:null,layers:[],composite:null},change:()=>{a?r.dispatch("change"):a=!0},download_error:q=>r.dispatch("error",q.detail)}}),q=>n=q,()=>n)}H(k,S)},$$slots:{default:!0}})}};Q(y,v=>{r.shared.interactive?v(b,!1):v(x)})}H(s,p),de()}const Lg=Object.freeze(Object.defineProperty({__proto__:null,default:Zp},Symbol.toStringTag,{value:"Module"}));export{ys as $,Da as A,se as B,ct as C,zt as D,j as E,Er as F,We as G,be as H,di as I,Gn as J,kt as K,Yc as L,pt as M,su as N,Ui as O,dt as P,Ot as Q,Pr as R,eu as S,Qi as T,Sr as U,Mt as V,vu as W,Nn as X,qs as Y,Un as Z,Sc as _,we as a,Ht as a0,kc as a1,na as a2,Jt as a3,Na as a4,ht as a5,wt as a6,Cu as a7,Ku as a8,Hu as a9,pd as aa,md as ab,wd as ac,Ad as ad,Sd as ae,ms as af,us as ag,Or as ah,Mo as ai,eh as aj,io as ak,to as al,Po as am,M_ as an,Pt as ao,Dt as ap,Yl as aq,ws as ar,rh as as,Lg as at,Nu as b,Di as c,cs as d,jt as e,eo as f,Ou as g,Jr as h,La as i,ga as j,me as k,Pa as l,Wr as m,fd as n,gd as o,bd as p,kd as q,oc as r,Ss as s,_t as t,Xl as u,_i as v,It as w,Md as x,ge as y,ia as z};
